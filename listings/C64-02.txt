basic......PAGE 0001

LINE# LOC   CODE        LINE


00001  0000              .LIB   DISCLAIMER
00002  0000              ;****************************************
00003  0000              ;*                                      *
00004  0000              ;* BBBBB   AAAA   SSS  IIII  CCCC       *
00005  0000              ;* BB  BB AA  AA SS  S  II  CC   C      *
00006  0000              ;* BB  BB AA  AA  SS    II  CC          *
00007  0000              ;* BBBBB  AAAAAA   SS   II  CC          *
00008  0000              ;* BB  BB AA  AA    SS  II  CC          *
00009  0000              ;* BB  BB AA  AA S  SS  II  CC   C      *
00010  0000              ;* BBBBB  AA  AA  SSS  IIII  CCCC       *
00011  0000              ;*                                      *
00012  0000              ;****************************************
00013  0000              ;
00014  0000              ;****************************************
00015  0000              ;*                                      *
00016  0000              ;* PET BASIC VERSION 2.2                *
00017  0000              ;*      THIS VERSION OF PET BASIC IS    *
00018  0000              ;* DESIGNED TO FUNCTION WITH THE KERNAL *
00019  0000              ;* PROVIDED IN THE FOLOWING MACHINES:   *
00020  0000              ;*      2001-4/8 (B/N)                  *
00021  0000              ;*      4016/4032                       *
00022  0000              ;*      8032                            *
00023  0000              ;*      TOY                             *
00024  0000              ;*      VIC-20/VIC-40                   *
00025  0000              ;*    * COMMODORE 10/16/64              *
00026  0000              ;*      MAX                             *
00027  0000              ;* COPYRIGHT (C) 1982 BY                *
00028  0000              ;* COMMODORE BUSINESS MACHINES          *
00029  0000              ;*                                      *
00030  0000              ;****************************************



00032  0000              ;*****LISTING DATE -1200 10 APRIL 1982***



00034  0000              ;****************************************
00035  0000              ;* THIS SOFTWARE IS FURNISHED FOR USE IN*
00036  0000              ;* THE ABOVE LISTED MACHINES ONLY.      *
00037  0000              ;*                                      *
00038  0000              ;* COPIES THEREOF MAY NOT BE PROVIDED   *
00039  0000              ;* OR MADE AVAILABLE FOR USE ON ANY     *
00040  0000              ;* SYSTEM.                              *
00041  0000              ;*                                      *
00042  0000              ;* THE INFORMATION IN THIS DOCUMENT IS  *
00043  0000              ;* SUBJECT TO CHANGE WITHOUT NOTICE.    *
00044  0000              ;*                                      *
00045  0000              ;* NO RESPONSIBILITY IS ASSUMED FOR     *
00046  0000              ;* RELIABILITY OF THIS SOFTWARE.  RSR   *
00047  0000              ;*                                      *
00048  0000              ;****************************************
00049  0000              .END
00050  0000              .LIB   DECLARE







DECLARATIONS......PAGE 0002

LINE# LOC   CODE        LINE


00052  0000              ADDPRC =1
00053  0000              ROMLOC =$A000          ;VIC-40 BASIC ROM
00054  0000              LINLEN =40             ;VIC SCREEN SIZE ?WHY?
00055  0000              BUFLEN =89             ;VIC BUFFER
00056  0000              BUFPAG =2
00057  0000              BUF    =512
00058  0000              STKEND =507
00059  0000              CLMWID =10             ;PRINT WINDOW 10 CHARS
00060  0000              PI     =255
00061  0000              NUMLEV =23
00062  0000              STRSIZ =3
00063  0000              BLANK0 *=*+3           ;6510 REGISTER AREA
00064  0003              ADRAY1 *=*+2           ;CONVERT FLOAT->INTEGER
00065  0005              ADRAY2 *=*+2           ;CONVERT INTEGER->FLOAT
00066  0007              INTEGR
00067  0007              CHARAC *=*+1
00068  0008              ENDCHR *=*+1
00069  0009              TRMPOS *=*+1
00070  000A              VERCK  *=*+1
00071  000B              COUNT  *=*+1
00072  000C              DIMFLG *=*+1
00073  000D              VALTYP *=*+1
00074  000E              INTFLG *=*+1
00075  000F              GARBFL
00076  000F              DORES  *=*+1
00077  0010              SUBFLG *=*+1
00078  0011              INPFLG *=*+1
00079  0012              DOMASK
00080  0012              TANSGN *=*+1
00081  0013              CHANNL *=*+1
00082  0014              POKER
00083  0014              LINNUM *=*+2
00084  0016              TEMPPT *=*+1
00085  0017              LASTPT *=*+2
00086  0019              TEMPST *=*+9
00087  0022              INDEX
00088  0022              INDEX1 *=*+2
00089  0024              INDEX2 *=*+2
00090  0026              RESHO  *=*+1
00091  0027              RESMOH *=*+1
00092  0028              ADDEND
00093  0028              RESMO  *=*+1
00094  0029              RESLO  *=*+1
00095  002A                     *=*+1
00096  002B              TXTTAB *=*+2
00097  002D              VARTAB *=*+2
00098  002F              ARYTAB *=*+2
00099  0031              STREND *=*+2
00100  0033              FRETOP *=*+2
00101  0035              FRESPC *=*+2
00102  0037              MEMSIZ *=*+2
00103  0039              CURLIN *=*+2
00104  003B              OLDLIN *=*+2
00105  003D              OLDTXT *=*+2
00106  003F              DATLIN *=*+2






DECLARATIONS......PAGE 0003

LINE# LOC   CODE        LINE


00107  0041              DATPTR *=*+2
00108  0043              INPPTR *=*+2
00109  0045              VARNAM *=*+2
00110  0047              FDECPT 
00111  0047              VARPNT *=*+2
00112  0049              LSTPNT
00113  0049              ANDMSK
00114  0049              FORPNT *=*+2
00115  004B              EORMSK =FORPNT+1
00116  004B              VARTXT
00117  004B              OPPTR  *=*+2
00118  004D              OPMASK *=*+1
00119  004E              GRBPNT
00120  004E              TEMPF3
00121  004E              DEFPNT *=*+2
00122  0050              DSCPNT *=*+2
00123  0052                     *=*+1
00124  0053              FOUR6  *=*+1
00125  0054              JMPER  *=*+1
00126  0055              SIZE   *=*+1
00127  0056              OLDOV  *=*+1
00128  0057              TEMPF1 *=*+1
00129  0058              ARYPNT
00130  0058              HIGHDS *=*+2
00131  005A              HIGHTR *=*+2
00132  005C              TEMPF2
00133  005C                     *=*+1
00134  005D              DECCNT
00135  005D              LOWDS  *=*+2
00136  005F              GRBTOP
00137  005F              DPTFLG
00138  005F              LOWTR  *=*+1
00139  0060              EXPSGN *=*+1
00140  0061              TENEXP =LOWDS+1
00141  0061              EPSGN  =LOWTR+1
00142  0061              DSCTMP
00143  0061              FAC
00144  0061              FACEXP *=*+1
00145  0062              FACHO  *=*+1
00146  0063              FACMOH *=*+1
00147  0064              INDICE
00148  0064              FACMO  *=*+1
00149  0065              FACLO  *=*+1
00150  0066              FACSGN *=*+1
00151  0067              DEGREE
00152  0067              SGNFLG *=*+1
00153  0068              BITS   *=*+1
00154  0069              ARGEXP *=*+1
00155  006A              ARGHO  *=*+1
00156  006B              ARGMOH *=*+1
00157  006C              ARGMO  *=*+1
00158  006D              ARGLO  *=*+1
00159  006E              ARGSGN *=*+1
00160  006F              STRNGI
00161  006F              ARISGN *=*+1






DECLARATIONS......PAGE 0004

LINE# LOC   CODE        LINE


00162  0070              FACOV  *=*+1
00163  0071              BUFPTR
00164  0071              STRNG2
00165  0071              POLYPT
00166  0071              CURTOL
00167  0071              FBUFPT *=*+2
00168  0073              CHRGET *=*+6
00169  0079              CHRGOT *=*+1
00170  007A              TXTPTR *=*+6
00171  0080              QNUM   *=*+10
00172  008A              CHRRTS *=*+1
00173  008B              RNDX   *=*+5
00174  0090                     *=255
00175  00FF              LOFBUF *=*+1
00176  0100              FBUFFR *=*+1
00177  0101              STRNG1 =ARISGN
00178  0101              ;
00179  0101                     *=$0300         ;BASIC INDIRECTS
00180  0300              IERROR *=*+2           ;INDIRECT ERROR (OUTPUT ERROR IN .X)
00181  0302              IMAIN  *=*+2           ;INDIRECT MAIN (SYSTEM DIRECT LOOP)
00182  0304              ICRNCH *=*+2           ;INDIRECT CRUNCH (TOKENIZATION ROUTINE)
00183  0306              IQPLOP *=*+2           ;INDIRECT LIST (CHAR LIST)
00184  0308              IGONE  *=*+2           ;INDIRECT GONE (CHAR DISPATCH)
00185  030A              IEVAL  *=*+2           ;INDIRECT EVAL (SYMBOL EVALUATION)
00186  030C              ;TEMP STORAGE UNTILL SYSTEM INTERGRATION
00187  030C              ; SYS 6502 REGS
00188  030C              SAREG  *=*+1           ;.A REG
00189  030D              SXREG  *=*+1           ;.X REG
00190  030E              SYREG  *=*+1           ;.Y REG
00191  030F              SPREG  *=*+1           ;.P REG
00192  0310              USRPOK *=*+3           ;USER FUNCTION DISPATCH
00193  0313                     *=$0300+20      ;SYSTEM INDIRECTS FOLLOW
00194  0314              .END
00195  0314              .LIB   TOKENS



























TOKENS......PAGE 0005

LINE# LOC   CODE        LINE


00197  0314                     *=ROMLOC
00198  A000  94 E3              .WOR INIT       ;C000 HARD RESET
00199  A002  7B E3              .WOR PANIC      ;C000 SOFT RESET
00200  A004  43 42              .BYT 'CBMBASIC'
00201  A00C  30 A8       STMDSP .WOR END-1
00202  A00E  41 A7              .WOR FOR-1
00203  A010  1D AD              .WOR NEXT-1
00204  A012  F7 A8              .WOR DATA-1
00205  A014  A4 AB              .WOR INPUTN-1
00206  A016  BE AB              .WOR INPUT-1
00207  A018  80 B0              .WOR DIM-1
00208  A01A  05 AC              .WOR READ-1
00209  A01C  A4 A9              .WOR LET-1
00210  A01E  9F A8              .WOR GOTO-1
00211  A020  70 A8              .WOR RUN-1
00212  A022  27 A9              .WOR IF-1
00213  A024  1C A8              .WOR RESTOR-1
00214  A026  82 A8              .WOR GOSUB-1
00215  A028  D1 A8              .WOR RETURN-1
00216  A02A  3A A9              .WOR REM-1
00217  A02C  2E A8              .WOR STOP-1
00218  A02E  4A A9              .WOR ONGOTO-1
00219  A030  2C B8              .WOR FNWAIT-1
00220  A032  67 E1              .WOR CLOAD-1
00221  A034  55 E1              .WOR CSAVE-1
00222  A036  64 E1              .WOR CVERF-1
00223  A038  B2 B3              .WOR DEF-1
00224  A03A  23 B8              .WOR POKE-1
00225  A03C  7F AA              .WOR PRINTN-1
00226  A03E  9F AA              .WOR PRINT-1
00227  A040  56 A8              .WOR CONT-1
00228  A042  9B A6              .WOR LIST-1
00229  A044  5D A6              .WOR CLEAR-1
00230  A046  85 AA              .WOR CMD-1
00231  A048  29 E1              .WOR CSYS-1 
00232  A04A  BD E1              .WOR COPEN-1
00233  A04C  C6 E1              .WOR CCLOS-1
00234  A04E  7A AB              .WOR GET-1
00235  A050  41 A6              .WOR SCRATH-1
00236  A052  39 BC       FUNDSP .WOR SGN
00237  A054  CC BC              .WOR INT
00238  A056  58 BC              .WOR ABS
00239  A058  10 03       USRLOC .WOR USRPOK
00240  A05A  7D B3              .WOR FRE
00241  A05C  9E B3              .WOR POS
00242  A05E  71 BF              .WOR SQR
00243  A060  97 E0              .WOR RND
00244  A062  EA B9              .WOR LOG
00245  A064  ED BF              .WOR EXP
00246  A066  64 E2              .WOR COS
00247  A068  6B E2              .WOR SIN
00248  A06A  B4 E2              .WOR TAN
00249  A06C  0E E3              .WOR ATN
00250  A06E  0D B8              .WOR PEEK
00251  A070  7C B7              .WOR LEN






TOKENS......PAGE 0006

LINE# LOC   CODE        LINE


00252  A072  65 B4              .WOR STRD
00253  A074  AD B7              .WOR VAL
00254  A076  8B B7              .WOR ASC
00255  A078  EC B6              .WOR CHRD
00256  A07A  00 B7              .WOR LEFTD
00257  A07C  2C B7              .WOR RIGHTD
00258  A07E  37 B7              .WOR MIDD
00259  A080  79          OPTAB  .BYT 121
00260  A081  69 B8              .WOR FADDT-1
00261  A083  79                 .BYT 121
00262  A084  52 B8              .WOR FSUBT-1
00263  A086  7B                 .BYT 123
00264  A087  2A BA              .WOR FMULTT-1
00265  A089  7B                 .BYT 123
00266  A08A  11 BB              .WOR FDIVT-1
00267  A08C  7F                 .BYT 127
00268  A08D  7A BF              .WOR FPWRT-1
00269  A08F  50                 .BYT 80
00270  A090  E8 AF              .WOR ANDOP-1
00271  A092  46                 .BYT 70
00272  A093  E5 AF              .WOR OROP-1
00273  A095  7D          NEGTAB .BYT 125
00274  A096  B3 BF              .WOR NEGOP-1 
00275  A098  5A          NOTTAB .BYT 90
00276  A099  D3 AE              .WOR NOTOP-1
00277  A09B  64          PTDORL .BYT 100
00278  A09C  15 B0              .WOR DOREL-1
00279  A09E              Q=128-1
00280  A09E  45 4E       RESLST .BYT 'EN',$C4
00280  A0A0  C4 
00281  A0A1              ENDTK  =@200
00282  A0A1  46 4F              .BYT 'FO',$D2
00282  A0A3  D2 
00283  A0A4              FORTK  =@201
00284  A0A4  4E 45 58           .BYT 'NEX',$D4
00284  A0A7  D4 
00285  A0A8  44 41 54           .BYT 'DAT',$C1
00285  A0AB  C1 
00286  A0AC              DATATK =@203
00287  A0AC  49 4E              .BYT 'INPUT',$A3
00287  A0B1  A3 
00288  A0B2  49 4E              .BYT 'INPU',$D4
00288  A0B6  D4 
00289  A0B7  44 49              .BYT 'DI',$CD
00289  A0B9  CD 
00290  A0BA  52 45 41           .BYT 'REA',$C4
00290  A0BD  C4 
00291  A0BE  4C 45              .BYT 'LE',$D4
00291  A0C0  D4 
00292  A0C1  47 4F 54           .BYT 'GOT',$CF
00292  A0C4  CF 
00293  A0C5              GOTOTK =@211
00294  A0C5  52 55              .BYT 'RU',$CE
00294  A0C7  CE 
00295  A0C8  49                 .BYT 'I',$C6






TOKENS......PAGE 0007

LINE# LOC   CODE        LINE


00295  A0C9  C6 
00296  A0CA  52 45              .BYT 'RESTOR',$C5
00296  A0D0  C5 
00297  A0D1  47 4F              .BYT 'GOSU',$C2
00297  A0D5  C2 
00298  A0D6              GOSUTK =@215
00299  A0D6  52 45              .BYT 'RETUR',$CE
00299  A0DB  CE 
00300  A0DC  52 45              .BYT 'RE',$CD
00300  A0DE  CD 
00301  A0DF              REMTK  =@217
00302  A0DF  53 54 4F           .BYT 'STO',$D0
00302  A0E2  D0 
00303  A0E3  4F                 .BYT 'O',$CE
00303  A0E4  CE 
00304  A0E5  57 41 49           .BYT 'WAI',$D4
00304  A0E8  D4 
00305  A0E9  4C 4F 41           .BYT 'LOA',$C4
00305  A0EC  C4 
00306  A0ED  53 41 56           .BYT 'SAV',$C5
00306  A0F0  C5 
00307  A0F1  56 45              .BYT 'VERIF',$D9
00307  A0F6  D9 
00308  A0F7  44 45              .BYT 'DE',$C6
00308  A0F9  C6 
00309  A0FA  50 4F 4B           .BYT 'POK',$C5
00309  A0FD  C5 
00310  A0FE  50 52              .BYT 'PRINT',$A3
00310  A103  A3 
00311  A104  50 52              .BYT 'PRIN',$D4
00311  A108  D4 
00312  A109              PRINTK =@231
00313  A109  43 4F 4E           .BYT 'CON',$D4
00313  A10C  D4 
00314  A10D  4C 49 53           .BYT 'LIS',$D4
00314  A110  D4 
00315  A111  43 4C              .BYT 'CL',$D2
00315  A113  D2 
00316  A114  43 4D              .BYT 'CM',$C4
00316  A116  C4 
00317  A117  53 59              .BYT 'SY',$D3
00317  A119  D3 
00318  A11A  4F 50 45           .BYT 'OPE',$CE
00318  A11D  CE 
00319  A11E  43 4C              .BYT 'CLOS',$C5
00319  A122  C5 
00320  A123  47 45              .BYT 'GE',$D4
00320  A125  D4 
00321  A126  4E 45              .BYT 'NE',$D7
00321  A128  D7 
00322  A129              SCRATK =@242
00323  A129              .END
00324  A129              .LIB   TOKEN2








TOKEN2......PAGE 0008

LINE# LOC   CODE        LINE


00326  A129  54 41 42           .BYT 'TAB',$A8
00326  A12C  A8 
00327  A12D              TABTK  =@243
00328  A12D  54                 .BYT 'T',$CF
00328  A12E  CF 
00329  A12F              TOTK   =@244
00330  A12F  46                 .BYT 'F',$CE
00330  A130  CE 
00331  A131              FNTK   =@245
00332  A131  53 50 43           .BYT 'SPC',$A8
00332  A134  A8 
00333  A135              SPCTK  =@246
00334  A135  54 48 45           .BYT 'THE',$CE
00334  A138  CE 
00335  A139              THENTK =@247
00336  A139  4E 4F              .BYT 'NO',$D4
00336  A13B  D4 
00337  A13C              NOTTK  =@250
00338  A13C  53 54 45           .BYT 'STE',$D0
00338  A13F  D0 
00339  A140              STEPTK =@251
00340  A140  AB                 .BYT $AB
00341  A141              PLUSTK =@252
00342  A141  AD                 .BYT $AD
00343  A142              MINUTK =@253
00344  A142  AA                 .BYT $AA
00345  A143  AF                 .BYT $AF
00346  A144  DE                 .BYT $DE
00347  A145  41 4E              .BYT 'AN',$C4
00347  A147  C4 
00348  A148  4F                 .BYT 'O',$D2
00348  A149  D2 
00349  A14A  BE                 .BYT 190
00350  A14B              GREATK =@261
00351  A14B  BD                 .BYT $BD
00352  A14C              EQULTK =@262
00353  A14C  BC                 .BYT 188
00354  A14D              LESSTK =@263
00355  A14D  53 47              .BYT 'SG',$CE
00355  A14F  CE 
00356  A150              ONEFUN =@264
00357  A150  49 4E              .BYT 'IN',$D4
00357  A152  D4 
00358  A153  41 42              .BYT 'AB',$D3
00358  A155  D3 
00359  A156  55 53              .BYT 'US',$D2
00359  A158  D2 
00360  A159  46 52              .BYT 'FR',$C5
00360  A15B  C5 
00361  A15C  50 4F              .BYT 'PO',$D3
00361  A15E  D3 
00362  A15F  53 51              .BYT 'SQ',$D2
00362  A161  D2 
00363  A162  52 4E              .BYT 'RN',$C4
00363  A164  C4 






TOKEN2......PAGE 0009

LINE# LOC   CODE        LINE


00364  A165  4C 4F              .BYT 'LO',$C7
00364  A167  C7 
00365  A168  45 58              .BYT 'EX',$D0
00365  A16A  D0 
00366  A16B  43 4F              .BYT 'CO',$D3
00366  A16D  D3 
00367  A16E  53 49              .BYT 'SI',$CE
00367  A170  CE 
00368  A171  54 41              .BYT 'TA',$CE
00368  A173  CE 
00369  A174  41 54              .BYT 'AT',$CE
00369  A176  CE 
00370  A177  50 45 45           .BYT 'PEE',$CB
00370  A17A  CB 
00371  A17B  4C 45              .BYT 'LE',$CE
00371  A17D  CE 
00372  A17E  53 54 52           .BYT 'STR',$A4
00372  A181  A4 
00373  A182  56 41              .BYT 'VA',$CC
00373  A184  CC 
00374  A185  41 53              .BYT 'AS',$C3
00374  A187  C3 
00375  A188  43 48 52           .BYT 'CHR',$A4
00375  A18B  A4 
00376  A18C              LASNUM =@307
00377  A18C  4C 45              .BYT 'LEFT',$A4
00377  A190  A4 
00378  A191  52 49              .BYT 'RIGHT',$A4
00378  A196  A4 
00379  A197  4D 49 44           .BYT 'MID',$A4
00379  A19A  A4 
00380  A19B  47                 .BYT 'G',$CF
00380  A19C  CF 
00381  A19D              GOTK   =@313
00382  A19D  00                 .BYT 0


























ERROR MESSAGES......PAGE 000A

LINE# LOC   CODE        LINE


00384  A19E  54 4F       ERR01  .BYT 'TOO MANY FILE',$D3
00384  A1AB  D3 
00385  A1AC  46 49       ERR02  .BYT 'FILE OPE',$CE
00385  A1B4  CE 
00386  A1B5  46 49       ERR03  .BYT 'FILE NOT OPE',$CE
00386  A1C1  CE 
00387  A1C2  46 49       ERR04  .BYT 'FILE NOT FOUN',$C4
00387  A1CF  C4 
00388  A1D0  44 45       ERR05  .BYT 'DEVICE NOT PRESEN',$D4
00388  A1E1  D4 
00389  A1E2  4E 4F       ERR06  .BYT 'NOT INPUT FIL',$C5
00389  A1EF  C5 
00390  A1F0  4E 4F       ERR07  .BYT 'NOT OUTPUT FIL',$C5
00390  A1FE  C5 
00391  A1FF  4D 49       ERR08  .BYT 'MISSING FILE NAM',$C5
00391  A20F  C5 
00392  A210  49 4C       ERR09  .BYT 'ILLEGAL DEVICE NUMBE',$D2
00392  A224  D2 
00393  A225  4E 45       ERR10  .BYT 'NEXT WITHOUT FO',$D2
00393  A234  D2 
00394  A235              ERRNF  =10
00395  A235  53 59       ERR11  .BYT 'SYNTA',$D8
00395  A23A  D8 
00396  A23B              ERRSN  =11
00397  A23B  52 45       ERR12  .BYT 'RETURN WITHOUT GOSU',$C2
00397  A24E  C2 
00398  A24F              ERRRG  =12
00399  A24F  4F 55       ERR13  .BYT 'OUT OF DAT',$C1
00399  A259  C1 
00400  A25A              ERROD  =13
00401  A25A  49 4C       ERR14  .BYT 'ILLEGAL QUANTIT',$D9
00401  A269  D9 
00402  A26A              ERRFC  =14
00403  A26A  4F 56       ERR15  .BYT 'OVERFLO',$D7
00403  A271  D7 
00404  A272              ERROV  =15
00405  A272  4F 55       ERR16  .BYT 'OUT OF MEMOR',$D9
00405  A27E  D9 
00406  A27F              ERROM  =16
00407  A27F  55 4E       ERR17  .BYT 'UNDEF',$27
00407  A284  27 
00408  A285  44 20              .BYT 'D STATEMEN',$D4
00408  A28F  D4 
00409  A290              ERRUS  =17
00410  A290  42 41       ERR18  .BYT 'BAD SUBSCRIP',$D4
00410  A29C  D4 
00411  A29D              ERRBS  =18
00412  A29D  52 45       ERR19  .BYT 'REDIM',$27,'D ARRA',$D9
00412  A2A2  27 
00412  A2A3  44 20 
00412  A2A9  D9 
00413  A2AA              ERRDD  =19
00414  A2AA  44 49       ERR20  .BYT 'DIVISION BY ZER',$CF
00414  A2B9  CF 
00415  A2BA              ERRDVO =20






ERROR MESSAGES......PAGE 000B

LINE# LOC   CODE        LINE


00416  A2BA  49 4C       ERR21  .BYT 'ILLEGAL DIREC',$D4
00416  A2C7  D4 
00417  A2C8              ERRID  =21
00418  A2C8  54 59       ERR22  .BYT 'TYPE MISMATC',$C8
00418  A2D4  C8 
00419  A2D5              ERRTM  =22
00420  A2D5  53 54       ERR23  .BYT 'STRING TOO LON',$C7
00420  A2E3  C7 
00421  A2E4              ERRLS  =23
00422  A2E4  46 49       ERR24  .BYT 'FILE DAT',$C1
00422  A2EC  C1 
00423  A2ED              ERRBD  =24
00424  A2ED  46 4F       ERR25  .BYT 'FORMULA TOO COMPLE',$D8
00424  A2FF  D8 
00425  A300              ERRST  =25
00426  A300  43 41 4E    ERR26  .BYT 'CAN',$27,'T CONTINU',$C5
00426  A303  27 
00426  A304  54 20 
00426  A30D  C5 
00427  A30E              ERRCN  =26
00428  A30E  55 4E       ERR27  .BYT 'UNDEF',$27,'D FUNCTIO',$CE
00428  A313  27 
00428  A314  44 20 
00428  A31D  CE 
00429  A31E              ERRUF  =27
00430  A31E  56 45       ERR28  .BYT 'VERIF',$D9
00430  A323  D9 
00431  A324              ERVFY  =28
00432  A324  4C 4F 41    ERR29  .BYT 'LOA',$C4
00432  A327  C4 
00433  A328              ERLOAD =29






























ERROR MESSAGES......PAGE 000C

LINE# LOC   CODE        LINE


00435  A328              ; TABLE TO TRANSLATE ERROR MESSAGE #
00436  A328              ; TO ADDRESS OF STRING CONTAINING MESSAGE
00437  A328              ;
00438  A328  9E A1       ERRTAB .WOR ERR01
00439  A32A  AC A1              .WOR ERR02
00440  A32C  B5 A1              .WOR ERR03
00441  A32E  C2 A1              .WOR ERR04
00442  A330  D0 A1              .WOR ERR05
00443  A332  E2 A1              .WOR ERR06
00444  A334  F0 A1              .WOR ERR07
00445  A336  FF A1              .WOR ERR08
00446  A338  10 A2              .WOR ERR09
00447  A33A  25 A2              .WOR ERR10
00448  A33C  35 A2              .WOR ERR11
00449  A33E  3B A2              .WOR ERR12
00450  A340  4F A2              .WOR ERR13
00451  A342  5A A2              .WOR ERR14
00452  A344  6A A2              .WOR ERR15
00453  A346  72 A2              .WOR ERR16
00454  A348  7F A2              .WOR ERR17
00455  A34A  90 A2              .WOR ERR18
00456  A34C  9D A2              .WOR ERR19
00457  A34E  AA A2              .WOR ERR20
00458  A350  BA A2              .WOR ERR21
00459  A352  C8 A2              .WOR ERR22
00460  A354  D5 A2              .WOR ERR23
00461  A356  E4 A2              .WOR ERR24
00462  A358  ED A2              .WOR ERR25
00463  A35A  00 A3              .WOR ERR26
00464  A35C  0E A3              .WOR ERR27
00465  A35E  1E A3              .WOR ERR28
00466  A360  24 A3              .WOR ERR29
00467  A362  83 A3              .WOR ERR30





00469  A364  0D          OKMSG  .BYT $D,'OK',$D,$0
00469  A365  4F 4B 
00469  A367  0D 
00469  A368  00 
00470  A369  20          ERR    .BYT $20,' ERROR',0 ;ADD A SPACE FOR VIC-40 SCREEN
00470  A36A  20 45 
00470  A370  00 
00471  A371  20 49       INTXT  .BYT ' IN ',0
00471  A375  00 
00472  A376  0D          REDDY  .BYT $D,$A,'READY.',$D,$A,0
00472  A377  0A 
00472  A378  52 45 
00472  A37E  0D 
00472  A37F  0A 
00472  A380  00 
00473  A381              ERBRK  =30
00474  A381  0D          BRKTXT .BYT $D,$A






ERROR MESSAGES......PAGE 000D

LINE# LOC   CODE        LINE


00474  A382  0A 
00475  A383  42 52       ERR30  .BYT 'BREAK',0,$A0 ;SHIFTED SPACE
00475  A388  00 
00475  A389  A0 

























































ERROR MESSAGES......PAGE 000E

LINE# LOC   CODE        LINE


00477  A38A              FORSIZ =@22
00478  A38A  BA          FNDFOR TSX
00479  A38B  E8                 INX
00480  A38C  E8                 INX
00481  A38D  E8                 INX
00482  A38E  E8                 INX
00483  A38F  BD 01 01    FFLOOP LDA 257,X
00484  A392  C9 81              CMP #FORTK
00485  A394  D0 21              BNE FFRTS
00486  A396  A5 4A              LDA FORPNT+1
00487  A398  D0 0A              BNE CMPFOR
00488  A39A  BD 02 01           LDA 258,X
00489  A39D  85 49              STA FORPNT
00490  A39F  BD 03 01           LDA 259,X
00491  A3A2  85 4A              STA FORPNT+1
00492  A3A4  DD 03 01    CMPFOR CMP 259,X
00493  A3A7  D0 07              BNE ADDFRS
00494  A3A9  A5 49              LDA FORPNT
00495  A3AB  DD 02 01           CMP 258,X
00496  A3AE  F0 07              BEQ FFRTS
00497  A3B0  8A          ADDFRS TXA 
00498  A3B1  18                 CLC
00499  A3B2  69 12              ADC #FORSIZ
00500  A3B4  AA                 TAX
00501  A3B5  D0 D8              BNE FFLOOP
00502  A3B7  60          FFRTS  RTS
00503  A3B8  20 08 A4    BLTU   JSR REASON
00504  A3BB  85 31              STA STREND
00505  A3BD  84 32              STY STREND+1
00506  A3BF  38          BLTUC  SEC
00507  A3C0  A5 5A              LDA HIGHTR
00508  A3C2  E5 5F              SBC LOWTR
00509  A3C4  85 22              STA INDEX
00510  A3C6  A8                 TAY
00511  A3C7  A5 5B              LDA HIGHTR+1
00512  A3C9  E5 60              SBC LOWTR+1
00513  A3CB  AA                 TAX
00514  A3CC  E8                 INX
00515  A3CD  98                 TYA
00516  A3CE  F0 23              BEQ DECBLT
00517  A3D0  A5 5A              LDA HIGHTR
00518  A3D2  38                 SEC
00519  A3D3  E5 22              SBC INDEX
00520  A3D5  85 5A              STA HIGHTR
00521  A3D7  B0 03              BCS BLT1
00522  A3D9  C6 5B              DEC HIGHTR+1
00523  A3DB  38                 SEC
00524  A3DC  A5 58       BLT1   LDA HIGHDS
00525  A3DE  E5 22              SBC INDEX
00526  A3E0  85 58              STA HIGHDS
00527  A3E2  B0 08              BCS MOREN1
00528  A3E4  C6 59              DEC HIGHDS+1
00529  A3E6  90 04              BCC MOREN1
00530  A3E8  B1 5A       BLTLP  LDA (HIGHTR)Y
00531  A3EA  91 58              STA (HIGHDS)Y






ERROR MESSAGES......PAGE 000F

LINE# LOC   CODE        LINE


00532  A3EC  88          MOREN1 DEY
00533  A3ED  D0 F9              BNE BLTLP
00534  A3EF  B1 5A              LDA (HIGHTR),Y
00535  A3F1  91 58              STA (HIGHDS),Y
00536  A3F3  C6 5B       DECBLT DEC HIGHTR+1
00537  A3F5  C6 59              DEC HIGHDS+1
00538  A3F7  CA                 DEX
00539  A3F8  D0 F2              BNE MOREN1
00540  A3FA  60                 RTS
00541  A3FB  0A          GETSTK ASL A
00542  A3FC  69 3E              ADC #NUMLEV+NUMLEV+16
00543  A3FE  B0 35              BCS OMERR
00544  A400  85 22              STA INDEX
00545  A402  BA                 TSX
00546  A403  E4 22              CPX INDEX
00547  A405  90 2E              BCC OMERR
00548  A407  60                 RTS
00549  A408  C4 34       REASON CPY FRETOP+1
00550  A40A  90 28              BCC REARTS
00551  A40C  D0 04              BNE TRYMOR
00552  A40E  C5 33              CMP FRETOP
00553  A410  90 22              BCC REARTS
00554  A412  48          TRYMOR PHA
00555  A413  A2 09              LDX #8+ADDPRC
00556  A415  98                 TYA
00557  A416  48          REASAV PHA
00558  A417  B5 57              LDA HIGHDS-1,X
00559  A419  CA                 DEX
00560  A41A  10 FA              BPL REASAV
00561  A41C  20 26 B5           JSR GARBA2
00562  A41F  A2 F7              LDX #248-ADDPRC
00563  A421  68          REASTO PLA
00564  A422  95 61              STA HIGHDS+8+ADDPRC,X
00565  A424  E8                 INX
00566  A425  30 FA              BMI REASTO
00567  A427  68                 PLA
00568  A428  A8                 TAY
00569  A429  68                 PLA
00570  A42A  C4 34              CPY FRETOP+1
00571  A42C  90 06              BCC REARTS
00572  A42E  D0 05              BNE OMERR
00573  A430  C5 33              CMP FRETOP
00574  A432  B0 01              BCS OMERR
00575  A434  60          REARTS RTS
00576  A435              .END
00577  A435              .LIB   CODE1















CODE1......PAGE 0010

LINE# LOC   CODE        LINE


00579  A435  A2 10       OMERR  LDX #ERROM
00580  A437  6C 00 03    ERROR  JMP (IERROR)
00581  A43A  8A          NERROX TXA
00582  A43B  0A                 ASL A
00583  A43C  AA                 TAX
00584  A43D  BD 26 A3           LDA ERRTAB-2,X
00585  A440  85 22              STA INDEX1
00586  A442  BD 27 A3           LDA ERRTAB-1,X
00587  A445  85 23              STA INDEX1+1
00588  A447  20 CC FF           JSR CLSCHN
00589  A44A  A9 00              LDA #0
00590  A44C  85 13              STA CHANNL
00591  A44E  20 D7 AA    ERRCRD JSR CRDO
00592  A451  20 45 AB           JSR OUTQST
00593  A454  A0 00              LDY #0
00594  A456  B1 22       GETERR LDA (INDEX1)Y
00595  A458  48                 PHA
00596  A459  29 7F              AND #127
00597  A45B  20 47 AB           JSR OUTDO
00598  A45E  C8                 INY
00599  A45F  68                 PLA
00600  A460  10 F4              BPL GETERR
00601  A462  20 7A A6           JSR STKINI
00602  A465  A9 69              LDA #<ERR
00603  A467  A0 A3              LDY #>ERR
00604  A469  20 1E AB    ERRFIN JSR STROUT
00605  A46C  A4 3A              LDY CURLIN+1
00606  A46E  C8                 INY
00607  A46F  F0 03              BEQ READYX
00608  A471  20 C2 BD           JSR INPRT





00610  A474  A9 76       READYX LDA #<REDDY
00611  A476  A0 A3              LDY #>REDDY
00612  A478  20 1E AB           JSR STROUT
00613  A47B  A9 80              LDA #$80        ;DIRECT MESSAGES ON
00614  A47D  20 90 FF           JSR SETMSG      ;FROM KERNAL





00616  A480  6C 02 03    MAIN   JMP (IMAIN)
00617  A483  20 60 A5    NMAIN  JSR INLIN
00618  A486  86 7A              STX TXTPTR
00619  A488  84 7B              STY TXTPTR+1
00620  A48A  20 73 00           JSR CHRGET
00621  A48D  AA                 TAX
00622  A48E  F0 F0              BEQ MAIN
00623  A490  A2 FF              LDX #255
00624  A492  86 3A              STX CURLIN+1
00625  A494  90 06              BCC MAIN1






CODE1......PAGE 0011

LINE# LOC   CODE        LINE


00626  A496  20 79 A5           JSR CRUNCH
00627  A499  4C E1 A7           JMP GONE
00628  A49C  20 6B A9    MAIN1  JSR LINGET
00629  A49F  20 79 A5           JSR CRUNCH
00630  A4A2  84 0B              STY COUNT
00631  A4A4  20 13 A6           JSR FNDLIN
00632  A4A7  90 44              BCC NODEL
00633  A4A9  A0 01              LDY #1
00634  A4AB  B1 5F              LDA (LOWTR)Y
00635  A4AD  85 23              STA INDEX1+1
00636  A4AF  A5 2D              LDA VARTAB
00637  A4B1  85 22              STA INDEX1
00638  A4B3  A5 60              LDA LOWTR+1
00639  A4B5  85 25              STA INDEX2+1
00640  A4B7  A5 5F              LDA LOWTR
00641  A4B9  88                 DEY
00642  A4BA  F1 5F              SBC (LOWTR)Y 
00643  A4BC  18                 CLC
00644  A4BD  65 2D              ADC VARTAB
00645  A4BF  85 2D              STA VARTAB
00646  A4C1  85 24              STA INDEX2
00647  A4C3  A5 2E              LDA VARTAB+1
00648  A4C5  69 FF              ADC #255
00649  A4C7  85 2E              STA VARTAB+1
00650  A4C9  E5 60              SBC LOWTR+1
00651  A4CB  AA                 TAX
00652  A4CC  38                 SEC
00653  A4CD  A5 5F              LDA LOWTR
00654  A4CF  E5 2D              SBC VARTAB
00655  A4D1  A8                 TAY
00656  A4D2  B0 03              BCS QDECT1
00657  A4D4  E8                 INX
00658  A4D5  C6 25              DEC INDEX2+1
00659  A4D7  18          QDECT1 CLC
00660  A4D8  65 22              ADC INDEX1
00661  A4DA  90 03              BCC MLOOP
00662  A4DC  C6 23              DEC INDEX1+1
00663  A4DE  18                 CLC
00664  A4DF  B1 22       MLOOP  LDA (INDEX1)Y
00665  A4E1  91 24              STA (INDEX2)Y
00666  A4E3  C8                 INY 
00667  A4E4  D0 F9              BNE MLOOP
00668  A4E6  E6 23              INC INDEX1+1
00669  A4E8  E6 25              INC INDEX2+1
00670  A4EA  CA                 DEX
00671  A4EB  D0 F2              BNE MLOOP
00672  A4ED  20 59 A6    NODEL  JSR RUNC
00673  A4F0  20 33 A5           JSR LNKPRG
00674  A4F3  AD 00 02           LDA BUF
00675  A4F6  F0 88              BEQ MAIN
00676  A4F8  18                 CLC
00677  A4F9  A5 2D              LDA VARTAB
00678  A4FB  85 5A              STA HIGHTR 
00679  A4FD  65 0B              ADC COUNT
00680  A4FF  85 58              STA HIGHDS






CODE1......PAGE 0012

LINE# LOC   CODE        LINE


00681  A501  A4 2E              LDY VARTAB+1
00682  A503  84 5B              STY HIGHTR+1
00683  A505  90 01              BCC NODELC
00684  A507  C8                 INY
00685  A508  84 59       NODELC STY HIGHDS+1
00686  A50A  20 B8 A3           JSR BLTU
00687  A50D  A5 14              LDA LINNUM
00688  A50F  A4 15              LDY LINNUM+1
00689  A511  8D FE 01           STA BUF-2
00690  A514  8C FF 01           STY BUF-1
00691  A517  A5 31              LDA STREND
00692  A519  A4 32              LDY STREND+1
00693  A51B  85 2D              STA VARTAB
00694  A51D  84 2E              STY VARTAB+1
00695  A51F  A4 0B              LDY COUNT
00696  A521  88                 DEY
00697  A522  B9 FC 01    STOLOP LDA BUF-4,Y
00698  A525  91 5F              STA (LOWTR)Y
00699  A527  88                 DEY
00700  A528  10 F8              BPL STOLOP
00701  A52A  20 59 A6    FINI   JSR RUNC
00702  A52D  20 33 A5           JSR LNKPRG
00703  A530  4C 80 A4           JMP MAIN
00704  A533  A5 2B       LNKPRG LDA TXTTAB
00705  A535  A4 2C              LDY TXTTAB+1
00706  A537  85 22              STA INDEX
00707  A539  84 23              STY INDEX+1
00708  A53B  18                 CLC 
00709  A53C  A0 01       CHEAD  LDY #1
00710  A53E  B1 22              LDA (INDEX)Y
00711  A540  F0 1D              BEQ LNKRTS
00712  A542  A0 04              LDY #4
00713  A544  C8          CZLOOP INY
00714  A545  B1 22              LDA (INDEX)Y
00715  A547  D0 FB              BNE CZLOOP
00716  A549  C8                 INY
00717  A54A  98                 TYA
00718  A54B  65 22              ADC INDEX
00719  A54D  AA                 TAX
00720  A54E  A0 00              LDY #0
00721  A550  91 22              STA (INDEX)Y
00722  A552  A5 23              LDA INDEX+1
00723  A554  69 00              ADC #0
00724  A556  C8                 INY
00725  A557  91 22              STA (INDEX)Y
00726  A559  86 22              STX INDEX
00727  A55B  85 23              STA INDEX+1
00728  A55D  90 DD              BCC CHEAD
00729  A55F  60          LNKRTS RTS





00731  A560              ;FUNCTION TO GET A LINE ONE CHARACTER AT






CODE1......PAGE 0013

LINE# LOC   CODE        LINE


00732  A560              ;A TIME FROM THE INPUT CHANNEL AND
00733  A560              ;BUILD IT IN THE INPUT BUFFER.
00734  A560              ;
00735  A560  A2 00       INLIN  LDX #0
00736  A562              ;
00737  A562  20 12 E1    INLINC JSR INCHR
00738  A565  C9 0D              CMP #13         ;A CARRIAGE RETURN?
00739  A567  F0 0D              BEQ FININ1      ;YES...DONE BUILD
00740  A569              ;
00741  A569  9D 00 02           STA BUF,X       ;PUT IT AWAY
00742  A56C  E8                 INX
00743  A56D  E0 59              CPX #BUFLEN     ;MAX CHARACTER LINE?
00744  A56F  90 F1              BCC INLINC      ;NO...O.K.
00745  A571              ;
00746  A571  A2 17              LDX #ERRLS      ;STRING TOO LONG ERROR
00747  A573  4C 37 A4           JMP ERROR
00748  A576              ;
00749  A576  4C CA AA    FININ1 JMP FININL
00750  A579              .END
00751  A579              .LIB   CODE2









































CODE2......PAGE 0014

LINE# LOC   CODE        LINE


00753  A579              BUFOFS =@1000
00754  A579  6C 04 03    CRUNCH JMP (ICRNCH)
00755  A57C  A6 7A       NCRNCH LDX TXTPTR
00756  A57E  A0 04              LDY #4
00757  A580  84 0F              STY DORES
00758  A582  BD 00 02    KLOOP  LDA BUFOFS,X
00759  A585  10 07              BPL CMPSPC
00760  A587  C9 FF              CMP #PI
00761  A589  F0 3E              BEQ STUFFH
00762  A58B  E8                 INX
00763  A58C  D0 F4              BNE KLOOP
00764  A58E  C9 20       CMPSPC CMP #' 
00765  A590  F0 37              BEQ STUFFH
00766  A592  85 08              STA ENDCHR
00767  A594  C9 22              CMP #34
00768  A596  F0 56              BEQ STRNG
00769  A598  24 0F              BIT DORES
00770  A59A  70 2D              BVS STUFFH
00771  A59C  C9 3F              CMP #'?
00772  A59E  D0 04              BNE KLOOP1
00773  A5A0  A9 99              LDA #PRINTK
00774  A5A2  D0 25              BNE STUFFH
00775  A5A4  C9 30       KLOOP1 CMP #'0
00776  A5A6  90 04              BCC MUSTCR
00777  A5A8  C9 3C              CMP #60
00778  A5AA  90 1D              BCC STUFFH
00779  A5AC  84 71       MUSTCR STY BUFPTR
00780  A5AE  A0 00              LDY #0
00781  A5B0  84 0B              STY COUNT
00782  A5B2  88                 DEY
00783  A5B3  86 7A              STX TXTPTR
00784  A5B5  CA                 DEX
00785  A5B6  C8          RESER  INY
00786  A5B7  E8                 INX
00787  A5B8  BD 00 02    RESCON LDA BUFOFS,X
00788  A5BB  38                 SEC
00789  A5BC  F9 9E A0           SBC RESLST,Y
00790  A5BF  F0 F5              BEQ RESER
00791  A5C1  C9 80              CMP #128
00792  A5C3  D0 30              BNE NTHIS
00793  A5C5  05 0B              ORA COUNT
00794  A5C7  A4 71       GETBPT LDY BUFPTR
00795  A5C9  E8          STUFFH INX
00796  A5CA  C8                 INY
00797  A5CB  99 FB 01           STA BUF-5,Y
00798  A5CE  B9 FB 01           LDA BUF-5,Y
00799  A5D1  F0 36              BEQ CRDONE
00800  A5D3  38                 SEC
00801  A5D4  E9 3A              SBC #':
00802  A5D6  F0 04              BEQ COLIS
00803  A5D8  C9 49              CMP #DATATK-$3A
00804  A5DA  D0 02              BNE NODATT
00805  A5DC  85 0F       COLIS  STA DORES
00806  A5DE  38          NODATT SEC
00807  A5DF  E9 55              SBC #REMTK-$3A






CODE2......PAGE 0015

LINE# LOC   CODE        LINE


00808  A5E1  D0 9F              BNE KLOOP
00809  A5E3  85 08              STA ENDCHR
00810  A5E5  BD 00 02    STR1   LDA BUFOFS,X
00811  A5E8  F0 DF              BEQ STUFFH
00812  A5EA  C5 08              CMP ENDCHR
00813  A5EC  F0 DB              BEQ STUFFH
00814  A5EE  C8          STRNG  INY
00815  A5EF  99 FB 01           STA BUF-5,Y
00816  A5F2  E8                 INX
00817  A5F3  D0 F0              BNE STR1
00818  A5F5  A6 7A       NTHIS  LDX TXTPTR
00819  A5F7  E6 0B              INC COUNT
00820  A5F9  C8          NTHIS1 INY
00821  A5FA  B9 9D A0           LDA RESLST-1,Y
00822  A5FD  10 FA              BPL NTHIS1
00823  A5FF  B9 9E A0           LDA RESLST,Y
00824  A602  D0 B4              BNE RESCON
00825  A604  BD 00 02           LDA BUFOFS,X
00826  A607  10 BE              BPL GETBPT
00827  A609  99 FD 01    CRDONE STA BUF-3,Y
00828  A60C  C6 7B              DEC TXTPTR+1
00829  A60E              ZZ1    =BUF-1
00830  A60E  A9 FF              LDA #<ZZ1
00831  A610  85 7A              STA TXTPTR
00832  A612  60                 RTS
00833  A613  A5 2B       FNDLIN LDA TXTTAB
00834  A615  A6 2C              LDX TXTTAB+1
00835  A617  A0 01       FNDLNC LDY #1
00836  A619  85 5F              STA LOWTR
00837  A61B  86 60              STX LOWTR+1
00838  A61D  B1 5F              LDA (LOWTR)Y
00839  A61F  F0 1F              BEQ FLINRT
00840  A621  C8                 INY
00841  A622  C8                 INY
00842  A623  A5 15              LDA LINNUM+1
00843  A625  D1 5F              CMP (LOWTR)Y
00844  A627  90 18              BCC FLNRTS
00845  A629  F0 03              BEQ FNDLO1 
00846  A62B  88                 DEY
00847  A62C  D0 09              BNE AFFRTS
00848  A62E  A5 14       FNDLO1 LDA LINNUM
00849  A630  88                 DEY
00850  A631  D1 5F              CMP (LOWTR)Y
00851  A633  90 0C              BCC FLNRTS
00852  A635  F0 0A              BEQ FLNRTS
00853  A637  88          AFFRTS DEY
00854  A638  B1 5F              LDA (LOWTR)Y
00855  A63A  AA                 TAX
00856  A63B  88                 DEY
00857  A63C  B1 5F              LDA (LOWTR)Y
00858  A63E  B0 D7              BCS FNDLNC
00859  A640  18          FLINRT CLC
00860  A641  60          FLNRTS RTS
00861  A642  D0 FD       SCRATH BNE FLNRTS
00862  A644  A9 00       SCRTCH LDA #0






CODE2......PAGE 0016

LINE# LOC   CODE        LINE


00863  A646  A8                 TAY
00864  A647  91 2B              STA (TXTTAB)Y
00865  A649  C8                 INY
00866  A64A  91 2B              STA (TXTTAB)Y
00867  A64C  A5 2B              LDA TXTTAB
00868  A64E  18                 CLC
00869  A64F  69 02              ADC #2
00870  A651  85 2D              STA VARTAB
00871  A653  A5 2C              LDA TXTTAB+1
00872  A655  69 00              ADC #0
00873  A657  85 2E              STA VARTAB+1
00874  A659  20 8E A6    RUNC   JSR STXTPT
00875  A65C  A9 00              LDA #0
00876  A65E  D0 2D       CLEAR  BNE STKRTS
00877  A660  20 E7 FF    CLEARC JSR CCALL       ;MOVED FOR V2 ORIG FOR RS-232
00878  A663  A5 37       CLEART LDA MEMSIZ      ;ENTRY FOR OPEN & CLOSE MEMSIZ CHANGES
00879  A665  A4 38              LDY MEMSIZ+1
00880  A667  85 33              STA FRETOP
00881  A669  84 34              STY FRETOP+1
00882  A66B  A5 2D              LDA VARTAB
00883  A66D  A4 2E              LDY VARTAB+1
00884  A66F  85 2F              STA ARYTAB
00885  A671  84 30              STY ARYTAB+1
00886  A673  85 31              STA STREND
00887  A675  84 32              STY STREND+1
00888  A677  20 1D A8    FLOAD  JSR RESTOR
00889  A67A  A2 19       STKINI LDX #TEMPST
00890  A67C  86 16              STX TEMPPT
00891  A67E  68                 PLA 
00892  A67F  A8                 TAY
00893  A680  68                 PLA
00894  A681  A2 FA              LDX #STKEND-257
00895  A683  9A                 TXS
00896  A684  48                 PHA
00897  A685  98                 TYA
00898  A686  48                 PHA
00899  A687  A9 00              LDA #0
00900  A689  85 3E              STA OLDTXT+1
00901  A68B  85 10              STA SUBFLG
00902  A68D  60          STKRTS RTS
00903  A68E  18          STXTPT CLC
00904  A68F  A5 2B              LDA TXTTAB
00905  A691  69 FF              ADC #255
00906  A693  85 7A              STA TXTPTR
00907  A695  A5 2C              LDA TXTTAB+1
00908  A697  69 FF              ADC #255
00909  A699  85 7B              STA TXTPTR+1
00910  A69B  60                 RTS
00911  A69C              .END
00912  A69C              .LIB   CODE3











CODE3......PAGE 0017

LINE# LOC   CODE        LINE


00914  A69C  90 06       LIST   BCC GOLST
00915  A69E  F0 04              BEQ GOLST
00916  A6A0  C9 AB              CMP #MINUTK
00917  A6A2  D0 E9              BNE STKRTS
00918  A6A4  20 6B A9    GOLST  JSR LINGET
00919  A6A7  20 13 A6           JSR FNDLIN
00920  A6AA  20 79 00           JSR CHRGOT
00921  A6AD  F0 0C              BEQ LSTEND
00922  A6AF  C9 AB              CMP #MINUTK
00923  A6B1  D0 8E              BNE FLNRTS
00924  A6B3  20 73 00           JSR CHRGET
00925  A6B6  20 6B A9           JSR LINGET
00926  A6B9  D0 86              BNE FLNRTS
00927  A6BB  68          LSTEND PLA
00928  A6BC  68                 PLA
00929  A6BD  A5 14              LDA LINNUM
00930  A6BF  05 15              ORA LINNUM+1
00931  A6C1  D0 06              BNE LIST4
00932  A6C3  A9 FF              LDA #255
00933  A6C5  85 14              STA LINNUM
00934  A6C7  85 15              STA LINNUM+1
00935  A6C9  A0 01       LIST4  LDY #1
00936  A6CB  84 0F              STY DORES
00937  A6CD  B1 5F              LDA (LOWTR)Y
00938  A6CF  F0 43              BEQ GRODY
00939  A6D1  20 2C A8           JSR ISCNTC
00940  A6D4  20 D7 AA           JSR CRDO
00941  A6D7  C8                 INY
00942  A6D8  B1 5F              LDA (LOWTR)Y
00943  A6DA  AA                 TAX
00944  A6DB  C8                 INY
00945  A6DC  B1 5F              LDA (LOWTR)Y
00946  A6DE  C5 15              CMP LINNUM+1
00947  A6E0  D0 04              BNE TSTDUN
00948  A6E2  E4 14              CPX LINNUM
00949  A6E4  F0 02              BEQ TYPLIN
00950  A6E6  B0 2C       TSTDUN BCS GRODY
00951  A6E8  84 49       TYPLIN STY LSTPNT
00952  A6EA  20 CD BD           JSR LINPRT
00953  A6ED  A9 20              LDA #' 
00954  A6EF  A4 49       PRIT4  LDY LSTPNT
00955  A6F1  29 7F              AND #127
00956  A6F3  20 47 AB    PLOOP  JSR OUTDO
00957  A6F6  C9 22              CMP #34
00958  A6F8  D0 06              BNE PLOOP1
00959  A6FA  A5 0F              LDA DORES
00960  A6FC  49 FF              EOR #@377
00961  A6FE  85 0F              STA DORES
00962  A700  C8          PLOOP1 INY
00963  A701  F0 11              BEQ GRODY
00964  A703  B1 5F              LDA (LOWTR)Y
00965  A705  D0 10              BNE QPLOP
00966  A707  A8                 TAY
00967  A708  B1 5F              LDA (LOWTR)Y
00968  A70A  AA                 TAX






CODE3......PAGE 0018

LINE# LOC   CODE        LINE


00969  A70B  C8                 INY
00970  A70C  B1 5F              LDA (LOWTR)Y
00971  A70E  86 5F              STX LOWTR
00972  A710  85 60              STA LOWTR+1
00973  A712  D0 B5              BNE LIST4
00974  A714  4C 86 E3    GRODY  JMP READY
00975  A717  6C 06 03    QPLOP  JMP (IQPLOP)
00976  A71A  10 D7       NQPLOP BPL PLOOP
00977  A71C  C9 FF              CMP #PI
00978  A71E  F0 D3              BEQ PLOOP
00979  A720  24 0F              BIT DORES
00980  A722  30 CF              BMI PLOOP
00981  A724  38                 SEC
00982  A725  E9 7F              SBC #127
00983  A727  AA                 TAX
00984  A728  84 49              STY LSTPNT
00985  A72A  A0 FF              LDY #255
00986  A72C  CA          RESRCH DEX
00987  A72D  F0 08              BEQ PRIT3
00988  A72F  C8          RESCR1 INY
00989  A730  B9 9E A0           LDA RESLST,Y
00990  A733  10 FA              BPL RESCR1
00991  A735  30 F5              BMI RESRCH
00992  A737  C8          PRIT3  INY
00993  A738  B9 9E A0           LDA RESLST,Y
00994  A73B  30 B2              BMI PRIT4
00995  A73D  20 47 AB           JSR OUTDO
00996  A740  D0 F5              BNE PRIT3
00997  A742  A9 80       FOR    LDA #128
00998  A744  85 10              STA SUBFLG
00999  A746  20 A5 A9           JSR LET
01000  A749  20 8A A3           JSR FNDFOR
01001  A74C  D0 05              BNE NOTOL
01002  A74E  8A                 TXA
01003  A74F  69 0F              ADC #FORSIZ-3
01004  A751  AA                 TAX
01005  A752  9A                 TXS
01006  A753  68          NOTOL  PLA
01007  A754  68                 PLA
01008  A755  A9 09              LDA #8+ADDPRC
01009  A757  20 FB A3           JSR GETSTK
01010  A75A  20 06 A9           JSR DATAN
01011  A75D  18                 CLC
01012  A75E  98                 TYA
01013  A75F  65 7A              ADC TXTPTR
01014  A761  48                 PHA
01015  A762  A5 7B              LDA TXTPTR+1
01016  A764  69 00              ADC #0
01017  A766  48                 PHA
01018  A767  A5 3A              LDA CURLIN+1
01019  A769  48                 PHA
01020  A76A  A5 39              LDA CURLIN
01021  A76C  48                 PHA
01022  A76D  A9 A4              LDA #TOTK
01023  A76F  20 FF AE           JSR SYNCHR






CODE3......PAGE 0019

LINE# LOC   CODE        LINE


01024  A772  20 8D AD           JSR CHKNUM
01025  A775  20 8A AD           JSR FRMNUM
01026  A778  A5 66              LDA FACSGN
01027  A77A  09 7F              ORA #127
01028  A77C  25 62              AND FACHO
01029  A77E  85 62              STA FACHO
01030  A780  A9 8B              LDA #<LDFONE
01031  A782  A0 A7              LDY #>LDFONE
01032  A784  85 22              STA INDEX1
01033  A786  84 23              STY INDEX1+1
01034  A788  4C 43 AE           JMP FORPSH
01035  A78B  A9 BC       LDFONE LDA #<FONE
01036  A78D  A0 B9              LDY #>FONE
01037  A78F  20 A2 BB           JSR MOVFM
01038  A792  20 79 00           JSR CHRGOT
01039  A795  C9 A9              CMP #STEPTK
01040  A797  D0 06              BNE ONEON
01041  A799  20 73 00           JSR CHRGET
01042  A79C  20 8A AD           JSR FRMNUM
01043  A79F  20 2B BC    ONEON  JSR SIGN
01044  A7A2  20 38 AE           JSR PUSHF
01045  A7A5  A5 4A              LDA FORPNT+1
01046  A7A7  48                 PHA
01047  A7A8  A5 49              LDA FORPNT
01048  A7AA  48                 PHA
01049  A7AB  A9 81              LDA #FORTK
01050  A7AD  48                 PHA
01051  A7AE              .END
01052  A7AE              .LIB   CODE4
































CODE4......PAGE 001A

LINE# LOC   CODE        LINE


01054  A7AE  20 2C A8    NEWSTT JSR ISCNTC
01055  A7B1  A5 7A              LDA TXTPTR
01056  A7B3  A4 7B              LDY TXTPTR+1
01057  A7B5  C0 02              CPY #BUFPAG
01058  A7B7  EA                 NOP
01059  A7B8  F0 04              BEQ DIRCON
01060  A7BA  85 3D              STA OLDTXT
01061  A7BC  84 3E              STY OLDTXT+1
01062  A7BE  A0 00       DIRCON LDY #0
01063  A7C0  B1 7A              LDA (TXTPTR)Y
01064  A7C2  D0 43              BNE MORSTS
01065  A7C4  A0 02              LDY #2
01066  A7C6  B1 7A              LDA (TXTPTR)Y
01067  A7C8  18                 CLC
01068  A7C9  D0 03              BNE DIRCN1
01069  A7CB  4C 4B A8           JMP ENDCON
01070  A7CE  C8          DIRCN1 INY
01071  A7CF  B1 7A              LDA (TXTPTR)Y
01072  A7D1  85 39              STA CURLIN
01073  A7D3  C8                 INY
01074  A7D4  B1 7A              LDA (TXTPTR)Y
01075  A7D6  85 3A              STA CURLIN+1
01076  A7D8  98                 TYA
01077  A7D9  65 7A              ADC TXTPTR
01078  A7DB  85 7A              STA TXTPTR
01079  A7DD  90 02              BCC GONE
01080  A7DF  E6 7B              INC TXTPTR+1
01081  A7E1  6C 08 03    GONE   JMP (IGONE)
01082  A7E4  20 73 00    NGONE  JSR CHRGET
01083  A7E7  20 ED A7    NGONE1 JSR GONE3
01084  A7EA  4C AE A7           JMP NEWSTT
01085  A7ED  F0 3C       GONE3  BEQ ISCRTS
01086  A7EF  E9 80       GONE2  SBC #ENDTK
01087  A7F1  90 11              BCC GLET
01088  A7F3  C9 23              CMP #SCRATK-ENDTK+1
01089  A7F5  B0 17              BCS SNERRX
01090  A7F7  0A                 ASL A
01091  A7F8  A8                 TAY
01092  A7F9  B9 0D A0           LDA STMDSP+1,Y
01093  A7FC  48                 PHA
01094  A7FD  B9 0C A0           LDA STMDSP,Y
01095  A800  48                 PHA
01096  A801  4C 73 00           JMP CHRGET
01097  A804  4C A5 A9    GLET   JMP LET
01098  A807  C9 3A       MORSTS CMP #':
01099  A809  F0 D6              BEQ GONE
01100  A80B  4C 08 AF    SNERR1 JMP SNERR
01101  A80E  C9 4B       SNERRX CMP #GOTK-ENDTK
01102  A810  D0 F9              BNE SNERR1
01103  A812  20 73 00           JSR CHRGET
01104  A815  A9 A4              LDA #TOTK
01105  A817  20 FF AE           JSR SYNCHR
01106  A81A  4C A0 A8           JMP GOTO
01107  A81D  38          RESTOR SEC
01108  A81E  A5 2B              LDA TXTTAB






CODE4......PAGE 001B

LINE# LOC   CODE        LINE


01109  A820  E9 01              SBC #1
01110  A822  A4 2C              LDY TXTTAB+1
01111  A824  B0 01              BCS RESFIN
01112  A826  88                 DEY
01113  A827  85 41       RESFIN STA DATPTR
01114  A829  84 42              STY DATPTR+1
01115  A82B  60          ISCRTS RTS
01116  A82C  20 E1 FF    ISCNTC JSR $FFE1
01117  A82F  B0 01       STOP   BCS STOPC
01118  A831  18          END    CLC
01119  A832  D0 3C       STOPC  BNE CONTRT
01120  A834  A5 7A              LDA TXTPTR
01121  A836  A4 7B              LDY TXTPTR+1
01122  A838  A6 3A              LDX CURLIN+1
01123  A83A  E8                 INX
01124  A83B  F0 0C              BEQ DIRIS
01125  A83D  85 3D              STA OLDTXT
01126  A83F  84 3E              STY OLDTXT+1
01127  A841  A5 39       STPEND LDA CURLIN
01128  A843  A4 3A              LDY CURLIN+1
01129  A845  85 3B              STA OLDLIN
01130  A847  84 3C              STY OLDLIN+1
01131  A849  68          DIRIS  PLA
01132  A84A  68                 PLA
01133  A84B  A9 81       ENDCON LDA #<BRKTXT
01134  A84D  A0 A3              LDY #>BRKTXT
01135  A84F  90 03              BCC GORDY
01136  A851  4C 69 A4           JMP ERRFIN
01137  A854  4C 86 E3    GORDY  JMP READY
01138  A857  D0 17       CONT   BNE CONTRT
01139  A859  A2 1A              LDX #ERRCN
01140  A85B  A4 3E              LDY OLDTXT+1
01141  A85D  D0 03              BNE *+5
01142  A85F  4C 37 A4           JMP ERROR
01143  A862  A5 3D              LDA OLDTXT
01144  A864  85 7A              STA TXTPTR
01145  A866  84 7B              STY TXTPTR+1
01146  A868  A5 3B              LDA OLDLIN
01147  A86A  A4 3C              LDY OLDLIN+1
01148  A86C  85 39              STA CURLIN
01149  A86E  84 3A              STY CURLIN+1
01150  A870  60          CONTRT RTS
01151  A871  08          RUN    PHP
01152  A872  A9 00              LDA #0          ;NO KERNAL MESSAGES
01153  A874  20 90 FF           JSR SETMSG
01154  A877  28                 PLP
01155  A878  D0 03              BNE *+5
01156  A87A  4C 59 A6           JMP RUNC
01157  A87D  20 60 A6           JSR CLEARC
01158  A880  4C 97 A8           JMP RUNC2
01159  A883  A9 03       GOSUB  LDA #3
01160  A885  20 FB A3           JSR GETSTK
01161  A888  A5 7B              LDA TXTPTR+1
01162  A88A  48                 PHA
01163  A88B  A5 7A              LDA TXTPTR






CODE4......PAGE 001C

LINE# LOC   CODE        LINE


01164  A88D  48                 PHA
01165  A88E  A5 3A              LDA CURLIN+1
01166  A890  48                 PHA
01167  A891  A5 39              LDA CURLIN
01168  A893  48                 PHA
01169  A894  A9 8D              LDA #GOSUTK
01170  A896  48                 PHA
01171  A897  20 79 00    RUNC2  JSR CHRGOT
01172  A89A  20 A0 A8           JSR GOTO
01173  A89D  4C AE A7           JMP NEWSTT
01174  A8A0  20 6B A9    GOTO   JSR LINGET
01175  A8A3  20 09 A9           JSR REMN
01176  A8A6  38                 SEC
01177  A8A7  A5 39              LDA CURLIN
01178  A8A9  E5 14              SBC LINNUM
01179  A8AB  A5 3A              LDA CURLIN+1
01180  A8AD  E5 15              SBC LINNUM+1
01181  A8AF  B0 0B              BCS LUK4IT
01182  A8B1  98                 TYA
01183  A8B2  38                 SEC
01184  A8B3  65 7A              ADC TXTPTR
01185  A8B5  A6 7B              LDX TXTPTR+1
01186  A8B7  90 07              BCC LUKALL
01187  A8B9  E8                 INX
01188  A8BA  B0 04              BCS LUKALL
01189  A8BC  A5 2B       LUK4IT LDA TXTTAB
01190  A8BE  A6 2C              LDX TXTTAB+1
01191  A8C0  20 17 A6    LUKALL JSR FNDLNC
01192  A8C3  90 1E              BCC USERR
01193  A8C5  A5 5F              LDA LOWTR
01194  A8C7  E9 01              SBC #1
01195  A8C9              .END
01196  A8C9              .LIB   CODE5




























CODE5......PAGE 001D

LINE# LOC   CODE        LINE


01198  A8C9  85 7A              STA TXTPTR
01199  A8CB  A5 60              LDA LOWTR+1
01200  A8CD  E9 00              SBC #0
01201  A8CF  85 7B              STA TXTPTR+1
01202  A8D1  60          GORTS  RTS
01203  A8D2  D0 FD       RETURN BNE GORTS
01204  A8D4  A9 FF              LDA #255
01205  A8D6  85 4A              STA FORPNT+1
01206  A8D8  20 8A A3           JSR FNDFOR
01207  A8DB  9A                 TXS
01208  A8DC  C9 8D              CMP #GOSUTK
01209  A8DE  F0 0B              BEQ RETU1
01210  A8E0  A2 0C              LDX #ERRRG
01211  A8E2  2C                 .BYT $2C
01212  A8E3  A2 11       USERR  LDX #ERRUS
01213  A8E5  4C 37 A4           JMP ERROR
01214  A8E8  4C 08 AF    SNERR2 JMP SNERR
01215  A8EB  68          RETU1  PLA
01216  A8EC  68                 PLA
01217  A8ED  85 39              STA CURLIN
01218  A8EF  68                 PLA
01219  A8F0  85 3A              STA CURLIN+1
01220  A8F2  68                 PLA
01221  A8F3  85 7A              STA TXTPTR
01222  A8F5  68                 PLA
01223  A8F6  85 7B              STA TXTPTR+1
01224  A8F8  20 06 A9    DATA   JSR DATAN
01225  A8FB  98          ADDON  TYA
01226  A8FC  18                 CLC
01227  A8FD  65 7A              ADC TXTPTR
01228  A8FF  85 7A              STA TXTPTR
01229  A901  90 02              BCC REMRTS
01230  A903  E6 7B              INC TXTPTR+1
01231  A905  60          REMRTS RTS
01232  A906  A2 3A       DATAN  LDX #':
01233  A908  2C                 .BYT $2C
01234  A909  A2 00       REMN   LDX #0
01235  A90B  86 07              STX CHARAC
01236  A90D  A0 00              LDY #0
01237  A90F  84 08              STY ENDCHR
01238  A911  A5 08       EXCHQT LDA ENDCHR
01239  A913  A6 07              LDX CHARAC
01240  A915  85 07              STA CHARAC
01241  A917  86 08              STX ENDCHR
01242  A919  B1 7A       REMER  LDA (TXTPTR)Y
01243  A91B  F0 E8              BEQ REMRTS
01244  A91D  C5 08              CMP ENDCHR
01245  A91F  F0 E4              BEQ REMRTS
01246  A921  C8                 INY
01247  A922  C9 22              CMP #34
01248  A924  D0 F3              BNE REMER
01249  A926  F0 E9              BEQ EXCHQT
01250  A928  20 9E AD    IF     JSR FRMEVL
01251  A92B  20 79 00           JSR CHRGOT
01252  A92E  C9 89              CMP #GOTOTK






CODE5......PAGE 001E

LINE# LOC   CODE        LINE


01253  A930  F0 05              BEQ OKGOTO
01254  A932  A9 A7              LDA #THENTK
01255  A934  20 FF AE           JSR SYNCHR
01256  A937  A5 61       OKGOTO LDA FACEXP
01257  A939  D0 05              BNE DOCOND
01258  A93B  20 09 A9    REM    JSR REMN
01259  A93E  F0 BB              BEQ ADDON
01260  A940  20 79 00    DOCOND JSR CHRGOT
01261  A943  B0 03              BCS DOCO
01262  A945  4C A0 A8           JMP GOTO
01263  A948  4C ED A7    DOCO   JMP GONE3
01264  A94B  20 9E B7    ONGOTO JSR GETBYT
01265  A94E  48                 PHA
01266  A94F  C9 8D              CMP #GOSUTK
01267  A951  F0 04              BEQ ONGLOP
01268  A953  C9 89       SNERR3 CMP #GOTOTK
01269  A955  D0 91              BNE SNERR2
01270  A957  C6 65       ONGLOP DEC FACLO
01271  A959  D0 04              BNE ONGLP1
01272  A95B  68                 PLA
01273  A95C  4C EF A7           JMP GONE2
01274  A95F  20 73 00    ONGLP1 JSR CHRGET
01275  A962  20 6B A9           JSR LINGET
01276  A965  C9 2C              CMP #44
01277  A967  F0 EE              BEQ ONGLOP
01278  A969  68                 PLA
01279  A96A  60          ONGRTS RTS
01280  A96B  A2 00       LINGET LDX #0
01281  A96D  86 14              STX LINNUM
01282  A96F  86 15              STX LINNUM+1
01283  A971  B0 F7       MORLIN BCS ONGRTS
01284  A973  E9 2F              SBC #$2F
01285  A975  85 07              STA CHARAC
01286  A977  A5 15              LDA LINNUM+1
01287  A979  85 22              STA INDEX
01288  A97B  C9 19              CMP #25
01289  A97D  B0 D4              BCS SNERR3
01290  A97F  A5 14              LDA LINNUM
01291  A981  0A                 ASL A
01292  A982  26 22              ROL INDEX
01293  A984  0A                 ASL A
01294  A985  26 22              ROL INDEX
01295  A987  65 14              ADC LINNUM
01296  A989  85 14              STA LINNUM
01297  A98B  A5 22              LDA INDEX
01298  A98D  65 15              ADC LINNUM+1
01299  A98F  85 15              STA LINNUM+1
01300  A991  06 14              ASL LINNUM
01301  A993  26 15              ROL LINNUM+1
01302  A995  A5 14              LDA LINNUM
01303  A997  65 07              ADC CHARAC
01304  A999  85 14              STA LINNUM
01305  A99B  90 02              BCC NXTLGC
01306  A99D  E6 15              INC LINNUM+1
01307  A99F  20 73 00    NXTLGC JSR CHRGET






CODE5......PAGE 001F

LINE# LOC   CODE        LINE


01308  A9A2  4C 71 A9           JMP MORLIN
01309  A9A5  20 8B B0    LET    JSR PTRGET
01310  A9A8  85 49              STA FORPNT
01311  A9AA  84 4A              STY FORPNT+1
01312  A9AC  A9 B2              LDA #$B2
01313  A9AE  20 FF AE           JSR SYNCHR
01314  A9B1  A5 0E              LDA INTFLG
01315  A9B3  48                 PHA
01316  A9B4  A5 0D              LDA VALTYP
01317  A9B6  48                 PHA
01318  A9B7  20 9E AD           JSR FRMEVL
01319  A9BA  68                 PLA
01320  A9BB  2A                 ROL A
01321  A9BC  20 90 AD           JSR CHKVAL
01322  A9BF  D0 18              BNE COPSTR
01323  A9C1  68                 PLA
01324  A9C2  10 12       QINTGR BPL COPFLT
01325  A9C4  20 1B BC           JSR ROUND
01326  A9C7  20 BF B1           JSR AYINT
01327  A9CA  A0 00              LDY #0
01328  A9CC  A5 64              LDA FACMO
01329  A9CE  91 49              STA (FORPNT)Y
01330  A9D0  C8                 INY
01331  A9D1  A5 65              LDA FACLO
01332  A9D3  91 49              STA (FORPNT)Y
01333  A9D5  60                 RTS
01334  A9D6  4C D0 BB    COPFLT JMP MOVVF
01335  A9D9  68          COPSTR PLA
01336  A9DA  A4 4A       INPCOM LDY FORPNT+1
01337  A9DC  C0 BF              CPY #>ZERO
01338  A9DE  D0 4C              BNE GETSPT
01339  A9E0  20 A6 B6           JSR FREFAC
01340  A9E3  C9 06              CMP #6
01341  A9E5  D0 3D              BNE FCERR2
01342  A9E7  A0 00              LDY #0
01343  A9E9  84 61              STY FACEXP
01344  A9EB  84 66              STY FACSGN
01345  A9ED              .END
01346  A9ED              .LIB   CODE6






















CODE6......PAGE 0020

LINE# LOC   CODE        LINE


01348  A9ED  84 71       TIMELP STY FBUFPT
01349  A9EF  20 1D AA           JSR TIMNUM
01350  A9F2  20 E2 BA           JSR MUL10
01351  A9F5  E6 71              INC FBUFPT
01352  A9F7  A4 71              LDY FBUFPT
01353  A9F9  20 1D AA           JSR TIMNUM
01354  A9FC  20 0C BC           JSR MOVAF
01355  A9FF  AA                 TAX
01356  AA00  F0 05              BEQ NOML6
01357  AA02  E8                 INX
01358  AA03  8A                 TXA
01359  AA04  20 ED BA           JSR FINML6
01360  AA07  A4 71       NOML6  LDY FBUFPT
01361  AA09  C8                 INY
01362  AA0A  C0 06              CPY #6
01363  AA0C  D0 DF              BNE TIMELP
01364  AA0E  20 E2 BA           JSR MUL10
01365  AA11  20 9B BC           JSR QINT
01366  AA14  A6 64              LDX FACMO
01367  AA16  A4 63              LDY FACMOH
01368  AA18  A5 65              LDA FACLO
01369  AA1A  4C DB FF           JMP SETTIM
01370  AA1D  B1 22       TIMNUM LDA (INDEX)Y
01371  AA1F  20 80 00           JSR QNUM
01372  AA22  90 03              BCC GOTNUM
01373  AA24  4C 48 B2    FCERR2 JMP FCERR
01374  AA27  E9 2F       GOTNUM SBC #$2F
01375  AA29  4C 7E BD           JMP FINLOG
01376  AA2C  A0 02       GETSPT LDY #2
01377  AA2E  B1 64              LDA (FACMO)Y
01378  AA30  C5 34              CMP FRETOP+1
01379  AA32  90 17              BCC DNTCPY
01380  AA34  D0 07              BNE QVARIA
01381  AA36  88                 DEY
01382  AA37  B1 64              LDA (FACMO)Y
01383  AA39  C5 33              CMP FRETOP
01384  AA3B  90 0E              BCC DNTCPY
01385  AA3D  A4 65       QVARIA LDY FACLO
01386  AA3F  C4 2E              CPY VARTAB+1
01387  AA41  90 08              BCC DNTCPY
01388  AA43  D0 0D              BNE COPY
01389  AA45  A5 64              LDA FACMO
01390  AA47  C5 2D              CMP VARTAB
01391  AA49  B0 07              BCS COPY
01392  AA4B  A5 64       DNTCPY LDA FACMO
01393  AA4D  A4 65              LDY FACMO+1
01394  AA4F  4C 68 AA           JMP COPYC
01395  AA52  A0 00       COPY   LDY #0
01396  AA54  B1 64              LDA (FACMO)Y
01397  AA56  20 75 B4           JSR STRINI
01398  AA59  A5 50              LDA DSCPNT
01399  AA5B  A4 51              LDY DSCPNT+1
01400  AA5D  85 6F              STA STRNG1
01401  AA5F  84 70              STY STRNG1+1
01402  AA61  20 7A B6           JSR MOVINS






CODE6......PAGE 0021

LINE# LOC   CODE        LINE


01403  AA64  A9 61              LDA #<DSCTMP
01404  AA66  A0 00              LDY #>DSCTMP
01405  AA68  85 50       COPYC  STA DSCPNT
01406  AA6A  84 51              STY DSCPNT+1
01407  AA6C  20 DB B6           JSR FRETMS
01408  AA6F  A0 00              LDY #0
01409  AA71  B1 50              LDA (DSCPNT)Y
01410  AA73  91 49              STA (FORPNT)Y
01411  AA75  C8                 INY
01412  AA76  B1 50              LDA (DSCPNT)Y
01413  AA78  91 49              STA (FORPNT)Y
01414  AA7A  C8                 INY
01415  AA7B  B1 50              LDA (DSCPNT)Y
01416  AA7D  91 49              STA (FORPNT)Y
01417  AA7F  60                 RTS
01418  AA80  20 86 AA    PRINTN JSR CMD
01419  AA83  4C B5 AB           JMP IODONE
01420  AA86  20 9E B7    CMD    JSR GETBYT
01421  AA89  F0 05              BEQ SAVEIT
01422  AA8B  A9 2C              LDA #44
01423  AA8D  20 FF AE           JSR SYNCHR
01424  AA90  08          SAVEIT PHP
01425  AA91  86 13              STX CHANNL
01426  AA93  20 18 E1           JSR COOUT
01427  AA96  28                 PLP
01428  AA97  4C A0 AA           JMP PRINT
01429  AA9A  20 21 AB    STRDON JSR STRPRT
01430  AA9D  20 79 00    NEWCHR JSR CHRGOT
01431  AAA0  F0 35       PRINT  BEQ CRDO
01432  AAA2  F0 43       PRINTC BEQ PRTRTS
01433  AAA4  C9 A3              CMP #TABTK
01434  AAA6  F0 50              BEQ TABER
01435  AAA8  C9 A6              CMP #SPCTK
01436  AAAA  18                 CLC
01437  AAAB  F0 4B              BEQ TABER
01438  AAAD  C9 2C              CMP #44
01439  AAAF  F0 37              BEQ COMPRT
01440  AAB1  C9 3B              CMP #59
01441  AAB3  F0 5E              BEQ NOTABR
01442  AAB5  20 9E AD           JSR FRMEVL
01443  AAB8  24 0D              BIT VALTYP
01444  AABA  30 DE              BMI STRDON
01445  AABC  20 DD BD           JSR FOUT
01446  AABF  20 87 B4           JSR STRLIT
01447  AAC2  20 21 AB           JSR STRPRT
01448  AAC5  20 3B AB           JSR OUTSPC
01449  AAC8  D0 D3              BNE NEWCHR
01450  AACA  A9 00       FININL LDA #0
01451  AACC  9D 00 02           STA BUF,X
01452  AACF              ZZ5=BUF-1
01453  AACF  A2 FF              LDX #<ZZ5
01454  AAD1  A0 01              LDY #>ZZ5
01455  AAD3  A5 13              LDA CHANNL
01456  AAD5  D0 10              BNE PRTRTS
01457  AAD7  A9 0D       CRDO   LDA #13






CODE6......PAGE 0022

LINE# LOC   CODE        LINE


01458  AAD9  20 47 AB           JSR OUTDO
01459  AADC  24 13              BIT CHANNL
01460  AADE  10 05              BPL CRFIN
01461  AAE0              ;
01462  AAE0  A9 0A              LDA #10
01463  AAE2  20 47 AB           JSR OUTDO
01464  AAE5  49 FF       CRFIN  EOR #255
01465  AAE7  60          PRTRTS RTS
01466  AAE8  38          COMPRT SEC
01467  AAE9  20 F0 FF           JSR PLOT        ;GET TAB POSITION IN X
01468  AAEC  98                 TYA
01469  AAED              NCMPOS =@36
01470  AAED  38                 SEC
01471  AAEE  E9 0A       MORCO1 SBC #CLMWID
01472  AAF0  B0 FC              BCS MORCO1
01473  AAF2  49 FF              EOR #255
01474  AAF4  69 01              ADC #1
01475  AAF6  D0 16              BNE ASPAC
01476  AAF8  08          TABER  PHP
01477  AAF9  38                 SEC
01478  AAFA  20 F0 FF           JSR PLOT        ;READ TAB POSITION
01479  AAFD  84 09              STY TRMPOS
01480  AAFF  20 9B B7           JSR GTBYTC
01481  AB02  C9 29              CMP #41
01482  AB04  D0 59              BNE SNERR4
01483  AB06  28                 PLP
01484  AB07  90 06              BCC XSPAC
01485  AB09  8A                 TXA
01486  AB0A  E5 09              SBC TRMPOS
01487  AB0C  90 05              BCC NOTABR
01488  AB0E  AA          ASPAC  TAX
01489  AB0F  E8          XSPAC  INX
01490  AB10  CA          XSPAC2 DEX
01491  AB11  D0 06              BNE XSPAC1
01492  AB13  20 73 00    NOTABR JSR CHRGET
01493  AB16  4C A2 AA           JMP PRINTC
01494  AB19              .END
01495  AB19              .LIB   CODE7























CODE7......PAGE 0023

LINE# LOC   CODE        LINE


01497  AB19  20 3B AB    XSPAC1 JSR OUTSPC
01498  AB1C  D0 F2              BNE XSPAC2
01499  AB1E  20 87 B4    STROUT JSR STRLIT
01500  AB21  20 A6 B6    STRPRT JSR FREFAC
01501  AB24  AA                 TAX
01502  AB25  A0 00              LDY #0
01503  AB27  E8                 INX
01504  AB28  CA          STRPR2 DEX
01505  AB29  F0 BC              BEQ PRTRTS
01506  AB2B  B1 22              LDA (INDEX)Y
01507  AB2D  20 47 AB           JSR OUTDO
01508  AB30  C8                 INY
01509  AB31  C9 0D              CMP #13
01510  AB33  D0 F3              BNE STRPR2
01511  AB35  20 E5 AA           JSR CRFIN
01512  AB38  4C 28 AB           JMP STRPR2
01513  AB3B              OUTSPC
01514  AB3B  A5 13              LDA CHANNL
01515  AB3D  F0 03              BEQ CRTSKP
01516  AB3F  A9 20              LDA #' 
01517  AB41  2C                 .BYT $2C
01518  AB42  A9 1D       CRTSKP LDA #29
01519  AB44  2C                 .BYT $2C
01520  AB45  A9 3F       OUTQST LDA #'?
01521  AB47  20 0C E1    OUTDO  JSR OUTCH
01522  AB4A  29 FF       OUTRTS AND #255
01523  AB4C  60                 RTS
01524  AB4D  A5 11       TRMNOK LDA INPFLG
01525  AB4F  F0 11              BEQ TRMNO1
01526  AB51  30 04              BMI GETDTL
01527  AB53  A0 FF              LDY #255
01528  AB55  D0 04              BNE STCURL
01529  AB57  A5 3F       GETDTL LDA DATLIN
01530  AB59  A4 40              LDY DATLIN+1
01531  AB5B  85 39       STCURL STA CURLIN
01532  AB5D  84 3A              STY CURLIN+1
01533  AB5F  4C 08 AF    SNERR4 JMP SNERR
01534  AB62  A5 13       TRMNO1 LDA CHANNL
01535  AB64  F0 05              BEQ DOAGIN
01536  AB66  A2 18              LDX #ERRBD
01537  AB68  4C 37 A4           JMP ERROR
01538  AB6B  A9 0C       DOAGIN LDA #<TRYAGN
01539  AB6D  A0 AD              LDY #>TRYAGN
01540  AB6F  20 1E AB           JSR STROUT
01541  AB72  A5 3D              LDA OLDTXT
01542  AB74  A4 3E              LDY OLDTXT+1
01543  AB76  85 7A              STA TXTPTR
01544  AB78  84 7B              STY TXTPTR+1
01545  AB7A  60                 RTS
01546  AB7B  20 A6 B3    GET    JSR ERRDIR
01547  AB7E  C9 23              CMP #'#
01548  AB80  D0 10              BNE GETTTY
01549  AB82  20 73 00           JSR CHRGET
01550  AB85  20 9E B7           JSR GETBYT
01551  AB88  A9 2C              LDA #44






CODE7......PAGE 0024

LINE# LOC   CODE        LINE


01552  AB8A  20 FF AE           JSR SYNCHR
01553  AB8D  86 13              STX CHANNL
01554  AB8F  20 1E E1           JSR COIN
01555  AB92              ZZ2=BUF+1
01556  AB92  A2 01       GETTTY LDX #<ZZ2
01557  AB94              ZZ3=BUF+2
01558  AB94  A0 02              LDY #>ZZ3
01559  AB96  A9 00              LDA #0
01560  AB98  8D 01 02           STA BUF+1
01561  AB9B  A9 40              LDA #64
01562  AB9D  20 0F AC           JSR INPCO1
01563  ABA0  A6 13              LDX CHANNL
01564  ABA2  D0 13              BNE IORELE
01565  ABA4  60                 RTS
01566  ABA5  20 9E B7    INPUTN JSR GETBYT
01567  ABA8  A9 2C              LDA #44
01568  ABAA  20 FF AE           JSR SYNCHR
01569  ABAD  86 13              STX CHANNL
01570  ABAF  20 1E E1           JSR COIN
01571  ABB2  20 CE AB           JSR NOTQTI
01572  ABB5  A5 13       IODONE LDA CHANNL
01573  ABB7  20 CC FF    IORELE JSR CLSCHN
01574  ABBA  A2 00              LDX #0
01575  ABBC  86 13              STX CHANNL
01576  ABBE  60                 RTS
01577  ABBF  C9 22       INPUT  CMP #34
01578  ABC1  D0 0B              BNE NOTQTI
01579  ABC3  20 BD AE           JSR STRTXT
01580  ABC6  A9 3B              LDA #59
01581  ABC8  20 FF AE           JSR SYNCHR
01582  ABCB  20 21 AB           JSR STRPRT
01583  ABCE  20 A6 B3    NOTQTI JSR ERRDIR
01584  ABD1  A9 2C              LDA #44
01585  ABD3  8D FF 01           STA BUF-1
01586  ABD6  20 F9 AB    GETAGN JSR QINLIN
01587  ABD9  A5 13              LDA CHANNL
01588  ABDB  F0 0D              BEQ BUFFUL
01589  ABDD  20 B7 FF           JSR READST
01590  ABE0  29 02              AND #2
01591  ABE2  F0 06              BEQ BUFFUL
01592  ABE4  20 B5 AB           JSR IODONE
01593  ABE7  4C F8 A8           JMP DATA
01594  ABEA  AD 00 02    BUFFUL LDA BUF
01595  ABED  D0 1E              BNE INPCON
01596  ABEF  A5 13              LDA CHANNL
01597  ABF1  D0 E3              BNE GETAGN
01598  ABF3  20 06 A9           JSR DATAN
01599  ABF6  4C FB A8           JMP ADDON
01600  ABF9  A5 13       QINLIN LDA CHANNL
01601  ABFB  D0 06              BNE GINLIN
01602  ABFD  20 45 AB           JSR OUTQST
01603  AC00  20 3B AB           JSR OUTSPC
01604  AC03  4C 60 A5    GINLIN JMP INLIN
01605  AC06  A6 41       READ   LDX DATPTR
01606  AC08  A4 42              LDY DATPTR+1






CODE7......PAGE 0025

LINE# LOC   CODE        LINE


01607  AC0A  A9                 .BYT $A9
01608  AC0B  98                 TYA
01609  AC0C  2C                 .BYT $2C
01610  AC0D  A9 00       INPCON LDA #0
01611  AC0F  85 11       INPCO1 STA INPFLG
01612  AC11  86 43              STX INPPTR
01613  AC13  84 44              STY INPPTR+1
01614  AC15  20 8B B0    INLOOP JSR PTRGET
01615  AC18  85 49              STA FORPNT
01616  AC1A  84 4A              STY FORPNT+1
01617  AC1C  A5 7A              LDA TXTPTR
01618  AC1E  A4 7B              LDY TXTPTR+1
01619  AC20  85 4B              STA VARTXT
01620  AC22  84 4C              STY VARTXT+1
01621  AC24  A6 43              LDX INPPTR
01622  AC26  A4 44              LDY INPPTR+1
01623  AC28  86 7A              STX TXTPTR
01624  AC2A  84 7B              STY TXTPTR+1
01625  AC2C  20 79 00           JSR CHRGOT
01626  AC2F  D0 20              BNE DATBK1
01627  AC31  24 11              BIT INPFLG
01628  AC33  50 0C              BVC QDATA
01629  AC35  20 24 E1           JSR CGETL
01630  AC38  8D 00 02           STA BUF
01631  AC3B              ZZ4=BUF-1
01632  AC3B  A2 FF              LDX #<ZZ4
01633  AC3D  A0 01              LDY #>ZZ4
01634  AC3F  D0 0C              BNE DATBK
01635  AC41  30 75       QDATA  BMI DATLOP
01636  AC43  A5 13              LDA CHANNL
01637  AC45  D0 03              BNE GETNTH
01638  AC47  20 45 AB           JSR OUTQST
01639  AC4A  20 F9 AB    GETNTH JSR QINLIN
01640  AC4D  86 7A       DATBK  STX TXTPTR
01641  AC4F  84 7B              STY TXTPTR+1
01642  AC51              .END
01643  AC51              .LIB   CODE8
























CODE8......PAGE 0026

LINE# LOC   CODE        LINE


01645  AC51  20 73 00    DATBK1 JSR CHRGET
01646  AC54  24 0D              BIT VALTYP
01647  AC56  10 31              BPL NUMINS
01648  AC58  24 11              BIT INPFLG
01649  AC5A  50 09              BVC SETQUT
01650  AC5C  E8                 INX
01651  AC5D  86 7A              STX TXTPTR
01652  AC5F  A9 00              LDA #0
01653  AC61  85 07              STA CHARAC
01654  AC63  F0 0C              BEQ RESETC
01655  AC65  85 07       SETQUT STA CHARAC
01656  AC67  C9 22              CMP #34
01657  AC69  F0 07              BEQ NOWGET
01658  AC6B  A9 3A              LDA #':
01659  AC6D  85 07              STA CHARAC
01660  AC6F  A9 2C              LDA #44
01661  AC71  18          RESETC CLC
01662  AC72  85 08       NOWGET STA ENDCHR
01663  AC74  A5 7A              LDA TXTPTR
01664  AC76  A4 7B              LDY TXTPTR+1
01665  AC78  69 00              ADC #0
01666  AC7A  90 01              BCC NOWGE1
01667  AC7C  C8                 INY
01668  AC7D  20 8D B4    NOWGE1 JSR STRLT2
01669  AC80  20 E2 B7           JSR ST2TXT
01670  AC83  20 DA A9           JSR INPCOM
01671  AC86  4C 91 AC           JMP STRDN2
01672  AC89  20 F3 BC    NUMINS JSR FIN
01673  AC8C  A5 0E              LDA INTFLG
01674  AC8E  20 C2 A9           JSR QINTGR
01675  AC91  20 79 00    STRDN2 JSR CHRGOT
01676  AC94  F0 07              BEQ TRMOK
01677  AC96  C9 2C              CMP #44
01678  AC98  F0 03              BEQ *+5
01679  AC9A  4C 4D AB           JMP TRMNOK
01680  AC9D  A5 7A       TRMOK  LDA TXTPTR
01681  AC9F  A4 7B              LDY TXTPTR+1
01682  ACA1  85 43              STA INPPTR
01683  ACA3  84 44              STY INPPTR+1
01684  ACA5  A5 4B              LDA VARTXT
01685  ACA7  A4 4C              LDY VARTXT+1
01686  ACA9  85 7A              STA TXTPTR
01687  ACAB  84 7B              STY TXTPTR+1
01688  ACAD  20 79 00           JSR CHRGOT
01689  ACB0  F0 2D              BEQ VAREND
01690  ACB2  20 FD AE           JSR CHKCOM
01691  ACB5  4C 15 AC           JMP INLOOP
01692  ACB8  20 06 A9    DATLOP JSR DATAN
01693  ACBB  C8                 INY
01694  ACBC  AA                 TAX
01695  ACBD  D0 12              BNE NOWLIN
01696  ACBF  A2 0D              LDX #ERROD
01697  ACC1  C8                 INY
01698  ACC2  B1 7A              LDA (TXTPTR)Y
01699  ACC4  F0 6C              BEQ ERRGO5






CODE8......PAGE 0027

LINE# LOC   CODE        LINE


01700  ACC6  C8                 INY
01701  ACC7  B1 7A              LDA (TXTPTR)Y
01702  ACC9  85 3F              STA DATLIN
01703  ACCB  C8                 INY
01704  ACCC  B1 7A              LDA (TXTPTR)Y
01705  ACCE  C8                 INY
01706  ACCF  85 40              STA DATLIN+1
01707  ACD1  20 FB A8    NOWLIN JSR ADDON       ;TXTPTR+.Y
01708  ACD4  20 79 00           JSR CHRGOT      ;SPAN BLANKS
01709  ACD7  AA                 TAX             ;USED LATER
01710  ACD8  E0 83              CPX #DATATK
01711  ACDA  D0 DC              BNE DATLOP
01712  ACDC  4C 51 AC           JMP DATBK1
01713  ACDF  A5 43       VAREND LDA INPPTR
01714  ACE1  A4 44              LDY INPPTR+1
01715  ACE3  A6 11              LDX INPFLG
01716  ACE5  10 03              BPL VARY0
01717  ACE7  4C 27 A8           JMP RESFIN
01718  ACEA  A0 00       VARY0  LDY #0
01719  ACEC  B1 43              LDA (INPPTR)Y
01720  ACEE  F0 0B              BEQ INPRTS
01721  ACF0  A5 13              LDA CHANNL
01722  ACF2  D0 07              BNE INPRTS
01723  ACF4  A9 FC              LDA #<EXIGNT
01724  ACF6  A0 AC              LDY #>EXIGNT
01725  ACF8  4C 1E AB           JMP STROUT
01726  ACFB  60          INPRTS RTS
01727  ACFC  3F 45       EXIGNT .BYT '?EXTRA IGNORED'
01728  AD0A  0D                 .BYT $D
01729  AD0B  00                 .BYT 0
01730  AD0C  3F 52       TRYAGN .BYT '?REDO FROM START'
01731  AD1C  0D                 .BYT $D
01732  AD1D  00                 .BYT 0
01733  AD1E  D0 04       NEXT   BNE GETFOR
01734  AD20  A0 00              LDY #0
01735  AD22  F0 03              BEQ STXFOR
01736  AD24  20 8B B0    GETFOR JSR PTRGET
01737  AD27  85 49       STXFOR STA FORPNT
01738  AD29  84 4A              STY FORPNT+1
01739  AD2B  20 8A A3           JSR FNDFOR
01740  AD2E  F0 05              BEQ HAVFOR
01741  AD30  A2 0A              LDX #ERRNF
01742  AD32  4C 37 A4    ERRGO5 JMP ERROR       ;CHANGE
01743  AD35  9A          HAVFOR TXS
01744  AD36  8A                 TXA
01745  AD37  18                 CLC
01746  AD38  69 04              ADC #4
01747  AD3A  48                 PHA
01748  AD3B  69 06              ADC #5+ADDPRC
01749  AD3D  85 24              STA INDEX2
01750  AD3F  68                 PLA
01751  AD40  A0 01              LDY #1
01752  AD42  20 A2 BB           JSR MOVFM
01753  AD45  BA                 TSX
01754  AD46  BD 09 01           LDA ADDPRC+264,X






CODE8......PAGE 0028

LINE# LOC   CODE        LINE


01755  AD49  85 66              STA FACSGN
01756  AD4B  A5 49              LDA FORPNT
01757  AD4D  A4 4A              LDY FORPNT+1
01758  AD4F  20 67 B8           JSR FADD
01759  AD52  20 D0 BB           JSR MOVVF
01760  AD55  A0 01              LDY #1
01761  AD57  20 5D BC           JSR FCOMPN
01762  AD5A  BA                 TSX
01763  AD5B  38                 SEC
01764  AD5C  FD 09 01           SBC ADDPRC+264,X
01765  AD5F  F0 17              BEQ LOOPDN
01766  AD61  BD 0F 01           LDA 269+ADDPRC+ADDPRC,X
01767  AD64  85 39              STA CURLIN
01768  AD66  BD 10 01           LDA 270+ADDPRC+ADDPRC,X
01769  AD69  85 3A              STA CURLIN+1
01770  AD6B  BD 12 01           LDA 272+ADDPRC+ADDPRC,X
01771  AD6E  85 7A              STA TXTPTR
01772  AD70  BD 11 01           LDA 271+ADDPRC+ADDPRC,X
01773  AD73  85 7B              STA TXTPTR+1
01774  AD75  4C AE A7    NEWSGO JMP NEWSTT
01775  AD78  8A          LOOPDN TXA
01776  AD79  69 11              ADC #15+ADDPRC+ADDPRC
01777  AD7B  AA                 TAX
01778  AD7C  9A                 TXS 
01779  AD7D  20 79 00           JSR CHRGOT
01780  AD80  C9 2C              CMP #44
01781  AD82  D0 F1              BNE NEWSGO
01782  AD84  20 73 00           JSR CHRGET
01783  AD87  20 24 AD           JSR GETFOR
01784  AD8A  20 9E AD    FRMNUM JSR FRMEVL
01785  AD8D  18          CHKNUM CLC
01786  AD8E  24                 .BYT $24
01787  AD8F  38          CHKSTR SEC
01788  AD90  24 0D       CHKVAL BIT VALTYP
01789  AD92              .END
01790  AD92              .LIB   CODE9

























CODE9......PAGE 0029

LINE# LOC   CODE        LINE


01792  AD92  30 03              BMI DOCSTR
01793  AD94  B0 03              BCS CHKERR
01794  AD96  60          CHKOK  RTS
01795  AD97  B0 FD       DOCSTR BCS CHKOK
01796  AD99  A2 16       CHKERR LDX #ERRTM
01797  AD9B  4C 37 A4    ERRGO4 JMP ERROR
01798  AD9E  A6 7A       FRMEVL LDX TXTPTR
01799  ADA0  D0 02              BNE FRMEV1
01800  ADA2  C6 7B              DEC TXTPTR+1
01801  ADA4  C6 7A       FRMEV1 DEC TXTPTR
01802  ADA6  A2 00              LDX #0
01803  ADA8  24                 .BYT $24
01804  ADA9  48          LPOPER PHA
01805  ADAA  8A                 TXA
01806  ADAB  48                 PHA
01807  ADAC  A9 01              LDA #1
01808  ADAE  20 FB A3           JSR GETSTK
01809  ADB1  20 83 AE           JSR EVAL
01810  ADB4  A9 00              LDA #0
01811  ADB6  85 4D              STA OPMASK
01812  ADB8  20 79 00    TSTOP  JSR CHRGOT
01813  ADBB  38          LOPREL SEC
01814  ADBC  E9 B1              SBC #GREATK
01815  ADBE  90 17              BCC ENDREL
01816  ADC0  C9 03              CMP #LESSTK-GREATK+1
01817  ADC2  B0 13              BCS ENDREL
01818  ADC4  C9 01              CMP #1
01819  ADC6  2A                 ROL A
01820  ADC7  49 01              EOR #1
01821  ADC9  45 4D              EOR OPMASK
01822  ADCB  C5 4D              CMP OPMASK
01823  ADCD  90 61              BCC SNERR5
01824  ADCF  85 4D              STA OPMASK
01825  ADD1  20 73 00           JSR CHRGET
01826  ADD4  4C BB AD           JMP LOPREL
01827  ADD7  A6 4D       ENDREL LDX OPMASK
01828  ADD9  D0 2C              BNE FINREL
01829  ADDB  B0 7B              BCS QOP
01830  ADDD  69 07              ADC #GREATK-PLUSTK
01831  ADDF  90 77              BCC QOP
01832  ADE1  65 0D              ADC VALTYP
01833  ADE3  D0 03              BNE *+5
01834  ADE5  4C 3D B6           JMP CAT
01835  ADE8  69 FF              ADC #$FF
01836  ADEA  85 22              STA INDEX1
01837  ADEC  0A                 ASL A
01838  ADED  65 22              ADC INDEX1
01839  ADEF  A8                 TAY 
01840  ADF0  68          QPREC  PLA
01841  ADF1  D9 80 A0           CMP OPTAB,Y
01842  ADF4  B0 67              BCS QCHNUM
01843  ADF6  20 8D AD           JSR CHKNUM
01844  ADF9  48          DOPREC PHA
01845  ADFA  20 20 AE    NEGPRC JSR DOPRE1
01846  ADFD  68                 PLA






CODE9......PAGE 002A

LINE# LOC   CODE        LINE


01847  ADFE  A4 4B              LDY OPPTR
01848  AE00  10 17              BPL QPREC1
01849  AE02  AA                 TAX
01850  AE03  F0 56              BEQ QOPGO
01851  AE05  D0 5F              BNE PULSTK
01852  AE07  46 0D       FINREL LSR VALTYP
01853  AE09  8A                 TXA
01854  AE0A  2A                 ROL A
01855  AE0B  A6 7A              LDX TXTPTR
01856  AE0D  D0 02              BNE FINRE2
01857  AE0F  C6 7B              DEC TXTPTR+1
01858  AE11  C6 7A       FINRE2 DEC TXTPTR
01859  AE13  A0 1B              LDY #PTDORL-OPTAB
01860  AE15  85 4D              STA OPMASK
01861  AE17  D0 D7              BNE QPREC
01862  AE19  D9 80 A0    QPREC1 CMP OPTAB,Y
01863  AE1C  B0 48              BCS PULSTK
01864  AE1E  90 D9              BCC DOPREC
01865  AE20  B9 82 A0    DOPRE1 LDA OPTAB+2,Y
01866  AE23  48                 PHA
01867  AE24  B9 81 A0           LDA OPTAB+1,Y
01868  AE27  48                 PHA
01869  AE28  20 33 AE           JSR PUSHF1
01870  AE2B  A5 4D              LDA OPMASK
01871  AE2D  4C A9 AD           JMP LPOPER
01872  AE30  4C 08 AF    SNERR5 JMP SNERR
01873  AE33  A5 66       PUSHF1 LDA FACSGN
01874  AE35  BE 80 A0           LDX OPTAB,Y
01875  AE38  A8          PUSHF  TAY
01876  AE39  68                 PLA
01877  AE3A  85 22              STA INDEX1
01878  AE3C  E6 22              INC INDEX1
01879  AE3E  68                 PLA
01880  AE3F  85 23              STA INDEX1+1
01881  AE41  98                 TYA
01882  AE42  48                 PHA
01883  AE43  20 1B BC    FORPSH JSR ROUND
01884  AE46  A5 65              LDA FACLO
01885  AE48  48                 PHA
01886  AE49  A5 64              LDA FACMO
01887  AE4B  48                 PHA
01888  AE4C  A5 63              LDA FACMOH
01889  AE4E  48                 PHA
01890  AE4F  A5 62              LDA FACHO
01891  AE51  48                 PHA
01892  AE52  A5 61              LDA FACEXP
01893  AE54  48                 PHA
01894  AE55  6C 22 00           JMP (INDEX1)
01895  AE58  A0 FF       QOP    LDY #255
01896  AE5A  68                 PLA
01897  AE5B  F0 23       QOPGO  BEQ QOPRTS
01898  AE5D  C9 64       QCHNUM CMP #100
01899  AE5F  F0 03              BEQ UNPSTK
01900  AE61  20 8D AD           JSR CHKNUM
01901  AE64  84 4B       UNPSTK STY OPPTR






CODE9......PAGE 002B

LINE# LOC   CODE        LINE


01902  AE66  68          PULSTK PLA
01903  AE67  4A                 LSR A
01904  AE68  85 12              STA DOMASK
01905  AE6A  68                 PLA
01906  AE6B  85 69              STA ARGEXP
01907  AE6D  68                 PLA
01908  AE6E  85 6A              STA ARGHO
01909  AE70  68                 PLA
01910  AE71  85 6B              STA ARGMOH
01911  AE73  68                 PLA
01912  AE74  85 6C              STA ARGMO
01913  AE76  68                 PLA
01914  AE77  85 6D              STA ARGLO
01915  AE79  68                 PLA
01916  AE7A  85 6E              STA ARGSGN
01917  AE7C  45 66              EOR FACSGN
01918  AE7E  85 6F              STA ARISGN
01919  AE80  A5 61       QOPRTS LDA FACEXP
01920  AE82  60          UNPRTS RTS





01922  AE83  6C 0A 03    EVAL   JMP (IEVAL)
01923  AE86  A9 00       NEVAL  LDA #0
01924  AE88  85 0D              STA VALTYP
01925  AE8A  20 73 00    EVAL0  JSR CHRGET
01926  AE8D  B0 03              BCS EVAL2
01927  AE8F  4C F3 BC    EVAL1  JMP FIN
01928  AE92  20 13 B1    EVAL2  JSR ISLETC
01929  AE95  90 03              BCC *+5
01930  AE97  4C 28 AF           JMP ISVAR
01931  AE9A  C9 FF              CMP #PI
01932  AE9C  D0 0F              BNE QDOT
01933  AE9E  A9 A8              LDA #<PIVAL
01934  AEA0  A0 AE              LDY #>PIVAL
01935  AEA2  20 A2 BB           JSR MOVFM
01936  AEA5  4C 73 00           JMP CHRGET
01937  AEA8  82          PIVAL  .BYT @202
01938  AEA9  49                 .BYT @111
01939  AEAA  0F                 .BYT @017
01940  AEAB  DA                 .BYT @332
01941  AEAC  A1                 .BYT @241
01942  AEAD  C9 2E       QDOT   CMP #'.
01943  AEAF  F0 DE              BEQ EVAL1
01944  AEB1  C9 AB              CMP #MINUTK
01945  AEB3  F0 58              BEQ DOMIN
01946  AEB5  C9 AA              CMP #PLUSTK
01947  AEB7  F0 D1              BEQ EVAL0
01948  AEB9  C9 22              CMP #34
01949  AEBB  D0 0F              BNE EVAL3
01950  AEBD  A5 7A       STRTXT LDA TXTPTR
01951  AEBF  A4 7B              LDY TXTPTR+1
01952  AEC1  69 00              ADC #0






CODE9......PAGE 002C

LINE# LOC   CODE        LINE


01953  AEC3  90 01              BCC STRTX2
01954  AEC5  C8                 INY
01955  AEC6  20 87 B4    STRTX2 JSR STRLIT
01956  AEC9  4C E2 B7           JMP ST2TXT
01957  AECC  C9 A8       EVAL3  CMP #NOTTK
01958  AECE  D0 13              BNE EVAL4
01959  AED0  A0 18              LDY #24
01960  AED2  D0 3B              BNE GONPRC
01961  AED4  20 BF B1    NOTOP  JSR AYINT
01962  AED7  A5 65              LDA FACLO
01963  AED9  49 FF              EOR #255
01964  AEDB  A8                 TAY
01965  AEDC  A5 64              LDA FACMO
01966  AEDE  49 FF              EOR #255
01967  AEE0  4C 91 B3           JMP GIVAYF
01968  AEE3  C9 A5       EVAL4  CMP #FNTK
01969  AEE5  D0 03              BNE *+5
01970  AEE7  4C F4 B3           JMP FNDOER
01971  AEEA  C9 B4              CMP #ONEFUN
01972  AEEC  90 03              BCC PARCHK
01973  AEEE  4C A7 AF           JMP ISFUN
01974  AEF1  20 FA AE    PARCHK JSR CHKOPN
01975  AEF4  20 9E AD           JSR FRMEVL
01976  AEF7  A9 29       CHKCLS LDA #41
01977  AEF9  2C                 .BYT $2C
01978  AEFA  A9 28       CHKOPN LDA #40
01979  AEFC  2C                 .BYT $2C
01980  AEFD  A9 2C       CHKCOM LDA #44
01981  AEFF  A0 00       SYNCHR LDY #0
01982  AF01  D1 7A              CMP (TXTPTR)Y
01983  AF03  D0 03              BNE SNERR
01984  AF05  4C 73 00           JMP CHRGET
01985  AF08  A2 0B       SNERR  LDX #ERRSN
01986  AF0A  4C 37 A4           JMP ERROR
01987  AF0D  A0 15       DOMIN  LDY #21
01988  AF0F  68          GONPRC PLA
01989  AF10  68                 PLA
01990  AF11  4C FA AD           JMP NEGPRC
01991  AF14              .END
01992  AF14              .LIB   CODE10





















CODE10......PAGE 002D

LINE# LOC   CODE        LINE


01994  AF14              ;TEST POINTER TO VARIABLE TO SEE
01995  AF14              ;IF CONSTANT IS CONTAINED IN BASIC.
01996  AF14              ;ARRAY VARIABLES HAVE ZEROES PLACED
01997  AF14              ;IN RAM. UNDEFINED SIMPLE VARIABLES
01998  AF14              ;HAVE POINTER T ZERO IN BASIC.
01999  AF14              ;
02000  AF14  38          TSTROM SEC
02001  AF15  A5 64              LDA FACMO
02002  AF17  E9 00              SBC #<ROMLOC
02003  AF19  A5 65              LDA FACLO
02004  AF1B  E9 A0              SBC #>ROMLOC
02005  AF1D  90 08              BCC TSTR10
02006  AF1F              ;
02007  AF1F  A9 A2              LDA #<INITAT
02008  AF21  E5 64              SBC FACMO
02009  AF23  A9 E3              LDA #>INITAT
02010  AF25  E5 65              SBC FACLO
02011  AF27              ;
02012  AF27  60          TSTR10 RTS





02014  AF28  20 8B B0    ISVAR  JSR PTRGET
02015  AF2B  85 64       ISVRET STA FACMO
02016  AF2D  84 65              STY FACMO+1
02017  AF2F  A6 45              LDX VARNAM
02018  AF31  A4 46              LDY VARNAM+1
02019  AF33  A5 0D              LDA VALTYP
02020  AF35  F0 26              BEQ GOOO
02021  AF37  A9 00              LDA #0
02022  AF39  85 70              STA FACOV
02023  AF3B  20 14 AF           JSR TSTROM      ;SEE IF AN ARRAY
02024  AF3E  90 1C              BCC STRRTS      ;DON'T TEST ST(I),TI(I)
02025  AF40  E0 54              CPX #'T
02026  AF42  D0 18              BNE STRRTS
02027  AF44  C0 C9              CPY #$C9
02028  AF46  D0 14              BNE STRRTS
02029  AF48  20 84 AF           JSR GETTIM
02030  AF4B  84 5E              STY TENEXP
02031  AF4D  88                 DEY
02032  AF4E  84 71              STY FBUFPT
02033  AF50  A0 06              LDY #6
02034  AF52  84 5D              STY DECCNT
02035  AF54  A0 24              LDY #FDCEND-FOUTBL
02036  AF56  20 68 BE           JSR FOUTIM
02037  AF59  4C 6F B4           JMP TIMSTR
02038  AF5C  60          STRRTS RTS
02039  AF5D  24 0E       GOOO   BIT INTFLG
02040  AF5F  10 0D              BPL GOOOOO
02041  AF61  A0 00              LDY #0
02042  AF63  B1 64              LDA (FACMO)Y
02043  AF65  AA                 TAX
02044  AF66  C8                 INY






CODE10......PAGE 002E

LINE# LOC   CODE        LINE


02045  AF67  B1 64              LDA (FACMO)Y
02046  AF69  A8                 TAY
02047  AF6A  8A                 TXA
02048  AF6B  4C 91 B3           JMP GIVAYF
02049  AF6E  20 14 AF    GOOOOO JSR TSTROM      ;SEE IF ARRAY
02050  AF71  90 2D              BCC GOMOVF      ;DON'T TEST ST(I),TI(I)
02051  AF73  E0 54              CPX #'T
02052  AF75  D0 1B              BNE QSTATV
02053  AF77  C0 49              CPY #'I
02054  AF79  D0 25              BNE GOMOVF
02055  AF7B  20 84 AF           JSR GETTIM
02056  AF7E  98                 TYA
02057  AF7F  A2 A0              LDX #160
02058  AF81  4C 4F BC           JMP FLOATB
02059  AF84  20 DE FF    GETTIM JSR RDTIM
02060  AF87  86 64              STX FACMO
02061  AF89  84 63              STY FACMOH
02062  AF8B  85 65              STA FACLO
02063  AF8D  A0 00              LDY #0
02064  AF8F  84 62              STY FACHO
02065  AF91  60                 RTS
02066  AF92  E0 53       QSTATV CPX #'S
02067  AF94  D0 0A              BNE GOMOVF
02068  AF96  C0 54              CPY #'T
02069  AF98  D0 06              BNE GOMOVF
02070  AF9A  20 B7 FF           JSR READST
02071  AF9D  4C 3C BC           JMP FLOAT
02072  AFA0  A5 64       GOMOVF LDA FACMO
02073  AFA2  A4 65              LDY FACMO+1
02074  AFA4  4C A2 BB           JMP MOVFM
02075  AFA7  0A          ISFUN  ASL A
02076  AFA8  48                 PHA
02077  AFA9  AA                 TAX
02078  AFAA  20 73 00           JSR CHRGET
02079  AFAD  E0 8F              CPX #LASNUM+LASNUM-255
02080  AFAF  90 20              BCC OKNORM
02081  AFB1  20 FA AE           JSR CHKOPN
02082  AFB4  20 9E AD           JSR FRMEVL
02083  AFB7  20 FD AE           JSR CHKCOM
02084  AFBA  20 8F AD           JSR CHKSTR
02085  AFBD  68                 PLA
02086  AFBE  AA                 TAX
02087  AFBF  A5 65              LDA FACMO+1
02088  AFC1  48                 PHA
02089  AFC2  A5 64              LDA FACMO
02090  AFC4  48                 PHA
02091  AFC5  8A                 TXA
02092  AFC6  48                 PHA
02093  AFC7  20 9E B7           JSR GETBYT
02094  AFCA  68                 PLA
02095  AFCB  A8                 TAY
02096  AFCC  8A                 TXA
02097  AFCD  48                 PHA
02098  AFCE  4C D6 AF           JMP FINGO
02099  AFD1  20 F1 AE    OKNORM JSR PARCHK






CODE10......PAGE 002F

LINE# LOC   CODE        LINE


02100  AFD4  68                 PLA
02101  AFD5  A8                 TAY
02102  AFD6  B9 EA 9F    FINGO  LDA FUNDSP-ONEFUN-ONEFUN+256,Y
02103  AFD9  85 55              STA JMPER+1
02104  AFDB  B9 EB 9F           LDA FUNDSP-ONEFUN-ONEFUN+257,Y
02105  AFDE  85 56              STA JMPER+2
02106  AFE0  20 54 00           JSR JMPER
02107  AFE3  4C 8D AD           JMP CHKNUM
02108  AFE6  A0 FF       OROP   LDY #255
02109  AFE8  2C                 .BYT $2C
02110  AFE9  A0 00       ANDOP  LDY #0
02111  AFEB  84 0B              STY COUNT
02112  AFED  20 BF B1           JSR AYINT
02113  AFF0  A5 64              LDA FACMO
02114  AFF2  45 0B              EOR COUNT
02115  AFF4  85 07              STA INTEGR
02116  AFF6  A5 65              LDA FACLO
02117  AFF8  45 0B              EOR COUNT
02118  AFFA  85 08              STA INTEGR+1
02119  AFFC  20 FC BB           JSR MOVFA
02120  AFFF  20 BF B1           JSR AYINT
02121  B002  A5 65              LDA FACLO
02122  B004  45 0B              EOR COUNT
02123  B006  25 08              AND INTEGR+1
02124  B008  45 0B              EOR COUNT
02125  B00A  A8                 TAY
02126  B00B  A5 64              LDA FACMO
02127  B00D  45 0B              EOR COUNT
02128  B00F  25 07              AND INTEGR
02129  B011  45 0B              EOR COUNT
02130  B013  4C 91 B3           JMP GIVAYF
02131  B016  20 90 AD    DOREL  JSR CHKVAL
02132  B019  B0 13              BCS STRCMP
02133  B01B  A5 6E              LDA ARGSGN
02134  B01D  09 7F              ORA #127
02135  B01F  25 6A              AND ARGHO
02136  B021  85 6A              STA ARGHO
02137  B023  A9 69              LDA #<ARGEXP
02138  B025  A0 00              LDY #>ARGEXP
02139  B027  20 5B BC           JSR FCOMP
02140  B02A  AA                 TAX
02141  B02B  4C 61 B0           JMP QCOMP
02142  B02E  A9 00       STRCMP LDA #0
02143  B030  85 0D              STA VALTYP
02144  B032  C6 4D              DEC OPMASK
02145  B034  20 A6 B6           JSR FREFAC
02146  B037  85 61              STA DSCTMP
02147  B039  86 62              STX DSCTMP+1
02148  B03B  84 63              STY DSCTMP+2
02149  B03D  A5 6C              LDA ARGMO
02150  B03F  A4 6D              LDY ARGMO+1
02151  B041  20 AA B6           JSR FRETMP
02152  B044  86 6C              STX ARGMO
02153  B046  84 6D              STY ARGMO+1
02154  B048  AA                 TAX






CODE10......PAGE 0030

LINE# LOC   CODE        LINE


02155  B049  38                 SEC
02156  B04A  E5 61              SBC DSCTMP
02157  B04C  F0 08              BEQ STASGN
02158  B04E  A9 01              LDA #1
02159  B050  90 04              BCC STASGN
02160  B052  A6 61              LDX DSCTMP
02161  B054  A9 FF              LDA #$FF
02162  B056  85 66       STASGN STA FACSGN
02163  B058  A0 FF              LDY #255
02164  B05A  E8                 INX
02165  B05B  C8          NXTCMP INY
02166  B05C  CA                 DEX
02167  B05D  D0 07              BNE GETCMP
02168  B05F  A6 66              LDX FACSGN
02169  B061  30 0F       QCOMP  BMI DOCMP
02170  B063  18                 CLC
02171  B064  90 0C              BCC DOCMP
02172  B066  B1 6C       GETCMP LDA (ARGMO)Y
02173  B068              .END
02174  B068              .LIB   CODE11









































CODE11......PAGE 0031

LINE# LOC   CODE        LINE


02176  B068  D1 62              CMP (DSCTMP+1)Y
02177  B06A  F0 EF              BEQ NXTCMP
02178  B06C  A2 FF              LDX #$FF
02179  B06E  B0 02              BCS DOCMP
02180  B070  A2 01              LDX #1
02181  B072  E8          DOCMP  INX
02182  B073  8A                 TXA
02183  B074  2A                 ROL A
02184  B075  25 12              AND DOMASK
02185  B077  F0 02              BEQ GOFLOT
02186  B079  A9 FF              LDA #$FF
02187  B07B  4C 3C BC    GOFLOT JMP FLOAT
02188  B07E  20 FD AE    DIM3   JSR CHKCOM
02189  B081  AA          DIM    TAX
02190  B082  20 90 B0           JSR PTRGT1
02191  B085  20 79 00           JSR CHRGOT
02192  B088  D0 F4              BNE DIM3
02193  B08A  60                 RTS
02194  B08B  A2 00       PTRGET LDX #0
02195  B08D  20 79 00           JSR CHRGOT
02196  B090  86 0C       PTRGT1 STX DIMFLG
02197  B092  85 45       PTRGT2 STA VARNAM
02198  B094  20 79 00           JSR CHRGOT
02199  B097  20 13 B1           JSR ISLETC
02200  B09A  B0 03              BCS PTRGT3
02201  B09C  4C 08 AF    INTERR JMP SNERR
02202  B09F  A2 00       PTRGT3 LDX #0
02203  B0A1  86 0D              STX VALTYP
02204  B0A3  86 0E              STX INTFLG
02205  B0A5  20 73 00           JSR CHRGET
02206  B0A8  90 05              BCC ISSEC
02207  B0AA  20 13 B1           JSR ISLETC
02208  B0AD  90 0B              BCC NOSEC
02209  B0AF  AA          ISSEC  TAX
02210  B0B0  20 73 00    EATEM  JSR CHRGET
02211  B0B3  90 FB              BCC EATEM
02212  B0B5  20 13 B1           JSR ISLETC
02213  B0B8  B0 F6              BCS EATEM
02214  B0BA  C9 24       NOSEC  CMP #'$
02215  B0BC  D0 06              BNE NOTSTR
02216  B0BE  A9 FF              LDA #$FF
02217  B0C0  85 0D              STA VALTYP
02218  B0C2  D0 10              BNE TURNON
02219  B0C4  C9 25       NOTSTR CMP #'%
02220  B0C6  D0 13              BNE STRNAM
02221  B0C8  A5 10              LDA SUBFLG
02222  B0CA  D0 D0              BNE INTERR
02223  B0CC  A9 80              LDA #128
02224  B0CE  85 0E              STA INTFLG
02225  B0D0  05 45              ORA VARNAM
02226  B0D2  85 45              STA VARNAM
02227  B0D4  8A          TURNON TXA
02228  B0D5  09 80              ORA #128
02229  B0D7  AA                 TAX
02230  B0D8  20 73 00           JSR CHRGET






CODE11......PAGE 0032

LINE# LOC   CODE        LINE


02231  B0DB  86 46       STRNAM STX VARNAM+1
02232  B0DD  38                 SEC
02233  B0DE  05 10              ORA SUBFLG
02234  B0E0  E9 28              SBC #40
02235  B0E2  D0 03              BNE *+5
02236  B0E4  4C D1 B1           JMP ISARY
02237  B0E7  A0 00              LDY #0
02238  B0E9  84 10              STY SUBFLG
02239  B0EB  A5 2D              LDA VARTAB
02240  B0ED  A6 2E              LDX VARTAB+1
02241  B0EF  86 60       STXFND STX LOWTR+1
02242  B0F1  85 5F       LOPFND STA LOWTR
02243  B0F3  E4 30              CPX ARYTAB+1
02244  B0F5  D0 04              BNE LOPFN
02245  B0F7  C5 2F              CMP ARYTAB
02246  B0F9  F0 22              BEQ NOTFNS
02247  B0FB  A5 45       LOPFN  LDA VARNAM
02248  B0FD  D1 5F              CMP (LOWTR)Y
02249  B0FF  D0 08              BNE NOTIT
02250  B101  A5 46              LDA VARNAM+1
02251  B103  C8                 INY
02252  B104  D1 5F              CMP (LOWTR)Y
02253  B106  F0 7D              BEQ FINPTR
02254  B108  88                 DEY
02255  B109  18          NOTIT  CLC
02256  B10A  A5 5F              LDA LOWTR
02257  B10C  69 07              ADC #6+ADDPRC
02258  B10E  90 E1              BCC LOPFND
02259  B110  E8                 INX
02260  B111  D0 DC              BNE STXFND
02261  B113  C9 41       ISLETC CMP #'A
02262  B115  90 05              BCC ISLRTS
02263  B117  E9 5B              SBC #$5B
02264  B119  38                 SEC
02265  B11A  E9 A5              SBC #@245
02266  B11C  60          ISLRTS RTS
02267  B11D  68          NOTFNS PLA
02268  B11E  48                 PHA
02269  B11F              ZZ6=ISVRET-1
02270  B11F  C9 2A              CMP #<ZZ6 
02271  B121  D0 05              BNE NOTEVL
02272  B123  A9 13       LDZR   LDA #<ZERO
02273  B125  A0 BF              LDY #>ZERO
02274  B127  60                 RTS
02275  B128  A5 45       NOTEVL LDA VARNAM
02276  B12A  A4 46              LDY VARNAM+1
02277  B12C  C9 54              CMP #'T
02278  B12E  D0 0B              BNE QSTAVR
02279  B130  C0 C9              CPY #@311
02280  B132  F0 EF              BEQ LDZR
02281  B134  C0 49              CPY #@111
02282  B136  D0 03              BNE QSTAVR
02283  B138  4C 08 AF    GOBADV JMP SNERR
02284  B13B              QSTAVR
02285  B13B  C9 53              CMP #'S






CODE11......PAGE 0033

LINE# LOC   CODE        LINE


02286  B13D  D0 04              BNE VAROK
02287  B13F  C0 54              CPY #'T
02288  B141  F0 F5              BEQ GOBADV
02289  B143  A5 2F       VAROK  LDA ARYTAB
02290  B145  A4 30              LDY ARYTAB+1
02291  B147  85 5F              STA LOWTR
02292  B149  84 60              STY LOWTR+1
02293  B14B  A5 31              LDA STREND
02294  B14D  A4 32              LDY STREND+1
02295  B14F  85 5A              STA HIGHTR
02296  B151  84 5B              STY HIGHTR+1
02297  B153  18                 CLC
02298  B154  69 07              ADC #6+ADDPRC
02299  B156  90 01              BCC NOTEVE
02300  B158  C8                 INY
02301  B159  85 58       NOTEVE STA HIGHDS
02302  B15B  84 59              STY HIGHDS+1
02303  B15D  20 B8 A3           JSR BLTU
02304  B160  A5 58              LDA HIGHDS
02305  B162  A4 59              LDY HIGHDS+1
02306  B164  C8                 INY
02307  B165  85 2F              STA ARYTAB
02308  B167  84 30              STY ARYTAB+1
02309  B169  A0 00              LDY #0
02310  B16B  A5 45              LDA VARNAM
02311  B16D  91 5F              STA (LOWTR)Y
02312  B16F  C8                 INY
02313  B170  A5 46              LDA VARNAM+1
02314  B172  91 5F              STA (LOWTR)Y
02315  B174  A9 00              LDA #0
02316  B176  C8                 INY
02317  B177  91 5F              STA (LOWTR)Y
02318  B179  C8                 INY
02319  B17A  91 5F              STA (LOWTR)Y
02320  B17C  C8                 INY
02321  B17D  91 5F              STA (LOWTR)Y
02322  B17F  C8                 INY
02323  B180  91 5F              STA (LOWTR)Y
02324  B182  C8                 INY
02325  B183  91 5F              STA (LOWTR)Y
02326  B185  A5 5F       FINPTR LDA LOWTR
02327  B187  18                 CLC
02328  B188  69 02              ADC #2
02329  B18A  A4 60              LDY LOWTR+1
02330  B18C  90 01              BCC FINNOW
02331  B18E  C8                 INY
02332  B18F  85 47       FINNOW STA VARPNT
02333  B191  84 48              STY VARPNT+1
02334  B193  60                 RTS
02335  B194  A5 0B       FMAPTR LDA COUNT
02336  B196  0A                 ASL A
02337  B197  69 05              ADC #5
02338  B199  65 5F              ADC LOWTR
02339  B19B  A4 60              LDY LOWTR+1
02340  B19D  90 01              BCC JSRGM






CODE11......PAGE 0034

LINE# LOC   CODE        LINE


02341  B19F  C8                 INY
02342  B1A0  85 58       JSRGM  STA ARYPNT
02343  B1A2  84 59              STY ARYPNT+1
02344  B1A4  60                 RTS
02345  B1A5              .END
02346  B1A5              .LIB   CODE12























































CODE12......PAGE 0035

LINE# LOC   CODE        LINE


02348  B1A5  90          N32768 .BYT 144,128,0,0,0
02348  B1A6  80 
02348  B1A7  00 
02348  B1A8  00 
02348  B1A9  00 
02349  B1AA  20 BF B1    FLPINT JSR AYINT
02350  B1AD  A5 64              LDA FACMO
02351  B1AF  A4 65              LDY  FACLO
02352  B1B1  60                 RTS
02353  B1B2  20 73 00    INTIDX JSR CHRGET
02354  B1B5  20 9E AD           JSR FRMEVL
02355  B1B8  20 8D AD    POSINT JSR CHKNUM
02356  B1BB  A5 66              LDA FACSGN
02357  B1BD  30 0D              BMI NONONO
02358  B1BF  A5 61       AYINT  LDA FACEXP
02359  B1C1  C9 90              CMP #144
02360  B1C3  90 09              BCC QINTGO
02361  B1C5  A9 A5              LDA #<N32768
02362  B1C7  A0 B1              LDY #>N32768
02363  B1C9  20 5B BC           JSR FCOMP
02364  B1CC  D0 7A       NONONO BNE FCERR
02365  B1CE  4C 9B BC    QINTGO JMP QINT
02366  B1D1  A5 0C       ISARY  LDA DIMFLG
02367  B1D3  05 0E              ORA INTFLG
02368  B1D5  48                 PHA
02369  B1D6  A5 0D              LDA VALTYP
02370  B1D8  48                 PHA
02371  B1D9  A0 00              LDY #0
02372  B1DB  98          INDLOP TYA
02373  B1DC  48                 PHA
02374  B1DD  A5 46              LDA VARNAM+1
02375  B1DF  48                 PHA
02376  B1E0  A5 45              LDA VARNAM
02377  B1E2  48                 PHA
02378  B1E3  20 B2 B1           JSR INTIDX
02379  B1E6  68                 PLA
02380  B1E7  85 45              STA VARNAM
02381  B1E9  68                 PLA
02382  B1EA  85 46              STA VARNAM+1
02383  B1EC  68                 PLA
02384  B1ED  A8                 TAY
02385  B1EE  BA                 TSX
02386  B1EF  BD 02 01           LDA 258,X
02387  B1F2  48                 PHA
02388  B1F3  BD 01 01           LDA 257,X
02389  B1F6  48                 PHA
02390  B1F7  A5 64              LDA INDICE
02391  B1F9  9D 02 01           STA 258,X
02392  B1FC  A5 65              LDA INDICE+1
02393  B1FE  9D 01 01           STA 257,X
02394  B201  C8                 INY
02395  B202  20 79 00           JSR CHRGOT
02396  B205  C9 2C              CMP #44
02397  B207  F0 D2              BEQ INDLOP
02398  B209  84 0B              STY COUNT






CODE12......PAGE 0036

LINE# LOC   CODE        LINE


02399  B20B  20 F7 AE           JSR CHKCLS
02400  B20E  68                 PLA
02401  B20F  85 0D              STA VALTYP
02402  B211  68                 PLA
02403  B212  85 0E              STA INTFLG
02404  B214  29 7F              AND #127
02405  B216  85 0C              STA DIMFLG
02406  B218  A6 2F              LDX ARYTAB
02407  B21A  A5 30              LDA ARYTAB+1
02408  B21C  86 5F       LOPFDA STX LOWTR
02409  B21E  85 60              STA LOWTR+1
02410  B220  C5 32              CMP STREND+1
02411  B222  D0 04              BNE LOPFDV
02412  B224  E4 31              CPX STREND
02413  B226  F0 39              BEQ NOTFDD
02414  B228  A0 00       LOPFDV LDY #0
02415  B22A  B1 5F              LDA (LOWTR)Y
02416  B22C  C8                 INY
02417  B22D  C5 45              CMP VARNAM
02418  B22F  D0 06              BNE NMARY1
02419  B231  A5 46              LDA VARNAM+1
02420  B233  D1 5F              CMP (LOWTR)Y
02421  B235  F0 16              BEQ GOTARY
02422  B237  C8          NMARY1 INY
02423  B238  B1 5F              LDA (LOWTR)Y
02424  B23A  18                 CLC
02425  B23B  65 5F              ADC LOWTR
02426  B23D  AA                 TAX
02427  B23E  C8                 INY
02428  B23F  B1 5F              LDA (LOWTR)Y
02429  B241  65 60              ADC LOWTR+1
02430  B243  90 D7              BCC LOPFDA
02431  B245  A2 12       BSERR  LDX #ERRBS
02432  B247  2C                 .BYT $2C
02433  B248  A2 0E       FCERR  LDX #ERRFC
02434  B24A  4C 37 A4    ERRGO3 JMP ERROR
02435  B24D  A2 13       GOTARY LDX #ERRDD
02436  B24F  A5 0C              LDA DIMFLG
02437  B251  D0 F7              BNE ERRGO3
02438  B253  20 94 B1           JSR FMAPTR
02439  B256  A5 0B              LDA COUNT
02440  B258  A0 04              LDY #4
02441  B25A  D1 5F              CMP (LOWTR)Y
02442  B25C  D0 E7              BNE BSERR
02443  B25E  4C EA B2           JMP GETDEF
02444  B261  20 94 B1    NOTFDD JSR FMAPTR
02445  B264  20 08 A4           JSR REASON
02446  B267  A0 00              LDY #0
02447  B269  84 72              STY CURTOL+1
02448  B26B  A2 05              LDX #5
02449  B26D  A5 45              LDA VARNAM
02450  B26F  91 5F              STA (LOWTR)Y
02451  B271  10 01              BPL NOTFLT
02452  B273  CA                 DEX
02453  B274  C8          NOTFLT INY






CODE12......PAGE 0037

LINE# LOC   CODE        LINE


02454  B275  A5 46              LDA VARNAM+1
02455  B277  91 5F              STA (LOWTR)Y
02456  B279  10 02              BPL STOMLT
02457  B27B  CA                 DEX
02458  B27C  CA                 DEX
02459  B27D  86 71       STOMLT STX CURTOL
02460  B27F  A5 0B              LDA COUNT
02461  B281  C8                 INY
02462  B282  C8                 INY
02463  B283  C8                 INY
02464  B284  91 5F              STA (LOWTR)Y
02465  B286  A2 0B       LOPPTA LDX #11
02466  B288  A9 00              LDA #0
02467  B28A  24 0C              BIT DIMFLG
02468  B28C  50 08              BVC NOTDIM
02469  B28E  68                 PLA
02470  B28F  18                 CLC
02471  B290  69 01              ADC #1
02472  B292  AA                 TAX
02473  B293  68                 PLA
02474  B294  69 00              ADC #0
02475  B296  C8          NOTDIM INY
02476  B297  91 5F              STA (LOWTR)Y
02477  B299  C8                 INY
02478  B29A  8A                 TXA
02479  B29B  91 5F              STA (LOWTR)Y
02480  B29D  20 4C B3           JSR UMULT
02481  B2A0  86 71              STX CURTOL
02482  B2A2  85 72              STA CURTOL+1
02483  B2A4  A4 22              LDY INDEX
02484  B2A6  C6 0B              DEC COUNT
02485  B2A8  D0 DC              BNE LOPPTA
02486  B2AA  65 59              ADC ARYPNT+1
02487  B2AC  B0 5D              BCS OMERR1
02488  B2AE  85 59              STA ARYPNT+1
02489  B2B0  A8                 TAY
02490  B2B1  8A                 TXA
02491  B2B2  65 58              ADC ARYPNT
02492  B2B4  90 03              BCC GREASE
02493  B2B6  C8                 INY
02494  B2B7  F0 52              BEQ OMERR1
02495  B2B9  20 08 A4    GREASE JSR REASON
02496  B2BC  85 31              STA STREND
02497  B2BE  84 32              STY STREND+1
02498  B2C0  A9 00              LDA #0
02499  B2C2  E6 72              INC CURTOL+1
02500  B2C4              .END
02501  B2C4              .LIB   CODE13













CODE13......PAGE 0038

LINE# LOC   CODE        LINE


02503  B2C4  A4 71              LDY CURTOL
02504  B2C6  F0 05              BEQ DECCUR
02505  B2C8  88          ZERITA DEY
02506  B2C9  91 58              STA (ARYPNT)Y
02507  B2CB  D0 FB              BNE ZERITA
02508  B2CD  C6 59       DECCUR DEC ARYPNT+1
02509  B2CF  C6 72              DEC CURTOL+1
02510  B2D1  D0 F5              BNE ZERITA
02511  B2D3  E6 59              INC ARYPNT+1
02512  B2D5  38                 SEC
02513  B2D6  A5 31              LDA STREND
02514  B2D8  E5 5F              SBC LOWTR
02515  B2DA  A0 02              LDY #2
02516  B2DC  91 5F              STA (LOWTR)Y
02517  B2DE  A5 32              LDA STREND+1
02518  B2E0  C8                 INY
02519  B2E1  E5 60              SBC LOWTR+1
02520  B2E3  91 5F              STA (LOWTR)Y
02521  B2E5  A5 0C              LDA DIMFLG
02522  B2E7  D0 62              BNE DIMRTS
02523  B2E9  C8                 INY
02524  B2EA  B1 5F       GETDEF LDA (LOWTR)Y
02525  B2EC  85 0B              STA COUNT
02526  B2EE  A9 00              LDA #0
02527  B2F0  85 71              STA CURTOL
02528  B2F2  85 72       INLPNM STA CURTOL+1
02529  B2F4  C8                 INY
02530  B2F5  68                 PLA
02531  B2F6  AA                 TAX
02532  B2F7  85 64              STA INDICE
02533  B2F9  68                 PLA
02534  B2FA  85 65              STA INDICE+1
02535  B2FC  D1 5F              CMP (LOWTR)Y
02536  B2FE  90 0E              BCC INLPN2
02537  B300  D0 06              BNE BSERR7
02538  B302  C8                 INY
02539  B303  8A                 TXA
02540  B304  D1 5F              CMP (LOWTR)Y
02541  B306  90 07              BCC INLPN1
02542  B308  4C 45 B2    BSERR7 JMP BSERR
02543  B30B  4C 35 A4    OMERR1 JMP OMERR
02544  B30E  C8          INLPN2 INY
02545  B30F  A5 72       INLPN1 LDA CURTOL+1
02546  B311  05 71              ORA CURTOL
02547  B313  18                 CLC
02548  B314  F0 0A              BEQ ADDIND
02549  B316  20 4C B3           JSR UMULT
02550  B319  8A                 TXA
02551  B31A  65 64              ADC INDICE
02552  B31C  AA                 TAX
02553  B31D  98                 TYA
02554  B31E  A4 22              LDY INDEX1
02555  B320  65 65       ADDIND ADC INDICE+1
02556  B322  86 71              STX CURTOL
02557  B324  C6 0B              DEC COUNT






CODE13......PAGE 0039

LINE# LOC   CODE        LINE


02558  B326  D0 CA              BNE INLPNM
02559  B328  85 72              STA CURTOL+1
02560  B32A  A2 05              LDX #5
02561  B32C  A5 45              LDA VARNAM
02562  B32E  10 01              BPL NOTFL1
02563  B330  CA                 DEX
02564  B331  A5 46       NOTFL1 LDA VARNAM+1
02565  B333  10 02              BPL STOML1
02566  B335  CA                 DEX
02567  B336  CA                 DEX
02568  B337  86 28       STOML1 STX ADDEND
02569  B339  A9 00              LDA #0
02570  B33B  20 55 B3           JSR UMULTD
02571  B33E  8A                 TXA
02572  B33F  65 58              ADC ARYPNT
02573  B341  85 47              STA VARPNT
02574  B343  98                 TYA
02575  B344  65 59              ADC ARYPNT+1
02576  B346  85 48              STA VARPNT+1
02577  B348  A8                 TAY
02578  B349  A5 47              LDA VARPNT
02579  B34B  60          DIMRTS RTS
02580  B34C  84 22       UMULT  STY INDEX
02581  B34E  B1 5F              LDA (LOWTR)Y
02582  B350  85 28              STA ADDEND
02583  B352  88                 DEY
02584  B353  B1 5F              LDA (LOWTR)Y
02585  B355  85 29       UMULTD STA ADDEND+1
02586  B357  A9 10              LDA #16
02587  B359  85 5D              STA DECCNT
02588  B35B  A2 00              LDX #0
02589  B35D  A0 00              LDY #0
02590  B35F  8A          UMULTC TXA
02591  B360  0A                 ASL A
02592  B361  AA                 TAX
02593  B362  98                 TYA
02594  B363  2A                 ROL A
02595  B364  A8                 TAY
02596  B365  B0 A4              BCS OMERR1
02597  B367  06 71              ASL CURTOL
02598  B369  26 72              ROL CURTOL+1
02599  B36B  90 0B              BCC UMLCNT
02600  B36D  18                 CLC
02601  B36E  8A                 TXA
02602  B36F  65 28              ADC ADDEND
02603  B371  AA                 TAX
02604  B372  98                 TYA
02605  B373  65 29              ADC ADDEND+1
02606  B375  A8                 TAY
02607  B376  B0 93              BCS OMERR1
02608  B378  C6 5D       UMLCNT DEC DECCNT
02609  B37A  D0 E3              BNE UMULTC
02610  B37C  60          UMLRTS RTS
02611  B37D  A5 0D       FRE    LDA VALTYP
02612  B37F  F0 03              BEQ NOFREF






CODE13......PAGE 003A

LINE# LOC   CODE        LINE


02613  B381  20 A6 B6           JSR FREFAC
02614  B384  20 26 B5    NOFREF JSR GARBA2
02615  B387  38                 SEC
02616  B388  A5 33              LDA FRETOP
02617  B38A  E5 31              SBC STREND
02618  B38C  A8                 TAY
02619  B38D  A5 34              LDA FRETOP+1
02620  B38F  E5 32              SBC STREND+1
02621  B391  A2 00       GIVAYF LDX #0
02622  B393  86 0D              STX VALTYP
02623  B395  85 62              STA FACHO
02624  B397  84 63              STY FACHO+1
02625  B399  A2 90              LDX #144
02626  B39B  4C 44 BC           JMP FLOATS
02627  B39E  38          POS    SEC
02628  B39F  20 F0 FF           JSR PLOT        ;GET TAB POS IN .Y
02629  B3A2  A9 00       SNGFLT LDA #0
02630  B3A4  F0 EB              BEQ GIVAYF
02631  B3A6  A6 3A       ERRDIR LDX CURLIN+1
02632  B3A8  E8                 INX
02633  B3A9  D0 A0              BNE DIMRTS
02634  B3AB  A2 15              LDX #ERRID
02635  B3AD  2C                 .BYT $2C
02636  B3AE  A2 1B       ERRGUF LDX #ERRUF
02637  B3B0  4C 37 A4           JMP ERROR
02638  B3B3  20 E1 B3    DEF    JSR GETFNM
02639  B3B6  20 A6 B3           JSR ERRDIR
02640  B3B9  20 FA AE           JSR CHKOPN
02641  B3BC  A9 80              LDA #128
02642  B3BE  85 10              STA SUBFLG
02643  B3C0  20 8B B0           JSR PTRGET
02644  B3C3  20 8D AD           JSR CHKNUM
02645  B3C6  20 F7 AE           JSR CHKCLS
02646  B3C9  A9 B2              LDA #$B2
02647  B3CB  20 FF AE           JSR SYNCHR
02648  B3CE  48                 PHA
02649  B3CF  A5 48              LDA VARPNT+1
02650  B3D1  48                 PHA
02651  B3D2  A5 47              LDA VARPNT
02652  B3D4  48                 PHA
02653  B3D5  A5 7B              LDA TXTPTR+1
02654  B3D7              .END
02655  B3D7              .LIB   CODE14


















CODE14......PAGE 003B

LINE# LOC   CODE        LINE


02657  B3D7  48                 PHA
02658  B3D8  A5 7A              LDA TXTPTR
02659  B3DA  48                 PHA
02660  B3DB  20 F8 A8           JSR DATA
02661  B3DE  4C 4F B4           JMP DEFFIN
02662  B3E1  A9 A5       GETFNM LDA #FNTK
02663  B3E3  20 FF AE           JSR SYNCHR
02664  B3E6  09 80              ORA #128
02665  B3E8  85 10              STA SUBFLG
02666  B3EA  20 92 B0           JSR PTRGT2
02667  B3ED  85 4E              STA DEFPNT
02668  B3EF  84 4F              STY DEFPNT+1
02669  B3F1  4C 8D AD           JMP CHKNUM
02670  B3F4  20 E1 B3    FNDOER JSR GETFNM
02671  B3F7  A5 4F              LDA DEFPNT+1
02672  B3F9  48                 PHA
02673  B3FA  A5 4E              LDA DEFPNT
02674  B3FC  48                 PHA
02675  B3FD  20 F1 AE           JSR PARCHK
02676  B400  20 8D AD           JSR CHKNUM
02677  B403  68                 PLA
02678  B404  85 4E              STA DEFPNT
02679  B406  68                 PLA
02680  B407  85 4F              STA DEFPNT+1
02681  B409  A0 02              LDY #2
02682  B40B  B1 4E              LDA (DEFPNT)Y
02683  B40D  85 47              STA VARPNT
02684  B40F  AA                 TAX
02685  B410  C8                 INY
02686  B411  B1 4E              LDA (DEFPNT)Y
02687  B413  F0 99              BEQ ERRGUF
02688  B415  85 48              STA VARPNT+1
02689  B417  C8                 INY
02690  B418  B1 47       DEFSTF LDA (VARPNT)Y
02691  B41A  48                 PHA
02692  B41B  88                 DEY
02693  B41C  10 FA              BPL DEFSTF
02694  B41E  A4 48              LDY VARPNT+1
02695  B420  20 D4 BB           JSR MOVMF
02696  B423  A5 7B              LDA TXTPTR+1
02697  B425  48                 PHA
02698  B426  A5 7A              LDA TXTPTR
02699  B428  48                 PHA
02700  B429  B1 4E              LDA (DEFPNT)Y
02701  B42B  85 7A              STA TXTPTR
02702  B42D  C8                 INY
02703  B42E  B1 4E              LDA (DEFPNT)Y
02704  B430  85 7B              STA TXTPTR+1
02705  B432  A5 48              LDA VARPNT+1
02706  B434  48                 PHA
02707  B435  A5 47              LDA VARPNT
02708  B437  48                 PHA
02709  B438  20 8A AD           JSR FRMNUM
02710  B43B  68                 PLA
02711  B43C  85 4E              STA DEFPNT






CODE14......PAGE 003C

LINE# LOC   CODE        LINE


02712  B43E  68                 PLA
02713  B43F  85 4F              STA DEFPNT+1
02714  B441  20 79 00           JSR CHRGOT
02715  B444  F0 03              BEQ *+5
02716  B446  4C 08 AF           JMP SNERR
02717  B449  68                 PLA
02718  B44A  85 7A              STA TXTPTR
02719  B44C  68                 PLA
02720  B44D  85 7B              STA TXTPTR+1
02721  B44F  A0 00       DEFFIN LDY #0
02722  B451  68                 PLA
02723  B452  91 4E              STA (DEFPNT)Y
02724  B454  68                 PLA
02725  B455  C8                 INY
02726  B456  91 4E              STA (DEFPNT)Y
02727  B458  68                 PLA
02728  B459  C8                 INY
02729  B45A  91 4E              STA (DEFPNT)Y
02730  B45C  68                 PLA
02731  B45D  C8                 INY
02732  B45E  91 4E              STA (DEFPNT)Y
02733  B460  68                 PLA
02734  B461  C8                 INY
02735  B462  91 4E              STA (DEFPNT)Y
02736  B464  60                 RTS
02737  B465  20 8D AD    STRD   JSR CHKNUM
02738  B468  A0 00              LDY #0
02739  B46A  20 DF BD           JSR FOUTC
02740  B46D  68                 PLA
02741  B46E  68                 PLA
02742  B46F  A9 FF       TIMSTR LDA #<LOFBUF
02743  B471  A0 00              LDY #>LOFBUF
02744  B473  F0 12              BEQ STRLIT
02745  B475  A6 64       STRINI LDX FACMO
02746  B477  A4 65              LDY FACMO+1
02747  B479  86 50              STX DSCPNT
02748  B47B  84 51              STY DSCPNT+1
02749  B47D  20 F4 B4    STRSPA JSR GETSPA
02750  B480  86 62              STX DSCTMP+1
02751  B482  84 63              STY DSCTMP+2
02752  B484  85 61              STA DSCTMP
02753  B486  60                 RTS
02754  B487  A2 22       STRLIT LDX #34
02755  B489  86 07              STX CHARAC
02756  B48B  86 08              STX ENDCHR
02757  B48D  85 6F       STRLT2 STA STRNG1
02758  B48F  84 70              STY STRNG1+1
02759  B491  85 62              STA DSCTMP+1
02760  B493  84 63              STY DSCTMP+2
02761  B495  A0 FF              LDY #255
02762  B497  C8          STRGET INY
02763  B498  B1 6F              LDA (STRNG1)Y
02764  B49A  F0 0C              BEQ STRFI1
02765  B49C  C5 07              CMP CHARAC
02766  B49E  F0 04              BEQ STRFIN






CODE14......PAGE 003D

LINE# LOC   CODE        LINE


02767  B4A0  C5 08              CMP ENDCHR
02768  B4A2  D0 F3              BNE STRGET
02769  B4A4  C9 22       STRFIN CMP #34
02770  B4A6  F0 01              BEQ STRFI2
02771  B4A8  18          STRFI1 CLC
02772  B4A9  84 61       STRFI2 STY DSCTMP
02773  B4AB  98                 TYA
02774  B4AC  65 6F              ADC STRNG1
02775  B4AE  85 71              STA STRNG2
02776  B4B0  A6 70              LDX STRNG1+1
02777  B4B2  90 01              BCC STRST2
02778  B4B4  E8                 INX
02779  B4B5  86 72       STRST2 STX STRNG2+1
02780  B4B7  A5 70              LDA STRNG1+1
02781  B4B9  F0 04              BEQ STRCP
02782  B4BB  C9 02              CMP #BUFPAG
02783  B4BD  D0 0B              BNE PUTNEW
02784  B4BF  98          STRCP  TYA
02785  B4C0  20 75 B4           JSR STRINI
02786  B4C3  A6 6F              LDX STRNG1
02787  B4C5  A4 70              LDY STRNG1+1
02788  B4C7  20 88 B6           JSR MOVSTR
02789  B4CA  A6 16       PUTNEW LDX TEMPPT
02790  B4CC  E0 22              CPX #TEMPST+STRSIZ+STRSIZ+STRSIZ
02791  B4CE  D0 05              BNE PUTNW1
02792  B4D0  A2 19              LDX #ERRST
02793  B4D2  4C 37 A4    ERRGO2 JMP ERROR
02794  B4D5  A5 61       PUTNW1 LDA DSCTMP
02795  B4D7  95 00              STA 0,X
02796  B4D9  A5 62              LDA DSCTMP+1
02797  B4DB  95 01              STA 1,X
02798  B4DD  A5 63              LDA DSCTMP+2
02799  B4DF  95 02              STA 2,X
02800  B4E1  A0 00              LDY #0
02801  B4E3  86 64              STX FACMO
02802  B4E5  84 65              STY FACMO+1
02803  B4E7  84 70              STY FACOV
02804  B4E9  88                 DEY
02805  B4EA  84 0D              STY VALTYP
02806  B4EC  86 17              STX LASTPT
02807  B4EE  E8                 INX
02808  B4EF  E8                 INX
02809  B4F0  E8                 INX
02810  B4F1  86 16              STX TEMPPT
02811  B4F3  60                 RTS
02812  B4F4  46 0F       GETSPA LSR GARBFL
02813  B4F6  48          TRYAG2 PHA
02814  B4F7  49 FF              EOR #255
02815  B4F9  38                 SEC
02816  B4FA  65 33              ADC FRETOP
02817  B4FC  A4 34              LDY FRETOP+1
02818  B4FE  B0 01              BCS TRYAG3
02819  B500  88                 DEY
02820  B501  C4 32       TRYAG3 CPY STREND+1
02821  B503  90 11              BCC GARBAG






CODE14......PAGE 003E

LINE# LOC   CODE        LINE


02822  B505  D0 04              BNE STRFRE
02823  B507  C5 31              CMP STREND
02824  B509  90 0B              BCC GARBAG
02825  B50B  85 33       STRFRE STA FRETOP
02826  B50D  84 34              STY FRETOP+1
02827  B50F  85 35              STA FRESPC
02828  B511  84 36              STY FRESPC+1
02829  B513  AA                 TAX
02830  B514  68                 PLA
02831  B515  60                 RTS
02832  B516  A2 10       GARBAG LDX #ERROM
02833  B518  A5 0F              LDA GARBFL
02834  B51A  30 B6              BMI ERRGO2
02835  B51C  20 26 B5           JSR GARBA2
02836  B51F  A9 80              LDA #128
02837  B521  85 0F              STA GARBFL
02838  B523  68                 PLA
02839  B524  D0 D0              BNE TRYAG2
02840  B526  A6 37       GARBA2 LDX MEMSIZ
02841  B528  A5 38              LDA MEMSIZ+1
02842  B52A  86 33       FNDVAR STX FRETOP
02843  B52C  85 34              STA FRETOP+1
02844  B52E  A0 00              LDY #0
02845  B530  84 4F              STY GRBPNT+1
02846  B532  84 4E              STY GRBPNT
02847  B534  A5 31              LDA STREND
02848  B536  A6 32              LDX STREND+1
02849  B538  85 5F              STA GRBTOP
02850  B53A  86 60              STX GRBTOP+1
02851  B53C  A9 19              LDA #<TEMPST
02852  B53E  A2 00              LDX #>TEMPST
02853  B540  85 22              STA INDEX1
02854  B542  86 23              STX INDEX1+1
02855  B544  C5 16       TVAR   CMP TEMPPT
02856  B546  F0 05              BEQ SVARS
02857  B548  20 C7 B5           JSR DVAR
02858  B54B  F0 F7              BEQ TVAR
02859  B54D  A9 07       SVARS  LDA #6+ADDPRC
02860  B54F  85 53              STA FOUR6
02861  B551  A5 2D              LDA VARTAB
02862  B553  A6 2E              LDX VARTAB+1
02863  B555              .END
02864  B555              .LIB   CODE15


















CODE15......PAGE 003F

LINE# LOC   CODE        LINE


02866  B555  85 22              STA INDEX1
02867  B557  86 23              STX INDEX1+1
02868  B559  E4 30       SVAR   CPX ARYTAB+1
02869  B55B  D0 04              BNE SVARGO
02870  B55D  C5 2F              CMP ARYTAB
02871  B55F  F0 05              BEQ ARYVAR
02872  B561  20 BD B5    SVARGO JSR DVARS
02873  B564  F0 F3              BEQ SVAR
02874  B566  85 58       ARYVAR STA ARYPNT
02875  B568  86 59              STX ARYPNT+1
02876  B56A  A9 03              LDA #STRSIZ
02877  B56C  85 53              STA FOUR6
02878  B56E  A5 58       ARYVA2 LDA ARYPNT
02879  B570  A6 59              LDX ARYPNT+1
02880  B572  E4 32       ARYVA3 CPX STREND+1
02881  B574  D0 07              BNE ARYVGO
02882  B576  C5 31              CMP STREND
02883  B578  D0 03              BNE *+5
02884  B57A  4C 06 B6           JMP GRBPAS
02885  B57D  85 22       ARYVGO STA INDEX1
02886  B57F  86 23              STX INDEX1+1
02887  B581  A0 00              LDY #1-ADDPRC
02888  B583  B1 22              LDA (INDEX1)Y
02889  B585  AA                 TAX
02890  B586  C8                 INY
02891  B587  B1 22              LDA (INDEX1)Y
02892  B589  08                 PHP
02893  B58A  C8                 INY
02894  B58B  B1 22              LDA (INDEX1)Y
02895  B58D  65 58              ADC ARYPNT
02896  B58F  85 58              STA ARYPNT
02897  B591  C8                 INY
02898  B592  B1 22              LDA (INDEX1)Y
02899  B594  65 59              ADC ARYPNT+1
02900  B596  85 59              STA ARYPNT+1
02901  B598  28                 PLP
02902  B599  10 D3              BPL ARYVA2
02903  B59B  8A                 TXA
02904  B59C  30 D0              BMI ARYVA2
02905  B59E  C8                 INY
02906  B59F  B1 22              LDA (INDEX1)Y
02907  B5A1  A0 00              LDY #0
02908  B5A3  0A                 ASL A
02909  B5A4  69 05              ADC #5
02910  B5A6  65 22              ADC INDEX1
02911  B5A8  85 22              STA INDEX1
02912  B5AA  90 02              BCC ARYGET
02913  B5AC  E6 23              INC INDEX1+1
02914  B5AE  A6 23       ARYGET LDX INDEX1+1
02915  B5B0  E4 59       ARYSTR CPX ARYPNT+1
02916  B5B2  D0 04              BNE GOGO
02917  B5B4  C5 58              CMP ARYPNT
02918  B5B6  F0 BA              BEQ ARYVA3
02919  B5B8  20 C7 B5    GOGO   JSR DVAR
02920  B5BB  F0 F3              BEQ ARYSTR






CODE15......PAGE 0040

LINE# LOC   CODE        LINE


02921  B5BD  B1 22       DVARS  LDA (INDEX1)Y
02922  B5BF  30 35              BMI DVARTS
02923  B5C1  C8                 INY
02924  B5C2  B1 22              LDA (INDEX1)Y
02925  B5C4  10 30              BPL DVARTS
02926  B5C6  C8                 INY
02927  B5C7  B1 22       DVAR   LDA (INDEX1)Y
02928  B5C9  F0 2B              BEQ DVARTS
02929  B5CB  C8                 INY
02930  B5CC  B1 22              LDA (INDEX1)Y
02931  B5CE  AA                 TAX
02932  B5CF  C8                 INY
02933  B5D0  B1 22              LDA (INDEX1)Y
02934  B5D2  C5 34              CMP FRETOP+1
02935  B5D4  90 06              BCC DVAR2
02936  B5D6  D0 1E              BNE DVARTS
02937  B5D8  E4 33              CPX FRETOP
02938  B5DA  B0 1A              BCS DVARTS
02939  B5DC  C5 60       DVAR2  CMP GRBTOP+1
02940  B5DE  90 16              BCC DVARTS
02941  B5E0  D0 04              BNE DVAR3
02942  B5E2  E4 5F              CPX GRBTOP
02943  B5E4  90 10              BCC DVARTS
02944  B5E6  86 5F       DVAR3  STX GRBTOP
02945  B5E8  85 60              STA GRBTOP+1
02946  B5EA  A5 22              LDA INDEX1
02947  B5EC  A6 23              LDX INDEX1+1
02948  B5EE  85 4E              STA GRBPNT
02949  B5F0  86 4F              STX GRBPNT+1
02950  B5F2  A5 53              LDA FOUR6
02951  B5F4  85 55              STA SIZE
02952  B5F6  A5 53       DVARTS LDA FOUR6
02953  B5F8  18                 CLC
02954  B5F9  65 22              ADC INDEX1
02955  B5FB  85 22              STA INDEX1
02956  B5FD  90 02              BCC GRBRTS
02957  B5FF  E6 23              INC INDEX1+1
02958  B601  A6 23       GRBRTS LDX INDEX1+1
02959  B603  A0 00              LDY #0
02960  B605  60                 RTS
02961  B606  A5 4F       GRBPAS LDA GRBPNT+1
02962  B608  05 4E              ORA GRBPNT
02963  B60A  F0 F5              BEQ GRBRTS
02964  B60C  A5 55              LDA SIZE
02965  B60E  29 04              AND #4
02966  B610  4A                 LSR A
02967  B611  A8                 TAY
02968  B612  85 55              STA SIZE
02969  B614  B1 4E              LDA (GRBPNT)Y
02970  B616  65 5F              ADC LOWTR
02971  B618  85 5A              STA HIGHTR
02972  B61A  A5 60              LDA LOWTR+1
02973  B61C  69 00              ADC #0
02974  B61E  85 5B              STA HIGHTR+1
02975  B620  A5 33              LDA FRETOP






CODE15......PAGE 0041

LINE# LOC   CODE        LINE


02976  B622  A6 34              LDX FRETOP+1
02977  B624  85 58              STA HIGHDS
02978  B626  86 59              STX HIGHDS+1
02979  B628  20 BF A3           JSR BLTUC
02980  B62B  A4 55              LDY SIZE
02981  B62D  C8                 INY
02982  B62E  A5 58              LDA HIGHDS
02983  B630  91 4E              STA (GRBPNT)Y
02984  B632  AA                 TAX
02985  B633  E6 59              INC HIGHDS+1
02986  B635  A5 59              LDA HIGHDS+1
02987  B637  C8                 INY
02988  B638  91 4E              STA (GRBPNT)Y
02989  B63A  4C 2A B5           JMP FNDVAR
02990  B63D  A5 65       CAT    LDA FACLO
02991  B63F  48                 PHA
02992  B640  A5 64              LDA FACMO
02993  B642  48                 PHA
02994  B643  20 83 AE           JSR EVAL
02995  B646  20 8F AD           JSR CHKSTR
02996  B649  68                 PLA
02997  B64A  85 6F              STA STRNG1
02998  B64C  68                 PLA
02999  B64D  85 70              STA STRNG1+1
03000  B64F  A0 00              LDY #0
03001  B651  B1 6F              LDA (STRNG1)Y
03002  B653  18                 CLC
03003  B654  71 64              ADC (FACMO)Y
03004  B656  90 05              BCC SIZEOK
03005  B658  A2 17              LDX #ERRLS
03006  B65A  4C 37 A4           JMP ERROR
03007  B65D  20 75 B4    SIZEOK JSR STRINI
03008  B660  20 7A B6           JSR MOVINS
03009  B663  A5 50              LDA DSCPNT
03010  B665  A4 51              LDY DSCPNT+1
03011  B667  20 AA B6           JSR FRETMP
03012  B66A  20 8C B6           JSR MOVDO
03013  B66D  A5 6F              LDA STRNG1
03014  B66F  A4 70              LDY STRNG1+1
03015  B671  20 AA B6           JSR FRETMP
03016  B674  20 CA B4           JSR PUTNEW
03017  B677  4C B8 AD           JMP TSTOP
03018  B67A  A0 00       MOVINS LDY #0
03019  B67C  B1 6F              LDA (STRNG1)Y
03020  B67E  48                 PHA
03021  B67F  C8                 INY
03022  B680              .END
03023  B680              .LIB   CODE16













CODE16......PAGE 0042

LINE# LOC   CODE        LINE


03025  B680  B1 6F              LDA (STRNG1)Y
03026  B682  AA                 TAX
03027  B683  C8                 INY
03028  B684  B1 6F              LDA (STRNG1)Y
03029  B686  A8                 TAY
03030  B687  68                 PLA
03031  B688  86 22       MOVSTR STX INDEX
03032  B68A  84 23              STY INDEX+1
03033  B68C  A8          MOVDO  TAY
03034  B68D  F0 0A              BEQ MVDONE
03035  B68F  48                 PHA
03036  B690  88          MOVLP  DEY
03037  B691  B1 22              LDA (INDEX)Y
03038  B693  91 35              STA (FRESPC)Y
03039  B695  98                 TYA
03040  B696  D0 F8              BNE MOVLP
03041  B698  68                 PLA
03042  B699  18          MVDONE CLC
03043  B69A  65 35              ADC FRESPC
03044  B69C  85 35              STA FRESPC
03045  B69E  90 02              BCC MVSTRT
03046  B6A0  E6 36              INC FRESPC+1
03047  B6A2  60          MVSTRT RTS
03048  B6A3  20 8F AD    FRESTR JSR CHKSTR
03049  B6A6  A5 64       FREFAC LDA FACMO
03050  B6A8  A4 65              LDY FACMO+1
03051  B6AA  85 22       FRETMP STA INDEX
03052  B6AC  84 23              STY INDEX+1
03053  B6AE  20 DB B6           JSR FRETMS
03054  B6B1  08                 PHP
03055  B6B2  A0 00              LDY #0
03056  B6B4  B1 22              LDA (INDEX)Y
03057  B6B6  48                 PHA
03058  B6B7  C8                 INY
03059  B6B8  B1 22              LDA (INDEX)Y
03060  B6BA  AA                 TAX
03061  B6BB  C8                 INY
03062  B6BC  B1 22              LDA (INDEX)Y
03063  B6BE  A8                 TAY
03064  B6BF  68                 PLA
03065  B6C0  28                 PLP
03066  B6C1  D0 13              BNE FRETRT
03067  B6C3  C4 34              CPY FRETOP+1
03068  B6C5  D0 0F              BNE FRETRT
03069  B6C7  E4 33              CPX FRETOP
03070  B6C9  D0 0B              BNE FRETRT
03071  B6CB  48                 PHA
03072  B6CC  18                 CLC
03073  B6CD  65 33              ADC FRETOP
03074  B6CF  85 33              STA FRETOP
03075  B6D1  90 02              BCC FREPLA
03076  B6D3  E6 34              INC FRETOP+1
03077  B6D5  68          FREPLA PLA
03078  B6D6  86 22       FRETRT STX INDEX
03079  B6D8  84 23              STY INDEX+1






CODE16......PAGE 0043

LINE# LOC   CODE        LINE


03080  B6DA  60                 RTS
03081  B6DB  C4 18       FRETMS CPY LASTPT+1
03082  B6DD  D0 0C              BNE FRERTS
03083  B6DF  C5 17              CMP LASTPT
03084  B6E1  D0 08              BNE FRERTS
03085  B6E3  85 16              STA TEMPPT
03086  B6E5  E9 03              SBC #STRSIZ
03087  B6E7  85 17              STA LASTPT
03088  B6E9  A0 00              LDY #0
03089  B6EB  60          FRERTS RTS
03090  B6EC  20 A1 B7    CHRD   JSR CONINT
03091  B6EF  8A                 TXA
03092  B6F0  48                 PHA
03093  B6F1  A9 01              LDA #1
03094  B6F3  20 7D B4           JSR STRSPA
03095  B6F6  68                 PLA
03096  B6F7  A0 00              LDY #0
03097  B6F9  91 62              STA (DSCTMP+1)Y
03098  B6FB  68                 PLA
03099  B6FC  68                 PLA
03100  B6FD  4C CA B4           JMP PUTNEW
03101  B700  20 61 B7    LEFTD  JSR PREAM
03102  B703  D1 50              CMP (DSCPNT)Y
03103  B705  98                 TYA
03104  B706  90 04       RLEFT  BCC RLEFT1
03105  B708  B1 50              LDA (DSCPNT)Y
03106  B70A  AA                 TAX
03107  B70B  98                 TYA
03108  B70C  48          RLEFT1 PHA
03109  B70D  8A          RLEFT2 TXA
03110  B70E  48          RLEFT3 PHA
03111  B70F  20 7D B4           JSR STRSPA
03112  B712  A5 50              LDA DSCPNT
03113  B714  A4 51              LDY DSCPNT+1
03114  B716  20 AA B6           JSR FRETMP
03115  B719  68                 PLA
03116  B71A  A8                 TAY
03117  B71B  68                 PLA
03118  B71C  18                 CLC
03119  B71D  65 22              ADC INDEX
03120  B71F  85 22              STA INDEX
03121  B721  90 02              BCC PULMOR
03122  B723  E6 23              INC INDEX+1
03123  B725  98          PULMOR TYA
03124  B726  20 8C B6           JSR MOVDO
03125  B729  4C CA B4           JMP PUTNEW
03126  B72C  20 61 B7    RIGHTD JSR PREAM
03127  B72F  18                 CLC
03128  B730  F1 50              SBC (DSCPNT)Y
03129  B732  49 FF              EOR #255
03130  B734  4C 06 B7           JMP RLEFT
03131  B737  A9 FF       MIDD   LDA #255
03132  B739  85 65              STA FACLO
03133  B73B  20 79 00           JSR CHRGOT
03134  B73E  C9 29              CMP #41






CODE16......PAGE 0044

LINE# LOC   CODE        LINE


03135  B740  F0 06              BEQ MID2
03136  B742  20 FD AE           JSR CHKCOM
03137  B745  20 9E B7           JSR GETBYT
03138  B748  20 61 B7    MID2   JSR PREAM
03139  B74B  F0 4B              BEQ GOFUC
03140  B74D  CA                 DEX
03141  B74E  8A                 TXA
03142  B74F  48                 PHA
03143  B750  18                 CLC
03144  B751  A2 00              LDX #0
03145  B753  F1 50              SBC (DSCPNT)Y
03146  B755  B0 B6              BCS RLEFT2
03147  B757  49 FF              EOR #255
03148  B759  C5 65              CMP FACLO
03149  B75B  90 B1              BCC RLEFT3
03150  B75D  A5 65              LDA FACLO
03151  B75F  B0 AD              BCS RLEFT3
03152  B761  20 F7 AE    PREAM  JSR CHKCLS
03153  B764  68                 PLA
03154  B765  A8                 TAY
03155  B766  68                 PLA
03156  B767  85 55              STA JMPER+1
03157  B769  68                 PLA
03158  B76A  68                 PLA
03159  B76B  68                 PLA
03160  B76C  AA                 TAX
03161  B76D  68                 PLA
03162  B76E  85 50              STA DSCPNT
03163  B770  68                 PLA
03164  B771  85 51              STA DSCPNT+1
03165  B773  A5 55              LDA JMPER+1
03166  B775  48                 PHA
03167  B776  98                 TYA
03168  B777  48                 PHA
03169  B778  A0 00              LDY #0
03170  B77A  8A                 TXA
03171  B77B  60                 RTS
03172  B77C  20 82 B7    LEN    JSR LEN1
03173  B77F  4C A2 B3           JMP SNGFLT
03174  B782  20 A3 B6    LEN1   JSR FRESTR
03175  B785  A2 00              LDX #0
03176  B787  86 0D              STX VALTYP
03177  B789  A8                 TAY
03178  B78A  60                 RTS
03179  B78B  20 82 B7    ASC    JSR LEN1
03180  B78E  F0 08              BEQ GOFUC
03181  B790  A0 00              LDY #0
03182  B792  B1 22              LDA (INDEX1)Y
03183  B794  A8                 TAY
03184  B795  4C A2 B3           JMP SNGFLT
03185  B798  4C 48 B2    GOFUC  JMP FCERR
03186  B79B  20 73 00    GTBYTC JSR CHRGET
03187  B79E              .END
03188  B79E              .LIB   CODE17







CODE17......PAGE 0045

LINE# LOC   CODE        LINE


03190  B79E  20 8A AD    GETBYT JSR FRMNUM
03191  B7A1  20 B8 B1    CONINT JSR POSINT
03192  B7A4  A6 64              LDX FACMO
03193  B7A6  D0 F0              BNE GOFUC
03194  B7A8  A6 65              LDX FACLO
03195  B7AA  4C 79 00           JMP CHRGOT
03196  B7AD  20 82 B7    VAL    JSR LEN1
03197  B7B0  D0 03              BNE *+5
03198  B7B2  4C F7 B8           JMP ZEROFC
03199  B7B5  A6 7A              LDX TXTPTR
03200  B7B7  A4 7B              LDY TXTPTR+1
03201  B7B9  86 71              STX STRNG2
03202  B7BB  84 72              STY STRNG2+1
03203  B7BD  A6 22              LDX INDEX1
03204  B7BF  86 7A              STX TXTPTR
03205  B7C1  18                 CLC
03206  B7C2  65 22              ADC INDEX1
03207  B7C4  85 24              STA INDEX2
03208  B7C6  A6 23              LDX INDEX1+1
03209  B7C8  86 7B              STX TXTPTR+1
03210  B7CA  90 01              BCC VAL2
03211  B7CC  E8                 INX
03212  B7CD  86 25       VAL2   STX INDEX2+1
03213  B7CF  A0 00              LDY #0
03214  B7D1  B1 24              LDA (INDEX2)Y
03215  B7D3  48                 PHA
03216  B7D4  98                 TYA             ;A=0
03217  B7D5  91 24              STA (INDEX2)Y
03218  B7D7  20 79 00           JSR CHRGOT
03219  B7DA  20 F3 BC           JSR FIN
03220  B7DD  68                 PLA
03221  B7DE  A0 00              LDY #0
03222  B7E0  91 24              STA (INDEX2)Y
03223  B7E2  A6 71       ST2TXT LDX STRNG2
03224  B7E4  A4 72              LDY STRNG2+1
03225  B7E6  86 7A              STX TXTPTR
03226  B7E8  84 7B              STY TXTPTR+1
03227  B7EA  60          VALRTS RTS
03228  B7EB  20 8A AD    GETNUM JSR FRMNUM
03229  B7EE  20 F7 B7           JSR GETADR
03230  B7F1  20 FD AE    COMBYT JSR CHKCOM
03231  B7F4  4C 9E B7           JMP GETBYT
03232  B7F7  A5 66       GETADR LDA FACSGN
03233  B7F9  30 9D              BMI GOFUC
03234  B7FB  A5 61              LDA FACEXP
03235  B7FD  C9 91              CMP #145
03236  B7FF  B0 97              BCS GOFUC
03237  B801  20 9B BC           JSR QINT
03238  B804  A5 64              LDA FACMO
03239  B806  A4 65              LDY FACMO+1
03240  B808  84 14              STY POKER
03241  B80A  85 15              STA POKER+1
03242  B80C  60                 RTS
03243  B80D  A5 15       PEEK   LDA POKER+1
03244  B80F  48                 PHA






CODE17......PAGE 0046

LINE# LOC   CODE        LINE


03245  B810  A5 14              LDA POKER
03246  B812  48                 PHA
03247  B813  20 F7 B7           JSR GETADR
03248  B816  A0 00              LDY #0
03249  B818  B1 14       GETCON LDA (POKER)Y
03250  B81A  A8                 TAY
03251  B81B  68          DOSGFL PLA
03252  B81C  85 14              STA POKER
03253  B81E  68                 PLA
03254  B81F  85 15              STA POKER+1
03255  B821  4C A2 B3           JMP SNGFLT
03256  B824  20 EB B7    POKE   JSR GETNUM
03257  B827  8A                 TXA
03258  B828  A0 00              LDY #0
03259  B82A  91 14              STA (POKER)Y
03260  B82C  60                 RTS
03261  B82D  20 EB B7    FNWAIT JSR GETNUM
03262  B830  86 49              STX ANDMSK
03263  B832  A2 00              LDX #0
03264  B834  20 79 00           JSR CHRGOT
03265  B837  F0 03              BEQ STORDO
03266  B839  20 F1 B7           JSR COMBYT
03267  B83C  86 4A       STORDO STX EORMSK
03268  B83E  A0 00              LDY #0
03269  B840  B1 14       WAITER LDA (POKER)Y
03270  B842  45 4A              EOR EORMSK
03271  B844  25 49              AND ANDMSK
03272  B846  F0 F8              BEQ WAITER
03273  B848  60          ZERRTS RTS
03274  B849  A9 11       FADDH  LDA #<FHALF
03275  B84B  A0 BF              LDY #>FHALF
03276  B84D  4C 67 B8           JMP FADD
03277  B850  20 8C BA    FSUB   JSR CONUPK
03278  B853  A5 66       FSUBT  LDA FACSGN
03279  B855  49 FF              EOR #@377
03280  B857  85 66              STA FACSGN
03281  B859  45 6E              EOR ARGSGN
03282  B85B  85 6F              STA ARISGN
03283  B85D  A5 61              LDA FACEXP
03284  B85F  4C 6A B8           JMP FADDT
03285  B862  20 99 B9    FADD5  JSR SHIFTR
03286  B865  90 3C              BCC FADD4
03287  B867  20 8C BA    FADD   JSR CONUPK
03288  B86A  D0 03       FADDT  BNE *+5
03289  B86C  4C FC BB           JMP MOVFA
03290  B86F  A6 70              LDX FACOV
03291  B871  86 56              STX OLDOV
03292  B873  A2 69              LDX #ARGEXP
03293  B875  A5 69              LDA ARGEXP
03294  B877  A8          FADDC  TAY
03295  B878  F0 CE              BEQ ZERRTS
03296  B87A  38                 SEC
03297  B87B  E5 61              SBC FACEXP
03298  B87D  F0 24              BEQ FADD4
03299  B87F  90 12              BCC FADDA






CODE17......PAGE 0047

LINE# LOC   CODE        LINE


03300  B881  84 61              STY FACEXP
03301  B883  A4 6E              LDY ARGSGN
03302  B885  84 66              STY FACSGN
03303  B887  49 FF              EOR #@377
03304  B889  69 00              ADC #0
03305  B88B  A0 00              LDY #0
03306  B88D  84 56              STY OLDOV
03307  B88F  A2 61              LDX #FAC
03308  B891  D0 04              BNE FADD1
03309  B893  A0 00       FADDA  LDY #0
03310  B895  84 70              STY FACOV
03311  B897  C9 F9       FADD1  CMP #$F9
03312  B899  30 C7              BMI FADD5
03313  B89B  A8                 TAY
03314  B89C  A5 70              LDA FACOV
03315  B89E  56 01              LSR 1,X
03316  B8A0  20 B0 B9           JSR ROLSHF
03317  B8A3  24 6F       FADD4  BIT ARISGN
03318  B8A5  10 57              BPL FADD2
03319  B8A7  A0 61              LDY #FACEXP
03320  B8A9  E0 69              CPX #ARGEXP
03321  B8AB  F0 02              BEQ SUBIT
03322  B8AD  A0 69              LDY #ARGEXP
03323  B8AF  38          SUBIT  SEC
03324  B8B0  49 FF              EOR #@377
03325  B8B2  65 56              ADC OLDOV
03326  B8B4  85 70              STA FACOV
03327  B8B6  B9 04 00           LDA 3+ADDPRC,Y
03328  B8B9  F5 04              SBC 3+ADDPRC,X
03329  B8BB  85 65              STA FACLO
03330  B8BD  B9 03 00           LDA ADDPRC+2,Y
03331  B8C0  F5 03              SBC 2+ADDPRC,X
03332  B8C2  85 64              STA FACMO
03333  B8C4  B9 02 00           LDA 2,Y
03334  B8C7  F5 02              SBC 2,X
03335  B8C9  85 63              STA FACMOH
03336  B8CB  B9 01 00           LDA 1,Y
03337  B8CE  F5 01              SBC 1,X
03338  B8D0  85 62              STA FACHO
03339  B8D2  B0 03       FADFLT BCS NORMAL
03340  B8D4  20 47 B9           JSR NEGFAC
03341  B8D7  A0 00       NORMAL LDY #0
03342  B8D9  98                 TYA
03343  B8DA  18                 CLC
03344  B8DB  A6 62       NORM3  LDX FACHO
03345  B8DD  D0 4A              BNE NORM1
03346  B8DF  A6 63              LDX FACHO+1
03347  B8E1  86 62              STX FACHO
03348  B8E3  A6 64              LDX FACMOH+1
03349  B8E5              .END
03350  B8E5              .LIB   CODE18










CODE18......PAGE 0048

LINE# LOC   CODE        LINE


03352  B8E5  86 63              STX FACMOH
03353  B8E7  A6 65              LDX FACMO+1
03354  B8E9  86 64              STX FACMO
03355  B8EB  A6 70              LDX FACOV
03356  B8ED  86 65              STX FACLO
03357  B8EF  84 70              STY FACOV
03358  B8F1  69 08              ADC #@10
03359  B8F3              ADDPR2 =ADDPRC+ADDPRC
03360  B8F3              ADDPR4 =ADDPR2+ADDPR2
03361  B8F3              ADDPR8 =ADDPR4+ADDPR4
03362  B8F3  C9 20              CMP #@30+ADDPR8
03363  B8F5  D0 E4              BNE NORM3
03364  B8F7  A9 00       ZEROFC LDA #0
03365  B8F9  85 61       ZEROF1 STA FACEXP
03366  B8FB  85 66       ZEROML STA FACSGN
03367  B8FD  60                 RTS
03368  B8FE  65 56       FADD2  ADC OLDOV
03369  B900  85 70              STA FACOV
03370  B902  A5 65              LDA FACLO
03371  B904  65 6D              ADC ARGLO
03372  B906  85 65              STA FACLO
03373  B908  A5 64              LDA FACMO
03374  B90A  65 6C              ADC ARGMO
03375  B90C  85 64              STA FACMO
03376  B90E  A5 63              LDA FACMOH
03377  B910  65 6B              ADC ARGMOH
03378  B912  85 63              STA FACMOH
03379  B914  A5 62              LDA FACHO
03380  B916  65 6A              ADC ARGHO
03381  B918  85 62              STA FACHO
03382  B91A  4C 36 B9           JMP SQUEEZ
03383  B91D  69 01       NORM2  ADC #1
03384  B91F  06 70              ASL FACOV
03385  B921  26 65              ROL FACLO
03386  B923  26 64              ROL FACMO
03387  B925  26 63              ROL FACMOH
03388  B927  26 62              ROL FACHO
03389  B929  10 F2       NORM1  BPL NORM2
03390  B92B  38                 SEC
03391  B92C  E5 61              SBC FACEXP
03392  B92E  B0 C7              BCS ZEROFC
03393  B930  49 FF              EOR #@377
03394  B932  69 01              ADC #1
03395  B934  85 61              STA FACEXP
03396  B936  90 0E       SQUEEZ BCC RNDRTS
03397  B938  E6 61       RNDSHF INC FACEXP
03398  B93A  F0 42              BEQ OVERR
03399  B93C  66 62              ROR FACHO
03400  B93E  66 63              ROR FACMOH
03401  B940  66 64              ROR FACMO
03402  B942  66 65              ROR FACLO
03403  B944  66 70              ROR FACOV
03404  B946  60          RNDRTS RTS
03405  B947  A5 66       NEGFAC LDA FACSGN
03406  B949  49 FF              EOR #@377






CODE18......PAGE 0049

LINE# LOC   CODE        LINE


03407  B94B  85 66              STA FACSGN
03408  B94D  A5 62       NEGFCH LDA FACHO
03409  B94F  49 FF              EOR #@377
03410  B951  85 62              STA FACHO
03411  B953  A5 63              LDA FACMOH
03412  B955  49 FF              EOR #@377
03413  B957  85 63              STA FACMOH
03414  B959  A5 64              LDA FACMO
03415  B95B  49 FF              EOR #@377
03416  B95D  85 64              STA FACMO
03417  B95F  A5 65              LDA FACLO
03418  B961  49 FF              EOR #@377
03419  B963  85 65              STA FACLO
03420  B965  A5 70              LDA FACOV
03421  B967  49 FF              EOR #@377
03422  B969  85 70              STA FACOV
03423  B96B  E6 70              INC FACOV
03424  B96D  D0 0E              BNE INCFRT
03425  B96F  E6 65       INCFAC INC FACLO
03426  B971  D0 0A              BNE INCFRT
03427  B973  E6 64              INC FACMO
03428  B975  D0 06              BNE INCFRT
03429  B977  E6 63              INC FACMOH
03430  B979  D0 02              BNE INCFRT
03431  B97B  E6 62              INC FACHO
03432  B97D  60          INCFRT RTS
03433  B97E  A2 0F       OVERR  LDX #ERROV
03434  B980  4C 37 A4           JMP ERROR
03435  B983  A2 25       MULSHF LDX #RESHO-1
03436  B985  B4 04       SHFTR2 LDY 3+ADDPRC,X
03437  B987  84 70              STY FACOV
03438  B989  B4 03              LDY 3,X
03439  B98B  94 04              STY 4,X
03440  B98D  B4 02              LDY 2,X
03441  B98F  94 03              STY 3,X
03442  B991  B4 01              LDY 1,X
03443  B993  94 02              STY 2,X
03444  B995  A4 68              LDY BITS
03445  B997  94 01              STY 1,X
03446  B999  69 08       SHIFTR ADC #@10
03447  B99B  30 E8              BMI SHFTR2
03448  B99D  F0 E6              BEQ SHFTR2
03449  B99F  E9 08              SBC #@10
03450  B9A1  A8                 TAY
03451  B9A2  A5 70              LDA FACOV
03452  B9A4  B0 14              BCS SHFTRT
03453  B9A6  16 01       SHFTR3 ASL 1,X
03454  B9A8  90 02              BCC SHFTR4
03455  B9AA  F6 01              INC 1,X
03456  B9AC  76 01       SHFTR4 ROR 1,X
03457  B9AE  76 01              ROR 1,X
03458  B9B0  76 02       ROLSHF ROR 2,X
03459  B9B2  76 03              ROR 3,X
03460  B9B4  76 04              ROR 4,X
03461  B9B6  6A                 ROR A






CODE18......PAGE 004A

LINE# LOC   CODE        LINE


03462  B9B7  C8                 INY
03463  B9B8  D0 EC              BNE SHFTR3
03464  B9BA  18          SHFTRT CLC
03465  B9BB  60                 RTS
03466  B9BC  81          FONE   .BYT @201,0,0,0,0
03466  B9BD  00 
03466  B9BE  00 
03466  B9BF  00 
03466  B9C0  00 
03467  B9C1  03          LOGCN2 .BYT 3,@177,@136,@126
03467  B9C2  7F 
03467  B9C3  5E 
03467  B9C4  56 
03468  B9C5  CB                 .BYT @313,@171,@200,@23
03468  B9C6  79 
03468  B9C7  80 
03468  B9C8  13 
03469  B9C9  9B                 .BYT @233,@13,@144,@200
03469  B9CA  0B 
03469  B9CB  64 
03469  B9CC  80 
03470  B9CD  76                 .BYT @166,@70,@223,@26
03470  B9CE  38 
03470  B9CF  93 
03470  B9D0  16 
03471  B9D1  82                 .BYT @202,@70,@252,@73,@40
03471  B9D2  38 
03471  B9D3  AA 
03471  B9D4  3B 
03471  B9D5  20 
03472  B9D6  80          SQR05  .BYT @200,@65,4,@363,@64
03472  B9D7  35 
03472  B9D8  04 
03472  B9D9  F3 
03472  B9DA  34 
03473  B9DB  81          SQR20  .BYT @201,@65,@4,@363,@64
03473  B9DC  35 
03473  B9DD  04 
03473  B9DE  F3 
03473  B9DF  34 
03474  B9E0  80          NEGHLF .BYT @200,@200,0,0,0
03474  B9E1  80 
03474  B9E2  00 
03474  B9E3  00 
03474  B9E4  00 
03475  B9E5  80          LOG2   .BYT @200,@61,@162,@27,@370
03475  B9E6  31 
03475  B9E7  72 
03475  B9E8  17 
03475  B9E9  F8 
03476  B9EA              .END
03477  B9EA              .LIB   CODE19









CODE19......PAGE 004B

LINE# LOC   CODE        LINE


03479  B9EA  20 2B BC    LOG    JSR SIGN
03480  B9ED  F0 02              BEQ LOGERR
03481  B9EF  10 03              BPL LOG1
03482  B9F1  4C 48 B2    LOGERR JMP FCERR
03483  B9F4  A5 61       LOG1   LDA FACEXP
03484  B9F6  E9 7F              SBC #@177
03485  B9F8  48                 PHA
03486  B9F9  A9 80              LDA #@200
03487  B9FB  85 61              STA FACEXP
03488  B9FD  A9 D6              LDA #<SQR05
03489  B9FF  A0 B9              LDY #>SQR05
03490  BA01  20 67 B8           JSR FADD
03491  BA04  A9 DB              LDA #<SQR20
03492  BA06  A0 B9              LDY #>SQR20
03493  BA08  20 0F BB           JSR FDIV
03494  BA0B  A9 BC              LDA #<FONE
03495  BA0D  A0 B9              LDY #>FONE
03496  BA0F  20 50 B8           JSR FSUB
03497  BA12  A9 C1              LDA #<LOGCN2
03498  BA14  A0 B9              LDY #>LOGCN2
03499  BA16  20 43 E0           JSR POLYX
03500  BA19  A9 E0              LDA #<NEGHLF
03501  BA1B  A0 B9              LDY #>NEGHLF
03502  BA1D  20 67 B8           JSR FADD
03503  BA20  68                 PLA
03504  BA21  20 7E BD           JSR FINLOG
03505  BA24  A9 E5              LDA #<LOG2
03506  BA26  A0 B9              LDY #>LOG2
03507  BA28  20 8C BA    FMULT  JSR CONUPK
03508  BA2B  D0 03       FMULTT BNE *+5
03509  BA2D  4C 8B BA           JMP MULTRT
03510  BA30  20 B7 BA           JSR MULDIV
03511  BA33  A9 00              LDA #0
03512  BA35  85 26              STA RESHO
03513  BA37  85 27              STA RESMOH
03514  BA39  85 28              STA RESMO
03515  BA3B  85 29              STA RESLO
03516  BA3D  A5 70              LDA FACOV
03517  BA3F  20 59 BA           JSR MLTPLY
03518  BA42  A5 65              LDA FACLO
03519  BA44  20 59 BA           JSR MLTPLY
03520  BA47  A5 64              LDA FACMO
03521  BA49  20 59 BA           JSR MLTPLY
03522  BA4C  A5 63              LDA FACMOH
03523  BA4E  20 59 BA           JSR MLTPLY
03524  BA51  A5 62              LDA FACHO
03525  BA53  20 5E BA           JSR MLTPL1
03526  BA56  4C 8F BB           JMP MOVFR
03527  BA59  D0 03       MLTPLY BNE *+5
03528  BA5B  4C 83 B9           JMP MULSHF
03529  BA5E  4A          MLTPL1 LSR A
03530  BA5F  09 80              ORA #@200
03531  BA61  A8          MLTPL2 TAY
03532  BA62  90 19              BCC MLTPL3
03533  BA64  18                 CLC






CODE19......PAGE 004C

LINE# LOC   CODE        LINE


03534  BA65  A5 29              LDA RESLO
03535  BA67  65 6D              ADC ARGLO
03536  BA69  85 29              STA RESLO
03537  BA6B  A5 28              LDA RESMO
03538  BA6D  65 6C              ADC ARGMO
03539  BA6F  85 28              STA RESMO
03540  BA71  A5 27              LDA RESMOH
03541  BA73  65 6B              ADC ARGMOH
03542  BA75  85 27              STA RESMOH
03543  BA77  A5 26              LDA RESHO
03544  BA79  65 6A              ADC ARGHO
03545  BA7B  85 26              STA RESHO
03546  BA7D  66 26       MLTPL3 ROR RESHO
03547  BA7F  66 27              ROR RESMOH
03548  BA81  66 28              ROR RESMO
03549  BA83  66 29              ROR RESLO
03550  BA85  66 70              ROR FACOV
03551  BA87  98                 TYA
03552  BA88  4A                 LSR A
03553  BA89  D0 D6              BNE MLTPL2
03554  BA8B  60          MULTRT RTS
03555  BA8C  85 22       CONUPK STA INDEX1
03556  BA8E  84 23              STY INDEX1+1
03557  BA90  A0 04              LDY #3+ADDPRC
03558  BA92  B1 22              LDA (INDEX1)Y
03559  BA94  85 6D              STA ARGLO
03560  BA96  88                 DEY
03561  BA97  B1 22              LDA (INDEX)Y
03562  BA99  85 6C              STA ARGMO
03563  BA9B  88                 DEY
03564  BA9C  B1 22              LDA (INDEX1)Y
03565  BA9E  85 6B              STA ARGMOH
03566  BAA0  88                 DEY
03567  BAA1  B1 22              LDA (INDEX1)Y
03568  BAA3  85 6E              STA ARGSGN
03569  BAA5  45 66              EOR FACSGN
03570  BAA7  85 6F              STA ARISGN
03571  BAA9  A5 6E              LDA ARGSGN
03572  BAAB  09 80              ORA #@200
03573  BAAD  85 6A              STA ARGHO
03574  BAAF  88                 DEY
03575  BAB0  B1 22              LDA (INDEX1)Y
03576  BAB2  85 69              STA ARGEXP
03577  BAB4  A5 61              LDA FACEXP
03578  BAB6  60                 RTS
03579  BAB7  A5 69       MULDIV LDA ARGEXP
03580  BAB9  F0 1F       MLDEXP BEQ ZEREMV
03581  BABB  18                 CLC
03582  BABC  65 61              ADC FACEXP
03583  BABE  90 04              BCC TRYOFF
03584  BAC0  30 1D              BMI GOOVER
03585  BAC2  18                 CLC
03586  BAC3  2C                 .BYT $2C
03587  BAC4  10 14       TRYOFF BPL ZEREMV
03588  BAC6  69 80              ADC #@200






CODE19......PAGE 004D

LINE# LOC   CODE        LINE


03589  BAC8  85 61              STA FACEXP
03590  BACA  D0 03              BNE *+5
03591  BACC  4C FB B8           JMP ZEROML
03592  BACF  A5 6F              LDA ARISGN
03593  BAD1  85 66              STA FACSGN
03594  BAD3  60                 RTS
03595  BAD4  A5 66       MLDVEX LDA FACSGN
03596  BAD6  49 FF              EOR #@377
03597  BAD8  30 05              BMI GOOVER
03598  BADA  68          ZEREMV PLA
03599  BADB  68                 PLA
03600  BADC  4C F7 B8           JMP ZEROFC
03601  BADF  4C 7E B9    GOOVER JMP OVERR
03602  BAE2  20 0C BC    MUL10  JSR MOVAF
03603  BAE5  AA                 TAX
03604  BAE6  F0 10              BEQ MUL10R
03605  BAE8  18                 CLC
03606  BAE9  69 02              ADC #2
03607  BAEB  B0 F2              BCS GOOVER
03608  BAED  A2 00       FINML6 LDX #0
03609  BAEF  86 6F              STX ARISGN
03610  BAF1  20 77 B8           JSR FADDC
03611  BAF4  E6 61              INC FACEXP
03612  BAF6  F0 E7              BEQ GOOVER
03613  BAF8  60          MUL10R RTS
03614  BAF9  84          TENC   .BYT @204,@40,0,0,0
03614  BAFA  20 
03614  BAFB  00 
03614  BAFC  00 
03614  BAFD  00 
03615  BAFE  20 0C BC    DIV10  JSR MOVAF
03616  BB01  A9 F9              LDA #<TENC
03617  BB03  A0 BA              LDY #>TENC
03618  BB05  A2 00              LDX #0
03619  BB07  86 6F       FDIVF  STX ARISGN
03620  BB09  20 A2 BB           JSR MOVFM
03621  BB0C  4C 12 BB           JMP FDIVT
03622  BB0F  20 8C BA    FDIV   JSR CONUPK
03623  BB12  F0 76       FDIVT  BEQ DV0ERR
03624  BB14  20 1B BC           JSR ROUND
03625  BB17  A9 00              LDA #0
03626  BB19  38                 SEC
03627  BB1A  E5 61              SBC FACEXP
03628  BB1C  85 61              STA FACEXP
03629  BB1E  20 B7 BA           JSR MULDIV
03630  BB21  E6 61              INC FACEXP
03631  BB23  F0 BA              BEQ GOOVER
03632  BB25  A2 FC              LDX #253-ADDPRC
03633  BB27  A9 01              LDA #1
03634  BB29  A4 6A       DIVIDE LDY ARGHO
03635  BB2B  C4 62              CPY FACHO
03636  BB2D  D0 10              BNE SAVQUO
03637  BB2F  A4 6B              LDY ARGMOH
03638  BB31  C4 63              CPY FACMOH
03639  BB33  D0 0A              BNE SAVQUO






CODE19......PAGE 004E

LINE# LOC   CODE        LINE


03640  BB35  A4 6C              LDY ARGMO
03641  BB37  C4 64              CPY FACMO
03642  BB39  D0 04              BNE SAVQUO
03643  BB3B  A4 6D              LDY ARGLO
03644  BB3D  C4 65              CPY FACLO
03645  BB3F  08          SAVQUO PHP
03646  BB40  2A                 ROL A
03647  BB41  90 09              BCC QSHFT
03648  BB43  E8                 INX
03649  BB44  95 29              STA RESLO,X
03650  BB46  F0 32              BEQ LD100
03651  BB48  10 34              BPL DIVNRM
03652  BB4A  A9 01              LDA #1
03653  BB4C  28          QSHFT  PLP
03654  BB4D  B0 0E              BCS DIVSUB
03655  BB4F  06 6D       SHFARG ASL ARGLO
03656  BB51  26 6C              ROL ARGMO
03657  BB53  26 6B              ROL ARGMOH
03658  BB55  26 6A              ROL ARGHO
03659  BB57  B0 E6              BCS SAVQUO
03660  BB59  30 CE              BMI DIVIDE
03661  BB5B  10 E2              BPL SAVQUO
03662  BB5D  A8          DIVSUB TAY
03663  BB5E  A5 6D              LDA ARGLO
03664  BB60  E5 65              SBC FACLO
03665  BB62  85 6D              STA ARGLO
03666  BB64  A5 6C              LDA ARGMO
03667  BB66  E5 64              SBC FACMO
03668  BB68  85 6C              STA ARGMO
03669  BB6A  A5 6B              LDA ARGMOH
03670  BB6C  E5 63              SBC FACMOH
03671  BB6E  85 6B              STA ARGMOH
03672  BB70  A5 6A              LDA ARGHO
03673  BB72  E5 62              SBC FACHO
03674  BB74  85 6A              STA ARGHO
03675  BB76  98                 TYA
03676  BB77  4C 4F BB           JMP SHFARG
03677  BB7A  A9 40       LD100  LDA #@100
03678  BB7C  D0 CE              BNE QSHFT
03679  BB7E  0A          DIVNRM ASL A
03680  BB7F  0A                 ASL A
03681  BB80  0A                 ASL A
03682  BB81  0A                 ASL A
03683  BB82  0A                 ASL A
03684  BB83  0A                 ASL A
03685  BB84  85 70              STA FACOV
03686  BB86  28                 PLP
03687  BB87  4C 8F BB           JMP MOVFR
03688  BB8A  A2 14       DV0ERR LDX #ERRDVO
03689  BB8C  4C 37 A4           JMP ERROR
03690  BB8F              .END
03691  BB8F              .LIB   CODE20









CODE20......PAGE 004F

LINE# LOC   CODE        LINE


03693  BB8F  A5 26       MOVFR  LDA RESHO
03694  BB91  85 62              STA FACHO
03695  BB93  A5 27              LDA RESMOH
03696  BB95  85 63              STA FACMOH
03697  BB97  A5 28              LDA RESMO
03698  BB99  85 64              STA FACMO
03699  BB9B  A5 29              LDA RESLO
03700  BB9D  85 65              STA FACLO
03701  BB9F  4C D7 B8           JMP NORMAL
03702  BBA2  85 22       MOVFM  STA INDEX1
03703  BBA4  84 23              STY INDEX1+1
03704  BBA6  A0 04              LDY #3+ADDPRC
03705  BBA8  B1 22              LDA (INDEX1)Y
03706  BBAA  85 65              STA FACLO
03707  BBAC  88                 DEY
03708  BBAD  B1 22              LDA (INDEX1)Y
03709  BBAF  85 64              STA FACMO
03710  BBB1  88                 DEY
03711  BBB2  B1 22              LDA (INDEX1)Y
03712  BBB4  85 63              STA FACMOH
03713  BBB6  88                 DEY
03714  BBB7  B1 22              LDA (INDEX1)Y
03715  BBB9  85 66              STA FACSGN
03716  BBBB  09 80              ORA #@200
03717  BBBD  85 62              STA FACHO
03718  BBBF  88                 DEY
03719  BBC0  B1 22              LDA (INDEX1)Y
03720  BBC2  85 61              STA FACEXP
03721  BBC4  84 70              STY FACOV
03722  BBC6  60                 RTS   
03723  BBC7  A2 5C       MOV2F  LDX #TEMPF2
03724  BBC9  2C                 .BYT $2C
03725  BBCA  A2 57       MOV1F  LDX #TEMPF1
03726  BBCC  A0 00              LDY #0
03727  BBCE  F0 04              BEQ MOVMF
03728  BBD0  A6 49       MOVVF  LDX FORPNT
03729  BBD2  A4 4A              LDY FORPNT+1
03730  BBD4  20 1B BC    MOVMF  JSR ROUND
03731  BBD7  86 22              STX INDEX1
03732  BBD9  84 23              STY INDEX1+1
03733  BBDB  A0 04              LDY #3+ADDPRC
03734  BBDD  A5 65              LDA FACLO
03735  BBDF  91 22              STA (INDEX)Y
03736  BBE1  88                 DEY
03737  BBE2  A5 64              LDA FACMO
03738  BBE4  91 22              STA (INDEX)Y
03739  BBE6  88                 DEY
03740  BBE7  A5 63              LDA FACMOH
03741  BBE9  91 22              STA (INDEX)Y
03742  BBEB  88                 DEY
03743  BBEC  A5 66              LDA FACSGN
03744  BBEE  09 7F              ORA #@177
03745  BBF0  25 62              AND FACHO
03746  BBF2  91 22              STA (INDEX)Y
03747  BBF4  88                 DEY






CODE20......PAGE 0050

LINE# LOC   CODE        LINE


03748  BBF5  A5 61              LDA FACEXP
03749  BBF7  91 22              STA (INDEX)Y
03750  BBF9  84 70              STY FACOV
03751  BBFB  60                 RTS
03752  BBFC  A5 6E       MOVFA  LDA ARGSGN
03753  BBFE  85 66       MOVFA1 STA FACSGN
03754  BC00  A2 05              LDX #4+ADDPRC
03755  BC02  B5 68       MOVFAL LDA ARGEXP-1,X
03756  BC04  95 60              STA FACEXP-1,X
03757  BC06  CA                 DEX
03758  BC07  D0 F9              BNE MOVFAL
03759  BC09  86 70              STX FACOV
03760  BC0B  60                 RTS
03761  BC0C  20 1B BC    MOVAF  JSR ROUND
03762  BC0F  A2 06       MOVEF  LDX #5+ADDPRC
03763  BC11  B5 60       MOVAFL LDA FACEXP-1,X
03764  BC13  95 68              STA ARGEXP-1,X
03765  BC15  CA                 DEX
03766  BC16  D0 F9              BNE MOVAFL
03767  BC18  86 70              STX FACOV
03768  BC1A  60          MOVRTS RTS
03769  BC1B  A5 61       ROUND  LDA FACEXP
03770  BC1D  F0 FB              BEQ MOVRTS
03771  BC1F  06 70              ASL FACOV
03772  BC21  90 F7              BCC MOVRTS
03773  BC23  20 6F B9    INCRND JSR INCFAC
03774  BC26  D0 F2              BNE MOVRTS
03775  BC28  4C 38 B9           JMP RNDSHF
03776  BC2B  A5 61       SIGN   LDA FACEXP
03777  BC2D  F0 09              BEQ SIGNRT
03778  BC2F  A5 66       FCSIGN LDA FACSGN
03779  BC31  2A          FCOMPS ROL A
03780  BC32  A9 FF              LDA #$FF
03781  BC34  B0 02              BCS SIGNRT
03782  BC36  A9 01              LDA #1
03783  BC38  60          SIGNRT RTS
03784  BC39  20 2B BC    SGN    JSR SIGN
03785  BC3C  85 62       FLOAT  STA FACHO
03786  BC3E  A9 00              LDA #0
03787  BC40  85 63              STA FACHO+1
03788  BC42  A2 88              LDX #@210
03789  BC44  A5 62       FLOATS LDA FACHO
03790  BC46  49 FF              EOR #@377
03791  BC48  2A                 ROL A
03792  BC49  A9 00       FLOATC LDA #0
03793  BC4B  85 65              STA FACLO
03794  BC4D  85 64              STA FACMO
03795  BC4F  86 61       FLOATB STX FACEXP
03796  BC51  85 70              STA FACOV
03797  BC53  85 66              STA FACSGN
03798  BC55  4C D2 B8           JMP FADFLT
03799  BC58  46 66       ABS    LSR FACSGN
03800  BC5A  60                 RTS
03801  BC5B  85 24       FCOMP  STA INDEX2
03802  BC5D  84 25       FCOMPN STY INDEX2+1






CODE20......PAGE 0051

LINE# LOC   CODE        LINE


03803  BC5F  A0 00              LDY #0
03804  BC61  B1 24              LDA (INDEX2)Y
03805  BC63  C8                 INY
03806  BC64  AA                 TAX
03807  BC65  F0 C4              BEQ SIGN
03808  BC67  B1 24              LDA (INDEX2)Y
03809  BC69  45 66              EOR FACSGN
03810  BC6B  30 C2              BMI FCSIGN
03811  BC6D  E4 61              CPX FACEXP
03812  BC6F  D0 21              BNE FCOMPC
03813  BC71  B1 24              LDA (INDEX2)Y
03814  BC73  09 80              ORA #@200
03815  BC75  C5 62              CMP FACHO
03816  BC77  D0 19              BNE FCOMPC
03817  BC79  C8                 INY
03818  BC7A  B1 24              LDA (INDEX2)Y
03819  BC7C  C5 63              CMP FACMOH
03820  BC7E  D0 12              BNE FCOMPC
03821  BC80  C8                 INY
03822  BC81  B1 24              LDA (INDEX2)Y
03823  BC83  C5 64              CMP FACMO
03824  BC85  D0 0B              BNE FCOMPC
03825  BC87  C8                 INY
03826  BC88  A9 7F              LDA #@177
03827  BC8A  C5 70              CMP FACOV
03828  BC8C  B1 24              LDA (INDEX2)Y
03829  BC8E  E5 65              SBC FACLO
03830  BC90  F0 28              BEQ QINTRT
03831  BC92  A5 66       FCOMPC LDA FACSGN
03832  BC94  90 02              BCC FCOMPD
03833  BC96  49 FF              EOR #@377
03834  BC98  4C 31 BC    FCOMPD JMP FCOMPS
03835  BC9B              .END
03836  BC9B              .LIB   CODE21



























CODE21......PAGE 0052

LINE# LOC   CODE        LINE


03838  BC9B  A5 61       QINT   LDA FACEXP
03839  BC9D  F0 4A              BEQ CLRFAC
03840  BC9F  38                 SEC
03841  BCA0  E9 A0              SBC #ADDPR8+@230
03842  BCA2  24 66              BIT FACSGN
03843  BCA4  10 09              BPL QISHFT
03844  BCA6  AA                 TAX
03845  BCA7  A9 FF              LDA #@377
03846  BCA9  85 68              STA BITS
03847  BCAB  20 4D B9           JSR NEGFCH
03848  BCAE  8A                 TXA
03849  BCAF  A2 61       QISHFT LDX #FAC
03850  BCB1  C9 F9              CMP #$F9
03851  BCB3  10 06              BPL QINT1
03852  BCB5  20 99 B9           JSR SHIFTR
03853  BCB8  84 68              STY BITS
03854  BCBA  60          QINTRT RTS
03855  BCBB  A8          QINT1  TAY
03856  BCBC  A5 66              LDA FACSGN
03857  BCBE  29 80              AND #@200
03858  BCC0  46 62              LSR FACHO
03859  BCC2  05 62              ORA FACHO
03860  BCC4  85 62              STA FACHO
03861  BCC6  20 B0 B9           JSR ROLSHF
03862  BCC9  84 68              STY BITS
03863  BCCB  60                 RTS
03864  BCCC  A5 61       INT    LDA FACEXP
03865  BCCE  C9 A0              CMP #ADDPR8+@230
03866  BCD0  B0 20              BCS INTRTS
03867  BCD2  20 9B BC           JSR QINT
03868  BCD5  84 70              STY FACOV
03869  BCD7  A5 66              LDA FACSGN
03870  BCD9  84 66              STY FACSGN
03871  BCDB  49 80              EOR #@200
03872  BCDD  2A                 ROL A
03873  BCDE  A9 A0              LDA #@230+8
03874  BCE0  85 61              STA FACEXP
03875  BCE2  A5 65              LDA FACLO
03876  BCE4  85 07              STA INTEGR
03877  BCE6  4C D2 B8           JMP FADFLT
03878  BCE9  85 62       CLRFAC STA FACHO
03879  BCEB  85 63              STA FACMOH
03880  BCED  85 64              STA FACMO
03881  BCEF  85 65              STA FACLO
03882  BCF1  A8                 TAY 
03883  BCF2  60          INTRTS RTS
03884  BCF3  A0 00       FIN    LDY #@0
03885  BCF5  A2 0A              LDX #@11+ADDPRC
03886  BCF7  94 5D       FINZLP STY DECCNT,X
03887  BCF9  CA                 DEX
03888  BCFA  10 FB              BPL FINZLP
03889  BCFC  90 0F              BCC FINDGQ
03890  BCFE  C9 2D              CMP #'-
03891  BD00  D0 04              BNE QPLUS
03892  BD02  86 67              STX SGNFLG






CODE21......PAGE 0053

LINE# LOC   CODE        LINE


03893  BD04  F0 04              BEQ FINC
03894  BD06  C9 2B       QPLUS  CMP #'+
03895  BD08  D0 05              BNE FIN1
03896  BD0A  20 73 00    FINC   JSR CHRGET
03897  BD0D  90 5B       FINDGQ BCC FINDIG
03898  BD0F  C9 2E       FIN1   CMP #'.
03899  BD11  F0 2E              BEQ FINDP
03900  BD13  C9 45              CMP #'E
03901  BD15  D0 30              BNE FINE
03902  BD17  20 73 00           JSR CHRGET
03903  BD1A  90 17              BCC FNEDG1
03904  BD1C  C9 AB              CMP #MINUTK
03905  BD1E  F0 0E              BEQ FINEC1
03906  BD20  C9 2D              CMP #'-
03907  BD22  F0 0A              BEQ FINEC1
03908  BD24  C9 AA              CMP #PLUSTK
03909  BD26  F0 08              BEQ FINEC
03910  BD28  C9 2B              CMP #'+
03911  BD2A  F0 04              BEQ FINEC
03912  BD2C  D0 07              BNE FINEC2
03913  BD2E  66 60       FINEC1 ROR EXPSGN
03914  BD30  20 73 00    FINEC  JSR CHRGET
03915  BD33  90 5C       FNEDG1 BCC FINEDG
03916  BD35  24 60       FINEC2 BIT EXPSGN
03917  BD37  10 0E              BPL FINE
03918  BD39  A9 00              LDA #0
03919  BD3B  38                 SEC
03920  BD3C  E5 5E              SBC TENEXP
03921  BD3E  4C 49 BD           JMP FINE1
03922  BD41  66 5F       FINDP  ROR DPTFLG
03923  BD43  24 5F              BIT DPTFLG
03924  BD45  50 C3              BVC FINC
03925  BD47  A5 5E       FINE   LDA TENEXP
03926  BD49  38          FINE1  SEC
03927  BD4A  E5 5D              SBC DECCNT
03928  BD4C  85 5E              STA TENEXP
03929  BD4E  F0 12              BEQ FINQNG
03930  BD50  10 09              BPL FINMUL
03931  BD52  20 FE BA    FINDIV JSR DIV10
03932  BD55  E6 5E              INC TENEXP
03933  BD57  D0 F9              BNE FINDIV
03934  BD59  F0 07              BEQ FINQNG
03935  BD5B  20 E2 BA    FINMUL JSR MUL10
03936  BD5E  C6 5E              DEC TENEXP
03937  BD60  D0 F9              BNE FINMUL
03938  BD62  A5 67       FINQNG LDA SGNFLG
03939  BD64  30 01              BMI NEGXQS
03940  BD66  60                 RTS
03941  BD67  4C B4 BF    NEGXQS JMP NEGOP
03942  BD6A  48          FINDIG PHA
03943  BD6B  24 5F              BIT DPTFLG
03944  BD6D  10 02              BPL FINDG1
03945  BD6F  E6 5D              INC DECCNT
03946  BD71  20 E2 BA    FINDG1 JSR MUL10
03947  BD74  68                 PLA






CODE21......PAGE 0054

LINE# LOC   CODE        LINE


03948  BD75  38                 SEC
03949  BD76  E9 30              SBC #'0
03950  BD78  20 7E BD           JSR FINLOG
03951  BD7B  4C 0A BD           JMP FINC
03952  BD7E  48          FINLOG PHA
03953  BD7F  20 0C BC           JSR MOVAF
03954  BD82  68                 PLA
03955  BD83  20 3C BC           JSR FLOAT
03956  BD86  A5 6E              LDA ARGSGN
03957  BD88  45 66              EOR FACSGN
03958  BD8A  85 6F              STA ARISGN
03959  BD8C  A6 61              LDX FACEXP
03960  BD8E  4C 6A B8           JMP FADDT
03961  BD91  A5 5E       FINEDG LDA TENEXP
03962  BD93  C9 0A              CMP #@12
03963  BD95  90 09              BCC MLEX10
03964  BD97  A9 64              LDA #@144
03965  BD99  24 60              BIT EXPSGN
03966  BD9B  30 11              BMI MLEXMI
03967  BD9D  4C 7E B9           JMP OVERR
03968  BDA0  0A          MLEX10 ASL A
03969  BDA1  0A                 ASL A
03970  BDA2  18                 CLC
03971  BDA3  65 5E              ADC TENEXP
03972  BDA5  0A                 ASL A
03973  BDA6  18                 CLC
03974  BDA7  A0 00              LDY #0
03975  BDA9  71 7A              ADC (TXTPTR)Y
03976  BDAB  38                 SEC
03977  BDAC  E9 30              SBC #'0
03978  BDAE  85 5E       MLEXMI STA TENEXP
03979  BDB0  4C 30 BD           JMP FINEC
03980  BDB3              .END
03981  BDB3              .LIB   CODE22



























CODE22......PAGE 0055

LINE# LOC   CODE        LINE


03983  BDB3  9B          N0999  .BYT @233,@76,@274,@37,@375
03983  BDB4  3E 
03983  BDB5  BC 
03983  BDB6  1F 
03983  BDB7  FD 
03984  BDB8  9E          N9999  .BYT @236,@156,@153,@47,@375
03984  BDB9  6E 
03984  BDBA  6B 
03984  BDBB  27 
03984  BDBC  FD 
03985  BDBD  9E          NMIL   .BYT @236,@156,@153,@50,0
03985  BDBE  6E 
03985  BDBF  6B 
03985  BDC0  28 
03985  BDC1  00 
03986  BDC2  A9 71       INPRT  LDA #<INTXT
03987  BDC4  A0 A3              LDY #>INTXT
03988  BDC6  20 DA BD           JSR STROU2
03989  BDC9  A5 3A              LDA CURLIN+1
03990  BDCB  A6 39              LDX CURLIN
03991  BDCD  85 62       LINPRT STA FACHO
03992  BDCF  86 63              STX FACHO+1
03993  BDD1  A2 90              LDX #@220
03994  BDD3  38                 SEC
03995  BDD4  20 49 BC           JSR FLOATC
03996  BDD7  20 DF BD           JSR FOUTC
03997  BDDA  4C 1E AB    STROU2 JMP STROUT
03998  BDDD  A0 01       FOUT   LDY #1
03999  BDDF  A9 20       FOUTC  LDA #' 
04000  BDE1  24 66              BIT FACSGN
04001  BDE3  10 02              BPL FOUT1
04002  BDE5  A9 2D              LDA #'-
04003  BDE7  99 FF 00    FOUT1  STA FBUFFR-1,Y
04004  BDEA  85 66              STA FACSGN
04005  BDEC  84 71              STY FBUFPT
04006  BDEE  C8                 INY
04007  BDEF  A9 30              LDA #'0
04008  BDF1  A6 61              LDX FACEXP
04009  BDF3  D0 03              BNE *+5
04010  BDF5  4C 04 BF           JMP FOUT19
04011  BDF8  A9 00              LDA #0
04012  BDFA  E0 80              CPX #@200
04013  BDFC  F0 02              BEQ FOUT37
04014  BDFE  B0 09              BCS FOUT7
04015  BE00  A9 BD       FOUT37 LDA #<NMIL
04016  BE02  A0 BD              LDY #>NMIL
04017  BE04  20 28 BA           JSR FMULT
04018  BE07  A9 F7              LDA #250-ADDPR2-ADDPRC
04019  BE09  85 5D       FOUT7  STA DECCNT
04020  BE0B  A9 B8       FOUT4  LDA #<N9999
04021  BE0D  A0 BD              LDY #>N9999
04022  BE0F  20 5B BC           JSR FCOMP
04023  BE12  F0 1E              BEQ BIGGES
04024  BE14  10 12              BPL FOUT9
04025  BE16  A9 B3       FOUT3  LDA #<N0999






CODE22......PAGE 0056

LINE# LOC   CODE        LINE


04026  BE18  A0 BD              LDY #>N0999
04027  BE1A  20 5B BC           JSR FCOMP
04028  BE1D  F0 02              BEQ FOUT38
04029  BE1F  10 0E              BPL FOUT5
04030  BE21  20 E2 BA    FOUT38 JSR MUL10
04031  BE24  C6 5D              DEC DECCNT
04032  BE26  D0 EE              BNE FOUT3
04033  BE28  20 FE BA    FOUT9  JSR DIV10
04034  BE2B  E6 5D              INC DECCNT
04035  BE2D  D0 DC              BNE FOUT4
04036  BE2F  20 49 B8    FOUT5  JSR FADDH
04037  BE32  20 9B BC    BIGGES JSR QINT
04038  BE35  A2 01              LDX #1
04039  BE37  A5 5D              LDA DECCNT
04040  BE39  18                 CLC
04041  BE3A  69 0A              ADC #ADDPR2+ADDPRC+7
04042  BE3C  30 09              BMI FOUTPI
04043  BE3E  C9 0B              CMP #ADDPR2+ADDPRC+@10
04044  BE40  B0 06              BCS FOUT6
04045  BE42  69 FF              ADC #$FF
04046  BE44  AA                 TAX
04047  BE45  A9 02              LDA #2
04048  BE47  38          FOUTPI SEC
04049  BE48  E9 02       FOUT6  SBC #2
04050  BE4A  85 5E              STA TENEXP
04051  BE4C  86 5D              STX DECCNT
04052  BE4E  8A                 TXA
04053  BE4F  F0 02              BEQ FOUT39
04054  BE51  10 13              BPL FOUT8
04055  BE53  A4 71       FOUT39 LDY FBUFPT
04056  BE55  A9 2E              LDA #'.
04057  BE57  C8                 INY
04058  BE58  99 FF 00           STA FBUFFR-1,Y
04059  BE5B  8A                 TXA
04060  BE5C  F0 06              BEQ FOUT16
04061  BE5E  A9 30              LDA #'0
04062  BE60  C8                 INY
04063  BE61  99 FF 00           STA FBUFFR-1,Y
04064  BE64  84 71       FOUT16 STY FBUFPT
04065  BE66  A0 00       FOUT8  LDY #0
04066  BE68  A2 80       FOUTIM LDX #@200
04067  BE6A  A5 65       FOUT2  LDA FACLO
04068  BE6C  18                 CLC
04069  BE6D  79 19 BF           ADC FOUTBL+2+ADDPRC,Y
04070  BE70  85 65              STA FACLO
04071  BE72  A5 64              LDA FACMO
04072  BE74  79 18 BF           ADC FOUTBL+1+ADDPRC,Y
04073  BE77  85 64              STA FACMO
04074  BE79  A5 63              LDA FACMOH
04075  BE7B  79 17 BF           ADC FOUTBL+1,Y
04076  BE7E  85 63              STA FACMOH
04077  BE80  A5 62              LDA FACHO
04078  BE82  79 16 BF           ADC FOUTBL,Y
04079  BE85  85 62              STA FACHO
04080  BE87  E8                 INX






CODE22......PAGE 0057

LINE# LOC   CODE        LINE


04081  BE88  B0 04              BCS FOUT41
04082  BE8A  10 DE              BPL FOUT2
04083  BE8C  30 02              BMI FOUT40
04084  BE8E  30 DA       FOUT41 BMI FOUT2
04085  BE90  8A          FOUT40 TXA
04086  BE91  90 04              BCC FOUTYP
04087  BE93  49 FF              EOR #@377
04088  BE95  69 0A              ADC #@12
04089  BE97  69 2F       FOUTYP ADC #@57
04090  BE99  C8                 INY
04091  BE9A  C8                 INY
04092  BE9B  C8                 INY
04093  BE9C  C8                 INY
04094  BE9D  84 47              STY FDECPT
04095  BE9F  A4 71              LDY FBUFPT
04096  BEA1  C8                 INY
04097  BEA2  AA                 TAX
04098  BEA3  29 7F              AND #@177
04099  BEA5  99 FF 00           STA FBUFFR-1,Y
04100  BEA8  C6 5D              DEC DECCNT
04101  BEAA  D0 06              BNE STXBUF
04102  BEAC  A9 2E              LDA #'.
04103  BEAE  C8                 INY
04104  BEAF  99 FF 00           STA FBUFFR-1,Y
04105  BEB2  84 71       STXBUF STY FBUFPT
04106  BEB4  A4 47              LDY FDECPT
04107  BEB6  8A                 TXA
04108  BEB7  49 FF              EOR #@377
04109  BEB9  29 80              AND #@200
04110  BEBB  AA                 TAX
04111  BEBC  C0 24              CPY #FDCEND-FOUTBL
04112  BEBE  F0 04              BEQ FOULDY
04113  BEC0  C0 3C              CPY #TIMEND-FOUTBL
04114  BEC2  D0 A6              BNE FOUT2
04115  BEC4  A4 71       FOULDY LDY FBUFPT
04116  BEC6  B9 FF 00    FOUT11 LDA FBUFFR-1,Y
04117  BEC9  88                 DEY
04118  BECA  C9 30              CMP #'0
04119  BECC  F0 F8              BEQ FOUT11
04120  BECE  C9 2E              CMP #'.
04121  BED0  F0 01              BEQ FOUT12
04122  BED2  C8                 INY
04123  BED3  A9 2B       FOUT12 LDA #'+
04124  BED5  A6 5E              LDX TENEXP
04125  BED7  F0 2E              BEQ FOUT17
04126  BED9  10 08              BPL FOUT14
04127  BEDB  A9 00              LDA #0
04128  BEDD  38                 SEC
04129  BEDE  E5 5E              SBC TENEXP
04130  BEE0  AA                 TAX
04131  BEE1              .END
04132  BEE1              .LIB   CODE23









CODE23......PAGE 0058

LINE# LOC   CODE        LINE


04134  BEE1  A9 2D              LDA #'-
04135  BEE3  99 01 01    FOUT14 STA FBUFFR+1,Y
04136  BEE6  A9 45              LDA #'E
04137  BEE8  99 00 01           STA FBUFFR,Y
04138  BEEB  8A                 TXA
04139  BEEC  A2 2F              LDX #@57
04140  BEEE  38                 SEC
04141  BEEF  E8          FOUT15 INX
04142  BEF0  E9 0A              SBC #@12
04143  BEF2  B0 FB              BCS FOUT15
04144  BEF4  69 3A              ADC #@72
04145  BEF6  99 03 01           STA FBUFFR+3,Y
04146  BEF9  8A                 TXA
04147  BEFA  99 02 01           STA FBUFFR+2,Y
04148  BEFD  A9 00              LDA #0
04149  BEFF  99 04 01           STA FBUFFR+4,Y
04150  BF02  F0 08              BEQ FOUT20
04151  BF04  99 FF 00    FOUT19 STA FBUFFR-1,Y
04152  BF07  A9 00       FOUT17 LDA #0
04153  BF09  99 00 01           STA FBUFFR,Y
04154  BF0C  A9 00       FOUT20 LDA #<FBUFFR
04155  BF0E  A0 01              LDY #>FBUFFR
04156  BF10  60                 RTS
04157  BF11  80          FHALF  .BYT @200,0
04157  BF12  00 
04158  BF13  00          ZERO   .BYT 0,0,0
04158  BF14  00 
04158  BF15  00 
04159  BF16  FA          FOUTBL .BYT @372,@12,@37,0,0
04159  BF17  0A 
04159  BF18  1F 
04159  BF19  00 
04159  BF1A  00 
04160  BF1B  98                 .BYT @230,@226,@200,@377
04160  BF1C  96 
04160  BF1D  80 
04160  BF1E  FF 
04161  BF1F  F0                 .BYT @360,@275,@300,0
04161  BF20  BD 
04161  BF21  C0 
04161  BF22  00 
04162  BF23  01                 .BYT 1,@206,@240,@377
04162  BF24  86 
04162  BF25  A0 
04162  BF26  FF 
04163  BF27  FF                 .BYT @377,@330,@360,0,0
04163  BF28  D8 
04163  BF29  F0 
04163  BF2A  00 
04163  BF2B  00 
04164  BF2C  03                 .BYT 3,@350,@377,@377
04164  BF2D  E8 
04164  BF2E  FF 
04164  BF2F  FF 
04165  BF30  FF                 .BYT @377,@234,0,0,0,@12






CODE23......PAGE 0059

LINE# LOC   CODE        LINE


04165  BF31  9C 
04165  BF32  00 
04165  BF33  00 
04165  BF34  00 
04165  BF35  0A 
04166  BF36  FF                 .BYT @377,@377,@377,@377
04166  BF37  FF 
04166  BF38  FF 
04166  BF39  FF 
04167  BF3A  FF          FDCEND .BYT @377,@337,@12,@200
04167  BF3B  DF 
04167  BF3C  0A 
04167  BF3D  80 
04168  BF3E  00                 .BYT 0,3,@113,@300,@377
04168  BF3F  03 
04168  BF40  4B 
04168  BF41  C0 
04168  BF42  FF 
04169  BF43  FF                 .BYT @377,@163,@140,0,0
04169  BF44  73 
04169  BF45  60 
04169  BF46  00 
04169  BF47  00 
04170  BF48  0E                 .BYT @16,@20,@377,@377
04170  BF49  10 
04170  BF4A  FF 
04170  BF4B  FF 
04171  BF4C  FD                 .BYT @375,@250,0,0,0,@74
04171  BF4D  A8 
04171  BF4E  00 
04171  BF4F  00 
04171  BF50  00 
04171  BF51  3C 
04172  BF52              TIMEND
04173  BF52              ;
04174  BF52  00          CKSMA0 .BYT $00        ;$A000 8K ROOM CHECK SUM ADJ
04175  BF53              PATCHS *=*+30          ; PATCH AREA
04176  BF71              ;
04177  BF71  20 0C BC    SQR    JSR MOVAF
04178  BF74  A9 11              LDA #<FHALF
04179  BF76  A0 BF              LDY #>FHALF
04180  BF78  20 A2 BB           JSR MOVFM
04181  BF7B  F0 70       FPWRT  BEQ EXP
04182  BF7D  A5 69              LDA ARGEXP
04183  BF7F  D0 03              BNE FPWRT1
04184  BF81  4C F9 B8           JMP ZEROF1
04185  BF84  A2 4E       FPWRT1 LDX #<TEMPF3
04186  BF86  A0 00              LDY #>TEMPF3
04187  BF88  20 D4 BB           JSR MOVMF
04188  BF8B  A5 6E              LDA ARGSGN
04189  BF8D  10 0F              BPL FPWR1
04190  BF8F  20 CC BC           JSR INT
04191  BF92  A9 4E              LDA #<TEMPF3
04192  BF94  A0 00              LDY #>TEMPF3
04193  BF96  20 5B BC           JSR FCOMP






CODE23......PAGE 005A

LINE# LOC   CODE        LINE


04194  BF99  D0 03              BNE FPWR1
04195  BF9B  98                 TYA
04196  BF9C  A4 07              LDY INTEGR
04197  BF9E  20 FE BB    FPWR1  JSR MOVFA1
04198  BFA1  98                 TYA
04199  BFA2  48                 PHA
04200  BFA3  20 EA B9           JSR LOG
04201  BFA6  A9 4E              LDA #<TEMPF3
04202  BFA8  A0 00              LDY #>TEMPF3
04203  BFAA  20 28 BA           JSR FMULT
04204  BFAD  20 ED BF           JSR EXP
04205  BFB0  68                 PLA
04206  BFB1  4A                 LSR A
04207  BFB2  90 0A              BCC NEGRTS
04208  BFB4  A5 61       NEGOP  LDA FACEXP
04209  BFB6  F0 06              BEQ NEGRTS
04210  BFB8  A5 66              LDA FACSGN
04211  BFBA  49 FF              EOR #@377
04212  BFBC  85 66              STA FACSGN
04213  BFBE  60          NEGRTS RTS
04214  BFBF              .END
04215  BFBF              .LIB   CODE24







































CODE24......PAGE 005B

LINE# LOC   CODE        LINE


04217  BFBF  81          LOGEB2 .BYT @201,@70,@252,@73,@51
04217  BFC0  38 
04217  BFC1  AA 
04217  BFC2  3B 
04217  BFC3  29 
04218  BFC4  07          EXPCON .BYT 7,@161,@64,@130,@76
04218  BFC5  71 
04218  BFC6  34 
04218  BFC7  58 
04218  BFC8  3E 
04219  BFC9  56                 .BYT @126,@164,@26,@176
04219  BFCA  74 
04219  BFCB  16 
04219  BFCC  7E 
04220  BFCD  B3                 .BYT @263,@33,@167,@57
04220  BFCE  1B 
04220  BFCF  77 
04220  BFD0  2F 
04221  BFD1  EE                 .BYT @356,@343,@205,@172
04221  BFD2  E3 
04221  BFD3  85 
04221  BFD4  7A 
04222  BFD5  1D                 .BYT @35,@204,@34,@52
04222  BFD6  84 
04222  BFD7  1C 
04222  BFD8  2A 
04223  BFD9  7C                 .BYT @174,@143,@131,@130
04223  BFDA  63 
04223  BFDB  59 
04223  BFDC  58 
04224  BFDD  0A                 .BYT @12,@176,@165,@375
04224  BFDE  7E 
04224  BFDF  75 
04224  BFE0  FD 
04225  BFE1  E7                 .BYT @347,@306,@200,@61
04225  BFE2  C6 
04225  BFE3  80 
04225  BFE4  31 
04226  BFE5  72                 .BYT @162,@30,@20,@201
04226  BFE6  18 
04226  BFE7  10 
04226  BFE8  81 
04227  BFE9  00                 .BYT 0,0,0,0
04227  BFEA  00 
04227  BFEB  00 
04227  BFEC  00 
04228  BFED              ;
04229  BFED              ; START OF KERNAL ROM
04230  BFED              ;
04231  BFED  A9 BF       EXP    LDA #<LOGEB2
04232  BFEF  A0 BF              LDY #>LOGEB2
04233  BFF1  20 28 BA           JSR FMULT
04234  BFF4  A5 70              LDA FACOV
04235  BFF6  69 50              ADC #@120
04236  BFF8  90 03              BCC STOLDX






CODE24......PAGE 005C

LINE# LOC   CODE        LINE


04237  BFFA  20 23 BC           JSR INCRND
04238  BFFD  4C 00 E0    STOLDX JMP STOLD       ;CROSS BOUNDRIES
04239  C000              .END
04240  C000              .LIB   CODE25

























































CODE25......PAGE 005D

LINE# LOC   CODE        LINE


04242  C000                     *=$E000         ;START OF VIC-40 KERNAL ROM


04244  E000              ; CONTINUATION OF EXPONENT ROUTINE
04245  E000              ;
04246  E000  85 56       STOLD  STA OLDOV
04247  E002  20 0F BC           JSR MOVEF
04248  E005  A5 61              LDA FACEXP
04249  E007  C9 88              CMP #@210
04250  E009  90 03              BCC EXP1
04251  E00B  20 D4 BA    GOMLDV JSR MLDVEX
04252  E00E  20 CC BC    EXP1   JSR INT
04253  E011  A5 07              LDA INTEGR
04254  E013  18                 CLC
04255  E014  69 81              ADC #@201
04256  E016  F0 F3              BEQ GOMLDV
04257  E018  38                 SEC
04258  E019  E9 01              SBC #1
04259  E01B  48                 PHA
04260  E01C  A2 05              LDX #4+ADDPRC
04261  E01E  B5 69       SWAPLP LDA ARGEXP,X
04262  E020  B4 61              LDY FACEXP,X
04263  E022  95 61              STA FACEXP,X
04264  E024  94 69              STY ARGEXP,X
04265  E026  CA                 DEX
04266  E027  10 F5              BPL SWAPLP
04267  E029  A5 56              LDA OLDOV
04268  E02B  85 70              STA FACOV
04269  E02D  20 53 B8           JSR FSUBT
04270  E030  20 B4 BF           JSR NEGOP
04271  E033  A9 C4              LDA #<EXPCON
04272  E035  A0 BF              LDY #>EXPCON
04273  E037  20 59 E0           JSR POLY
04274  E03A  A9 00              LDA #0
04275  E03C  85 6F              STA ARISGN
04276  E03E  68                 PLA
04277  E03F  20 B9 BA           JSR MLDEXP
04278  E042  60                 RTS
04279  E043  85 71       POLYX  STA POLYPT
04280  E045  84 72              STY POLYPT+1
04281  E047  20 CA BB           JSR MOV1F
04282  E04A  A9 57              LDA #TEMPF1
04283  E04C  20 28 BA           JSR FMULT
04284  E04F  20 5D E0           JSR POLY1
04285  E052  A9 57              LDA #<TEMPF1
04286  E054  A0 00              LDY #>TEMPF1
04287  E056  4C 28 BA           JMP FMULT
04288  E059  85 71       POLY   STA POLYPT
04289  E05B  84 72              STY POLYPT+1
04290  E05D  20 C7 BB    POLY1  JSR MOV2F
04291  E060  B1 71              LDA (POLYPT)Y
04292  E062  85 67              STA DEGREE
04293  E064  A4 71              LDY POLYPT
04294  E066  C8                 INY
04295  E067  98                 TYA






CODE25......PAGE 005E

LINE# LOC   CODE        LINE


04296  E068  D0 02              BNE POLY3
04297  E06A  E6 72              INC POLYPT+1
04298  E06C  85 71       POLY3  STA POLYPT
04299  E06E  A4 72              LDY POLYPT+1
04300  E070  20 28 BA    POLY2  JSR FMULT
04301  E073  A5 71              LDA POLYPT
04302  E075  A4 72              LDY POLYPT+1
04303  E077  18                 CLC
04304  E078  69 05              ADC #4+ADDPRC
04305  E07A  90 01              BCC POLY4
04306  E07C  C8                 INY
04307  E07D  85 71       POLY4  STA POLYPT
04308  E07F  84 72              STY POLYPT+1
04309  E081  20 67 B8           JSR FADD
04310  E084  A9 5C              LDA #<TEMPF2
04311  E086  A0 00              LDY #>TEMPF2
04312  E088  C6 67              DEC DEGREE
04313  E08A  D0 E4              BNE POLY2
04314  E08C  60                 RTS
04315  E08D  98          RMULC  .BYT @230,@65,@104,@172,0
04315  E08E  35 
04315  E08F  44 
04315  E090  7A 
04315  E091  00 
04316  E092  68          RADDC  .BYT @150,@50,@261,@106,0
04316  E093  28 
04316  E094  B1 
04316  E095  46 
04316  E096  00 
04317  E097  20 2B BC    RND    JSR SIGN
04318  E09A  30 37              BMI RND1
04319  E09C  D0 20              BNE QSETNR
04320  E09E  20 F3 FF           JSR RDBAS
04321  E0A1  86 22              STX INDEX1
04322  E0A3  84 23              STY INDEX1+1
04323  E0A5  A0 04              LDY #4
04324  E0A7  B1 22              LDA (INDEX1)Y
04325  E0A9  85 62              STA FACHO
04326  E0AB  C8                 INY
04327  E0AC  B1 22              LDA (INDEX1)Y
04328  E0AE  85 64              STA FACMO
04329  E0B0  A0 08              LDY #8
04330  E0B2  B1 22              LDA (INDEX1)Y
04331  E0B4  85 63              STA FACMOH
04332  E0B6  C8                 INY
04333  E0B7  B1 22              LDA (INDEX1)Y
04334  E0B9  85 65              STA FACLO
04335  E0BB  4C E3 E0           JMP STRNEX
04336  E0BE  A9 8B       QSETNR LDA #<RNDX
04337  E0C0  A0 00              LDY #>RNDX
04338  E0C2  20 A2 BB           JSR MOVFM
04339  E0C5  A9 8D              LDA #<RMULC
04340  E0C7  A0 E0              LDY #>RMULC
04341  E0C9  20 28 BA           JSR FMULT
04342  E0CC  A9 92              LDA #<RADDC






CODE25......PAGE 005F

LINE# LOC   CODE        LINE


04343  E0CE  A0 E0              LDY #>RADDC
04344  E0D0  20 67 B8           JSR FADD
04345  E0D3  A6 65       RND1   LDX FACLO
04346  E0D5  A5 62              LDA FACHO
04347  E0D7  85 65              STA FACLO
04348  E0D9  86 62              STX FACHO
04349  E0DB  A6 63              LDX FACMOH
04350  E0DD  A5 64              LDA FACMO
04351  E0DF  85 63              STA FACMOH
04352  E0E1  86 64              STX FACMO
04353  E0E3  A9 00       STRNEX LDA #0
04354  E0E5  85 66              STA FACSGN
04355  E0E7  A5 61              LDA FACEXP
04356  E0E9  85 70              STA FACOV
04357  E0EB  A9 80              LDA #@200
04358  E0ED  85 61              STA FACEXP
04359  E0EF  20 D7 B8           JSR NORMAL
04360  E0F2  A2 8B              LDX #<RNDX
04361  E0F4  A0 00              LDY #>RNDX
04362  E0F6  4C D4 BB    GMOVMF JMP MOVMF
04363  E0F9              .END
04364  E0F9              .LIB   CODE26







































CODE26......PAGE 0060

LINE# LOC   CODE        LINE


04366  E0F9              ;MOST REFERENCES TO KERNAL ARE DEFINED HERE
04367  E0F9              ;
04368  E0F9  C9 F0       EREXIT CMP #$F0        ;CHECK FOR SPECIAL CASE
04369  E0FB  D0 07              BNE EREXIX
04370  E0FD              ; TOP OF MEMORY HAS CHANGED
04371  E0FD  84 38              STY MEMSIZ+1
04372  E0FF  86 37              STX MEMSIZ
04373  E101  4C 63 A6           JMP CLEART      ;ACT AS IF HE TYPED CLEAR
04374  E104  AA          EREXIX TAX             ;SET TERMINATION FLAGS
04375  E105  D0 02              BNE EREXIY
04376  E107  A2 1E              LDX #ERBRK      ;BREAK ERROR
04377  E109  4C 37 A4    EREXIY JMP ERROR       ;NORMAL ERROR





04379  E10C              CLSCHN =$FFCC





04381  E10C  20 D2 FF    OUTCH  JSR $FFD2
04382  E10F  B0 E8              BCS EREXIT
04383  E111  60                 RTS





04385  E112  20 CF FF    INCHR  JSR $FFCF
04386  E115  B0 E2              BCS EREXIT
04387  E117  60                 RTS





04389  E118              CCALL  =$FFE7





04391  E118              SETTIM =$FFDB
04392  E118              RDTIM  =$FFDE





04394  E118  20 AD E4    COOUT  JSR PPACH       ; GO OUT TO SAVE .A FOR PRINT# PATCH
04395  E11B  B0 DC              BCS EREXIT
04396  E11D  60                 RTS






CODE26......PAGE 0061

LINE# LOC   CODE        LINE


04398  E11E  20 C6 FF    COIN   JSR $FFC6
04399  E121  B0 D6              BCS EREXIT
04400  E123  60                 RTS





04402  E124              READST =$FFB7





04404  E124  20 E4 FF    CGETL  JSR $FFE4
04405  E127  B0 D0              BCS EREXIT
04406  E129  60                 RTS





04408  E12A              RDBAS  =$FFF3





04410  E12A              SETMSG =$FF90





04412  E12A              PLOT   =$FFF0





04414  E12A  20 8A AD    CSYS   JSR FRMNUM      ;EVAL FORMULA
04415  E12D  20 F7 B7           JSR GETADR      ;CONVERT TO INT. ADDR
04416  E130  A9 E1              LDA #>CSYSRZ    ;PUSH RETURN ADDRESS
04417  E132  48                 PHA
04418  E133  A9 46              LDA #<CSYSRZ
04419  E135  48                 PHA
04420  E136  AD 0F 03           LDA SPREG       ;STATUS REG
04421  E139  48                 PHA
04422  E13A  AD 0C 03           LDA SAREG       ;LOAD 6502 REGS
04423  E13D  AE 0D 03           LDX SXREG
04424  E140  AC 0E 03           LDY SYREG
04425  E143  28                 PLP             ;LOAD 6502 STATUS REG
04426  E144  6C 14 00           JMP (LINNUM)    ;GO DO IT
04427  E147              CSYSRZ =*-1            ;RETURN TO HERE
04428  E147  08                 PHP             ;SAVE STATUS REG






CODE26......PAGE 0062

LINE# LOC   CODE        LINE


04429  E148  8D 0C 03           STA SAREG       ;SAVE 6502 REGS
04430  E14B  8E 0D 03           STX SXREG
04431  E14E  8C 0E 03           STY SYREG
04432  E151  68                 PLA             ;GET STATUS REG
04433  E152  8D 0F 03           STA SPREG
04434  E155  60                 RTS             ;RETURN TO SYSTEM





04436  E156  20 D4 E1    CSAVE  JSR PLSV        ;PARSE PARMS
04437  E159  A6 2D              LDX VARTAB      ;END SAVE ADDR
04438  E15B  A4 2E              LDY VARTAB+1
04439  E15D  A9 2B              LDA #<TXTTAB    ;INDIRECT WITH START ADDRESS
04440  E15F  20 D8 FF           JSR $FFD8       ;SAVE IT
04441  E162  B0 95              BCS EREXIT
04442  E164  60                 RTS





04444  E165  A9 01       CVERF  LDA #1          ;VERIFY FLAG
04445  E167  2C                 .BYT $2C        ;SKIP TWO BYTES





04447  E168  A9 00       CLOAD  LDA #0          ;LOAD FLAG
04448  E16A  85 0A              STA VERCK
04449  E16C  20 D4 E1           JSR PLSV        ;PARSE PARAMETERS
04450  E16F              ;
04451  E16F              CLD10                  ; JSR $FFE1 ;CHECK RUN/STOP
04452  E16F              ; CMP #$FF ;DONE YET?
04453  E16F              ; BNE CLD10 ;STILL BOUNCING
04454  E16F  A5 0A              LDA VERCK
04455  E171  A6 2B              LDX TXTTAB      ;.X AND .Y HAVE ALT...
04456  E173  A4 2C              LDY TXTTAB+1    ;...LOAD ADDRESS
04457  E175  20 D5 FF           JSR $FFD5       ;LOAD IT
04458  E178  B0 57              BCS JERXIT      ;PROBLEMS
04459  E17A              ;
04460  E17A  A5 0A              LDA VERCK
04461  E17C  F0 17              BEQ CLD50       ;WAS LOAD
04462  E17E              ;
04463  E17E              ;FINISH VERIFY
04464  E17E              ;
04465  E17E  A2 1C              LDX #ERVFY      ;ASSUME ERROR
04466  E180  20 B7 FF           JSR $FFB7       ;READ STATUS
04467  E183  29 10              AND #$10        ;CHECK ERROR
04468  E185  D0 17              BNE CLD55       ;REPLACES BEQ *+5/JMP ERROR
04469  E187              ;
04470  E187              ;PRINT VERIFY 'OK' IF DIRECT
04471  E187              ;






CODE26......PAGE 0063

LINE# LOC   CODE        LINE


04472  E187  A5 7A              LDA TXTPTR
04473  E189  C9 02              CMP #BUFPAG
04474  E18B  F0 07              BEQ CLD20
04475  E18D  A9 64              LDA #<OKMSG
04476  E18F  A0 A3              LDY #>OKMSG
04477  E191  4C 1E AB           JMP STROUT
04478  E194              ;
04479  E194  60          CLD20  RTS





04481  E195              ;
04482  E195              ;FINISH LOAD
04483  E195              ;
04484  E195  20 B7 FF    CLD50  JSR $FFB7       ;READ STATUS
04485  E198  29 BF              AND #$FF-$40    ;CLEAR E.O.I.
04486  E19A  F0 05              BEQ CLD60       ;WAS O.K.
04487  E19C  A2 1D              LDX #ERLOAD
04488  E19E  4C 37 A4    CLD55  JMP ERROR
04489  E1A1              ;
04490  E1A1  A5 7B       CLD60  LDA TXTPTR+1
04491  E1A3  C9 02              CMP #BUFPAG     ;DIRECT?
04492  E1A5  D0 0E              BNE CLD70       ;NO...
04493  E1A7              ;
04494  E1A7  86 2D              STX VARTAB
04495  E1A9  84 2E              STY VARTAB+1    ;END LOAD ADDRESS
04496  E1AB  A9 76              LDA #<REDDY
04497  E1AD  A0 A3              LDY #>REDDY
04498  E1AF  20 1E AB           JSR STROUT
04499  E1B2  4C 2A A5           JMP FINI
04500  E1B5              ;
04501  E1B5              ;PROGRAM LOAD
04502  E1B5              ;
04503  E1B5  20 8E A6    CLD70  JSR STXTPT
04504  E1B8  20 33 A5           JSR LNKPRG
04505  E1BB  4C 77 A6           JMP FLOAD





04507  E1BE  20 19 E2    COPEN  JSR PAOC        ;PARSE STATEMENT
04508  E1C1  20 C0 FF           JSR $FFC0       ;OPEN IT
04509  E1C4  B0 0B              BCS JERXIT      ;BAD STUFF OR MEMSIZ CHANGE
04510  E1C6  60                 RTS             ;A.O.K.





04512  E1C7  20 19 E2    CCLOS  JSR PAOC        ;PARSE STATEMENT
04513  E1CA  A5 49              LDA ANDMSK      ;GET LA
04514  E1CC  20 C3 FF           JSR $FFC3       ;CLOSE IT






CODE26......PAGE 0064

LINE# LOC   CODE        LINE


04515  E1CF  90 C3              BCC CLD20       ;IT'S OKAY...NO MEMSIZE CHANGE
04516  E1D1              ;
04517  E1D1  4C F9 E0    JERXIT JMP EREXIT





04519  E1D4              ;
04520  E1D4              ;PARSE LOAD AND SAVE COMMANDS
04521  E1D4              ;
04522  E1D4              PLSV
04523  E1D4              ;DEFAULT FILE NAME
04524  E1D4              ;
04525  E1D4  A9 00              LDA #0          ;LENGTH=0
04526  E1D6  20 BD FF           JSR $FFBD
04527  E1D9              ;
04528  E1D9              ;DEFAULT DEVICE #
04529  E1D9              ;
04530  E1D9  A2 01              LDX #1          ;DEVICE #1
04531  E1DB  A0 00              LDY #0          ;COMMAND 0
04532  E1DD  20 BA FF           JSR $FFBA
04533  E1E0              ;
04534  E1E0  20 06 E2           JSR PAOC20      ;BY-PASS JUNK
04535  E1E3  20 57 E2           JSR PAOC15      ;GET/SET FILE NAME
04536  E1E6  20 06 E2           JSR PAOC20      ;BY-PASS JUNK
04537  E1E9  20 00 E2           JSR PLSV7       ;GET ',FA'
04538  E1EC  A0 00              LDY #0          ;COMMAND 0
04539  E1EE  86 49              STX ANDMSK
04540  E1F0  20 BA FF           JSR $FFBA
04541  E1F3  20 06 E2           JSR PAOC20      ;BY-PASS JUNK
04542  E1F6  20 00 E2           JSR PLSV7       ;GET ',SA'
04543  E1F9  8A                 TXA             ;NEW COMMAND
04544  E1FA  A8                 TAY
04545  E1FB  A6 49              LDX ANDMSK      ;DEVICE #
04546  E1FD  4C BA FF           JMP $FFBA





04548  E200              ;LOOK FOR COMMA FOLLOWED BY BYTE
04549  E200  20 0E E2    PLSV7  JSR PAOC30
04550  E203  4C 9E B7           JMP GETBYT





04552  E206              ;SKIP RETURN IF NEXT CHAR IS END
04553  E206              ;
04554  E206  20 79 00    PAOC20 JSR CHRGOT
04555  E209  D0 02              BNE PAOCX
04556  E20B  68                 PLA
04557  E20C  68                 PLA






CODE26......PAGE 0065

LINE# LOC   CODE        LINE


04558  E20D  60          PAOCX  RTS





04560  E20E              ;CHECK FOR COMMA AND GOOD STUFF
04561  E20E              ;
04562  E20E  20 FD AE    PAOC30 JSR CHKCOM      ;CHECK COMMA
04563  E211  20 79 00    PAOC32 JSR CHRGOT      ;GET CURRENT
04564  E214  D0 F7              BNE PAOCX       ;IS O.K.
04565  E216  4C 08 AF    PAOC40 JMP SNERR       ;BAD...END OF LINE





04567  E219              ;PARSE OPEN/CLOSE
04568  E219              ;
04569  E219  A9 00       PAOC   LDA #0
04570  E21B  20 BD FF           JSR $FFBD       ;DEFAULT FILE NAME
04571  E21E              ;
04572  E21E  20 11 E2           JSR PAOC32      ;MUST GOT SOMETHING
04573  E221  20 9E B7           JSR GETBYT      ;GET LA
04574  E224  86 49              STX ANDMSK
04575  E226  8A                 TXA
04576  E227  A2 01              LDX #1          ;DEFAULT DEVICE
04577  E229  A0 00              LDY #0          ;DEFAULT COMMAND
04578  E22B  20 BA FF           JSR $FFBA       ;STORE IT
04579  E22E  20 06 E2           JSR PAOC20      ;SKIP JUNK
04580  E231  20 00 E2           JSR PLSV7
04581  E234  86 4A              STX EORMSK
04582  E236  A0 00              LDY #0          ;DEFAULT COMMAND
04583  E238  A5 49              LDA ANDMSK      ;GET LA
04584  E23A  E0 03              CPX #3
04585  E23C  90 01              BCC PAOC5
04586  E23E  88                 DEY             ;DEFAULT IEEE TO $FF
04587  E23F  20 BA FF    PAOC5  JSR $FFBA       ;STORE THEM
04588  E242  20 06 E2           JSR PAOC20      ;SKIP JUNK
04589  E245  20 00 E2           JSR PLSV7       ;GET SA
04590  E248  8A                 TXA
04591  E249  A8                 TAY
04592  E24A  A6 4A              LDX EORMSK
04593  E24C  A5 49              LDA ANDMSK
04594  E24E  20 BA FF           JSR $FFBA       ;SET UP REAL EVEYTHING
04595  E251  20 06 E2    PAOC7  JSR PAOC20
04596  E254  20 0E E2           JSR PAOC30
04597  E257  20 9E AD    PAOC15 JSR FRMEVL
04598  E25A  20 A3 B6           JSR FRESTR      ;LENGTH IN .A
04599  E25D  A6 22              LDX INDEX1
04600  E25F  A4 23              LDY INDEX1+1
04601  E261  4C BD FF           JMP $FFBD
04602  E264              .END
04603  E264              .LIB   TRIG







TRIG FUNCTIONS......PAGE 0066

LINE# LOC   CODE        LINE


04605  E264  A9 E0       COS    LDA #<PI2
04606  E266  A0 E2              LDY #>PI2
04607  E268  20 67 B8           JSR FADD
04608  E26B  20 0C BC    SIN    JSR MOVAF
04609  E26E  A9 E5              LDA #<TWOPI
04610  E270  A0 E2              LDY #>TWOPI
04611  E272  A6 6E              LDX ARGSGN
04612  E274  20 07 BB           JSR FDIVF
04613  E277  20 0C BC           JSR MOVAF
04614  E27A  20 CC BC           JSR INT
04615  E27D  A9 00              LDA #0
04616  E27F  85 6F              STA ARISGN
04617  E281  20 53 B8           JSR FSUBT
04618  E284  A9 EA              LDA #<FR4
04619  E286  A0 E2              LDY #>FR4
04620  E288  20 50 B8           JSR FSUB
04621  E28B  A5 66              LDA FACSGN
04622  E28D  48                 PHA
04623  E28E  10 0D              BPL SIN1
04624  E290  20 49 B8           JSR FADDH
04625  E293  A5 66              LDA FACSGN
04626  E295  30 09              BMI SIN2
04627  E297  A5 12              LDA TANSGN
04628  E299  49 FF              EOR #$FF
04629  E29B  85 12              STA TANSGN
04630  E29D  20 B4 BF    SIN1   JSR NEGOP
04631  E2A0  A9 EA       SIN2   LDA #<FR4
04632  E2A2  A0 E2              LDY #>FR4
04633  E2A4  20 67 B8           JSR FADD
04634  E2A7  68                 PLA
04635  E2A8  10 03              BPL SIN3
04636  E2AA  20 B4 BF           JSR NEGOP
04637  E2AD  A9 EF       SIN3   LDA #<SINCON
04638  E2AF  A0 E2              LDY #>SINCON
04639  E2B1  4C 43 E0           JMP POLYX
04640  E2B4  20 CA BB    TAN    JSR MOV1F
04641  E2B7  A9 00              LDA #0
04642  E2B9  85 12              STA TANSGN
04643  E2BB  20 6B E2           JSR SIN
04644  E2BE  A2 4E              LDX #<TEMPF3
04645  E2C0  A0 00              LDY #>TEMPF3
04646  E2C2  20 F6 E0           JSR GMOVMF
04647  E2C5  A9 57              LDA #<TEMPF1
04648  E2C7  A0 00              LDY #>TEMPF1
04649  E2C9  20 A2 BB           JSR MOVFM
04650  E2CC  A9 00              LDA #0
04651  E2CE  85 66              STA FACSGN
04652  E2D0  A5 12              LDA TANSGN
04653  E2D2  20 DC E2           JSR COSC
04654  E2D5  A9 4E              LDA #<TEMPF3
04655  E2D7  A0 00              LDY #>TEMPF3
04656  E2D9  4C 0F BB           JMP FDIV
04657  E2DC  48          COSC   PHA
04658  E2DD  4C 9D E2           JMP SIN1
04659  E2E0  81          PI2    .BYT @201,@111,@17,@332,@242






TRIG FUNCTIONS......PAGE 0067

LINE# LOC   CODE        LINE


04659  E2E1  49 
04659  E2E2  0F 
04659  E2E3  DA 
04659  E2E4  A2 
04660  E2E5  83          TWOPI  .BYT @203,@111,@17,@332,@242
04660  E2E6  49 
04660  E2E7  0F 
04660  E2E8  DA 
04660  E2E9  A2 
04661  E2EA  7F          FR4    .BYT @177,0,0,0,0
04661  E2EB  00 
04661  E2EC  00 
04661  E2ED  00 
04661  E2EE  00 
04662  E2EF  05          SINCON .BYT 5,@204,@346,@32,@55
04662  E2F0  84 
04662  E2F1  E6 
04662  E2F2  1A 
04662  E2F3  2D 
04663  E2F4  1B                 .BYT @33,@206,@50,@7,@373
04663  E2F5  86 
04663  E2F6  28 
04663  E2F7  07 
04663  E2F8  FB 
04664  E2F9  F8                 .BYT @370,@207,@231,@150,@211
04664  E2FA  87 
04664  E2FB  99 
04664  E2FC  68 
04664  E2FD  89 
04665  E2FE  01                 .BYT 1,@207,@43,@65,@337,@341
04665  E2FF  87 
04665  E300  23 
04665  E301  35 
04665  E302  DF 
04665  E303  E1 
04666  E304  86                 .BYT @206,@245,@135,@347,@50,@203
04666  E305  A5 
04666  E306  5D 
04666  E307  E7 
04666  E308  28 
04666  E309  83 
04667  E30A  49                 .BYT @111,@17,@332,@242
04667  E30B  0F 
04667  E30C  DA 
04667  E30D  A2 
04668  E30E  A5 66       ATN    LDA FACSGN
04669  E310  48                 PHA
04670  E311  10 03              BPL ATN1
04671  E313  20 B4 BF           JSR NEGOP
04672  E316  A5 61       ATN1   LDA FACEXP
04673  E318  48                 PHA
04674  E319  C9 81              CMP #@201
04675  E31B  90 07              BCC ATN2
04676  E31D  A9 BC              LDA #<FONE
04677  E31F  A0 B9              LDY #>FONE






TRIG FUNCTIONS......PAGE 0068

LINE# LOC   CODE        LINE


04678  E321  20 0F BB           JSR FDIV
04679  E324  A9 3E       ATN2   LDA #<ATNCON
04680  E326  A0 E3              LDY #>ATNCON
04681  E328  20 43 E0           JSR POLYX
04682  E32B  68                 PLA
04683  E32C  C9 81              CMP #@201
04684  E32E  90 07              BCC ATN3
04685  E330  A9 E0              LDA #<PI2
04686  E332  A0 E2              LDY #>PI2
04687  E334  20 50 B8           JSR FSUB
04688  E337  68          ATN3   PLA
04689  E338  10 03              BPL ATN4
04690  E33A  4C B4 BF           JMP NEGOP
04691  E33D  60          ATN4   RTS
04692  E33E  0B          ATNCON .BYT @13,@166,@263,@203
04692  E33F  76 
04692  E340  B3 
04692  E341  83 
04693  E342  BD                 .BYT @275,@323,@171,@36,@364
04693  E343  D3 
04693  E344  79 
04693  E345  1E 
04693  E346  F4 
04694  E347  A6                 .BYT @246,@365,@173,@203,@374
04694  E348  F5 
04694  E349  7B 
04694  E34A  83 
04694  E34B  FC 
04695  E34C  B0                 .BYT @260,@20
04695  E34D  10 
04696  E34E  7C                 .BYT @174,@14,@37,@147,@312
04696  E34F  0C 
04696  E350  1F 
04696  E351  67 
04696  E352  CA 
04697  E353  7C                 .BYT @174,@336,@123,@313,@301
04697  E354  DE 
04697  E355  53 
04697  E356  CB 
04697  E357  C1 
04698  E358  7D                 .BYT @175,@24,@144,@160,@114
04698  E359  14 
04698  E35A  64 
04698  E35B  70 
04698  E35C  4C 
04699  E35D  7D                 .BYT @175,@267,@352,@121,@172
04699  E35E  B7 
04699  E35F  EA 
04699  E360  51 
04699  E361  7A 
04700  E362  7D                 .BYT @175,@143,@60,@210,@176
04700  E363  63 
04700  E364  30 
04700  E365  88 
04700  E366  7E 






TRIG FUNCTIONS......PAGE 0069

LINE# LOC   CODE        LINE


04701  E367  7E                 .BYT @176,@222,@104,@231,@72
04701  E368  92 
04701  E369  44 
04701  E36A  99 
04701  E36B  3A 
04702  E36C  7E                 .BYT @176,@114,@314,@221,@307
04702  E36D  4C 
04702  E36E  CC 
04702  E36F  91 
04702  E370  C7 
04703  E371  7F                 .BYT @177,@252,@252,@252,@23
04703  E372  AA 
04703  E373  AA 
04703  E374  AA 
04703  E375  13 
04704  E376  81                 .BYT @201,0,0,0,0
04704  E377  00 
04704  E378  00 
04704  E379  00 
04704  E37A  00 
04705  E37B              .END
04706  E37B              .LIB   INIT







































INIT......PAGE 006A

LINE# LOC   CODE        LINE


04708  E37B  20 CC FF    PANIC  JSR CLSCHN      ;WARM START BASIC...
04709  E37E  A9 00              LDA #0          ;CLEAR CHANNELS
04710  E380  85 13              STA CHANNL
04711  E382  20 7A A6           JSR STKINI      ;RESTORE STACK
04712  E385  58                 CLI             ;ENABLE IRQ'S


04714  E386  A2 80       READY  LDX #$80
04715  E388  6C 00 03           JMP (IERROR)
04716  E38B  8A          NERROR TXA             ;GET  HIGH BIT
04717  E38C  30 03              BMI NREADY
04718  E38E  4C 3A A4           JMP NERROX
04719  E391  4C 74 A4    NREADY JMP READYX


04721  E394  20 53 E4    INIT   JSR INITV       ;GO INIT VECTORS
04722  E397  20 BF E3           JSR INITCZ      ;GO INIT CHARGET & Z-PAGE
04723  E39A  20 22 E4           JSR INITMS      ;GO PRINT INITILIZATION MESSAGES
04724  E39D  A2 FB              LDX #STKEND-256 ;SET UP END OF STACK
04725  E39F  9A                 TXS
04726  E3A0  D0 E4              BNE READY       ;JMP...READY




04728  E3A2  E6 7A       INITAT INC CHRGET+7
04729  E3A4  D0 02              BNE CHDGOT
04730  E3A6  E6 7B              INC CHRGET+8
04731  E3A8  AD 60 EA    CHDGOT LDA 60000
04732  E3AB  C9 3A              CMP #':
04733  E3AD  B0 0A              BCS CHDRTS
04734  E3AF  C9 20              CMP #' 
04735  E3B1  F0 EF              BEQ INITAT
04736  E3B3  38                 SEC
04737  E3B4  E9 30              SBC #'0
04738  E3B6  38                 SEC
04739  E3B7  E9 D0              SBC #$D0
04740  E3B9  60          CHDRTS RTS
04741  E3BA  80                 .BYT 128,79,199,82,88
04741  E3BB  4F 
04741  E3BC  C7 
04741  E3BD  52 
04741  E3BE  58 






04743  E3BF  A9 4C       INITCZ LDA #76
04744  E3C1  85 54              STA JMPER
04745  E3C3  8D 10 03           STA USRPOK
04746  E3C6  A9 48              LDA #<FCERR
04747  E3C8  A0 B2              LDY #>FCERR
04748  E3CA  8D 11 03           STA USRPOK+1






INIT......PAGE 006B

LINE# LOC   CODE        LINE


04749  E3CD  8C 12 03           STY USRPOK+2
04750  E3D0  A9 91              LDA #<GIVAYF
04751  E3D2  A0 B3              LDY #>GIVAYF
04752  E3D4  85 05              STA ADRAY2
04753  E3D6  84 06              STY ADRAY2+1
04754  E3D8  A9 AA              LDA #<FLPINT
04755  E3DA  A0 B1              LDY #>FLPINT
04756  E3DC  85 03              STA ADRAY1
04757  E3DE  84 04              STY ADRAY1+1
04758  E3E0  A2 1C              LDX #INITCZ-INITAT-1
04759  E3E2  BD A2 E3    MOVCHG LDA INITAT,X
04760  E3E5  95 73              STA CHRGET,X
04761  E3E7  CA                 DEX
04762  E3E8  10 F8              BPL MOVCHG
04763  E3EA  A9 03              LDA #STRSIZ
04764  E3EC  85 53              STA FOUR6
04765  E3EE  A9 00              LDA #0
04766  E3F0  85 68              STA BITS
04767  E3F2  85 13              STA CHANNL
04768  E3F4  85 18              STA LASTPT+1
04769  E3F6  A2 01              LDX #1
04770  E3F8  8E FD 01           STX BUF-3
04771  E3FB  8E FC 01           STX BUF-4
04772  E3FE  A2 19              LDX #TEMPST
04773  E400  86 16              STX TEMPPT
04774  E402  38                 SEC             ;READ BOTTOM OF MEMORY
04775  E403  20 9C FF           JSR $FF9C
04776  E406  86 2B              STX TXTTAB      ;NOW TXTAB HAS IT
04777  E408  84 2C              STY TXTTAB+1
04778  E40A  38                 SEC
04779  E40B  20 99 FF           JSR $FF99       ;READ TOP OF MEMORY
04780  E40E  86 37       USEDEF STX MEMSIZ
04781  E410  84 38              STY MEMSIZ+1
04782  E412  86 33              STX FRETOP
04783  E414  84 34              STY FRETOP+1
04784  E416  A0 00              LDY #0
04785  E418  98                 TYA
04786  E419  91 2B              STA (TXTTAB)Y
04787  E41B  E6 2B              INC TXTTAB
04788  E41D  D0 02              BNE INIT20
04789  E41F  E6 2C              INC TXTTAB+1
04790  E421  60          INIT20 RTS






04792  E422  A5 2B       INITMS LDA TXTTAB
04793  E424  A4 2C              LDY TXTTAB+1
04794  E426  20 08 A4           JSR REASON
04795  E429  A9 73              LDA #<FREMES
04796  E42B  A0 E4              LDY #>FREMES
04797  E42D  20 1E AB           JSR STROUT
04798  E430  A5 37              LDA MEMSIZ






INIT......PAGE 006C

LINE# LOC   CODE        LINE


04799  E432  38                 SEC
04800  E433  E5 2B              SBC TXTTAB
04801  E435  AA                 TAX
04802  E436  A5 38              LDA MEMSIZ+1
04803  E438  E5 2C              SBC TXTTAB+1
04804  E43A  20 CD BD           JSR LINPRT
04805  E43D  A9 60              LDA #<WORDS
04806  E43F  A0 E4              LDY #>WORDS
04807  E441  20 1E AB           JSR STROUT
04808  E444  4C 44 A6           JMP SCRTCH




04810  E447  8B E3       BVTRS  .WOR NERROR,NMAIN,NCRNCH,NQPLOP,NGONE,NEVAL
04810  E449  83 A4 
04810  E44B  7C A5 
04810  E44D  1A A7 
04810  E44F  E4 A7 
04810  E451  86 AE 
04811  E453              ;
04812  E453  A2 0B       INITV  LDX #INITV-BVTRS-1 ;INIT VECTORS
04813  E455  BD 47 E4    INITV1 LDA BVTRS,X
04814  E458  9D 00 03           STA IERROR,X
04815  E45B  CA                 DEX
04816  E45C  10 F7              BPL INITV1
04817  E45E  60                 RTS
04818  E45F  00          CHKE0  .BYT $00




04820  E460  20 42       WORDS  .BYT ' BASIC BYTES FREE',13,0
04820  E471  0D 
04820  E472  00 
04821  E473  93          FREMES .BYT 147,13,'    **** COMMODORE 64 BASIC V2 ****'
04821  E474  0D 
04821  E475  20 20 
04822  E498  0D                 .BYT 13,13,' 64K RAM SYSTEM  ',0
04822  E499  0D 
04822  E49A  20 36 
04822  E4AB  00 
04823  E4AC  00                 .BYT 0
04824  E4AD              ; PPACH - PRINT# PATCH TO COOUT (SAVE .A)
04825  E4AD              ;
04826  E4AD  48          PPACH  PHA
04827  E4AE  20 C9 FF           JSR $FFC9
04828  E4B1  AA                 TAX             ;SAVE ERROR CODE
04829  E4B2  68                 PLA
04830  E4B3  90 01              BCC PPACH0      ;NO ERROR....
04831  E4B5  8A                 TXA             ;ERROR CODE
04832  E4B6  60          PPACH0 RTS
04833  E4B7              .END
04834  E4B7              .END







INIT......PAGE 006D

LINE# LOC   CODE        LINE


ERRORS = 00000


SYMBOL TABLE

SYMBOL VALUE
 ABS      BC58    ADDEND   0028    ADDFRS   A3B0    ADDIND   B320
 ADDON    A8FB    ADDPR2   0002    ADDPR4   0004    ADDPR8   0008
 ADDPRC   0001    ADRAY1   0003    ADRAY2   0005    AFFRTS   A637
 ANDMSK   0049    ANDOP    AFE9    ARGEXP   0069    ARGHO    006A
 ARGLO    006D    ARGMO    006C    ARGMOH   006B    ARGSGN   006E
 ARISGN   006F    ARYGET   B5AE    ARYPNT   0058    ARYSTR   B5B0
 ARYTAB   002F    ARYVA2   B56E    ARYVA3   B572    ARYVAR   B566
 ARYVGO   B57D    ASC      B78B    ASPAC    AB0E    ATN      E30E
 ATN1     E316    ATN2     E324    ATN3     E337    ATN4     E33D
 ATNCON   E33E    AYINT    B1BF    BIGGES   BE32    BITS     0068
 BLANK0   0000    BLT1     A3DC    BLTLP    A3E8    BLTU     A3B8
 BLTUC    A3BF    BRKTXT   A381    BSERR    B245    BSERR7   B308
 BUF      0200    BUFFUL   ABEA    BUFLEN   0059    BUFOFS   0200
 BUFPAG   0002    BUFPTR   0071    BVTRS    E447    CAT      B63D
 CCALL    FFE7    CCLOS    E1C7    CGETL    E124    CHANNL   0013
 CHARAC   0007    CHDGOT   E3A8    CHDRTS   E3B9    CHEAD    A53C
 CHKCLS   AEF7    CHKCOM   AEFD    CHKE0    E45F    CHKERR   AD99
 CHKNUM   AD8D    CHKOK    AD96    CHKOPN   AEFA    CHKSTR   AD8F
 CHKVAL   AD90    CHRD     B6EC    CHRGET   0073    CHRGOT   0079
 CHRRTS   008A    CKSMA0   BF52    CLD10    E16F    CLD20    E194
 CLD50    E195    CLD55    E19E    CLD60    E1A1    CLD70    E1B5
 CLEAR    A65E    CLEARC   A660    CLEART   A663    CLMWID   000A
 CLOAD    E168    CLRFAC   BCE9    CLSCHN   FFCC    CMD      AA86
 CMPFOR   A3A4    CMPSPC   A58E    COIN     E11E    COLIS    A5DC
 COMBYT   B7F1    COMPRT   AAE8    CONINT   B7A1    CONT     A857
 CONTRT   A870    CONUPK   BA8C    COOUT    E118    COPEN    E1BE
 COPFLT   A9D6    COPSTR   A9D9    COPY     AA52    COPYC    AA68
 COS      E264    COSC     E2DC    COUNT    000B    CRDO     AAD7
 CRDONE   A609    CRFIN    AAE5    CRTSKP   AB42    CRUNCH   A579
 CSAVE    E156    CSYS     E12A    CSYSRZ   E146    CURLIN   0039
 CURTOL   0071    CVERF    E165    CZLOOP   A544    DATA     A8F8
 DATAN    A906    DATATK   0083    DATBK    AC4D    DATBK1   AC51
 DATLIN   003F    DATLOP   ACB8    DATPTR   0041    DECBLT   A3F3
 DECCNT   005D    DECCUR   B2CD    DEF      B3B3    DEFFIN   B44F
 DEFPNT   004E    DEFSTF   B418    DEGREE   0067    DIM      B081
 DIM3     B07E    DIMFLG   000C    DIMRTS   B34B    DIRCN1   A7CE
 DIRCON   A7BE    DIRIS    A849    DIV10    BAFE    DIVIDE   BB29
 DIVNRM   BB7E    DIVSUB   BB5D    DNTCPY   AA4B    DOAGIN   AB6B
 DOCMP    B072    DOCO     A948    DOCOND   A940    DOCSTR   AD97
 DOMASK   0012    DOMIN    AF0D    DOPRE1   AE20    DOPREC   ADF9
 DOREL    B016    DORES    000F    DOSGFL   B81B    DPTFLG   005F
 DSCPNT   0050    DSCTMP   0061    DV0ERR   BB8A    DVAR     B5C7
 DVAR2    B5DC    DVAR3    B5E6    DVARS    B5BD    DVARTS   B5F6
 EATEM    B0B0    END      A831    ENDCHR   0008    ENDCON   A84B
 ENDREL   ADD7    ENDTK    0080    EORMSK   004A    EPSGN    0060
 EQULTK   00B2    ERBRK    001E    EREXIT   E0F9    EREXIX   E104
 EREXIY   E109    ERLOAD   001D    ERR      A369    ERR01    A19E
 ERR02    A1AC    ERR03    A1B5    ERR04    A1C2    ERR05    A1D0








SYMBOL TABLE

SYMBOL VALUE
 ERR06    A1E2    ERR07    A1F0    ERR08    A1FF    ERR09    A210
 ERR10    A225    ERR11    A235    ERR12    A23B    ERR13    A24F
 ERR14    A25A    ERR15    A26A    ERR16    A272    ERR17    A27F
 ERR18    A290    ERR19    A29D    ERR20    A2AA    ERR21    A2BA
 ERR22    A2C8    ERR23    A2D5    ERR24    A2E4    ERR25    A2ED
 ERR26    A300    ERR27    A30E    ERR28    A31E    ERR29    A324
 ERR30    A383    ERRBD    0018    ERRBS    0012    ERRCN    001A
 ERRCRD   A44E    ERRDD    0013    ERRDIR   B3A6    ERRDVO   0014
 ERRFC    000E    ERRFIN   A469    ERRGO2   B4D2    ERRGO3   B24A
 ERRGO4   AD9B    ERRGO5   AD32    ERRGUF   B3AE    ERRID    0015
 ERRLS    0017    ERRNF    000A    ERROD    000D    ERROM    0010
 ERROR    A437    ERROV    000F    ERRRG    000C    ERRSN    000B
 ERRST    0019    ERRTAB   A328    ERRTM    0016    ERRUF    001B
 ERRUS    0011    ERVFY    001C    EVAL     AE83    EVAL0    AE8A
 EVAL1    AE8F    EVAL2    AE92    EVAL3    AECC    EVAL4    AEE3
 EXCHQT   A911    EXIGNT   ACFC    EXP      BFED    EXP1     E00E
 EXPCON   BFC4    EXPSGN   0060    FAC      0061    FACEXP   0061
 FACHO    0062    FACLO    0065    FACMO    0064    FACMOH   0063
 FACOV    0070    FACSGN   0066    FADD     B867    FADD1    B897
 FADD2    B8FE    FADD4    B8A3    FADD5    B862    FADDA    B893
 FADDC    B877    FADDH    B849    FADDT    B86A    FADFLT   B8D2
 FBUFFR   0100    FBUFPT   0071    FCERR    B248    FCERR2   AA24
 FCOMP    BC5B    FCOMPC   BC92    FCOMPD   BC98    FCOMPN   BC5D
 FCOMPS   BC31    FCSIGN   BC2F    FDCEND   BF3A    FDECPT   0047
 FDIV     BB0F    FDIVF    BB07    FDIVT    BB12    FFLOOP   A38F
 FFRTS    A3B7    FHALF    BF11    FIN      BCF3    FIN1     BD0F
 FINC     BD0A    FINDG1   BD71    FINDGQ   BD0D    FINDIG   BD6A
 FINDIV   BD52    FINDP    BD41    FINE     BD47    FINE1    BD49
 FINEC    BD30    FINEC1   BD2E    FINEC2   BD35    FINEDG   BD91
 FINGO    AFD6    FINI     A52A    FININ1   A576    FININL   AACA
 FINLOG   BD7E    FINML6   BAED    FINMUL   BD5B    FINNOW   B18F
 FINPTR   B185    FINQNG   BD62    FINRE2   AE11    FINREL   AE07
 FINZLP   BCF7    FLINRT   A640    FLNRTS   A641    FLOAD    A677
 FLOAT    BC3C    FLOATB   BC4F    FLOATC   BC49    FLOATS   BC44
 FLPINT   B1AA    FMAPTR   B194    FMULT    BA28    FMULTT   BA2B
 FNDFOR   A38A    FNDLIN   A613    FNDLNC   A617    FNDLO1   A62E
 FNDOER   B3F4    FNDVAR   B52A    FNEDG1   BD33    FNTK     00A5
 FNWAIT   B82D    FONE     B9BC    FOR      A742    FORPNT   0049
 FORPSH   AE43    FORSIZ   0012    FORTK    0081    FOULDY   BEC4
 FOUR6    0053    FOUT     BDDD    FOUT1    BDE7    FOUT11   BEC6
 FOUT12   BED3    FOUT14   BEE3    FOUT15   BEEF    FOUT16   BE64
 FOUT17   BF07    FOUT19   BF04    FOUT2    BE6A    FOUT20   BF0C
 FOUT3    BE16    FOUT37   BE00    FOUT38   BE21    FOUT39   BE53
 FOUT4    BE0B    FOUT40   BE90    FOUT41   BE8E    FOUT5    BE2F
 FOUT6    BE48    FOUT7    BE09    FOUT8    BE66    FOUT9    BE28
 FOUTBL   BF16    FOUTC    BDDF    FOUTIM   BE68    FOUTPI   BE47
 FOUTYP   BE97    FPWR1    BF9E    FPWRT    BF7B    FPWRT1   BF84
 FR4      E2EA    FRE      B37D    FREFAC   B6A6    FREMES   E473
 FREPLA   B6D5    FRERTS   B6EB    FRESPC   0035    FRESTR   B6A3
 FRETMP   B6AA    FRETMS   B6DB    FRETOP   0033    FRETRT   B6D6
 FRMEV1   ADA4    FRMEVL   AD9E    FRMNUM   AD8A    FSUB     B850
 FSUBT    B853    FUNDSP   A052    GARBA2   B526    GARBAG   B516
 GARBFL   000F    GET      AB7B    GETADR   B7F7    GETAGN   ABD6
 GETBPT   A5C7    GETBYT   B79E    GETCMP   B066    GETCON   B818
 GETDEF   B2EA    GETDTL   AB57    GETERR   A456    GETFNM   B3E1








SYMBOL TABLE

SYMBOL VALUE
 GETFOR   AD24    GETNTH   AC4A    GETNUM   B7EB    GETSPA   B4F4
 GETSPT   AA2C    GETSTK   A3FB    GETTIM   AF84    GETTTY   AB92
 GINLIN   AC03    GIVAYF   B391    GLET     A804    GMOVMF   E0F6
 GOBADV   B138    GOFLOT   B07B    GOFUC    B798    GOGO     B5B8
 GOLST    A6A4    GOMLDV   E00B    GOMOVF   AFA0    GONE     A7E1
 GONE2    A7EF    GONE3    A7ED    GONPRC   AF0F    GOOO     AF5D
 GOOOOO   AF6E    GOOVER   BADF    GORDY    A854    GORTS    A8D1
 GOSUB    A883    GOSUTK   008D    GOTARY   B24D    GOTK     00CB
 GOTNUM   AA27    GOTO     A8A0    GOTOTK   0089    GRBPAS   B606
 GRBPNT   004E    GRBRTS   B601    GRBTOP   005F    GREASE   B2B9
 GREATK   00B1    GRODY    A714    GTBYTC   B79B    HAVFOR   AD35
 HIGHDS   0058    HIGHTR   005A    ICRNCH   0304    IERROR   0300
 IEVAL    030A    IF       A928    IGONE    0308    IMAIN    0302
 INCFAC   B96F    INCFRT   B97D    INCHR    E112    INCRND   BC23
 INDEX    0022    INDEX1   0022    INDEX2   0024    INDICE   0064
 INDLOP   B1DB    INIT     E394    INIT20   E421    INITAT   E3A2
 INITCZ   E3BF    INITMS   E422    INITV    E453    INITV1   E455
 INLIN    A560    INLINC   A562    INLOOP   AC15    INLPN1   B30F
 INLPN2   B30E    INLPNM   B2F2    INPCO1   AC0F    INPCOM   A9DA
 INPCON   AC0D    INPFLG   0011    INPPTR   0043    INPRT    BDC2
 INPRTS   ACFB    INPUT    ABBF    INPUTN   ABA5    INT      BCCC
 INTEGR   0007    INTERR   B09C    INTFLG   000E    INTIDX   B1B2
 INTRTS   BCF2    INTXT    A371    IODONE   ABB5    IORELE   ABB7
 IQPLOP   0306    ISARY    B1D1    ISCNTC   A82C    ISCRTS   A82B
 ISFUN    AFA7    ISLETC   B113    ISLRTS   B11C    ISSEC    B0AF
 ISVAR    AF28    ISVRET   AF2B    JERXIT   E1D1    JMPER    0054
 JSRGM    B1A0    KLOOP    A582    KLOOP1   A5A4    LASNUM   00C7
 LASTPT   0017    LD100    BB7A    LDFONE   A78B    LDZR     B123
 LEFTD    B700    LEN      B77C    LEN1     B782    LESSTK   00B3
 LET      A9A5    LINGET   A96B    LINLEN   0028    LINNUM   0014
 LINPRT   BDCD    LIST     A69C    LIST4    A6C9    LNKPRG   A533
 LNKRTS   A55F    LOFBUF   00FF    LOG      B9EA    LOG1     B9F4
 LOG2     B9E5    LOGCN2   B9C1    LOGEB2   BFBF    LOGERR   B9F1
 LOOPDN   AD78    LOPFDA   B21C    LOPFDV   B228    LOPFN    B0FB
 LOPFND   B0F1    LOPPTA   B286    LOPREL   ADBB    LOWDS    005D
 LOWTR    005F    LPOPER   ADA9    LSTEND   A6BB    LSTPNT   0049
 LUK4IT   A8BC    LUKALL   A8C0    MAIN     A480    MAIN1    A49C
 MEMSIZ   0037    MID2     B748    MIDD     B737    MINUTK   00AB
 MLDEXP   BAB9    MLDVEX   BAD4    MLEX10   BDA0    MLEXMI   BDAE
 MLOOP    A4DF    MLTPL1   BA5E    MLTPL2   BA61    MLTPL3   BA7D
 MLTPLY   BA59    MORCO1   AAEE    MOREN1   A3EC    MORLIN   A971
 MORSTS   A807    MOV1F    BBCA    MOV2F    BBC7    MOVAF    BC0C
 MOVAFL   BC11    MOVCHG   E3E2    MOVDO    B68C    MOVEF    BC0F
 MOVFA    BBFC    MOVFA1   BBFE    MOVFAL   BC02    MOVFM    BBA2
 MOVFR    BB8F    MOVINS   B67A    MOVLP    B690    MOVMF    BBD4
 MOVRTS   BC1A    MOVSTR   B688    MOVVF    BBD0    MUL10    BAE2
 MUL10R   BAF8    MULDIV   BAB7    MULSHF   B983    MULTRT   BA8B
 MUSTCR   A5AC    MVDONE   B699    MVSTRT   B6A2    N0999    BDB3
 N32768   B1A5    N9999    BDB8    NCMPOS   001E    NCRNCH   A57C
 NEGFAC   B947    NEGFCH   B94D    NEGHLF   B9E0    NEGOP    BFB4
 NEGPRC   ADFA    NEGRTS   BFBE    NEGTAB   A095    NEGXQS   BD67
 NERROR   E38B    NERROX   A43A    NEVAL    AE86    NEWCHR   AA9D
 NEWSGO   AD75    NEWSTT   A7AE    NEXT     AD1E    NGONE    A7E4
 NGONE1   A7E7    NMAIN    A483    NMARY1   B237    NMIL     BDBD
 NODATT   A5DE    NODEL    A4ED    NODELC   A508    NOFREF   B384








SYMBOL TABLE

SYMBOL VALUE
 NOML6    AA07    NONONO   B1CC    NORM1    B929    NORM2    B91D
 NORM3    B8DB    NORMAL   B8D7    NOSEC    B0BA    NOTABR   AB13
 NOTDIM   B296    NOTEVE   B159    NOTEVL   B128    NOTFDD   B261
 NOTFL1   B331    NOTFLT   B274    NOTFNS   B11D    NOTIT    B109
 NOTOL    A753    NOTOP    AED4    NOTQTI   ABCE    NOTSTR   B0C4
 NOTTAB   A098    NOTTK    00A8    NOWGE1   AC7D    NOWGET   AC72
 NOWLIN   ACD1    NQPLOP   A71A    NREADY   E391    NTHIS    A5F5
 NTHIS1   A5F9    NUMINS   AC89    NUMLEV   0017    NXTCMP   B05B
 NXTLGC   A99F    OKGOTO   A937    OKMSG    A364    OKNORM   AFD1
 OLDLIN   003B    OLDOV    0056    OLDTXT   003D    OMERR    A435
 OMERR1   B30B    ONEFUN   00B4    ONEON    A79F    ONGLOP   A957
 ONGLP1   A95F    ONGOTO   A94B    ONGRTS   A96A    OPMASK   004D
 OPPTR    004B    OPTAB    A080    OROP     AFE6    OUTCH    E10C
 OUTDO    AB47    OUTQST   AB45    OUTRTS   AB4A    OUTSPC   AB3B
 OVERR    B97E    PANIC    E37B    PAOC     E219    PAOC15   E257
 PAOC20   E206    PAOC30   E20E    PAOC32   E211    PAOC40   E216
 PAOC5    E23F    PAOC7    E251    PAOCX    E20D    PARCHK   AEF1
 PATCHS   BF53    PEEK     B80D    PI       00FF    PI2      E2E0
 PIVAL    AEA8    PLOOP    A6F3    PLOOP1   A700    PLOT     FFF0
 PLSV     E1D4    PLSV7    E200    PLUSTK   00AA    POKE     B824
 POKER    0014    POLY     E059    POLY1    E05D    POLY2    E070
 POLY3    E06C    POLY4    E07D    POLYPT   0071    POLYX    E043
 POS      B39E    POSINT   B1B8    PPACH    E4AD    PPACH0   E4B6
 PREAM    B761    PRINT    AAA0    PRINTC   AAA2    PRINTK   0099
 PRINTN   AA80    PRIT3    A737    PRIT4    A6EF    PRTRTS   AAE7
 PTDORL   A09B    PTRGET   B08B    PTRGT1   B090    PTRGT2   B092
 PTRGT3   B09F    PULMOR   B725    PULSTK   AE66    PUSHF    AE38
 PUSHF1   AE33    PUTNEW   B4CA    PUTNW1   B4D5    Q        007F
 QCHNUM   AE5D    QCOMP    B061    QDATA    AC41    QDECT1   A4D7
 QDOT     AEAD    QINLIN   ABF9    QINT     BC9B    QINT1    BCBB
 QINTGO   B1CE    QINTGR   A9C2    QINTRT   BCBA    QISHFT   BCAF
 QNUM     0080    QOP      AE58    QOPGO    AE5B    QOPRTS   AE80
 QPLOP    A717    QPLUS    BD06    QPREC    ADF0    QPREC1   AE19
 QSETNR   E0BE    QSHFT    BB4C    QSTATV   AF92    QSTAVR   B13B
 QVARIA   AA3D    RADDC    E092    RDBAS    FFF3    RDTIM    FFDE
 READ     AC06    READST   FFB7    READY    E386    READYX   A474
 REARTS   A434    REASAV   A416    REASON   A408    REASTO   A421
 REDDY    A376    REM      A93B    REMER    A919    REMN     A909
 REMRTS   A905    REMTK    008F    RESCON   A5B8    RESCR1   A72F
 RESER    A5B6    RESETC   AC71    RESFIN   A827    RESHO    0026
 RESLO    0029    RESLST   A09E    RESMO    0028    RESMOH   0027
 RESRCH   A72C    RESTOR   A81D    RETU1    A8EB    RETURN   A8D2
 RIGHTD   B72C    RLEFT    B706    RLEFT1   B70C    RLEFT2   B70D
 RLEFT3   B70E    RMULC    E08D    RND      E097    RND1     E0D3
 RNDRTS   B946    RNDSHF   B938    RNDX     008B    ROLSHF   B9B0
 ROMLOC   A000    ROUND    BC1B    RUN      A871    RUNC     A659
 RUNC2    A897    SAREG    030C    SAVEIT   AA90    SAVQUO   BB3F
 SCRATH   A642    SCRATK   00A2    SCRTCH   A644    SETMSG   FF90
 SETQUT   AC65    SETTIM   FFDB    SGN      BC39    SGNFLG   0067
 SHFARG   BB4F    SHFTR2   B985    SHFTR3   B9A6    SHFTR4   B9AC
 SHFTRT   B9BA    SHIFTR   B999    SIGN     BC2B    SIGNRT   BC38
 SIN      E26B    SIN1     E29D    SIN2     E2A0    SIN3     E2AD
 SINCON   E2EF    SIZE     0055    SIZEOK   B65D    SNERR    AF08
 SNERR1   A80B    SNERR2   A8E8    SNERR3   A953    SNERR4   AB5F
 SNERR5   AE30    SNERRX   A80E    SNGFLT   B3A2    SPCTK    00A6








SYMBOL TABLE

SYMBOL VALUE
 SPREG    030F    SQR      BF71    SQR05    B9D6    SQR20    B9DB
 SQUEEZ   B936    ST2TXT   B7E2    STASGN   B056    STCURL   AB5B
 STEPTK   00A9    STKEND   01FB    STKINI   A67A    STKRTS   A68D
 STMDSP   A00C    STOLD    E000    STOLDX   BFFD    STOLOP   A522
 STOML1   B337    STOMLT   B27D    STOP     A82F    STOPC    A832
 STORDO   B83C    STPEND   A841    STR1     A5E5    STRCMP   B02E
 STRCP    B4BF    STRD     B465    STRDN2   AC91    STRDON   AA9A
 STREND   0031    STRFI1   B4A8    STRFI2   B4A9    STRFIN   B4A4
 STRFRE   B50B    STRGET   B497    STRINI   B475    STRLIT   B487
 STRLT2   B48D    STRNAM   B0DB    STRNEX   E0E3    STRNG    A5EE
 STRNG1   006F    STRNG2   0071    STRNGI   006F    STROU2   BDDA
 STROUT   AB1E    STRPR2   AB28    STRPRT   AB21    STRRTS   AF5C
 STRSIZ   0003    STRSPA   B47D    STRST2   B4B5    STRTX2   AEC6
 STRTXT   AEBD    STUFFH   A5C9    STXBUF   BEB2    STXFND   B0EF
 STXFOR   AD27    STXTPT   A68E    SUBFLG   0010    SUBIT    B8AF
 SVAR     B559    SVARGO   B561    SVARS    B54D    SWAPLP   E01E
 SXREG    030D    SYNCHR   AEFF    SYREG    030E    TABER    AAF8
 TABTK    00A3    TAN      E2B4    TANSGN   0012    TEMPF1   0057
 TEMPF2   005C    TEMPF3   004E    TEMPPT   0016    TEMPST   0019
 TENC     BAF9    TENEXP   005E    THENTK   00A7    TIMELP   A9ED
 TIMEND   BF52    TIMNUM   AA1D    TIMSTR   B46F    TOTK     00A4
 TRMNO1   AB62    TRMNOK   AB4D    TRMOK    AC9D    TRMPOS   0009
 TRYAG2   B4F6    TRYAG3   B501    TRYAGN   AD0C    TRYMOR   A412
 TRYOFF   BAC4    TSTDUN   A6E6    TSTOP    ADB8    TSTR10   AF27
 TSTROM   AF14    TURNON   B0D4    TVAR     B544    TWOPI    E2E5
 TXTPTR   007A    TXTTAB   002B    TYPLIN   A6E8    UMLCNT   B378
 UMLRTS   B37C    UMULT    B34C    UMULTC   B35F    UMULTD   B355
 UNPRTS   AE82    UNPSTK   AE64    USEDEF   E40E    USERR    A8E3
 USRLOC   A058    USRPOK   0310    VAL      B7AD    VAL2     B7CD
 VALRTS   B7EA    VALTYP   000D    VAREND   ACDF    VARNAM   0045
 VAROK    B143    VARPNT   0047    VARTAB   002D    VARTXT   004B
 VARY0    ACEA    VERCK    000A    WAITER   B840    WORDS    E460
 XSPAC    AB0F    XSPAC1   AB19    XSPAC2   AB10    ZEREMV   BADA
 ZERITA   B2C8    ZERO     BF13    ZEROF1   B8F9    ZEROFC   B8F7
 ZEROML   B8FB    ZERRTS   B848    ZZ1      01FF    ZZ2      0201
 ZZ3      0202    ZZ4      01FF    ZZ5      01FF    ZZ6      AF2A


END OF ASSEMBLY
kernal......PAGE 0001

LINE# LOC   CODE        LINE


00001  0000              .LIB   DISCLAIMER
00002  0000              ;****************************************
00003  0000              ;*                                      *
00004  0000              ;* KK  K EEEEE RRRR  NN  N  AAA  LL     *
00005  0000              ;* KK KK EE    RR  R NNN N AA  A LL     *
00006  0000              ;* KKK   EE    RR  R NNN N AA  A LL     *
00007  0000              ;* KKK   EEEE  RRRR  NNNNN AAAAA LL     *
00008  0000              ;* KK K  EE    RR  R NN NN AA  A LL     *
00009  0000              ;* KK KK EE    RR  R NN NN AA  A LL     *
00010  0000              ;* KK KK EEEEE RR  R NN NN AA  A LLLLL  *
00011  0000              ;*                                      *
00012  0000              ;***************************************
00013  0000              ;
00014  0000              ;***************************************
00015  0000              ;* PET KERNAL                          *
00016  0000              ;*   MEMORY AND I/O DEPENDENT ROUTINES *
00017  0000              ;* DRIVING THE HARDWARE OF THE         *
00018  0000              ;* FOLLOWING CBM MODELS:               *
00019  0000              ;*   COMMODORE 64 (NTSC OR PAL VIDEO)  *
00020  0000              ;* COPYRIGHT (C) 1982 BY               *
00021  0000              ;* COMMODORE BUSINESS MACHINES (CBM)   *
00022  0000              ;***************************************



00024  0000              ;****LISTING DATE --1200 06 JULY 1982***



00026  0000              ;***************************************
00027  0000              ;* THIS SOFTWARE IS FURNISHED FOR USE  *
00028  0000              ;* USE IN THE VIC OR COMMODORE COMPUTER*
00029  0000              ;* SERIES ONLY.                        *
00030  0000              ;*                                     *
00031  0000              ;* COPIES THEREOF MAY NOT BE PROVIDED  *
00032  0000              ;* OR MADE AVAILABLE FOR USE ON ANY    *
00033  0000              ;* OTHER SYSTEM.                       *
00034  0000              ;*                                     *
00035  0000              ;* THE INFORMATION IN THIS DOCUMENT IS *
00036  0000              ;* SUBJECT TO CHANGE WITHOUT NOTICE.   *
00037  0000              ;*                                     *
00038  0000              ;* NO RESPONSIBILITY IS ASSUMED FOR    *
00039  0000              ;* RELIABILITY OF THIS SOFTWARE. RSR   *
00040  0000              ;*                                     *
00041  0000              ;***************************************
00042  0000              .END
00043  0000              .LIB   DECLARE














DECLARE......PAGE 0002

LINE# LOC   CODE        LINE


00045  0000                     *=$0000         ;DECLARE 6510 PORTS
00046  0000              D6510  *=*+1           ;6510 DATA DIRECTION REGISTER
00047  0001              R6510  *=*+1           ;6510 DATA REGISTER
00048  0002                     *=$0002         ;MISS 6510 REGS
00049  0002              ;VIRTUAL REGS FOR MACHINE LANGUAGE MONITOR
00050  0002              PCH    *=*+1
00051  0003              PCL    *=*+1
00052  0004              FLGS   *=*+1
00053  0005              ACC    *=*+1
00054  0006              XR     *=*+1
00055  0007              YR     *=*+1
00056  0008              SP     *=*+1
00057  0009              INVH   *=*+1           ;USER MODIFIABLE IRQ
00058  000A              INVL   *=*+1



00060  000B                     * =$90
00061  0090              STATUS *=*+1           ;I/O OPERATION STATUS BYTE
00062  0091              ; CRFAC *=*+2 ;CORRECTION FACTOR (UNUSED)
00063  0091              STKEY  *=*+1           ;STOP KEY FLAG
00064  0092              SVXT   *=*+1           ;TEMPORARY
00065  0093              VERCK  *=*+1           ;LOAD OR VERIFY FLAG
00066  0094              C3P0   *=*+1           ;IEEE BUFFERED CHAR FLAG
00067  0095              BSOUR  *=*+1           ;CHAR BUFFER FOR IEEE
00068  0096              SYNO   *=*+1           ;CASSETTE SYNC #
00069  0097              XSAV   *=*+1           ;TEMP FOR BASIN
00070  0098              LDTND  *=*+1           ;INDEX TO LOGICAL FILE
00071  0099              DFLTN  *=*+1           ;DEFAULT INPUT DEVICE #
00072  009A              DFLTO  *=*+1           ;DEFAULT OUTPUT DEVICE #
00073  009B              PRTY   *=*+1           ;CASSETTE PARITY
00074  009C              DPSW   *=*+1           ;CASSETTE DIPOLE SWITCH
00075  009D              MSGFLG *=*+1           ;OS MESSAGE FLAG
00076  009E              PTR1                   ;CASSETTE ERROR PASS1
00077  009E              T1     *=*+1           ;TEMPORARY 1
00078  009F              TMPC
00079  009F              PTR2                   ;CASSETTE ERROR PASS2
00080  009F              T2     *=*+1           ;TEMPORARY 2
00081  00A0              TIME   *=*+3           ;24 HOUR CLOCK IN 1/60TH SECONDS
00082  00A3              R2D2                   ;SERIAL BUS USAGE
00083  00A3              PCNTR  *=*+1           ;CASSETTE STUFF
00084  00A4              ; PTCH *=*+1  (UNUSED)
00085  00A4              BSOUR1                 ;TEMP USED BY SERIAL ROUTINE
00086  00A4              FIRT   *=*+1
00087  00A5              COUNT                  ;TEMP USED BY SERIAL ROUTINE
00088  00A5              CNTDN  *=*+1           ;CASSETTE SYNC COUNTDOWN
00089  00A6              BUFPT  *=*+1           ;CASSETTE BUFFER POINTER
00090  00A7              INBIT                  ;RS-232 RCVR INPUT BIT STORAGE
00091  00A7              SHCNL  *=*+1           ;CASSETTE SHORT COUNT
00092  00A8              BITCI                  ;RS-232 RCVR BIT COUNT IN
00093  00A8              RER    *=*+1           ;CASSETTE READ ERROR
00094  00A9              RINONE                 ;RS-232 RCVR FLAG FOR START BIT CHECK
00095  00A9              REZ    *=*+1           ;CASSETE READING ZEROES
00096  00AA              RIDATA                 ;RS-232 RCVR BYTE BUFFER
00097  00AA              RDFLG  *=*+1           ;CASSETTE READ MODE






DECLARE......PAGE 0003

LINE# LOC   CODE        LINE


00098  00AB              RIPRTY                 ;RS-232 RCVR PARITY STORAGE
00099  00AB              SHCNH  *=*+1           ;CASSETTE SHORT CNT
00100  00AC              SAL    *=*+1
00101  00AD              SAH    *=*+1
00102  00AE              EAL    *=*+1
00103  00AF              EAH    *=*+1
00104  00B0              CMP0   *=*+1
00105  00B1              TEMP   *=*+1
00106  00B2              TAPE1  *=*+2           ;ADDRESS OF TAPE BUFFER #1Y.
00107  00B4              BITTS                  ;RS-232 TRNS BIT COUNT
00108  00B4              SNSW1  *=*+1
00109  00B5              NXTBIT                 ;RS-232 TRNS NEXT BIT TO BE SENT
00110  00B5              DIFF   *=*+1
00111  00B6              RODATA                 ;RS-232 TRNS BYTE BUFFER
00112  00B6              PRP    *=*+1
00113  00B7              FNLEN  *=*+1           ;LENGTH CURRENT FILE N STR
00114  00B8              LA     *=*+1           ;CURRENT FILE LOGICAL ADDR
00115  00B9              SA     *=*+1           ;CURRENT FILE 2ND ADDR
00116  00BA              FA     *=*+1           ;CURRENT FILE PRIMARY ADDR
00117  00BB              FNADR  *=*+2           ;ADDR CURRENT FILE NAME STR
00118  00BD              ROPRTY                 ;RS-232 TRNS PARITY BUFFER
00119  00BD              OCHAR  *=*+1
00120  00BE              FSBLK  *=*+1           ;CASSETTE READ BLOCK COUNT
00121  00BF              MYCH   *=*+1
00122  00C0              CAS1   *=*+1           ;CASSETTE MANUAL/CONTROLLED SWITCH
00123  00C1              TMP0
00124  00C1              STAL   *=*+1
00125  00C2              STAH   *=*+1
00126  00C3              MEMUSS                 ;CASSETTE LOAD TEMPS (2 BYTES)
00127  00C3              TMP2   *=*+2
00128  00C5              ;
00129  00C5              ;VARIABLES FOR SCREEN EDITOR
00130  00C5              ;
00131  00C5              LSTX   *=*+1           ;KEY SCAN INDEX
00132  00C6              ; SFST *=*+1 ;KEYBOARD SHIFT FLAG (UNUSED)
00133  00C6              NDX    *=*+1           ;INDEX TO KEYBOARD Q
00134  00C7              RVS    *=*+1           ;RVS FIELD ON FLAG
00135  00C8              INDX   *=*+1
00136  00C9              LSXP   *=*+1           ;X POS AT START
00137  00CA              LSTP   *=*+1
00138  00CB              SFDX   *=*+1           ;SHIFT MODE ON PRINT
00139  00CC              BLNSW  *=*+1           ;CURSOR BLINK ENAB
00140  00CD              BLNCT  *=*+1           ;COUNT TO TOGGLE CUR
00141  00CE              GDBLN  *=*+1           ;CHAR BEFORE CURSOR
00142  00CF              BLNON  *=*+1           ;ON/OFF BLINK FLAG
00143  00D0              CRSW   *=*+1           ;INPUT VS GET FLAG
00144  00D1              PNT    *=*+2           ;POINTER TO ROW
00145  00D3              ; POINT *=*+1   (UNUSED)
00146  00D3              PNTR   *=*+1           ;POINTER TO COLUMN
00147  00D4              QTSW   *=*+1           ;QUOTE SWITCH
00148  00D5              LNMX   *=*+1           ;40/80 MAX POSITON
00149  00D6              TBLX   *=*+1
00150  00D7              DATA   *=*+1
00151  00D8              INSRT  *=*+1           ;INSERT MODE FLAG
00152  00D9              LDTB1  *=*+26          ;LINE FLAGS+ENDSPACE






DECLARE......PAGE 0004

LINE# LOC   CODE        LINE


00153  00F3              USER   *=*+2           ;SCREEN EDITOR COLOR IP
00154  00F5              KEYTAB *=*+2           ;KEYSCAN TABLE INDIRECT
00155  00F7              ;RS-232 Z-PAGE
00156  00F7              RIBUF  *=*+2           ;RS-232 INPUT BUFFER POINTER
00157  00F9              ROBUF  *=*+2           ;RS-232 OUTPUT BUFFER POINTER
00158  00FB              FREKZP *=*+4           ;FREE KERNAL ZERO PAGE 9/24/80
00159  00FF              BASZPT *=*+1           ;LOCATION ($00FF) USED BY BASIC



00161  0100                     *=$100 
00162  0100              BAD    *=*+1
00163  0101                     *=$200
00164  0200              BUF    *=*+89          ;BASIC/MONITOR BUFFER

00166  0259              ; TABLES FOR OPEN FILES
00167  0259              ;
00168  0259              LAT    *=*+10          ;LOGICAL FILE NUMBERS
00169  0263              FAT    *=*+10          ;PRIMARY DEVICE NUMBERS
00170  026D              SAT    *=*+10          ;SECONDARY ADDRESSES


00172  0277              ; SYSTEM STORAGE
00173  0277              ;
00174  0277              KEYD   *=*+10          ;IRQ KEYBOARD BUFFER
00175  0281              MEMSTR *=*+2           ;START OF MEMORY
00176  0283              MEMSIZ *=*+2           ;TOP OF MEMORY
00177  0285              TIMOUT *=*+1           ;IEEE TIMEOUT FLAG


00179  0286              ; SCREEN EDITOR STORAGE
00180  0286              ;
00181  0286              COLOR  *=*+1           ;ACTIV COLOR NYBBLE
00182  0287              GDCOL  *=*+1           ;ORIGINAL COLOR BEFORE CURSOR
00183  0288              HIBASE *=*+1           ;BASE LOCATION OF SCREEN (TOP)
00184  0289              XMAX   *=*+1
00185  028A              RPTFLG *=*+1           ;KEY REPEAT FLAG
00186  028B              KOUNT  *=*+1
00187  028C              DELAY  *=*+1
00188  028D              SHFLAG *=*+1           ;SHIFT FLAG BYTE
00189  028E              LSTSHF *=*+1           ;LAST SHIFT PATTERN
00190  028F              KEYLOG *=*+2           ;INDIRECT FOR KEYBOARD TABLE SETUP
00191  0291              MODE   *=*+1           ;0-PET MODE, 1-CATTACANNA
00192  0292              AUTODN *=*+1           ;AUTO SCROLL DOWN FLAG(=0 ON,<>0 OFF)



00194  0293              ; RS-232 STORAGE
00195  0293              ;
00196  0293              M51CTR *=*+1           ;6551 CONTROL REGISTER
00197  0294              M51CDR *=*+1           ;6551 COMMAND REGISTER
00198  0295              M51AJB *=*+2           ;NON STANDARD (BITTIME/2-100)
00199  0297              RSSTAT *=*+1           ; RS-232 STATUS REGISTER
00200  0298              BITNUM *=*+1           ;NUMBER OF BITS TO SEND (FAST RESPONSE)
00201  0299              BAUDOF *=*+2           ;BAUD RATE FULL BIT TIME (CREATED BY OPEN)






DECLARE......PAGE 0005

LINE# LOC   CODE        LINE


00202  029B              ;
00203  029B              ; RECIEVER STORAGE
00204  029B              ;
00205  029B              ; INBIT *=*+1 ;INPUT BIT STORAGE
00206  029B              ; BITCI *=*+1 ;BIT COUNT IN
00207  029B              ; RINONE *=*+1 ;FLAG FOR START BIT CHECK
00208  029B              ; RIDATA *=*+1 ;BYTE IN BUFFER
00209  029B              ; RIPRTY *=*+1 ;BYTE IN PARITY STORAGE
00210  029B              RIDBE  *=*+1           ;INPUT BUFFER INDEX TO END
00211  029C              RIDBS  *=*+1           ;INPUT BUFFER POINTER TO START
00212  029D              ;
00213  029D              ; TRANSMITTER STORAGE
00214  029D              ;
00215  029D              ; BITTS *=*+1 ;# OF BITS TO BE SENT
00216  029D              ; NXTBIT *=*+1 ;NEXT BIT TO BE SENT
00217  029D              ; ROPRTY *=*+1 ;PARITY OF BYTE SENT
00218  029D              ; RODATA *=*+1 ;BYTE BUFFER OUT
00219  029D              RODBS  *=*+1           ;OUTPUT BUFFER INDEX TO START
00220  029E              RODBE  *=*+1           ;OUTPUT BUFFER INDEX TO END
00221  029F              ;
00222  029F              IRQTMP *=*+2           ;HOLDS IRQ DURING TAPE OPS
00223  02A1              ;
00224  02A1              ; TEMP SPACE FOR VIC-40 VARIABLES ****
00225  02A1              ;
00226  02A1              ENABL  *=*+1           ;RS-232 ENABLES (REPLACES IER)
00227  02A2              CASTON *=*+1           ;TOD SENSE DURING CASSETTES
00228  02A3              KIKA26 *=*+1           ;TEMP STORAGE FOR CASSETTE READ ROUTINE
00229  02A4              STUPID *=*+1           ;TEMP D1IRQ INDICATOR FOR CASSETTE READ
00230  02A5              LINTMP *=*+1           ;TEMPORARY FOR LINE INDEX
00231  02A6              PALNTS *=*+1           ;PAL VS NTSC FLAG 0=NTSC 1=PAL



00233  02A7                     *=$0300         ;REM PROGRAM INDIRECTS(10)
00234  0300                     *=$0300+20      ;REM KERNAL/OS INDIRECTS(20)
00235  0314              CINV   *=*+2           ;IRQ RAM VECTOR
00236  0316              CBINV  *=*+2           ;BRK INSTR RAM VECTOR
00237  0318              NMINV  *=*+2           ;NMI RAM VECTOR
00238  031A              IOPEN  *=*+2           ;INDIRECTS FOR CODE
00239  031C              ICLOSE *=*+2           ; CONFORMS TO KERNAL SPEC 8/19/80
00240  031E              ICHKIN *=*+2
00241  0320              ICKOUT *=*+2
00242  0322              ICLRCH *=*+2
00243  0324              IBASIN *=*+2
00244  0326              IBSOUT *=*+2
00245  0328              ISTOP  *=*+2
00246  032A              IGETIN *=*+2
00247  032C              ICLALL *=*+2
00248  032E              USRCMD *=*+2
00249  0330              ILOAD  *=*+2
00250  0332              ISAVE  *=*+2           ;SAVESP



00252  0334                     *=$0300+60






DECLARE......PAGE 0006

LINE# LOC   CODE        LINE


00253  033C              TBUFFR *=*+192         ;CASSETTE DATA BUFFER



00255  03FC                     * =$400
00256  0400              VICSCN *=*+1024
00257  0800              RAMLOC






















































DECLARE......PAGE 0007

LINE# LOC   CODE        LINE


00260  0800              ; I/O DEVICES
00261  0800              ;
00262  0800                     * =$D000
00263  D000              VICREG =*              ;VIC REGISTERS


00265  D000                     * =$D400
00266  D400              SIDREG =*              ;SID REGISTERS


00268  D400                     * =$D800
00269  D800              VICCOL *=*+1024        ;VIC COLOR NYBBLES


00271  DC00                     * =$DC00        ;DEVICE1 6526 (PAGE1 IRQ)
00272  DC00              COLM                   ;KEYBOARD MATRIX
00273  DC00              D1PRA  *=*+1
00274  DC01              ROWS                   ;KEYBOARD MATRIX
00275  DC01              D1PRB  *=*+1
00276  DC02              D1DDRA *=*+1
00277  DC03              D1DDRB *=*+1
00278  DC04              D1T1L  *=*+1
00279  DC05              D1T1H  *=*+1
00280  DC06              D1T2L  *=*+1
00281  DC07              D1T2H  *=*+1
00282  DC08              D1TOD1 *=*+1
00283  DC09              D1TODS *=*+1
00284  DC0A              D1TODM *=*+1
00285  DC0B              D1TODH *=*+1
00286  DC0C              D1SDR  *=*+1
00287  DC0D              D1ICR  *=*+1
00288  DC0E              D1CRA  *=*+1
00289  DC0F              D1CRB  *=*+1


00291  DC10                     * =$DD00        ;DEVICE2 6526 (PAGE2 NMI)
00292  DD00              D2PRA  *=*+1
00293  DD01              D2PRB  *=*+1
00294  DD02              D2DDRA *=*+1
00295  DD03              D2DDRB *=*+1
00296  DD04              D2T1L  *=*+1
00297  DD05              D2T1H  *=*+1
00298  DD06              D2T2L  *=*+1
00299  DD07              D2T2H  *=*+1
00300  DD08              D2TOD1 *=*+1
00301  DD09              D2TODS *=*+1
00302  DD0A              D2TODM *=*+1
00303  DD0B              D2TODH *=*+1
00304  DD0C              D2SDR  *=*+1
00305  DD0D              D2ICR  *=*+1
00306  DD0E              D2CRA  *=*+1
00307  DD0F              D2CRB  *=*+1


00309  DD10              TIMRB  =$19            ;6526 CRB ENABLE ONE-SHOT TB






DECLARE......PAGE 0008

LINE# LOC   CODE        LINE


00311  DD10              ;TAPE BLOCK TYPES
00312  DD10              ;
00313  DD10              EOT    =5              ;END OF TAPE
00314  DD10              BLF    =1              ;BASIC LOAD FILE
00315  DD10              BDF    =2              ;BASIC DATA FILE
00316  DD10              PLF    =3              ;FIXED PROGRAM TYPE
00317  DD10              BDFH   =4              ;BASIC DATA FILE HEADER
00318  DD10              BUFSZ  =192            ;BUFFER SIZE
00319  DD10              ;
00320  DD10              ;SCREEN EDITOR CONSTANTS
00321  DD10              ;
00322  DD10              LLEN   =40             ;SINGLE LINE 40 COLUMNS
00323  DD10              LLEN2  =80             ;DOUBLE LINE = 80 COLUMNS
00324  DD10              NLINES =25             ;25 ROWS ON SCREEN
00325  DD10              WHITE  =$01            ;WHITE SCREEN COLOR
00326  DD10              BLUE   =$06            ;BLUE CHAR COLOR
00327  DD10              CR     =$D             ;CARRIAGE RETURN
00328  DD10              .END
00329  DD10                     *=$E500         ;START OF VIC-40 KERNAL
00330  E500              .LIB   EDITOR.1









































SCREEN EDITOR......PAGE 0009

LINE# LOC   CODE        LINE


00332  E500              MAXCHR=80
00333  E500              NWRAP=2                ;MAX NUMBER OF PHYSICAL LINES PER LOGICAL LINE
00334  E500              ;
00335  E500              ;UNDEFINED FUNCTION ENTRY
00336  E500              ;
00337  E500              ; UNDEFD LDX #0
00338  E500              ; UNDEF2 LDA UNMSG,X
00339  E500              ; JSR PRT
00340  E500              ; INX
00341  E500              ; CPX #UNMSG2-UNMSG
00342  E500              ; BNE UNDEF2
00343  E500              ; SEC
00344  E500              ; RTS
00345  E500              ;
00346  E500              ; UNMSG .BYT $D,'?ADVANCED FUNCTION NOT AVAILABLE',$D
00347  E500              ; UNMSG2
00348  E500              ;
00349  E500              ;RETURN ADDRESS OF 6526
00350  E500              ;
00351  E500  A2 00       IOBASE LDX #<D1PRA
00352  E502  A0 DC              LDY #>D1PRA
00353  E504  60                 RTS
00354  E505              ;
00355  E505              ;RETURN MAX ROWS,COLS OF SCREEN
00356  E505              ;
00357  E505  A2 28       SCRORG LDX #LLEN
00358  E507  A0 19              LDY #NLINES
00359  E509  60                 RTS
00360  E50A              ;
00361  E50A              ;READ/PLOT CURSOR POSITION
00362  E50A              ;
00363  E50A  B0 07       PLOT   BCS PLOT10
00364  E50C  86 D6              STX TBLX
00365  E50E  84 D3              STY PNTR
00366  E510  20 6C E5           JSR STUPT
00367  E513  A6 D6       PLOT10 LDX TBLX
00368  E515  A4 D3              LDY PNTR
00369  E517  60                 RTS





00371  E518              ;INITIALIZE I/O
00372  E518              ;
00373  E518              CINT
00374  E518              ;
00375  E518              ; ESTABLISH SCREEN MEMORY
00376  E518              ;
00377  E518  20 A0 E5           JSR PANIC       ;SET UP VIC
00378  E51B              ;
00379  E51B  A9 00              LDA #0          ;MAKE SURE WE'RE IN PET MODE
00380  E51D  8D 91 02           STA MODE
00381  E520  85 CF              STA BLNON       ;WE DONT HAVE A GOOD CHAR FROM THE SCREEN YET







SCREEN EDITOR......PAGE 000A

LINE# LOC   CODE        LINE


00383  E522  A9 48              LDA #<SHFLOG    ;SET SHIFT LOGIC INDIRECTS
00384  E524  8D 8F 02           STA KEYLOG
00385  E527  A9 EB              LDA #>SHFLOG
00386  E529  8D 90 02           STA KEYLOG+1
00387  E52C  A9 0A              LDA #10
00388  E52E  8D 89 02           STA XMAX        ;MAXIMUM TYPE AHEAD BUFFER SIZE
00389  E531  8D 8C 02           STA DELAY
00390  E534  A9 0E              LDA #$E         ;INIT COLOR TO LIGHT BLUE<<<<<<<<<<
00391  E536  8D 86 02           STA COLOR
00392  E539  A9 04              LDA #4
00393  E53B  8D 8B 02           STA KOUNT       ;DELAY BETWEEN KEY REPEATS
00394  E53E  A9 0C              LDA #$C
00395  E540  85 CD              STA BLNCT
00396  E542  85 CC              STA BLNSW
00397  E544  AD 88 02    CLSR   LDA HIBASE      ;FILL HI BYTE PTR TABLE
00398  E547  09 80              ORA #$80
00399  E549  A8                 TAY
00400  E54A  A9 00              LDA #0
00401  E54C  AA                 TAX
00402  E54D  94 D9       LPS1   STY LDTB1,X
00403  E54F  18                 CLC
00404  E550  69 28              ADC #LLEN
00405  E552  90 01              BCC LPS2
00406  E554  C8                 INY             ;CARRY BUMP HI BYTE
00407  E555  E8          LPS2   INX
00408  E556  E0 1A              CPX #NLINES+1   ;DONE # OF LINES?
00409  E558  D0 F3              BNE LPS1        ;NO...
00410  E55A  A9 FF              LDA #$FF        ;TAG END OF LINE TABLE
00411  E55C  95 D9              STA LDTB1,X
00412  E55E  A2 18              LDX #NLINES-1   ;CLEAR FROM THE BOTTOM LINE UP
00413  E560  20 FF E9    CLEAR1 JSR CLRLN       ;SEE SCROLL ROUTINES
00414  E563  CA                 DEX
00415  E564  10 FA              BPL CLEAR1





00417  E566              ;HOME FUNCTION
00418  E566              ;
00419  E566  A0 00       NXTD   LDY #0
00420  E568  84 D3              STY PNTR        ;LEFT COLUMN
00421  E56A  84 D6              STY TBLX        ;TOP LINE
00422  E56C              ;
00423  E56C              ;MOVE CURSOR TO TBLX,PNTR
00424  E56C              ;
00425  E56C              STUPT
00426  E56C  A6 D6              LDX TBLX        ;GET CURENT LINE INDEX
00427  E56E  A5 D3              LDA PNTR        ;GET CHARACTER POINTER
00428  E570  B4 D9       FNDSTR LDY LDTB1,X     ;FIND BEGINING OF LINE
00429  E572  30 08              BMI STOK        ;BRANCH IF START FOUND
00430  E574  18                 CLC
00431  E575  69 28              ADC #LLEN       ;ADJUST POINTER
00432  E577  85 D3              STA PNTR
00433  E579  CA                 DEX






SCREEN EDITOR......PAGE 000B

LINE# LOC   CODE        LINE


00434  E57A  10 F4              BPL FNDSTR
00435  E57C              ;
00436  E57C              STOK
00437  E57C  B5 D9              LDA LDTB1,X
00438  E57E  29 03              AND #$03        ;GET RID OF GARBAGE
00439  E580  0D 88 02           ORA HIBASE      ;OR IN HIGH ORDER BITS
00440  E583  85 D2              STA PNT+1
00441  E585  BD F0 EC           LDA LDTB2,X
00442  E588  85 D1              STA PNT
00443  E58A              ;
00444  E58A  A9 27              LDA #LLEN-1
00445  E58C  E8                 INX
00446  E58D  B4 D9       FNDEND LDY LDTB1,X
00447  E58F  30 06              BMI STDONE
00448  E591  18                 CLC
00449  E592  69 28              ADC #LLEN
00450  E594  E8                 INX
00451  E595  10 F6              BPL FNDEND
00452  E597              STDONE
00453  E597  85 D5              STA LNMX
00454  E599  60                 RTS





00456  E59A              ;PANIC NMI ENTRY
00457  E59A              ;
00458  E59A  20 A0 E5    VPAN   JSR PANIC       ;FIX VIC SCREEN
00459  E59D  4C 66 E5           JMP NXTD        ;HOME CURSOR





00461  E5A0  A9 03       PANIC  LDA #3          ;RESET DEFAULT I/O
00462  E5A2  85 9A              STA DFLTO
00463  E5A4  A9 00              LDA #0
00464  E5A6  85 99              STA DFLTN





00466  E5A8              ;INIT VIC
00467  E5A8              ;
00468  E5A8  A2 2F       INITV  LDX #47         ;LOAD ALL VIC REGS ***
00469  E5AA  BD B8 EC    PX4    LDA TVIC-1,X
00470  E5AD  9D FF CF           STA VICREG-1,X
00471  E5B0  CA                 DEX
00472  E5B1  D0 F7              BNE PX4
00473  E5B3  60                 RTS









SCREEN EDITOR......PAGE 000C

LINE# LOC   CODE        LINE


00475  E5B4              ;
00476  E5B4              ;REMOVE CHARACTER FROM QUEUE
00477  E5B4              ;
00478  E5B4  AC 77 02    LP2    LDY KEYD
00479  E5B7  A2 00              LDX #0
00480  E5B9  BD 78 02    LP1    LDA KEYD+1,X
00481  E5BC  9D 77 02           STA KEYD,X
00482  E5BF  E8                 INX
00483  E5C0  E4 C6              CPX NDX
00484  E5C2  D0 F5              BNE LP1
00485  E5C4  C6 C6              DEC NDX
00486  E5C6  98                 TYA
00487  E5C7  58                 CLI
00488  E5C8  18                 CLC             ;GOOD RETURN
00489  E5C9  60                 RTS
00490  E5CA              ;
00491  E5CA  20 16 E7    LOOP4  JSR PRT
00492  E5CD              LOOP3
00493  E5CD  A5 C6              LDA NDX
00494  E5CF  85 CC              STA BLNSW
00495  E5D1  8D 92 02           STA AUTODN      ;TURN ON AUTO SCROLL DOWN
00496  E5D4  F0 F7              BEQ LOOP3
00497  E5D6  78                 SEI
00498  E5D7  A5 CF              LDA BLNON
00499  E5D9  F0 0C              BEQ LP21
00500  E5DB  A5 CE              LDA GDBLN
00501  E5DD  AE 87 02           LDX GDCOL       ;RESTORE ORIGINAL COLOR
00502  E5E0  A0 00              LDY #0
00503  E5E2  84 CF              STY BLNON
00504  E5E4  20 13 EA           JSR DSPP
00505  E5E7  20 B4 E5    LP21   JSR LP2
00506  E5EA  C9 83              CMP #$83        ;RUN KEY?
00507  E5EC  D0 10              BNE LP22
00508  E5EE  A2 09              LDX #9
00509  E5F0  78                 SEI
00510  E5F1  86 C6              STX NDX
00511  E5F3  BD E6 EC    LP23   LDA RUNTB-1,X
00512  E5F6  9D 76 02           STA KEYD-1,X
00513  E5F9  CA                 DEX
00514  E5FA  D0 F7              BNE LP23
00515  E5FC  F0 CF              BEQ LOOP3
00516  E5FE  C9 0D       LP22   CMP #$D
00517  E600  D0 C8              BNE LOOP4
00518  E602  A4 D5              LDY LNMX
00519  E604  84 D0              STY CRSW
00520  E606  B1 D1       CLP5   LDA (PNT)Y
00521  E608  C9 20              CMP #' 
00522  E60A  D0 03              BNE CLP6
00523  E60C  88                 DEY
00524  E60D  D0 F7              BNE CLP5
00525  E60F  C8          CLP6   INY
00526  E610  84 C8              STY INDX
00527  E612  A0 00              LDY #0
00528  E614  8C 92 02           STY AUTODN      ;TURN OFF AUTO SCROLL DOWN
00529  E617  84 D3              STY PNTR






SCREEN EDITOR......PAGE 000D

LINE# LOC   CODE        LINE


00530  E619  84 D4              STY QTSW
00531  E61B  A5 C9              LDA LSXP
00532  E61D  30 1B              BMI LOP5
00533  E61F  A6 D6              LDX TBLX
00534  E621  20 ED E6           JSR FINDST      ;FIND 1ST PHYSICAL LINE
00535  E624  E4 C9              CPX LSXP
00536  E626  D0 12              BNE LOP5
00537  E628  A5 CA              LDA LSTP
00538  E62A  85 D3              STA PNTR
00539  E62C  C5 C8              CMP INDX
00540  E62E  90 0A              BCC LOP5
00541  E630  B0 2B              BCS CLP2





00543  E632              ;INPUT A LINE UNTIL CARRIAGE RETURN
00544  E632              ;
00545  E632  98          LOOP5  TYA
00546  E633  48                 PHA
00547  E634  8A                 TXA
00548  E635  48                 PHA
00549  E636  A5 D0              LDA CRSW
00550  E638  F0 93              BEQ LOOP3
00551  E63A  A4 D3       LOP5   LDY PNTR
00552  E63C  B1 D1              LDA (PNT)Y
00553  E63E              NOTONE
00554  E63E  85 D7              STA DATA
00555  E640  29 3F       LOP51  AND #$3F
00556  E642  06 D7              ASL DATA
00557  E644  24 D7              BIT DATA
00558  E646  10 02              BPL LOP54
00559  E648  09 80              ORA #$80
00560  E64A  90 04       LOP54  BCC LOP52
00561  E64C  A6 D4              LDX QTSW
00562  E64E  D0 04              BNE LOP53
00563  E650  70 02       LOP52  BVS LOP53
00564  E652  09 40              ORA #$40
00565  E654  E6 D3       LOP53  INC PNTR
00566  E656  20 84 E6           JSR QTSWC
00567  E659  C4 C8              CPY INDX
00568  E65B  D0 17              BNE CLP1
00569  E65D  A9 00       CLP2   LDA #0
00570  E65F  85 D0              STA CRSW
00571  E661  A9 0D              LDA #$D
00572  E663  A6 99              LDX DFLTN       ;FIX GETS FROM SCREEN
00573  E665  E0 03              CPX #3          ;IS IT THE SCREEN?
00574  E667  F0 06              BEQ CLP2A
00575  E669  A6 9A              LDX DFLTO
00576  E66B  E0 03              CPX #3
00577  E66D  F0 03              BEQ CLP21
00578  E66F  20 16 E7    CLP2A  JSR PRT
00579  E672  A9 0D       CLP21  LDA #$D
00580  E674  85 D7       CLP1   STA DATA






SCREEN EDITOR......PAGE 000E

LINE# LOC   CODE        LINE


00581  E676  68                 PLA
00582  E677  AA                 TAX
00583  E678  68                 PLA
00584  E679  A8                 TAY
00585  E67A  A5 D7              LDA DATA
00586  E67C  C9 DE              CMP #$DE        ;IS IT <PI> ?
00587  E67E  D0 02              BNE CLP7
00588  E680  A9 FF              LDA #$FF
00589  E682  18          CLP7   CLC
00590  E683  60                 RTS





00592  E684  C9 22       QTSWC  CMP #$22
00593  E686  D0 08              BNE QTSWL
00594  E688  A5 D4              LDA QTSW
00595  E68A  49 01              EOR #$1
00596  E68C  85 D4              STA QTSW
00597  E68E  A9 22              LDA #$22
00598  E690  60          QTSWL  RTS





00600  E691  09 40       NXT33  ORA #$40
00601  E693  A6 C7       NXT3   LDX RVS
00602  E695  F0 02              BEQ NVS
00603  E697  09 80       NC3    ORA #$80
00604  E699  A6 D8       NVS    LDX INSRT
00605  E69B  F0 02              BEQ NVS1
00606  E69D  C6 D8              DEC INSRT
00607  E69F  AE 86 02    NVS1   LDX COLOR PUT COLOR ON SCREEN
00608  E6A2  20 13 EA           JSR DSPP
00609  E6A5  20 B6 E6           JSR WLOGIC      ;CHECK FOR WRAPAROUND
00610  E6A8  68          LOOP2  PLA
00611  E6A9  A8                 TAY
00612  E6AA  A5 D8              LDA INSRT
00613  E6AC  F0 02              BEQ LOP2
00614  E6AE  46 D4              LSR QTSW
00615  E6B0  68          LOP2   PLA
00616  E6B1  AA                 TAX
00617  E6B2  68                 PLA
00618  E6B3  18                 CLC             ;GOOD RETURN
00619  E6B4  58                 CLI
00620  E6B5  60                 RTS













SCREEN EDITOR......PAGE 000F

LINE# LOC   CODE        LINE


00622  E6B6              WLOGIC
00623  E6B6  20 B3 E8           JSR CHKDWN      ;MAYBE WE SHOULD WE INCREMENT TBLX
00624  E6B9  E6 D3              INC PNTR        ;BUMP CHARCTER POINTER
00625  E6BB  A5 D5              LDA LNMX        ;
00626  E6BD  C5 D3              CMP PNTR        ;IF LNMX IS LESS THAN PNTR
00627  E6BF  B0 3F              BCS WLGRTS      ;BRANCH IF LNMX>=PNTR
00628  E6C1  C9 4F              CMP #MAXCHR-1   ;PAST MAX CHARACTERS
00629  E6C3  F0 32              BEQ WLOG10      ;BRANCH IF SO
00630  E6C5  AD 92 02           LDA AUTODN      ;SHOULD WE AUTO SCROLL DOWN?
00631  E6C8  F0 03              BEQ WLOG20      ;BRANCH IF NOT
00632  E6CA  4C 67 E9           JMP BMT1        ;ELSE DECIDE WHICH WAY TO SCROLL



00634  E6CD              WLOG20
00635  E6CD  A6 D6              LDX TBLX        ;SEE IF WE SHOULD SCROLL DOWN
00636  E6CF  E0 19              CPX #NLINES
00637  E6D1  90 07              BCC WLOG30      ;BRANCH IF NOT
00638  E6D3  20 EA E8           JSR SCROL       ;ELSE DO THE SCROL UP
00639  E6D6  C6 D6              DEC TBLX        ;AND ADJUST CURENT LINE#
00640  E6D8  A6 D6              LDX TBLX
00641  E6DA  16 D9       WLOG30 ASL LDTB1,X     ;WRAP THE LINE
00642  E6DC  56 D9              LSR LDTB1,X
00643  E6DE  E8                 INX             ;INDEX TO NEXT LLINE
00644  E6DF  B5 D9              LDA LDTB1,X     ;GET HIGH ORDER BYTE OF ADDRESS
00645  E6E1  09 80              ORA #$80        ;MAKE IT A NON-CONTINUATION LINE
00646  E6E3  95 D9              STA LDTB1,X     ;AND PUT IT BACK
00647  E6E5  CA                 DEX             ;GET BACK TO CURRENT LINE
00648  E6E6  A5 D5              LDA LNMX        ;CONTINUE THE BYTES TAKEN OUT
00649  E6E8  18                 CLC
00650  E6E9  69 28              ADC #LLEN
00651  E6EB  85 D5              STA LNMX
00652  E6ED              FINDST
00653  E6ED  B5 D9              LDA LDTB1,X     ;IS THIS THE FIRST LINE?
00654  E6EF  30 03              BMI FINX        ;BRANCH IF SO
00655  E6F1  CA                 DEX             ;ELSE BACKUP 1
00656  E6F2  D0 F9              BNE FINDST
00657  E6F4              FINX
00658  E6F4  4C F0 E9           JMP SETPNT      ;MAKE SURE PNT IS RIGHT

00660  E6F7  C6 D6       WLOG10 DEC TBLX
00661  E6F9  20 7C E8           JSR NXLN
00662  E6FC  A9 00              LDA #0
00663  E6FE  85 D3              STA PNTR        ;POINT TO FIRST BYTE
00664  E700  60          WLGRTS RTS
















SCREEN EDITOR......PAGE 0010

LINE# LOC   CODE        LINE


00666  E701  A6 D6       BKLN   LDX TBLX
00667  E703  D0 06              BNE BKLN1
00668  E705  86 D3              STX PNTR
00669  E707  68                 PLA
00670  E708  68                 PLA
00671  E709  D0 9D              BNE LOOP2
00672  E70B              ;
00673  E70B  CA          BKLN1  DEX
00674  E70C  86 D6              STX TBLX
00675  E70E  20 6C E5           JSR STUPT
00676  E711  A4 D5              LDY LNMX
00677  E713  84 D3              STY PNTR
00678  E715  60                 RTS





00680  E716              ;PRINT ROUTINE
00681  E716              ;
00682  E716  48          PRT    PHA
00683  E717  85 D7              STA DATA
00684  E719  8A                 TXA
00685  E71A  48                 PHA
00686  E71B  98                 TYA
00687  E71C  48                 PHA
00688  E71D  A9 00              LDA #0
00689  E71F  85 D0              STA CRSW
00690  E721  A4 D3              LDY PNTR
00691  E723  A5 D7              LDA DATA
00692  E725  10 03              BPL *+5
00693  E727  4C D4 E7           JMP NXTX
00694  E72A  C9 0D              CMP #$D
00695  E72C  D0 03              BNE NJT1
00696  E72E  4C 91 E8           JMP NXT1
00697  E731  C9 20       NJT1   CMP #' 
00698  E733  90 10              BCC NTCN
00699  E735  C9 60              CMP #$60        ;LOWER CASE?
00700  E737  90 04              BCC NJT8        ;NO...
00701  E739  29 DF              AND #$DF        ;YES...MAKE SCREEN LOWER
00702  E73B  D0 02              BNE NJT9        ;ALWAYS
00703  E73D  29 3F       NJT8   AND #$3F
00704  E73F  20 84 E6    NJT9   JSR QTSWC
00705  E742  4C 93 E6           JMP NXT3
00706  E745  A6 D8       NTCN   LDX INSRT
00707  E747  F0 03              BEQ CNC3X
00708  E749  4C 97 E6           JMP NC3
00709  E74C  C9 14       CNC3X  CMP #$14
00710  E74E  D0 2E              BNE NTCN1
00711  E750  98                 TYA
00712  E751  D0 06              BNE BAK1UP
00713  E753  20 01 E7           JSR BKLN
00714  E756  4C 73 E7           JMP BK2
00715  E759  20 A1 E8    BAK1UP JSR CHKBAK      ;SHOULD WE DEC TBLX
00716  E75C  88                 DEY






SCREEN EDITOR......PAGE 0011

LINE# LOC   CODE        LINE


00717  E75D  84 D3              STY PNTR
00718  E75F  20 24 EA    BK1    JSR SCOLOR      ;FIX COLOR PTRS
00719  E762  C8          BK15   INY
00720  E763  B1 D1              LDA (PNT)Y
00721  E765  88                 DEY
00722  E766  91 D1              STA (PNT)Y
00723  E768  C8                 INY
00724  E769  B1 F3              LDA (USER)Y
00725  E76B  88                 DEY
00726  E76C  91 F3              STA (USER)Y
00727  E76E  C8                 INY
00728  E76F  C4 D5              CPY LNMX
00729  E771  D0 EF              BNE BK15
00730  E773  A9 20       BK2    LDA #' 
00731  E775  91 D1              STA (PNT)Y 
00732  E777  AD 86 02           LDA COLOR
00733  E77A  91 F3              STA (USER)Y
00734  E77C  10 4D              BPL JPL3
00735  E77E  A6 D4       NTCN1  LDX QTSW
00736  E780  F0 03              BEQ NC3W
00737  E782  4C 97 E6    CNC3   JMP NC3
00738  E785  C9 12       NC3W   CMP #$12
00739  E787  D0 02              BNE NC1
00740  E789  85 C7              STA RVS
00741  E78B  C9 13       NC1    CMP #$13
00742  E78D  D0 03              BNE NC2
00743  E78F  20 66 E5           JSR NXTD
00744  E792  C9 1D       NC2    CMP #$1D
00745  E794  D0 17              BNE NCX2
00746  E796  C8                 INY
00747  E797  20 B3 E8           JSR CHKDWN
00748  E79A  84 D3              STY PNTR
00749  E79C  88                 DEY
00750  E79D  C4 D5              CPY LNMX
00751  E79F  90 09              BCC NCZ2
00752  E7A1  C6 D6              DEC TBLX
00753  E7A3  20 7C E8           JSR NXLN
00754  E7A6  A0 00              LDY #0
00755  E7A8  84 D3       JPL4   STY PNTR
00756  E7AA  4C A8 E6    NCZ2   JMP LOOP2
00757  E7AD  C9 11       NCX2   CMP #$11
00758  E7AF  D0 1D              BNE COLR1
00759  E7B1  18                 CLC
00760  E7B2  98                 TYA
00761  E7B3  69 28              ADC #LLEN
00762  E7B5  A8                 TAY
00763  E7B6  E6 D6              INC TBLX
00764  E7B8  C5 D5              CMP LNMX
00765  E7BA  90 EC              BCC JPL4
00766  E7BC  F0 EA              BEQ JPL4
00767  E7BE  C6 D6              DEC TBLX
00768  E7C0  E9 28       CURS10 SBC #LLEN
00769  E7C2  90 04              BCC GOTDWN
00770  E7C4  85 D3              STA PNTR
00771  E7C6  D0 F8              BNE CURS10






SCREEN EDITOR......PAGE 0012

LINE# LOC   CODE        LINE


00772  E7C8  20 7C E8    GOTDWN JSR NXLN
00773  E7CB  4C A8 E6    JPL3   JMP LOOP2
00774  E7CE  20 CB E8    COLR1  JSR CHKCOL      ;CHECK FOR A COLOR
00775  E7D1  4C 44 EC           JMP LOWER       ;WAS JMP LOOP2



00777  E7D4              ;CHECK COLOR
00778  E7D4              ;





00780  E7D4              ;SHIFTED KEYS
00781  E7D4              ;
00782  E7D4              NXTX
00783  E7D4              KEEPIT
00784  E7D4  29 7F              AND #$7F
00785  E7D6  C9 7F              CMP #$7F
00786  E7D8  D0 02              BNE NXTX1
00787  E7DA  A9 5E              LDA #$5E
00788  E7DC              NXTX1
00789  E7DC              NXTXA
00790  E7DC  C9 20              CMP #$20        ;IS IT A FUNCTION KEY
00791  E7DE  90 03              BCC UHUH
00792  E7E0  4C 91 E6           JMP NXT33
00793  E7E3              UHUH
00794  E7E3  C9 0D              CMP #$D
00795  E7E5  D0 03              BNE UP5
00796  E7E7  4C 91 E8           JMP NXT1
00797  E7EA  A6 D4       UP5    LDX  QTSW
00798  E7EC  D0 3F              BNE UP6
00799  E7EE  C9 14              CMP #$14
00800  E7F0  D0 37              BNE UP9
00801  E7F2  A4 D5              LDY LNMX
00802  E7F4  B1 D1              LDA (PNT)Y
00803  E7F6  C9 20              CMP #' 
00804  E7F8  D0 04              BNE INS3
00805  E7FA  C4 D3              CPY PNTR
00806  E7FC  D0 07              BNE INS1
00807  E7FE  C0 4F       INS3   CPY #MAXCHR-1
00808  E800  F0 24              BEQ INSEXT      ;EXIT IF LINE TOO LONG
00809  E802  20 65 E9           JSR NEWLIN      ;SCROLL DOWN 1
00810  E805  A4 D5       INS1   LDY LNMX
00811  E807  20 24 EA           JSR SCOLOR
00812  E80A  88          INS2   DEY
00813  E80B  B1 D1              LDA (PNT)Y
00814  E80D  C8                 INY
00815  E80E  91 D1              STA (PNT)Y
00816  E810  88                 DEY
00817  E811  B1 F3              LDA (USER)Y
00818  E813  C8                 INY
00819  E814  91 F3              STA (USER)Y
00820  E816  88                 DEY






SCREEN EDITOR......PAGE 0013

LINE# LOC   CODE        LINE


00821  E817  C4 D3              CPY PNTR
00822  E819  D0 EF              BNE INS2
00823  E81B  A9 20              LDA #$20
00824  E81D  91 D1              STA (PNT)Y
00825  E81F  AD 86 02           LDA COLOR
00826  E822  91 F3              STA (USER)Y
00827  E824  E6 D8              INC INSRT
00828  E826  4C A8 E6    INSEXT JMP LOOP2
00829  E829  A6 D8       UP9    LDX INSRT
00830  E82B  F0 05              BEQ UP2
00831  E82D  09 40       UP6    ORA #$40
00832  E82F  4C 97 E6           JMP NC3
00833  E832  C9 11       UP2    CMP #$11
00834  E834  D0 16              BNE NXT2
00835  E836  A6 D6              LDX TBLX
00836  E838  F0 37              BEQ JPL2
00837  E83A  C6 D6              DEC TBLX
00838  E83C  A5 D3              LDA PNTR
00839  E83E  38                 SEC
00840  E83F  E9 28              SBC #LLEN
00841  E841  90 04              BCC UPALIN
00842  E843  85 D3              STA PNTR
00843  E845  10 2A              BPL JPL2
00844  E847  20 6C E5    UPALIN JSR STUPT
00845  E84A  D0 25              BNE JPL2
00846  E84C  C9 12       NXT2   CMP #$12
00847  E84E  D0 04              BNE NXT6
00848  E850  A9 00              LDA #0
00849  E852  85 C7              STA RVS
00850  E854  C9 1D       NXT6   CMP #$1D
00851  E856  D0 12              BNE NXT61
00852  E858  98                 TYA
00853  E859  F0 09              BEQ BAKBAK
00854  E85B  20 A1 E8           JSR CHKBAK
00855  E85E  88                 DEY
00856  E85F  84 D3              STY PNTR
00857  E861  4C A8 E6           JMP LOOP2
00858  E864  20 01 E7    BAKBAK JSR BKLN
00859  E867  4C A8 E6           JMP LOOP2
00860  E86A  C9 13       NXT61  CMP #$13
00861  E86C  D0 06              BNE SCCL
00862  E86E  20 44 E5           JSR CLSR
00863  E871  4C A8 E6    JPL2   JMP LOOP2
00864  E874              SCCL
00865  E874  09 80              ORA #$80        ;MAKE IT UPPER CASE
00866  E876  20 CB E8           JSR CHKCOL      ;TRY FOR COLOR
00867  E879  4C 4F EC           JMP UPPER       ;WAS JMP LOOP2
00868  E87C              ;
00869  E87C  46 C9       NXLN   LSR LSXP
00870  E87E  A6 D6              LDX TBLX
00871  E880  E8          NXLN2  INX
00872  E881  E0 19              CPX #NLINES     ;OFF BOTTOM?
00873  E883  D0 03              BNE NXLN1       ;NO...
00874  E885  20 EA E8           JSR SCROL       ;YES...SCROLL
00875  E888  B5 D9       NXLN1  LDA LDTB1,X     ;DOUBLE LINE?






SCREEN EDITOR......PAGE 0014

LINE# LOC   CODE        LINE


00876  E88A  10 F4              BPL NXLN2       ;YES...SCROLL AGAIN
00877  E88C  86 D6              STX TBLX
00878  E88E  4C 6C E5           JMP STUPT
00879  E891              NXT1
00880  E891  A2 00              LDX #0
00881  E893  86 D8              STX INSRT
00882  E895  86 C7              STX RVS
00883  E897  86 D4              STX QTSW
00884  E899  86 D3              STX PNTR
00885  E89B  20 7C E8           JSR NXLN
00886  E89E  4C A8 E6    JPL5   JMP LOOP2
00887  E8A1              ;
00888  E8A1              ;
00889  E8A1              ; CHECK FOR A DECREMENT TBLX
00890  E8A1              ;
00891  E8A1  A2 02       CHKBAK LDX #NWRAP
00892  E8A3  A9 00              LDA #0
00893  E8A5  C5 D3       CHKLUP CMP PNTR
00894  E8A7  F0 07              BEQ BACK
00895  E8A9  18                 CLC
00896  E8AA  69 28              ADC #LLEN
00897  E8AC  CA                 DEX
00898  E8AD  D0 F6              BNE CHKLUP
00899  E8AF  60                 RTS
00900  E8B0              ;
00901  E8B0  C6 D6       BACK   DEC TBLX
00902  E8B2  60                 RTS
00903  E8B3              ;
00904  E8B3              ; CHECK FOR INCREMENT TBLX
00905  E8B3              ;
00906  E8B3  A2 02       CHKDWN LDX #NWRAP
00907  E8B5  A9 27              LDA #LLEN-1
00908  E8B7  C5 D3       DWNCHK CMP PNTR
00909  E8B9  F0 07              BEQ DNLINE
00910  E8BB  18                 CLC
00911  E8BC  69 28              ADC #LLEN
00912  E8BE  CA                 DEX
00913  E8BF  D0 F6              BNE DWNCHK
00914  E8C1  60                 RTS
00915  E8C2              ;
00916  E8C2  A6 D6       DNLINE LDX TBLX
00917  E8C4  E0 19              CPX #NLINES
00918  E8C6  F0 02              BEQ DWNBYE
00919  E8C8  E6 D6              INC TBLX
00920  E8CA              ;
00921  E8CA  60          DWNBYE RTS

00923  E8CB              CHKCOL
00924  E8CB  A2 0F              LDX #15         ;THERE'S 15 COLORS
00925  E8CD  DD DA E8    CHK1A  CMP COLTAB,X
00926  E8D0  F0 04              BEQ CHK1B
00927  E8D2  CA                 DEX
00928  E8D3  10 F8              BPL CHK1A
00929  E8D5  60                 RTS
00930  E8D6              ;






SCREEN EDITOR......PAGE 0015

LINE# LOC   CODE        LINE


00931  E8D6              CHK1B
00932  E8D6  8E 86 02           STX COLOR       ;CHANGE THE COLOR
00933  E8D9  60                 RTS

00935  E8DA              COLTAB
00936  E8DA              ;BLK,WHT,RED,CYAN,MAGENTA,GRN,BLUE,YELLOW
00937  E8DA  90                 .BYT $90,$05,$1C,$9F,$9C,$1E,$1F,$9E
00937  E8DB  05 
00937  E8DC  1C 
00937  E8DD  9F 
00937  E8DE  9C 
00937  E8DF  1E 
00937  E8E0  1F 
00937  E8E1  9E 
00938  E8E2  81                 .BYT $81,$95,$96,$97,$98,$99,$9A,$9B
00938  E8E3  95 
00938  E8E4  96 
00938  E8E5  97 
00938  E8E6  98 
00938  E8E7  99 
00938  E8E8  9A 
00938  E8E9  9B 
00939  E8EA              .END
00940  E8EA              ;.LIB CONKAT (JAPAN CONVERSION TABLES)
00941  E8EA              .LIB   EDITOR.2




































EDITOR.2......PAGE 0016

LINE# LOC   CODE        LINE


00943  E8EA              ;SCREEN SCROLL ROUTINE
00944  E8EA              ;
00945  E8EA  A5 AC       SCROL  LDA SAL
00946  E8EC  48                 PHA
00947  E8ED  A5 AD              LDA SAH
00948  E8EF  48                 PHA
00949  E8F0  A5 AE              LDA EAL
00950  E8F2  48                 PHA
00951  E8F3  A5 AF              LDA EAH
00952  E8F5  48                 PHA
00953  E8F6              ;
00954  E8F6              ;   S C R O L L   U P
00955  E8F6              ;
00956  E8F6  A2 FF       SCRO0  LDX #$FF
00957  E8F8  C6 D6              DEC TBLX
00958  E8FA  C6 C9              DEC LSXP
00959  E8FC  CE A5 02           DEC LINTMP
00960  E8FF  E8          SCR10  INX             ;GOTO NEXT LINE
00961  E900  20 F0 E9           JSR SETPNT      ;POINT TO 'TO' LINE
00962  E903  E0 18              CPX #NLINES-1   ;DONE?
00963  E905  B0 0C              BCS SCR41       ;BRANCH IF SO
00964  E907              ;
00965  E907  BD F1 EC           LDA LDTB2+1,X   ;SETUP FROM PNTR
00966  E90A  85 AC              STA SAL
00967  E90C  B5 DA              LDA LDTB1+1,X
00968  E90E  20 C8 E9           JSR SCRLIN      ;SCROLL THIS LINE UP1
00969  E911  30 EC              BMI SCR10
00970  E913              ;
00971  E913              SCR41
00972  E913  20 FF E9           JSR CLRLN
00973  E916              ;
00974  E916  A2 00              LDX #0          ;SCROLL HI BYTE POINTERS
00975  E918  B5 D9       SCRL5  LDA LDTB1,X
00976  E91A  29 7F              AND #$7F
00977  E91C  B4 DA              LDY LDTB1+1,X
00978  E91E  10 02              BPL SCRL3
00979  E920  09 80              ORA #$80
00980  E922  95 D9       SCRL3  STA LDTB1,X
00981  E924  E8                 INX
00982  E925  E0 18              CPX #NLINES-1
00983  E927  D0 EF              BNE SCRL5
00984  E929              ;
00985  E929  A5 F1              LDA LDTB1+NLINES-1
00986  E92B  09 80              ORA #$80
00987  E92D  85 F1              STA LDTB1+NLINES-1
00988  E92F  A5 D9              LDA LDTB1       ;DOUBLE LINE?
00989  E931  10 C3              BPL SCRO0       ;YES...SCROLL AGAIN
00990  E933              ;
00991  E933  E6 D6              INC TBLX
00992  E935  EE A5 02           INC LINTMP
00993  E938  A9 7F              LDA #$7F        ;CHECK FOR CONTROL KEY
00994  E93A  8D 00 DC           STA COLM        ;DROP LINE 2 ON PORT B
00995  E93D  AD 01 DC           LDA ROWS
00996  E940  C9 FB              CMP #$FB        ;SLOW SCROLL KEY?(CONTROL)
00997  E942  08                 PHP             ;SAVE STATUS. RESTORE PORT B






EDITOR.2......PAGE 0017

LINE# LOC   CODE        LINE


00998  E943  A9 7F              LDA #$7F        ;FOR STOP KEY CHECK
00999  E945  8D 00 DC           STA COLM
01000  E948  28                 PLP
01001  E949  D0 0B              BNE MLP42
01002  E94B              ;
01003  E94B  A0 00              LDY #0
01004  E94D  EA          MLP4   NOP             ;DELAY
01005  E94E  CA                 DEX
01006  E94F  D0 FC              BNE MLP4
01007  E951  88                 DEY
01008  E952  D0 F9              BNE MLP4
01009  E954  84 C6              STY NDX         ;CLEAR KEY QUEUE BUFFER
01010  E956              ;
01011  E956  A6 D6       MLP42  LDX TBLX
01012  E958              ;
01013  E958  68          PULIND PLA             ;RESTORE OLD INDIRECTS
01014  E959  85 AF              STA EAH
01015  E95B  68                 PLA
01016  E95C  85 AE              STA EAL
01017  E95E  68                 PLA
01018  E95F  85 AD              STA SAH
01019  E961  68                 PLA
01020  E962  85 AC              STA SAL
01021  E964  60                 RTS





































EDITOR.2......PAGE 0018

LINE# LOC   CODE        LINE


01023  E965              NEWLIN
01024  E965  A6 D6              LDX TBLX
01025  E967  E8          BMT1   INX
01026  E968              ; CPX #NLINES ;EXCEDED THE NUMBER OF LINES ???
01027  E968              ; BEQ BMT2 ;VIC-40 CODE
01028  E968  B5 D9              LDA LDTB1,X     ;FIND LAST DISPLAY LINE OF THIS LINE
01029  E96A  10 FB              BPL BMT1        ;TABLE END MARK=>$FF WILL ABORT...ALSO
01030  E96C  8E A5 02    BMT2   STX LINTMP      ;FOUND IT
01031  E96F              ;GENERATE A NEW LINE
01032  E96F  E0 18              CPX #NLINES-1   ;IS ONE LINE FROM BOTTOM?
01033  E971  F0 0E              BEQ NEWLX       ;YES...JUST CLEAR LAST
01034  E973  90 0C              BCC NEWLX       ;<NLINES...INSERT LINE
01035  E975  20 EA E8           JSR SCROL       ;SCROLL EVERYTHING
01036  E978  AE A5 02           LDX LINTMP
01037  E97B  CA                 DEX
01038  E97C  C6 D6              DEC TBLX
01039  E97E  4C DA E6           JMP WLOG30
01040  E981  A5 AC       NEWLX  LDA SAL
01041  E983  48                 PHA
01042  E984  A5 AD              LDA SAH
01043  E986  48                 PHA
01044  E987  A5 AE              LDA EAL
01045  E989  48                 PHA
01046  E98A  A5 AF              LDA EAH
01047  E98C  48                 PHA
01048  E98D  A2 19              LDX #NLINES
01049  E98F  CA          SCD10  DEX
01050  E990  20 F0 E9           JSR SETPNT      ;SET UP TO ADDR
01051  E993  EC A5 02           CPX LINTMP
01052  E996  90 0E              BCC SCR40
01053  E998  F0 0C              BEQ SCR40       ;BRANCH IF FINISHED
01054  E99A  BD EF EC           LDA LDTB2-1,X   ;SET FROM ADDR
01055  E99D  85 AC              STA SAL
01056  E99F  B5 D8              LDA LDTB1-1,X
01057  E9A1  20 C8 E9           JSR SCRLIN      ;SCROLL THIS LINE DOWN
01058  E9A4  30 E9              BMI SCD10
01059  E9A6              SCR40
01060  E9A6  20 FF E9           JSR CLRLN
01061  E9A9  A2 17              LDX #NLINES-2
01062  E9AB              SCRD21
01063  E9AB  EC A5 02           CPX LINTMP      ;DONE?
01064  E9AE  90 0F              BCC SCRD22      ;BRANCH IF SO
01065  E9B0  B5 DA              LDA LDTB1+1,X
01066  E9B2  29 7F              AND #$7F
01067  E9B4  B4 D9              LDY LDTB1,X     ;WAS IT CONTINUED
01068  E9B6  10 02              BPL SCRD19      ;BRANCH IF SO
01069  E9B8  09 80              ORA #$80
01070  E9BA  95 DA       SCRD19 STA LDTB1+1,X
01071  E9BC  CA                 DEX
01072  E9BD  D0 EC              BNE SCRD21
01073  E9BF              SCRD22
01074  E9BF  AE A5 02           LDX LINTMP
01075  E9C2  20 DA E6           JSR WLOG30
01076  E9C5              ;
01077  E9C5  4C 58 E9           JMP PULIND      ;GO PUL OLD INDIRECTS AND RETURN






EDITOR.2......PAGE 0019

LINE# LOC   CODE        LINE


01078  E9C8              ;
01079  E9C8              ; SCROLL LINE FROM SAL TO PNT
01080  E9C8              ; AND COLORS FROM EAL TO USER
01081  E9C8              ;
01082  E9C8              SCRLIN
01083  E9C8  29 03              AND #$03        ;CLEAR ANY GARBAGE STUFF
01084  E9CA  0D 88 02           ORA HIBASE      ;PUT IN HIORDER BITS
01085  E9CD  85 AD              STA SAL+1
01086  E9CF  20 E0 E9           JSR TOFROM      ;COLOR TO & FROM ADDRS
01087  E9D2  A0 27              LDY #LLEN-1
01088  E9D4              SCD20
01089  E9D4  B1 AC              LDA (SAL)Y
01090  E9D6  91 D1              STA (PNT)Y
01091  E9D8  B1 AE              LDA (EAL)Y
01092  E9DA  91 F3              STA (USER)Y
01093  E9DC  88                 DEY
01094  E9DD  10 F5              BPL SCD20
01095  E9DF  60                 RTS
01096  E9E0              ;
01097  E9E0              ; DO COLOR TO AND FROM ADDRESSES
01098  E9E0              ; FROM CHARACTER TO AND FROM ADRS
01099  E9E0              ;
01100  E9E0              TOFROM
01101  E9E0  20 24 EA           JSR SCOLOR
01102  E9E3  A5 AC              LDA SAL         ;CHARACTER FROM
01103  E9E5  85 AE              STA EAL         ;MAKE COLOR FROM
01104  E9E7  A5 AD              LDA SAL+1
01105  E9E9  29 03              AND #$03
01106  E9EB  09 D8              ORA #>VICCOL
01107  E9ED  85 AF              STA EAL+1
01108  E9EF  60                 RTS
01109  E9F0              ;
01110  E9F0              ; SET UP PNT AND Y
01111  E9F0              ; FROM .X
01112  E9F0              ;
01113  E9F0  BD F0 EC    SETPNT LDA LDTB2,X
01114  E9F3  85 D1              STA PNT
01115  E9F5  B5 D9              LDA LDTB1,X
01116  E9F7  29 03              AND #$03
01117  E9F9  0D 88 02           ORA HIBASE
01118  E9FC  85 D2              STA PNT+1
01119  E9FE  60                 RTS
01120  E9FF              ;
01121  E9FF              ; CLEAR THE LINE POINTED TO BY .X
01122  E9FF              ;
01123  E9FF  A0 27       CLRLN  LDY #LLEN-1
01124  EA01  20 F0 E9           JSR SETPNT
01125  EA04  20 24 EA           JSR SCOLOR
01126  EA07  A9 20       CLR10  LDA #$20
01127  EA09  91 D1              STA (PNT)Y
01128  EA0B  20 DA E4           JSR CPATCH      ;DO THE COLOR (IN BACKGROUND)
01129  EA0E  EA                 NOP             ;FILL
01130  EA0F  88                 DEY
01131  EA10  10 F5              BPL CLR10
01132  EA12  60                 RTS






EDITOR.2......PAGE 001A

LINE# LOC   CODE        LINE


01134  EA13              ;
01135  EA13              ;PUT A CHAR ON THE SCREEN
01136  EA13              ;
01137  EA13  A8          DSPP   TAY             ;SAVE CHAR
01138  EA14  A9 02              LDA #2
01139  EA16  85 CD              STA BLNCT       ;BLINK CURSOR
01140  EA18  20 24 EA           JSR SCOLOR      ;SET COLOR PTR
01141  EA1B  98                 TYA             ;RESTORE COLOR
01142  EA1C  A4 D3       DSPP2  LDY PNTR        ;GET COLUMN
01143  EA1E  91 D1              STA (PNT)Y      ;CHAR TO SCREEN
01144  EA20  8A                 TXA
01145  EA21  91 F3              STA (USER)Y     ;COLOR TO SCREEN
01146  EA23  60                 RTS





01148  EA24  A5 D1       SCOLOR LDA PNT         ;GENERATE COLOR PTR
01149  EA26  85 F3              STA USER
01150  EA28  A5 D2              LDA PNT+1
01151  EA2A  29 03              AND #$03
01152  EA2C  09 D8              ORA #>VICCOL    ;VIC COLOR RAM
01153  EA2E  85 F4              STA USER+1
01154  EA30  60                 RTS




































EDITOR.2......PAGE 001B

LINE# LOC   CODE        LINE


01156  EA31  20 EA FF    KEY    JSR $FFEA       ;UPDATE JIFFY CLOCK
01157  EA34  A5 CC              LDA BLNSW       ;BLINKING CRSR ?
01158  EA36  D0 29              BNE KEY4        ;NO
01159  EA38  C6 CD              DEC BLNCT       ;TIME TO BLINK ?
01160  EA3A  D0 25              BNE KEY4        ;NO
01161  EA3C  A9 14              LDA #20         ;RESET BLINK COUNTER
01162  EA3E  85 CD       REPDO  STA BLNCT
01163  EA40  A4 D3              LDY PNTR        ;CURSOR POSITION
01164  EA42  46 CF              LSR BLNON       ;CARRY SET IF ORIGINAL CHAR
01165  EA44  AE 87 02           LDX GDCOL       ;GET CHAR ORIGINAL COLOR
01166  EA47  B1 D1              LDA (PNT)Y      ;GET CHARACTER
01167  EA49  B0 11              BCS KEY5        ;BRANCH IF NOT NEEDED
01168  EA4B              ;
01169  EA4B  E6 CF              INC BLNON       ;SET TO 1
01170  EA4D  85 CE              STA GDBLN       ;SAVE ORIGINAL CHAR
01171  EA4F  20 24 EA           JSR SCOLOR
01172  EA52  B1 F3              LDA (USER)Y     ;GET ORIGINAL COLOR
01173  EA54  8D 87 02           STA GDCOL       ;SAVE IT
01174  EA57  AE 86 02           LDX COLOR       ;BLINK IN THIS COLOR
01175  EA5A  A5 CE              LDA GDBLN       ;WITH ORIGINAL CHARACTER
01176  EA5C              ;
01177  EA5C  49 80       KEY5   EOR #$80        ;BLINK IT
01178  EA5E  20 1C EA           JSR DSPP2       ;DISPLAY IT
01179  EA61              ;
01180  EA61  A5 01       KEY4   LDA R6510       ;GET CASSETTE SWITCHES
01181  EA63  29 10              AND #$10        ;IS SWITCH DOWN ?
01182  EA65  F0 0A              BEQ KEY3        ;BRANCH IF SO
01183  EA67              ;
01184  EA67  A0 00              LDY #0
01185  EA69  84 C0              STY CAS1        ;CASSETTE OFF SWITCH
01186  EA6B              ;
01187  EA6B  A5 01              LDA R6510
01188  EA6D  09 20              ORA #$20
01189  EA6F  D0 08              BNE KL24        ;BRANCH IF MOTOR IS OFF
01190  EA71              ;
01191  EA71  A5 C0       KEY3   LDA CAS1
01192  EA73  D0 06              BNE KL2
01193  EA75              ;
01194  EA75  A5 01              LDA R6510
01195  EA77  29 1F              AND #%011111    ;TURN MOTOR ON
01196  EA79              ;
01197  EA79              KL24
01198  EA79  85 01              STA R6510
01199  EA7B              ;
01200  EA7B  20 87 EA    KL2    JSR SCNKEY      ;SCAN KEYBOARD
01201  EA7E              ;
01202  EA7E  AD 0D DC    KPREND LDA D1ICR       ;CLEAR INTERUPT FLAGS
01203  EA81  68                 PLA             ;RESTORE REGISTERS
01204  EA82  A8                 TAY
01205  EA83  68                 PLA
01206  EA84  AA                 TAX
01207  EA85  68                 PLA
01208  EA86  40                 RTI             ;EXIT FROM IRQ ROUTINES








EDITOR.2......PAGE 001C

LINE# LOC   CODE        LINE


01210  EA87              ; ****** GENERAL KEYBOARD SCAN ******
01211  EA87              ;
01212  EA87  A9 00       SCNKEY LDA #$00
01213  EA89  8D 8D 02           STA SHFLAG
01214  EA8C  A0 40              LDY #64         ;LAST KEY INDEX
01215  EA8E  84 CB              STY SFDX        ;NULL KEY FOUND
01216  EA90  8D 00 DC           STA COLM        ;RAISE ALL LINES
01217  EA93  AE 01 DC           LDX ROWS        ;CHECK FOR A KEY DOWN
01218  EA96  E0 FF              CPX #$FF        ;NO KEYS DOWN?
01219  EA98  F0 61              BEQ SCNOUT      ;BRANCH IF NONE
01220  EA9A  A8                 TAY             ;.A=0 LDY #0
01221  EA9B  A9 81              LDA #<MODE1
01222  EA9D  85 F5              STA KEYTAB
01223  EA9F  A9 EB              LDA #>MODE1
01224  EAA1  85 F6              STA KEYTAB+1
01225  EAA3  A9 FE              LDA #$FE        ;START WITH 1ST COLUMN
01226  EAA5  8D 00 DC           STA COLM
01227  EAA8  A2 08       SCN20  LDX #8          ;8 ROW KEYBOARD
01228  EAAA  48                 PHA             ;SAVE COLUMN OUTPUT INFO
01229  EAAB  AD 01 DC    SCN22  LDA ROWS
01230  EAAE  CD 01 DC           CMP ROWS        ;DEBOUNCE KEYBOARD
01231  EAB1  D0 F8              BNE SCN22
01232  EAB3  4A          SCN30  LSR A           ;LOOK FOR KEY DOWN
01233  EAB4  B0 16              BCS CKIT        ;NONE
01234  EAB6  48                 PHA
01235  EAB7  B1 F5              LDA (KEYTAB),Y  ;GET CHAR CODE
01236  EAB9  C9 05              CMP #$05
01237  EABB  B0 0C              BCS SPCK2       ;IF NOT SPECIAL KEY GO ON
01238  EABD  C9 03              CMP #$03        ;COULD IT BE A STOP KEY?
01239  EABF  F0 08              BEQ SPCK2       ;BRANCH IF SO
01240  EAC1  0D 8D 02           ORA SHFLAG
01241  EAC4  8D 8D 02           STA SHFLAG      ;PUT SHIFT BIT IN FLAG BYTE
01242  EAC7  10 02              BPL CKUT
01243  EAC9              SPCK2
01244  EAC9  84 CB              STY SFDX        ;SAVE KEY NUMBER
01245  EACB  68          CKUT   PLA
01246  EACC  C8          CKIT   INY
01247  EACD  C0 41              CPY #65
01248  EACF  B0 0B              BCS CKIT1       ;BRANCH IF FINISHED
01249  EAD1  CA                 DEX
01250  EAD2  D0 DF              BNE SCN30
01251  EAD4  38                 SEC
01252  EAD5  68                 PLA             ;RELOAD COLUMN INFO
01253  EAD6  2A                 ROL A
01254  EAD7  8D 00 DC           STA COLM        ;NEXT COLUMN ON KEYBOARD
01255  EADA  D0 CC              BNE SCN20       ;ALWAYS BRANCH
01256  EADC  68          CKIT1  PLA             ;DUMP COLUMN OUTPUT...ALL DONE
01257  EADD  6C 8F 02           JMP (KEYLOG)    ;EVALUATE SHIFT FUNCTIONS
01258  EAE0  A4 CB       REKEY  LDY SFDX        ;GET KEY INDEX
01259  EAE2  B1 F5              LDA (KEYTAB)Y   ;GET CHAR CODE
01260  EAE4  AA                 TAX             ;SAVE THE CHAR
01261  EAE5  C4 C5              CPY LSTX        ;SAME AS PREV CHAR INDEX?
01262  EAE7  F0 07              BEQ RPT10       ;YES
01263  EAE9  A0 10              LDY #$10        ;NO - RESET DELAY BEFORE REPEAT
01264  EAEB  8C 8C 02           STY DELAY






EDITOR.2......PAGE 001D

LINE# LOC   CODE        LINE


01265  EAEE  D0 36              BNE CKIT2       ;ALWAYS
01266  EAF0  29 7F       RPT10  AND #$7F        ;UNSHIFT IT
01267  EAF2  2C 8A 02           BIT RPTFLG      ;CHECK FOR REPEAT DISABLE
01268  EAF5  30 16              BMI RPT20       ;YES
01269  EAF7  70 49              BVS SCNRTS
01270  EAF9  C9 7F              CMP #$7F        ;NO KEYS ?
01271  EAFB  F0 29       SCNOUT BEQ CKIT2       ;YES - GET OUT
01272  EAFD  C9 14              CMP #$14        ;AN INST/DEL KEY ?
01273  EAFF  F0 0C              BEQ RPT20       ;YES - REPEAT IT
01274  EB01  C9 20              CMP #$20        ;A SPACE KEY ?
01275  EB03  F0 08              BEQ RPT20       ;YES
01276  EB05  C9 1D              CMP #$1D        ;A CRSR LEFT/RIGHT ?
01277  EB07  F0 04              BEQ RPT20       ;YES
01278  EB09  C9 11              CMP #$11        ;A CRSR UP/DWN ?
01279  EB0B  D0 35              BNE SCNRTS      ;NO - EXIT
01280  EB0D  AC 8C 02    RPT20  LDY DELAY       ;TIME TO REPEAT ?
01281  EB10  F0 05              BEQ RPT40       ;YES
01282  EB12  CE 8C 02           DEC DELAY
01283  EB15  D0 2B              BNE SCNRTS
01284  EB17  CE 8B 02    RPT40  DEC KOUNT       ;TIME FOR NEXT REPEAT ?
01285  EB1A  D0 26              BNE SCNRTS      ;NO
01286  EB1C  A0 04              LDY #4          ;YES - RESET CTR
01287  EB1E  8C 8B 02           STY KOUNT
01288  EB21  A4 C6              LDY NDX         ;NO REPEAT IF QUEUE FULL
01289  EB23  88                 DEY
01290  EB24  10 1C              BPL SCNRTS
01291  EB26              CKIT2
01292  EB26  A4 CB              LDY SFDX        ;GET INDEX OF KEY
01293  EB28  84 C5              STY LSTX        ;SAVE THIS INDEX TO KEY FOUND
01294  EB2A  AC 8D 02           LDY SHFLAG      ;UPDATE SHIFT STATUS
01295  EB2D  8C 8E 02           STY LSTSHF
01296  EB30  E0 FF       CKIT3  CPX #$FF        ;A NULL KEY OR NO KEY ?
01297  EB32  F0 0E              BEQ SCNRTS      ;BRANCH IF SO
01298  EB34  8A                 TXA             ;NEED X AS INDEX SO...
01299  EB35  A6 C6              LDX NDX         ;GET # OF CHARS IN KEY QUEUE
01300  EB37  EC 89 02           CPX XMAX        ;IRQ BUFFER FULL ?
01301  EB3A  B0 06              BCS SCNRTS      ;YES - NO MORE INSERT
01302  EB3C              PUTQUE
01303  EB3C  9D 77 02           STA KEYD,X      ;PUT RAW DATA HERE
01304  EB3F  E8                 INX
01305  EB40  86 C6              STX NDX         ;UPDATE KEY QUEUE COUNT
01306  EB42  A9 7F       SCNRTS LDA #$7F        ;SETUP PB7 FOR STOP KEY SENSE
01307  EB44  8D 00 DC           STA COLM
01308  EB47  60                 RTS

















EDITOR.2......PAGE 001E

LINE# LOC   CODE        LINE


01310  EB48              ;
01311  EB48              ; SHIFT LOGIC
01312  EB48              ;
01313  EB48              SHFLOG
01314  EB48  AD 8D 02           LDA SHFLAG
01315  EB4B  C9 03              CMP #$03        ;COMMODORE SHIFT COMBINATION?
01316  EB4D  D0 15              BNE KEYLG2      ;BRANCH IF NOT
01317  EB4F  CD 8E 02           CMP LSTSHF      ;DID I DO THIS ALREADY
01318  EB52  F0 EE              BEQ SCNRTS      ;BRANCH IF SO
01319  EB54  AD 91 02           LDA MODE
01320  EB57  30 1D              BMI SHFOUT      ;DONT SHIFT IF ITS MINUS

01322  EB59  AD 18 D0    SWITCH LDA VICREG+24   ;**********************************:
01323  EB5C  49 02              EOR #$02        ;TURN ON OTHER CASE
01324  EB5E  8D 18 D0           STA VICREG+24   ;POINT THE VIC THERE
01325  EB61  4C 76 EB           JMP SHFOUT

01327  EB64              ;
01328  EB64              KEYLG2
01329  EB64  0A                 ASL A
01330  EB65  C9 08              CMP #$08        ;WAS IT A CONTROL KEY
01331  EB67  90 02              BCC NCTRL       ;BRANCH IF NOT
01332  EB69  A9 06              LDA #6          ;ELSE USE TABLE #4
01333  EB6B              ;
01334  EB6B              NCTRL
01335  EB6B              NOTKAT
01336  EB6B  AA                 TAX
01337  EB6C  BD 79 EB           LDA KEYCOD,X
01338  EB6F  85 F5              STA KEYTAB
01339  EB71  BD 7A EB           LDA KEYCOD+1,X
01340  EB74  85 F6              STA KEYTAB+1
01341  EB76              SHFOUT
01342  EB76  4C E0 EA           JMP REKEY
01343  EB79              .END
01344  EB79              .LIB   EDITOR.3


























KEYBOARD TABLES......PAGE 001F

LINE# LOC   CODE        LINE


01346  EB79              KEYCOD                 ;KEYBOARD MODE 'DISPATCH'
01347  EB79  81 EB              .WORD MODE1
01348  EB7B  C2 EB              .WORD MODE2
01349  EB7D  03 EC              .WORD MODE3
01350  EB7F  78 EC              .WORD CONTRL    ;CONTROL KEYS
01351  EB81              ;
01352  EB81              ; COTTACONNA MODE
01353  EB81              ;
01354  EB81              ;.WORD MODE1  ;PET MODE1
01355  EB81              ;.WORD MODE2  ;PET MODE2
01356  EB81              ;.WORD CCTTA3 ;DUMMY WORD
01357  EB81              ;.WORD CONTRL
01358  EB81              ;
01359  EB81              ; EXTENDED KATAKANA MODE
01360  EB81              ;
01361  EB81              ;.WORD CCTTA2 ;KATAKANA CHARACTERS
01362  EB81              ;.WORD CCTTA3 ;LIMITED GRAPHICS
01363  EB81              ;.WORD CCTTA3 ;DUMMY
01364  EB81              ;.WORD CONTRL










































EDITOR.3......PAGE 0020

LINE# LOC   CODE        LINE


01367  EB81              MODE1
01368  EB81              ;DEL,3,5,7,9,+,YEN SIGN,1
01369  EB81  14                 .BYT $14,$0D,$1D,$88,$85,$86,$87,$11
01369  EB82  0D 
01369  EB83  1D 
01369  EB84  88 
01369  EB85  85 
01369  EB86  86 
01369  EB87  87 
01369  EB88  11 
01370  EB89              ;RETURN,W,R,Y,I,P,*,LEFT ARROW
01371  EB89  33                 .BYT $33,$57,$41,$34,$5A,$53,$45,$01
01371  EB8A  57 
01371  EB8B  41 
01371  EB8C  34 
01371  EB8D  5A 
01371  EB8E  53 
01371  EB8F  45 
01371  EB90  01 
01372  EB91              ;RT CRSR,A,D,G,J,L,;,CTRL
01373  EB91  35                 .BYT $35,$52,$44,$36,$43,$46,$54,$58
01373  EB92  52 
01373  EB93  44 
01373  EB94  36 
01373  EB95  43 
01373  EB96  46 
01373  EB97  54 
01373  EB98  58 
01374  EB99              ;F4,4,6,8,0,-,HOME,2
01375  EB99  37                 .BYT $37,$59,$47,$38,$42,$48,$55,$56
01375  EB9A  59 
01375  EB9B  47 
01375  EB9C  38 
01375  EB9D  42 
01375  EB9E  48 
01375  EB9F  55 
01375  EBA0  56 
01376  EBA1              ;F1,Z,C,B,M,.,R.SHIFTT,SPACE
01377  EBA1  39                 .BYT $39,$49,$4A,$30,$4D,$4B,$4F,$4E
01377  EBA2  49 
01377  EBA3  4A 
01377  EBA4  30 
01377  EBA5  4D 
01377  EBA6  4B 
01377  EBA7  4F 
01377  EBA8  4E 
01378  EBA9              ;F2,S,F,H,K,:,=,COM.KEY
01379  EBA9  2B                 .BYT $2B,$50,$4C,$2D,$2E,$3A,$40,$2C
01379  EBAA  50 
01379  EBAB  4C 
01379  EBAC  2D 
01379  EBAD  2E 
01379  EBAE  3A 
01379  EBAF  40 
01379  EBB0  2C 






EDITOR.3......PAGE 0021

LINE# LOC   CODE        LINE


01380  EBB1              ;F3,E,T,U,O,@,EXP,Q
01381  EBB1  5C                 .BYT $5C,$2A,$3B,$13,$01,$3D,$5E,$2F
01381  EBB2  2A 
01381  EBB3  3B 
01381  EBB4  13 
01381  EBB5  01 
01381  EBB6  3D 
01381  EBB7  5E 
01381  EBB8  2F 
01382  EBB9              ;CRSR DWN,L.SHIFT,X,V,N,,,/,STOP
01383  EBB9  31                 .BYT $31,$5F,$04,$32,$20,$02,$51,$03
01383  EBBA  5F 
01383  EBBB  04 
01383  EBBC  32 
01383  EBBD  20 
01383  EBBE  02 
01383  EBBF  51 
01383  EBC0  03 
01384  EBC1  FF                 .BYT $FF        ;END OF TABLE NULL

01386  EBC2              MODE2                  ;SHIFT
01387  EBC2              ;INS,%,',),+,YEN,!
01388  EBC2  94                 .BYT $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01388  EBC3  8D 
01388  EBC4  9D 
01388  EBC5  8C 
01388  EBC6  89 
01388  EBC7  8A 
01388  EBC8  8B 
01388  EBC9  91 
01389  EBCA              ;SRETURN,W,R,Y,I,P,*,SLEFT ARROW
01390  EBCA  23                 .BYT $23,$D7,$C1,$24,$DA,$D3,$C5,$01
01390  EBCB  D7 
01390  EBCC  C1 
01390  EBCD  24 
01390  EBCE  DA 
01390  EBCF  D3 
01390  EBD0  C5 
01390  EBD1  01 
01391  EBD2              ;LF.CRSR,A,D,G,J,L,;,CTRL
01392  EBD2  25                 .BYT $25,$D2,$C4,$26,$C3,$C6,$D4,$D8
01392  EBD3  D2 
01392  EBD4  C4 
01392  EBD5  26 
01392  EBD6  C3 
01392  EBD7  C6 
01392  EBD8  D4 
01392  EBD9  D8 
01393  EBDA              ;,$,&,(,      ,"
01394  EBDA  27                 .BYT $27,$D9,$C7,$28,$C2,$C8,$D5,$D6
01394  EBDB  D9 
01394  EBDC  C7 
01394  EBDD  28 
01394  EBDE  C2 
01394  EBDF  C8 






EDITOR.3......PAGE 0022

LINE# LOC   CODE        LINE


01394  EBE0  D5 
01394  EBE1  D6 
01395  EBE2              ;F5,Z,C,B,M,.,R.SHIFT,SSPACE
01396  EBE2  29                 .BYT $29,$C9,$CA,$30,$CD,$CB,$CF,$CE
01396  EBE3  C9 
01396  EBE4  CA 
01396  EBE5  30 
01396  EBE6  CD 
01396  EBE7  CB 
01396  EBE8  CF 
01396  EBE9  CE 
01397  EBEA              ;F6,S,F,H,K,:,=,SCOM.KEY
01398  EBEA  DB                 .BYT $DB,$D0,$CC,$DD,$3E,$5B,$BA,$3C
01398  EBEB  D0 
01398  EBEC  CC 
01398  EBED  DD 
01398  EBEE  3E 
01398  EBEF  5B 
01398  EBF0  BA 
01398  EBF1  3C 
01399  EBF2              ;F7,E,T,U,O,@,PI,G
01400  EBF2  A9                 .BYT $A9,$C0,$5D,$93,$01,$3D,$DE,$3F
01400  EBF3  C0 
01400  EBF4  5D 
01400  EBF5  93 
01400  EBF6  01 
01400  EBF7  3D 
01400  EBF8  DE 
01400  EBF9  3F 
01401  EBFA              ;CRSR DWN,L.SHIFT,X,V,N,,,/,RUN
01402  EBFA  21                 .BYT $21,$5F,$04,$22,$A0,$02,$D1,$83
01402  EBFB  5F 
01402  EBFC  04 
01402  EBFD  22 
01402  EBFE  A0 
01402  EBFF  02 
01402  EC00  D1 
01402  EC01  83 
01403  EC02  FF                 .BYT $FF        ;END OF TABLE NULL
01404  EC03              ;
01405  EC03              MODE3                  ;LEFT WINDOW GRAHPICS
01406  EC03              ;INS,C10,C12,C14,9,+,POUND SIGN,C8
01407  EC03  94                 .BYT $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01407  EC04  8D 
01407  EC05  9D 
01407  EC06  8C 
01407  EC07  89 
01407  EC08  8A 
01407  EC09  8B 
01407  EC0A  91 
01408  EC0B              ;RETURN,W,R,Y,I,P,*,LFT.ARROW
01409  EC0B  96                 .BYT $96,$B3,$B0,$97,$AD,$AE,$B1,$01
01409  EC0C  B3 
01409  EC0D  B0 
01409  EC0E  97 






EDITOR.3......PAGE 0023

LINE# LOC   CODE        LINE


01409  EC0F  AD 
01409  EC10  AE 
01409  EC11  B1 
01409  EC12  01 
01410  EC13              ;LF.CRSR,A,D,G,J,L,;,CTRL
01411  EC13  98                 .BYT $98,$B2,$AC,$99,$BC,$BB,$A3,$BD
01411  EC14  B2 
01411  EC15  AC 
01411  EC16  99 
01411  EC17  BC 
01411  EC18  BB 
01411  EC19  A3 
01411  EC1A  BD 
01412  EC1B              ;F8,C11,C13,C15,0,-,HOME,C9
01413  EC1B  9A                 .BYT $9A,$B7,$A5,$9B,$BF,$B4,$B8,$BE
01413  EC1C  B7 
01413  EC1D  A5 
01413  EC1E  9B 
01413  EC1F  BF 
01413  EC20  B4 
01413  EC21  B8 
01413  EC22  BE 
01414  EC23              ;F2,Z,C,B,M,.,R.SHIFT,SPACE
01415  EC23  29                 .BYT $29,$A2,$B5,$30,$A7,$A1,$B9,$AA
01415  EC24  A2 
01415  EC25  B5 
01415  EC26  30 
01415  EC27  A7 
01415  EC28  A1 
01415  EC29  B9 
01415  EC2A  AA 
01416  EC2B              ;F4,S,F,H,K,:,=,COM.KEY
01417  EC2B  A6                 .BYT $A6,$AF,$B6,$DC,$3E,$5B,$A4,$3C
01417  EC2C  AF 
01417  EC2D  B6 
01417  EC2E  DC 
01417  EC2F  3E 
01417  EC30  5B 
01417  EC31  A4 
01417  EC32  3C 
01418  EC33              ;F6,E,T,U,O,@,PI,Q
01419  EC33  A8                 .BYT $A8,$DF,$5D,$93,$01,$3D,$DE,$3F
01419  EC34  DF 
01419  EC35  5D 
01419  EC36  93 
01419  EC37  01 
01419  EC38  3D 
01419  EC39  DE 
01419  EC3A  3F 
01420  EC3B              ;CRSR.UP,L.SHIFT,X,V,N,,,/,STOP
01421  EC3B  81                 .BYT $81,$5F,$04,$95,$A0,$02,$AB,$83
01421  EC3C  5F 
01421  EC3D  04 
01421  EC3E  95 
01421  EC3F  A0 






EDITOR.3......PAGE 0024

LINE# LOC   CODE        LINE


01421  EC40  02 
01421  EC41  AB 
01421  EC42  83 
01422  EC43  FF                 .BYT $FF        ;END OF TABLE NULL
01423  EC44              ;CCTTA2 ;WAS CCTTA2 IN JAPANESE VERSION
01424  EC44              LOWER
01425  EC44  C9 0E              CMP #$0E        ;DOES HE WANT LOWER CASE?
01426  EC46  D0 07              BNE UPPER       ;BRANCH IF NOT
01427  EC48  AD 18 D0           LDA VICREG+24   ;ELSE SET VIC TO POINT TO LOWER CASE
01428  EC4B  09 02              ORA #$02
01429  EC4D  D0 09              BNE ULSET       ;JMP

01431  EC4F              UPPER
01432  EC4F  C9 8E              CMP #$8E        ;DOES HE WANT UPPER CASE
01433  EC51  D0 0B              BNE LOCK        ;BRANCH IF NOT
01434  EC53  AD 18 D0           LDA VICREG+24   ;MAKE SURE VIC POINT TO UPPER/PET SET
01435  EC56  29 FD              AND #$FF-$02
01436  EC58  8D 18 D0    ULSET  STA VICREG+24
01437  EC5B  4C A8 E6    OUTHRE JMP LOOP2

01439  EC5E              LOCK
01440  EC5E  C9 08              CMP #8          ;DOES HE WANT TO LOCK IN THIS MODE?
01441  EC60  D0 07              BNE UNLOCK      ;BRANCH IF NOT
01442  EC62  A9 80              LDA #$80        ;ELSE SET LOCK SWITCH ON
01443  EC64  0D 91 02           ORA MODE        ;DON'T HURT ANYTHING - JUST IN CASE
01444  EC67  30 09              BMI LEXIT

01446  EC69              UNLOCK
01447  EC69  C9 09              CMP #9          ;DOES HE WANT TO UNLOCK THE KEYBOARD?
01448  EC6B  D0 EE              BNE OUTHRE      ;BRANCH IF NOT
01449  EC6D  A9 7F              LDA #$7F        ;CLEAR THE LOCK SWITCH
01450  EC6F  2D 91 02           AND MODE        ;DONT HURT ANYTHING
01451  EC72  8D 91 02    LEXIT  STA MODE
01452  EC75  4C A8 E6           JMP LOOP2       ;GET OUT
01453  EC78              ;CCTTA3
01454  EC78              ;.BYT $04,$FF,$FF,$FF,$FF,$FF,$E2,$9D
01455  EC78              ;RUN-K24-K31
01456  EC78              ;.BYT $83,$01,$FF,$FF,$FF,$FF,$FF,$91
01457  EC78              ;K32-K39.F5
01458  EC78              ;.BYT $A0,$FF,$FF,$FF,$FF,$EE,$01,$89
01459  EC78              ;CO.KEY,K40-K47.F6
01460  EC78              ;.BYT $02,$FF,$FF,$FF,$FF,$E1,$FD,$8A
01461  EC78              ;K48-K55
01462  EC78              ;.BYT $FF,$FF,$FF,$FF,$FF,$B0,$E0,$8B
01463  EC78              ;K56-K63
01464  EC78              ;.BYT $F2,$F4,$F6,$FF,$F0,$ED,$93,$8C
01465  EC78              ;.BYT $FF ;END OF TABLE NULL

01467  EC78              CONTRL
01468  EC78              ;NULL,RED,PURPLE,BLUE,RVS ,NULL,NULL,BLACK
01469  EC78  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01469  EC79  FF 
01469  EC7A  FF 
01469  EC7B  FF 
01469  EC7C  FF 






EDITOR.3......PAGE 0025

LINE# LOC   CODE        LINE


01469  EC7D  FF 
01469  EC7E  FF 
01469  EC7F  FF 
01470  EC80              ;NULL, W  ,REVERSE, Y  , I  , P  ,NULL,MUSIC
01471  EC80  1C                 .BYT $1C,$17,$01,$9F,$1A,$13,$05,$FF
01471  EC81  17 
01471  EC82  01 
01471  EC83  9F 
01471  EC84  1A 
01471  EC85  13 
01471  EC86  05 
01471  EC87  FF 
01472  EC88  9C                 .BYT $9C,$12,$04,$1E,$03,$06,$14,$18
01472  EC89  12 
01472  EC8A  04 
01472  EC8B  1E 
01472  EC8C  03 
01472  EC8D  06 
01472  EC8E  14 
01472  EC8F  18 
01473  EC90              ;NULL,CYAN,GREEN,YELLOW,RVS OFF,NULL,NULL,WHITE
01474  EC90  1F                 .BYT $1F,$19,$07,$9E,$02,$08,$15,$16
01474  EC91  19 
01474  EC92  07 
01474  EC93  9E 
01474  EC94  02 
01474  EC95  08 
01474  EC96  15 
01474  EC97  16 
01475  EC98  12                 .BYT $12,$09,$0A,$92,$0D,$0B,$0F,$0E
01475  EC99  09 
01475  EC9A  0A 
01475  EC9B  92 
01475  EC9C  0D 
01475  EC9D  0B 
01475  EC9E  0F 
01475  EC9F  0E 
01476  ECA0  FF                 .BYT $FF,$10,$0C,$FF,$FF,$1B,$00,$FF
01476  ECA1  10 
01476  ECA2  0C 
01476  ECA3  FF 
01476  ECA4  FF 
01476  ECA5  1B 
01476  ECA6  00 
01476  ECA7  FF 
01477  ECA8  1C                 .BYT $1C,$FF,$1D,$FF,$FF,$1F,$1E,$FF
01477  ECA9  FF 
01477  ECAA  1D 
01477  ECAB  FF 
01477  ECAC  FF 
01477  ECAD  1F 
01477  ECAE  1E 
01477  ECAF  FF 
01478  ECB0  90                 .BYT $90,$06,$FF,$05,$FF,$FF,$11,$FF
01478  ECB1  06 






EDITOR.3......PAGE 0026

LINE# LOC   CODE        LINE


01478  ECB2  FF 
01478  ECB3  05 
01478  ECB4  FF 
01478  ECB5  FF 
01478  ECB6  11 
01478  ECB7  FF 
01479  ECB8  FF                 .BYT $FF        ;END OF TABLE NULL
01480  ECB9              TVIC
01481  ECB9  00                 .BYT 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ;SPRITES (0-16)
01481  ECBA  00 
01481  ECBB  00 
01481  ECBC  00 
01481  ECBD  00 
01481  ECBE  00 
01481  ECBF  00 
01481  ECC0  00 
01481  ECC1  00 
01481  ECC2  00 
01481  ECC3  00 
01481  ECC4  00 
01481  ECC5  00 
01481  ECC6  00 
01481  ECC7  00 
01481  ECC8  00 
01481  ECC9  00 
01482  ECCA  9B                 .BYT $9B,55,0,0,0,$08,0,$14,$0F,0,0,0,0,0,0 ;DATA (17-31) RC=311
01482  ECCB  37 
01482  ECCC  00 
01482  ECCD  00 
01482  ECCE  00 
01482  ECCF  08 
01482  ECD0  00 
01482  ECD1  14 
01482  ECD2  0F 
01482  ECD3  00 
01482  ECD4  00 
01482  ECD5  00 
01482  ECD6  00 
01482  ECD7  00 
01482  ECD8  00 
01483  ECD9  0E                 .BYT 14,6,1,2,3,4,0,1,2,3,4,5,6,7 ;32-46
01483  ECDA  06 
01483  ECDB  01 
01483  ECDC  02 
01483  ECDD  03 
01483  ECDE  04 
01483  ECDF  00 
01483  ECE0  01 
01483  ECE1  02 
01483  ECE2  03 
01483  ECE3  04 
01483  ECE4  05 
01483  ECE5  06 
01483  ECE6  07 
01484  ECE7              ;






EDITOR.3......PAGE 0027

LINE# LOC   CODE        LINE


01485  ECE7  4C 4F       RUNTB  .BYT 'LOAD',$D,'RUN',$D
01485  ECEB  0D 
01485  ECEC  52 55 4E 
01485  ECEF  0D 
01486  ECF0              ;
01487  ECF0              LINZ0  = VICSCN
01488  ECF0              LINZ1  = LINZ0+LLEN
01489  ECF0              LINZ2  = LINZ1+LLEN
01490  ECF0              LINZ3  = LINZ2+LLEN
01491  ECF0              LINZ4  = LINZ3+LLEN
01492  ECF0              LINZ5  = LINZ4+LLEN
01493  ECF0              LINZ6  = LINZ5+LLEN
01494  ECF0              LINZ7  = LINZ6+LLEN
01495  ECF0              LINZ8  = LINZ7+LLEN
01496  ECF0              LINZ9  = LINZ8+LLEN
01497  ECF0              LINZ10 = LINZ9+LLEN
01498  ECF0              LINZ11 = LINZ10+LLEN
01499  ECF0              LINZ12 = LINZ11+LLEN
01500  ECF0              LINZ13 = LINZ12+LLEN
01501  ECF0              LINZ14 = LINZ13+LLEN
01502  ECF0              LINZ15 = LINZ14+LLEN
01503  ECF0              LINZ16 = LINZ15+LLEN
01504  ECF0              LINZ17 = LINZ16+LLEN
01505  ECF0              LINZ18 = LINZ17+LLEN
01506  ECF0              LINZ19 = LINZ18+LLEN
01507  ECF0              LINZ20 = LINZ19+LLEN
01508  ECF0              LINZ21 = LINZ20+LLEN
01509  ECF0              LINZ22 = LINZ21+LLEN
01510  ECF0              LINZ23 = LINZ22+LLEN
01511  ECF0              LINZ24 = LINZ23+LLEN



01513  ECF0              ;****** SCREEN LINES LO BYTE TABLE ******
01514  ECF0              ;
01515  ECF0              LDTB2
01516  ECF0  00                 .BYTE <LINZ0
01517  ECF1  28                 .BYTE <LINZ1
01518  ECF2  50                 .BYTE <LINZ2
01519  ECF3  78                 .BYTE <LINZ3
01520  ECF4  A0                 .BYTE <LINZ4
01521  ECF5  C8                 .BYTE <LINZ5
01522  ECF6  F0                 .BYTE <LINZ6
01523  ECF7  18                 .BYTE <LINZ7
01524  ECF8  40                 .BYTE <LINZ8
01525  ECF9  68                 .BYTE <LINZ9
01526  ECFA  90                 .BYTE <LINZ10
01527  ECFB  B8                 .BYTE <LINZ11
01528  ECFC  E0                 .BYTE <LINZ12
01529  ECFD  08                 .BYTE <LINZ13
01530  ECFE  30                 .BYTE <LINZ14
01531  ECFF  58                 .BYTE <LINZ15
01532  ED00  80                 .BYTE <LINZ16
01533  ED01  A8                 .BYTE <LINZ17
01534  ED02  D0                 .BYTE <LINZ18






EDITOR.3......PAGE 0028

LINE# LOC   CODE        LINE


01535  ED03  F8                 .BYTE <LINZ19
01536  ED04  20                 .BYTE <LINZ20
01537  ED05  48                 .BYTE <LINZ21
01538  ED06  70                 .BYTE <LINZ22
01539  ED07  98                 .BYTE <LINZ23
01540  ED08  C0                 .BYTE <LINZ24
01541  ED09              .END
01542  ED09              .LIB   SERIAL4.0





















































SERIAL ROUTINES......PAGE 0029

LINE# LOC   CODE        LINE


01544  ED09              ;COMMAND SERIAL BUS DEVICE TO TALK
01545  ED09              ;
01546  ED09  09 40       TALK   ORA #$40        ;MAKE A TALK ADR
01547  ED0B  2C                 .BYT $2C        ;SKIP TWO BYTES



01549  ED0C              ;COMMAND SERIAL BUS DEVICE TO LISTEN
01550  ED0C              ;
01551  ED0C  09 20       LISTN  ORA #$20        ;MAKE A LISTEN ADR
01552  ED0E  20 A4 F0           JSR RSP232      ;PROTECT SELF FROM RS232 NMI'S
01553  ED11  48          LIST1  PHA
01554  ED12              ;
01555  ED12              ;
01556  ED12  24 94              BIT C3P0        ;CHARACTER LEFT IN BUF?
01557  ED14  10 0A              BPL LIST2       ;NO...
01558  ED16              ;
01559  ED16              ;SEND BUFFERED CHARACTER
01560  ED16              ;
01561  ED16  38                 SEC             ;SET EOI FLAG
01562  ED17  66 A3              ROR R2D2
01563  ED19              ;
01564  ED19  20 40 ED           JSR ISOUR       ;SEND LAST CHARACTER
01565  ED1C              ;
01566  ED1C  46 94              LSR C3P0        ;BUFFER CLEAR FLAG
01567  ED1E  46 A3              LSR R2D2        ;CLEAR EOI FLAG
01568  ED20              ;
01569  ED20              ;
01570  ED20  68          LIST2  PLA             ;TALK/LISTEN ADDRESS
01571  ED21  85 95              STA BSOUR
01572  ED23  78                 SEI
01573  ED24  20 97 EE           JSR DATAHI
01574  ED27  C9 3F              CMP #$3F        ;CLKHI ONLY ON UNLISTEN
01575  ED29  D0 03              BNE LIST5
01576  ED2B  20 85 EE           JSR CLKHI
01577  ED2E              ;
01578  ED2E  AD 00 DD    LIST5  LDA D2PRA       ;ASSERT ATTENTION
01579  ED31  09 08              ORA #$08
01580  ED33  8D 00 DD           STA D2PRA
01581  ED36              ;



01583  ED36  78          ISOURA SEI
01584  ED37  20 8E EE           JSR CLKLO       ;SET CLOCK LINE LOW
01585  ED3A  20 97 EE           JSR DATAHI
01586  ED3D  20 B3 EE           JSR W1MS        ;DELAY 1 MS



01588  ED40  78          ISOUR  SEI             ;NO IRQ'S ALLOWED
01589  ED41  20 97 EE           JSR DATAHI      ;MAKE SURE DATA IS RELEASED
01590  ED44  20 A9 EE           JSR DEBPIA      ;DATA SHOULD BE LOW
01591  ED47  B0 64              BCS NODEV
01592  ED49  20 85 EE           JSR CLKHI       ;CLOCK LINE HIGH






SERIAL ROUTINES......PAGE 002A

LINE# LOC   CODE        LINE


01593  ED4C  24 A3              BIT R2D2        ;EOI FLAG TEST
01594  ED4E  10 0A              BPL NOEOI
01595  ED50              ; DO THE EOI
01596  ED50  20 A9 EE    ISR02  JSR DEBPIA      ;WAIT FOR DATA TO GO HIGH
01597  ED53  90 FB              BCC ISR02
01598  ED55              ;
01599  ED55  20 A9 EE    ISR03  JSR DEBPIA      ;WAIT FOR DATA TO GO LOW
01600  ED58  B0 FB              BCS ISR03
01601  ED5A              ;
01602  ED5A  20 A9 EE    NOEOI  JSR DEBPIA      ;WAIT FOR DATA HIGH
01603  ED5D  90 FB              BCC NOEOI
01604  ED5F  20 8E EE           JSR CLKLO       ;SET CLOCK LOW
01605  ED62              ;
01606  ED62              ; SET TO SEND DATA
01607  ED62              ;
01608  ED62  A9 08              LDA #$08        ;COUNT 8 BITS
01609  ED64  85 A5              STA COUNT
01610  ED66              ;
01611  ED66              ISR01
01612  ED66  AD 00 DD           LDA D2PRA       ;DEBOUNCE THE BUS
01613  ED69  CD 00 DD           CMP D2PRA
01614  ED6C  D0 F8              BNE ISR01
01615  ED6E  0A                 ASL A           ;SET THE FLAGS
01616  ED6F  90 3F              BCC FRMERR      ;DATA MUST BE HI
01617  ED71              ;
01618  ED71  66 95              ROR BSOUR       ;NEXT BIT INTO CARRY
01619  ED73  B0 05              BCS ISRHI
01620  ED75  20 A0 EE           JSR DATALO
01621  ED78  D0 03              BNE ISRCLK
01622  ED7A  20 97 EE    ISRHI  JSR DATAHI
01623  ED7D  20 85 EE    ISRCLK JSR CLKHI       ;CLOCK HI
01624  ED80  EA                 NOP
01625  ED81  EA                 NOP
01626  ED82  EA                 NOP
01627  ED83  EA                 NOP
01628  ED84  AD 00 DD           LDA D2PRA
01629  ED87  29 DF              AND #$FF-$20    ;DATA HIGH
01630  ED89  09 10              ORA #$10        ;CLOCK LOW
01631  ED8B  8D 00 DD           STA D2PRA
01632  ED8E  C6 A5              DEC COUNT
01633  ED90  D0 D4              BNE ISR01
01634  ED92  A9 04              LDA #$04        ;SET TIMER FOR 1MS
01635  ED94  8D 07 DC           STA D1T2H
01636  ED97  A9 19              LDA #TIMRB      ;TRIGGER TIMER
01637  ED99  8D 0F DC           STA D1CRB
01638  ED9C  AD 0D DC           LDA D1ICR       ;CLEAR THE TIMER FLAGS<<<<<<<<<<<<<
01639  ED9F  AD 0D DC    ISR04  LDA D1ICR
01640  EDA2  29 02              AND #$02
01641  EDA4  D0 0A              BNE FRMERR
01642  EDA6  20 A9 EE           JSR DEBPIA
01643  EDA9  B0 F4              BCS ISR04
01644  EDAB  58                 CLI             ;LET IRQ'S CONTINUE
01645  EDAC  60                 RTS
01646  EDAD              ;
01647  EDAD              NODEV                  ;DEVICE NOT PRESENT ERROR






SERIAL ROUTINES......PAGE 002B

LINE# LOC   CODE        LINE


01648  EDAD  A9 80              LDA #$80
01649  EDAF  2C                 .BYT $2C
01650  EDB0              FRMERR                 ;FRAMING ERROR
01651  EDB0  A9 03              LDA #$03
01652  EDB2  20 1C FE    CSBERR JSR UDST        ;COMMODORE SERIAL BUSS ERROR ENTRY
01653  EDB5  58                 CLI             ;IRQ'S WERE OFF...TURN ON
01654  EDB6  18                 CLC             ;MAKE SURE NO KERNAL ERROR RETURNED
01655  EDB7  90 4A              BCC DLABYE      ;TURN ATN OFF ,RELEASE ALL LINES
01656  EDB9              ;



01658  EDB9              ;SEND SECONDARY ADDRESS AFTER LISTEN
01659  EDB9              ;
01660  EDB9  85 95       SECND  STA BSOUR       ;BUFFER CHARACTER
01661  EDBB  20 36 ED           JSR ISOURA      ;SEND IT



01663  EDBE              ;RELEASE ATTENTION AFTER LISTEN
01664  EDBE              ;
01665  EDBE  AD 00 DD    SCATN  LDA D2PRA
01666  EDC1  29 F7              AND #$FF-$08
01667  EDC3  8D 00 DD           STA D2PRA       ;RELEASE ATTENTION
01668  EDC6  60                 RTS



01670  EDC7              ;TALK SECOND ADDRESS
01671  EDC7              ;
01672  EDC7  85 95       TKSA   STA BSOUR       ;BUFFER CHARACTER
01673  EDC9  20 36 ED           JSR ISOURA      ;SEND SECOND ADDR



01675  EDCC              TKATN                  ;SHIFT OVER TO LISTENER
01676  EDCC  78                 SEI             ;NO IRQ'S HERE
01677  EDCD  20 A0 EE           JSR DATALO      ;DATA LINE LOW
01678  EDD0  20 BE ED           JSR SCATN
01679  EDD3  20 85 EE           JSR CLKHI       ;CLOCK LINE HIGH JSR/RTS
01680  EDD6  20 A9 EE    TKATN1 JSR DEBPIA      ;WAIT FOR CLOCK TO GO LOW
01681  EDD9  30 FB              BMI TKATN1
01682  EDDB  58                 CLI             ;IRQ'S OKAY NOW
01683  EDDC  60                 RTS



01685  EDDD              ;BUFFERED OUTPUT TO SERIAL BUS
01686  EDDD              ;
01687  EDDD  24 94       CIOUT  BIT C3P0        ;BUFFERED CHAR?
01688  EDDF  30 05              BMI CI2         ;YES...SEND LAST
01689  EDE1              ;
01690  EDE1  38                 SEC             ;NO...
01691  EDE2  66 94              ROR C3P0        ;SET BUFFERED CHAR FLAG
01692  EDE4  D0 05              BNE CI4         ;BRANCH ALWAYS






SERIAL ROUTINES......PAGE 002C

LINE# LOC   CODE        LINE


01693  EDE6              ;
01694  EDE6  48          CI2    PHA             ;SAVE CURRENT CHAR
01695  EDE7  20 40 ED           JSR ISOUR       ;SEND LAST CHAR
01696  EDEA  68                 PLA             ;RESTORE CURRENT CHAR
01697  EDEB  85 95       CI4    STA BSOUR       ;BUFFER CURRENT CHAR
01698  EDED  18                 CLC             ;CARRY-GOOD EXIT
01699  EDEE  60                 RTS



01701  EDEF              ;SEND UNTALK COMMAND ON SERIAL BUS
01702  EDEF              ;
01703  EDEF  78          UNTLK  SEI
01704  EDF0  20 8E EE           JSR CLKLO
01705  EDF3  AD 00 DD           LDA D2PRA       ;PULL ATN
01706  EDF6  09 08              ORA #$08
01707  EDF8  8D 00 DD           STA D2PRA
01708  EDFB  A9 5F              LDA #$5F        ;UNTALK COMMAND
01709  EDFD  2C                 .BYT $2C        ;SKIP TWO BYTES



01711  EDFE              ;SEND UNLISTEN COMMAND ON SERIAL BUS
01712  EDFE              ;
01713  EDFE  A9 3F       UNLSN  LDA #$3F        ;UNLISTEN COMMAND
01714  EE00  20 11 ED           JSR LIST1       ;SEND IT
01715  EE03              ;
01716  EE03              ; RELEASE ALL LINES
01717  EE03  20 BE ED    DLABYE JSR SCATN       ;ALWAYS RELEASE ATN
01718  EE06              ; DELAY THEN RELEASE CLOCK AND DATA
01719  EE06              ;
01720  EE06  8A          DLADLH TXA             ;DELAY APPROX 60 US
01721  EE07  A2 0A              LDX #10
01722  EE09  CA          DLAD00 DEX
01723  EE0A  D0 FD              BNE DLAD00
01724  EE0C  AA                 TAX
01725  EE0D  20 85 EE           JSR CLKHI
01726  EE10  4C 97 EE           JMP DATAHI



01728  EE13              ;INPUT A BYTE FROM SERIAL BUS
01729  EE13              ;
01730  EE13              ACPTR
01731  EE13  78                 SEI             ;NO IRQ ALLOWED
01732  EE14  A9 00              LDA #$00        ;SET EOI/ERROR FLAG
01733  EE16  85 A5              STA COUNT
01734  EE18  20 85 EE           JSR CLKHI       ;MAKE SURE CLOCK LINE IS RELEASED
01735  EE1B  20 A9 EE    ACP00A JSR DEBPIA      ;WAIT FOR CLOCK HIGH
01736  EE1E  10 FB              BPL ACP00A
01737  EE20              ;
01738  EE20              EOIACP
01739  EE20  A9 01              LDA #$01        ;SET TIMER 2 FOR 256US
01740  EE22  8D 07 DC           STA D1T2H
01741  EE25  A9 19              LDA #TIMRB






SERIAL ROUTINES......PAGE 002D

LINE# LOC   CODE        LINE


01742  EE27  8D 0F DC           STA D1CRB
01743  EE2A  20 97 EE           JSR DATAHI      ;DATA LINE HIGH (MAKES TIMMING MORE LIKE VIC-20
01744  EE2D  AD 0D DC           LDA D1ICR       ;CLEAR THE TIMER FLAGS<<<<<<<<<<<<
01745  EE30  AD 0D DC    ACP00  LDA D1ICR
01746  EE33  29 02              AND #$02        ;CHECK THE TIMER
01747  EE35  D0 07              BNE ACP00B      ;RAN OUT.....
01748  EE37  20 A9 EE           JSR DEBPIA      ;CHECK THE CLOCK LINE
01749  EE3A  30 F4              BMI ACP00       ;NO NOT YET
01750  EE3C  10 18              BPL ACP01       ;YES.....
01751  EE3E              ;
01752  EE3E  A5 A5       ACP00B LDA COUNT       ;CHECK FOR ERROR (TWICE THRU TIMEOUTS)
01753  EE40  F0 05              BEQ ACP00C
01754  EE42  A9 02              LDA #2
01755  EE44  4C B2 ED           JMP CSBERR      ; ST = 2 READ TIMEOUT
01756  EE47              ;
01757  EE47              ; TIMER RAN OUT DO AN EOI THING
01758  EE47              ;
01759  EE47  20 A0 EE    ACP00C JSR DATALO      ;DATA LINE LOW
01760  EE4A  20 85 EE           JSR CLKHI       ; DELAY AND THEN SET DATAHI (FIX FOR 40US C64)
01761  EE4D  A9 40              LDA #$40
01762  EE4F  20 1C FE           JSR UDST        ;OR AN EOI BIT INTO STATUS
01763  EE52  E6 A5              INC COUNT       ;GO AROUND AGAIN FOR ERROR CHECK ON EOI
01764  EE54  D0 CA              BNE EOIACP
01765  EE56              ;
01766  EE56              ; DO THE BYTE TRANSFER
01767  EE56              ;
01768  EE56  A9 08       ACP01  LDA #08         ;SET UP COUNTER
01769  EE58  85 A5              STA COUNT
01770  EE5A              ;
01771  EE5A  AD 00 DD    ACP03  LDA D2PRA       ;WAIT FOR CLOCK HIGH
01772  EE5D  CD 00 DD           CMP D2PRA       ;DEBOUNCE
01773  EE60  D0 F8              BNE ACP03
01774  EE62  0A                 ASL A           ;SHIFT DATA INTO CARRY
01775  EE63  10 F5              BPL ACP03       ;CLOCK STILL LOW...
01776  EE65  66 A4              ROR BSOUR1      ;ROTATE DATA IN
01777  EE67              ;
01778  EE67  AD 00 DD    ACP03A LDA D2PRA       ;WAIT FOR CLOCK LOW
01779  EE6A  CD 00 DD           CMP D2PRA       ;DEBOUNCE
01780  EE6D  D0 F8              BNE ACP03A
01781  EE6F  0A                 ASL A
01782  EE70  30 F5              BMI ACP03A
01783  EE72  C6 A5              DEC COUNT
01784  EE74  D0 E4              BNE ACP03       ;MORE BITS.....
01785  EE76              ;...EXIT...
01786  EE76  20 A0 EE           JSR DATALO      ;DATA LOW
01787  EE79  24 90              BIT STATUS      ;CHECK FOR EOI
01788  EE7B  50 03              BVC ACP04       ;NONE...
01789  EE7D              ;
01790  EE7D  20 06 EE           JSR DLADLH      ;DELAY THEN SET DATA HIGH
01791  EE80              ;
01792  EE80  A5 A4       ACP04  LDA BSOUR1
01793  EE82  58                 CLI             ;IRQ IS OK
01794  EE83  18                 CLC             ;GOOD EXIT
01795  EE84  60                 RTS
01796  EE85              ;






SERIAL ROUTINES......PAGE 002E

LINE# LOC   CODE        LINE


01797  EE85              CLKHI                  ;SET CLOCK LINE HIGH (INVERTED)
01798  EE85  AD 00 DD           LDA D2PRA
01799  EE88  29 EF              AND #$FF-$10
01800  EE8A  8D 00 DD           STA D2PRA
01801  EE8D  60                 RTS
01802  EE8E              ;
01803  EE8E              CLKLO                  ;SET CLOCK LINE LOW  (INVERTED)
01804  EE8E  AD 00 DD           LDA D2PRA
01805  EE91  09 10              ORA #$10
01806  EE93  8D 00 DD           STA D2PRA
01807  EE96  60                 RTS
01808  EE97              ;
01809  EE97              ;
01810  EE97              DATAHI                 ;SET DATA LINE HIGH (INVERTED)
01811  EE97  AD 00 DD           LDA D2PRA
01812  EE9A  29 DF              AND #$FF-$20
01813  EE9C  8D 00 DD           STA D2PRA
01814  EE9F  60                 RTS
01815  EEA0              ;
01816  EEA0              DATALO                 ;SET DATA LINE LOW  (INVERTED)
01817  EEA0  AD 00 DD           LDA D2PRA
01818  EEA3  09 20              ORA #$20
01819  EEA5  8D 00 DD           STA D2PRA
01820  EEA8  60                 RTS
01821  EEA9              ;
01822  EEA9  AD 00 DD    DEBPIA LDA D2PRA       ;DEBOUNCE THE PIA
01823  EEAC  CD 00 DD           CMP D2PRA
01824  EEAF  D0 F8              BNE DEBPIA
01825  EEB1  0A                 ASL A           ;SHIFT THE DATA BIT INTO THE CARRY...
01826  EEB2  60                 RTS             ;...AND THE CLOCK INTO NEG FLAG
01827  EEB3              ;
01828  EEB3              W1MS                   ;DELAY 1MS USING LOOP
01829  EEB3  8A                 TXA             ;SAVE .X
01830  EEB4  A2 B8              LDX #200-16     ;1000US-(1000/500*8=#40US HOLDS)
01831  EEB6  CA          W1MS1  DEX             ;5US LOOP
01832  EEB7  D0 FD              BNE W1MS1
01833  EEB9  AA                 TAX             ;RESTORE .X
01834  EEBA  60                 RTS
01835  EEBB              .END
01836  EEBB              .LIB   RS232TRANS





















RS-232 TRANSMITT......PAGE 002F

LINE# LOC   CODE        LINE


01838  EEBB              ; RSTRAB - ENTRY FOR NMI CONTINUE ROUTINE
01839  EEBB              ; RSTBGN - ENTRY FOR START TRANSMITTER
01840  EEBB              ;
01841  EEBB              ;   RSR - 8/18/80
01842  EEBB              ;
01843  EEBB              ; VARIABLES USED
01844  EEBB              ;   BITTS - # OF BITS TO BE SENT (<>0 NOT DONE)
01845  EEBB              ;   NXTBIT - BYTE CONTAINS NEXT BIT TO BE SENT
01846  EEBB              ;   ROPRTY - BYTE CONTAINS PARITY BIT CALCULATED
01847  EEBB              ;   RODATA - STORES DATA BYTE CURRENTLY BEING TRANSMITTED
01848  EEBB              ;   RODBS - OUTPUT BUFFER INDEX START
01849  EEBB              ;   RODBE - OUTPUT BUFFER INDEX END
01850  EEBB              ;   IF RODBS=RODBE THEN BUFFER EMPTY
01851  EEBB              ;   ROBUF - INDIRECT POINTER TO DATA BUFFER
01852  EEBB              ;   RSSTAT - RS-232 STATUS BYTE
01853  EEBB              ;
01854  EEBB              ;   XXX US - NORMAL BIT PATH
01855  EEBB              ;   XXX US - WORST CASE PARITY BIT PATH
01856  EEBB              ;   XXX US - STOP BIT PATH
01857  EEBB              ;   XXX US - START BIT PATH
01858  EEBB              ;
01859  EEBB  A5 B4       RSTRAB LDA BITTS       ;CHECK FOR PLACE IN BYTE...
01860  EEBD  F0 47              BEQ RSTBGN      ;...DONE, =0 START NEXT
01861  EEBF              ;
01862  EEBF  30 3F              BMI RST050      ;...DOING STOP BITS
01863  EEC1              ;
01864  EEC1  46 B6              LSR RODATA      ;SHIFT DATA INTO CARRY
01865  EEC3  A2 00              LDX #00         ;PREPARE FOR A ZERO
01866  EEC5  90 01              BCC RST005      ;YES...A ZERO
01867  EEC7  CA                 DEX             ;NO...MAKE AN $FF
01868  EEC8  8A          RST005 TXA             ;READY TO SEND
01869  EEC9              ;
01870  EEC9  45 BD              EOR ROPRTY      ;CALC INTO PARITY
01871  EECB  85 BD              STA ROPRTY
01872  EECD              ;
01873  EECD  C6 B4              DEC BITTS       ;BIT COUNT DOWN
01874  EECF  F0 06              BEQ RST010      ;WANT A PARITY INSTEAD
01875  EED1              ;
01876  EED1  8A          RSTEXT TXA             ;CALC BIT WHOLE TO SEND
01877  EED2  29 04              AND #$04        ;GOES OUT D2PA2
01878  EED4  85 B5              STA NXTBIT
01879  EED6  60                 RTS



















RS-232 TRANSMITT......PAGE 0030

LINE# LOC   CODE        LINE


01881  EED7              ; CALCULATE PARITY
01882  EED7              ;  NXTBIT =0 UPON ENTRY
01883  EED7              ;
01884  EED7  A9 20       RST010 LDA #$20        ;CHECK 6551 REG BITS
01885  EED9  2C 94 02           BIT M51CDR
01886  EEDC  F0 14              BEQ RSPNO       ;...NO PARITY, SEND A STOP
01887  EEDE  30 1C              BMI RST040      ;...NOT REAL PARITY
01888  EEE0  70 14              BVS RST030      ;...EVEN PARITY
01889  EEE2              ;
01890  EEE2  A5 BD              LDA ROPRTY      ;CALC ODD PARITY
01891  EEE4  D0 01              BNE RSPEXT      ;CORRECT GUESS
01892  EEE6              ;
01893  EEE6  CA          RSWEXT DEX             ;WRONG GUESS...ITS A ONE
01894  EEE7              ;
01895  EEE7  C6 B4       RSPEXT DEC BITTS       ;ONE STOP BIT ALWAYS
01896  EEE9  AD 93 02           LDA M51CTR      ;CHECK # OF STOP BITS
01897  EEEC  10 E3              BPL RSTEXT      ;...ONE
01898  EEEE  C6 B4              DEC BITTS       ;...TWO
01899  EEF0  D0 DF              BNE RSTEXT      ;JUMP
01900  EEF2              ;
01901  EEF2              RSPNO                  ;LINE TO SEND CANNOT BE PB0
01902  EEF2  E6 B4              INC BITTS       ;COUNTS AS ONE STOP BIT
01903  EEF4  D0 F0              BNE RSWEXT      ;JUMP TO FLIP TO ONE
01904  EEF6              ;
01905  EEF6  A5 BD       RST030 LDA ROPRTY      ;EVEN PARITY
01906  EEF8  F0 ED              BEQ RSPEXT      ;CORRECT GUESS...EXIT
01907  EEFA  D0 EA              BNE RSWEXT      ;WRONG...FLIP AND EXIT
01908  EEFC              ;
01909  EEFC  70 E9       RST040 BVS RSPEXT      ;WANTED SPACE
01910  EEFE  50 E6              BVC RSWEXT      ; WANTED MARK



01912  EF00              ; STOP BITS
01913  EF00              ;
01914  EF00  E6 B4       RST050 INC BITTS       ;STOP BIT COUNT TOWARDS ZERO
01915  EF02  A2 FF              LDX #$FF        ;SEND STOP BIT
01916  EF04  D0 CB              BNE RSTEXT      ;JUMP TO EXIT
01917  EF06              ;






















RS-232 TRANSMITT......PAGE 0031

LINE# LOC   CODE        LINE


01919  EF06              ; RSTBGN - ENTRY TO START BYTE TRANS
01920  EF06              ;
01921  EF06  AD 94 02    RSTBGN LDA M51CDR      ;CHECK FOR 3/X LINE
01922  EF09  4A                 LSR A
01923  EF0A  90 07              BCC RST060      ;3 LINE...NO CHECK
01924  EF0C  2C 01 DD           BIT D2PRB       ;CHECK FOR...
01925  EF0F  10 1D              BPL DSRERR      ;...DSR ERROR
01926  EF11  50 1E              BVC CTSERR      ;...CTS ERROR
01927  EF13              ;
01928  EF13              ; SET UP TO SEND NEXT BYTE
01929  EF13              ;
01930  EF13  A9 00       RST060 LDA #0
01931  EF15  85 BD              STA ROPRTY      ;ZERO PARITY
01932  EF17  85 B5              STA NXTBIT      ;SEND START BIT
01933  EF19  AE 98 02           LDX BITNUM      ;GET # OF BITS
01934  EF1C  86 B4       RST070 STX BITTS       ;BITTS=#OF BITTS+1
01935  EF1E              ;
01936  EF1E  AC 9D 02    RST080 LDY RODBS       ;CHECK BUFFER POINTERS
01937  EF21  CC 9E 02           CPY RODBE
01938  EF24  F0 13              BEQ RSODNE      ;ALL DONE...
01939  EF26              ;
01940  EF26  B1 F9              LDA (ROBUF)Y    ;GET DATA...
01941  EF28  85 B6              STA RODATA      ;...INTO BYTE BUFFER
01942  EF2A  EE 9D 02           INC RODBS       ;MOVE POINTER TO NEXT
01943  EF2D  60                 RTS



01945  EF2E              ; SET ERRORS
01946  EF2E              ;
01947  EF2E  A9 40       DSRERR LDA #$40        ;DSR GONE ERROR
01948  EF30  2C                 .BYT $2C
01949  EF31  A9 10       CTSERR LDA #$10        ;CTS GONE ERROR
01950  EF33  0D 97 02           ORA RSSTAT
01951  EF36  8D 97 02           STA RSSTAT
01952  EF39              ;
01953  EF39              ; ERRORS TURN OFF T1
01954  EF39              ;
01955  EF39  A9 01       RSODNE LDA #$01        ;KILL T1 NMI
01956  EF3B              ;ENTRY TO TURN OFF AN ENABLED NMI...
01957  EF3B  8D 0D DD    OENABL STA D2ICR       ;TOSS BAD/OLD NMI
01958  EF3E  4D A1 02           EOR ENABL       ;FLIP ENABLE
01959  EF41  09 80              ORA #$80        ;ENABLE GOOD NMI'S
01960  EF43  8D A1 02           STA ENABL
01961  EF46  8D 0D DD           STA D2ICR
01962  EF49  60                 RTS



01964  EF4A              ; BITCNT - CAL # OF BITS TO BE SENT
01965  EF4A              ;   RETURNS #OF BITS+1
01966  EF4A              ;
01967  EF4A  A2 09       BITCNT LDX #9          ;CALC WORD LENGTH
01968  EF4C  A9 20              LDA #$20
01969  EF4E  2C 93 02           BIT M51CTR






RS-232 TRANSMITT......PAGE 0032

LINE# LOC   CODE        LINE


01970  EF51  F0 01              BEQ BIT010
01971  EF53  CA                 DEX             ;BIT 5 HIGH IS A 7 OR 5
01972  EF54  50 02       BIT010 BVC BIT020
01973  EF56  CA                 DEX             ;BIT 6 HIGH IS A 6 OR 5
01974  EF57  CA                 DEX
01975  EF58  60          BIT020 RTS
01976  EF59              .END
01977  EF59              .LIB   RS232RCVR





















































RS-232 RECEIVER......PAGE 0033

LINE# LOC   CODE        LINE


01979  EF59              ; RSRCVR - NMI ROUTINE TO COLLECT
01980  EF59              ;  DATA INTO BYTES
01981  EF59              ;
01982  EF59              ; RSR 8/18/80
01983  EF59              ;
01984  EF59              ; VARIABLES USED
01985  EF59              ;   INBIT - INPUT BIT VALUE
01986  EF59              ;   BITCI - BIT COUNT IN
01987  EF59              ;   RINONE - FLAG FOR START BIT CHECK <>0 START BIT
01988  EF59              ;   RIDATA - BYTE INPUT BUFFER
01989  EF59              ;   RIPRTY - HOLDS BYTE INPUT PARITY
01990  EF59              ;   RIBUF - INDIRECT POINTER TO DATA BUFFER
01991  EF59              ;   RIDBE - INPUT BUFFER INDEX TO END
01992  EF59              ;   RIDBS - INPUT BUFFER POINTER TO START
01993  EF59              ;   IF RIDBE=RIDBS THEN INPUT BUFFER EMPTY
01994  EF59              ;
01995  EF59  A6 A9       RSRCVR LDX RINONE      ;CHECK FOR START BIT
01996  EF5B  D0 33              BNE RSRTRT      ;WAS START BIT
01997  EF5D              ;
01998  EF5D  C6 A8              DEC BITCI       ;CHECK WHERE WE ARE IN INPUT...
01999  EF5F  F0 36              BEQ RSR030      ;HAVE A FULL BYTE
02000  EF61  30 0D              BMI RSR020      ;GETTING STOP BITS
02001  EF63              ;
02002  EF63              ; CALC PARITY
02003  EF63              ;
02004  EF63  A5 A7              LDA INBIT       ;GET DATA UP
02005  EF65  45 AB              EOR RIPRTY      ;CALC NEW PARITY
02006  EF67  85 AB              STA RIPRTY
02007  EF69              ;
02008  EF69              ; SHIFT DATA BIT IN
02009  EF69              ;
02010  EF69  46 A7              LSR INBIT       ;IN BIT POS 0
02011  EF6B  66 AA              ROR RIDATA      ;C INTO DATA
02012  EF6D              ;
02013  EF6D              ; EXIT
02014  EF6D              ;
02015  EF6D  60          RSREXT RTS
























RS-232 RECEIVER......PAGE 0034

LINE# LOC   CODE        LINE


02017  EF6E              ; HAVE STOP BIT, SO STORE IN BUFFER
02018  EF6E              ;
02019  EF6E  C6 A8       RSR018 DEC BITCI       ;NO PARITY, DEC SO CHECK WORKS
02020  EF70  A5 A7       RSR020 LDA INBIT       ;GET DATA...
02021  EF72  F0 67              BEQ RSR060      ;...ZERO, AN ERROR?
02022  EF74              ;
02023  EF74  AD 93 02           LDA M51CTR      ;CHECK FOR CORRECT # OF STOP BITS
02024  EF77  0A                 ASL A           ;CARRY TELL HOW MAY STOP BITS
02025  EF78  A9 01              LDA #01
02026  EF7A  65 A8              ADC BITCI
02027  EF7C  D0 EF              BNE RSREXT      ;NO..EXIT
02028  EF7E              ;
02029  EF7E              ; RSRABL - ENABLE TO RECIEVE A BYTE
02030  EF7E              ;
02031  EF7E  A9 90       RSRABL LDA #$90        ;ENABLE FLAG FOR NEXT BYTE
02032  EF80  8D 0D DD           STA D2ICR       ;TOSS BAD/OLD NMI
02033  EF83  0D A1 02           ORA ENABL       ;MARK IN ENABLE REGISTER***********
02034  EF86  8D A1 02           STA ENABL       ;RE-ENABLED BY JMP OENABL
02035  EF89  85 A9              STA RINONE      ;FLAG FOR START BIT
02036  EF8B              ;
02037  EF8B  A9 02       RSRSXT LDA #$02        ;DISABLE T2
02038  EF8D  4C 3B EF           JMP OENABL      ;FLIP-OFF ENABL***************


02040  EF90              ; RECIEVER START BIT CHECK
02041  EF90              ;
02042  EF90  A5 A7       RSRTRT LDA INBIT       ;CHECK IF SPACE
02043  EF92  D0 EA              BNE RSRABL      ;BAD...TRY AGAIN
02044  EF94  85 A9              STA RINONE      ;GOOD...DISABLE FLAG
02045  EF96  60                 RTS             ;AND EXIT




02047  EF97              ;
02048  EF97              ; PUT DATA IN BUFFER (AT PARITY TIME)
02049  EF97              ;
02050  EF97  AC 9B 02    RSR030 LDY RIDBE       ;GET END
02051  EF9A  C8                 INY
02052  EF9B  CC 9C 02           CPY RIDBS       ;HAVE WE PASSED START?
02053  EF9E  F0 2A              BEQ RECERR      ;YES...ERROR
02054  EFA0              ;
02055  EFA0  8C 9B 02           STY RIDBE       ;MOVE RIDBE FOWARD
02056  EFA3  88                 DEY
02057  EFA4              ;
02058  EFA4  A5 AA              LDA RIDATA      ;GET BYTE BUFFER UP
02059  EFA6  AE 98 02           LDX BITNUM      ;SHIFT UNTILL FULL BYTE
02060  EFA9  E0 09       RSR031 CPX #9          ;ALWAYS 8 BITS
02061  EFAB  F0 04              BEQ RSR032
02062  EFAD  4A                 LSR A           ;FILL WITH ZEROS
02063  EFAE  E8                 INX
02064  EFAF  D0 F8              BNE RSR031
02065  EFB1              ;
02066  EFB1  91 F7       RSR032 STA (RIBUF)Y    ;DATA TO PAGE BUFFER
02067  EFB3              ;






RS-232 RECEIVER......PAGE 0035

LINE# LOC   CODE        LINE


02068  EFB3              ; PARITY CHECKING
02069  EFB3              ;
02070  EFB3  A9 20              LDA #$20        ;CHECK 6551 COMMAND REGISTER
02071  EFB5  2C 94 02           BIT M51CDR
02072  EFB8  F0 B4              BEQ RSR018      ;NO PARITY BIT SO STOP BIT
02073  EFBA  30 B1              BMI RSREXT      ;NO PARITY CHECK
02074  EFBC              ;
02075  EFBC              ; CHECK CALC PARITY
02076  EFBC              ;
02077  EFBC  A5 A7              LDA INBIT
02078  EFBE  45 AB              EOR RIPRTY      ;PUT IN WITH PARITY
02079  EFC0  F0 03              BEQ RSR050      ;EVEN PARITY
02080  EFC2  70 A9              BVS RSREXT      ;ODD...OKAY SO EXIT
02081  EFC4  2C                 .BYT $2C        ;SKIP TWO
02082  EFC5  50 A6       RSR050 BVC RSREXT      ;EVEN...OKAY SO EXIT
02083  EFC7              ;
02084  EFC7              ; ERRORS REPORTED
02085  EFC7  A9 01              LDA #1          ;PARITY ERROR
02086  EFC9  2C                 .BYT $2C
02087  EFCA  A9 04       RECERR LDA #$4         ;RECIEVER OVERRUN
02088  EFCC  2C                 .BYT $2C
02089  EFCD  A9 80       BREAKE LDA #$80        ;BREAK DETECTED
02090  EFCF  2C                 .BYT $2C
02091  EFD0  A9 02       FRAMEE LDA #$02        ;FRAME ERROR
02092  EFD2  0D 97 02    ERR232 ORA RSSTAT
02093  EFD5  8D 97 02           STA RSSTAT
02094  EFD8  4C 7E EF           JMP RSRABL      ;BAD EXIT SO HANG ##????????##
02095  EFDB              ;
02096  EFDB              ; CHECK FOR ERRORS
02097  EFDB              ;
02098  EFDB  A5 AA       RSR060 LDA RIDATA      ;EXPECTING STOP...
02099  EFDD  D0 F1              BNE FRAMEE      ;FRAME ERROR
02100  EFDF  F0 EC              BEQ BREAKE      ;COULD BE A BREAK
02101  EFE1              .END
02102  EFE1              .LIB   RS232INOUT


























RS232 INOUT......PAGE 0036

LINE# LOC   CODE        LINE


02104  EFE1              ; OUTPUT A FILE OVER USR PORT
02105  EFE1              ;  USING RS232
02106  EFE1              ;
02107  EFE1  85 9A       CKO232 STA DFLTO       ;SET DEFAULT OUT
02108  EFE3  AD 94 02           LDA M51CDR      ;CHECK FOR 3/X LINE
02109  EFE6  4A                 LSR A
02110  EFE7  90 29              BCC CKO100      ;3LINE...NO TURN AROUND
02111  EFE9              ;
02112  EFE9              ;*TURN AROUND LOGIC
02113  EFE9              ;
02114  EFE9              ; CHECK FOR DSR AND RTS
02115  EFE9              ;
02116  EFE9  A9 02              LDA #$02        ;BIT RTS IS ON
02117  EFEB  2C 01 DD           BIT D2PRB
02118  EFEE  10 1D              BPL CKDSRX      ;NO DSR...ERROR
02119  EFF0  D0 20              BNE CKO100      ;RTS...OUTPUTING OR FULL DUPLEX
02120  EFF2              ;
02121  EFF2              ; CHECK FOR ACTIVE INPUT
02122  EFF2              ;  RTS WILL BE LOW IF CURRENTLY INPUTING
02123  EFF2              ;
02124  EFF2  AD A1 02    CKO020 LDA ENABL
02125  EFF5  29 02              AND #$02        ;LOOK AT IER FOR T2
02126  EFF7  D0 F9              BNE CKO020      ;HANG UNTILL INPUT DONE
02127  EFF9              ;
02128  EFF9              ; WAIT FOR CTS TO BE OFF AS SPEC REQS
02129  EFF9              ;
02130  EFF9  2C 01 DD    CKO030 BIT D2PRB
02131  EFFC  70 FB              BVS CKO030
02132  EFFE              ;
02133  EFFE              ; TURN ON RTS
02134  EFFE              ;
02135  EFFE  AD 01 DD           LDA D2PRB
02136  F001  09 02              ORA #$02
02137  F003  8D 01 DD           STA D2PRB
02138  F006              ;
02139  F006              ; WAIT FOR CTS TO GO ON
02140  F006              ;
02141  F006  2C 01 DD    CKO040 BIT D2PRB
02142  F009  70 07              BVS CKO100      ;DONE...
02143  F00B  30 F9              BMI CKO040      ;WE STILL HAVE DSR
02144  F00D              ;
02145  F00D  A9 40       CKDSRX LDA #$40        ;A DATA SET READY ERROR
02146  F00F  8D 97 02           STA RSSTAT      ;MAJOR ERROR....WILL REQUIRE REOPEN
02147  F012              ;
02148  F012  18          CKO100 CLC             ;NO ERROR
02149  F013  60                 RTS
02150  F014              ;














RS232 INOUT......PAGE 0037

LINE# LOC   CODE        LINE


02152  F014              ; BSO232 - OUTPUT A CHAR RS232
02153  F014              ;   DATA PASSED IN T1 FROM BSOUT
02154  F014              ;
02155  F014              ; HANG LOOP FOR BUFFER FULL
02156  F014              ;
02157  F014  20 28 F0    BSOBAD JSR BSO100      ;KEEP TRYING TO START SYSTEM...
02158  F017              ;
02159  F017              ; BUFFER HANDLER
02160  F017              ;
02161  F017  AC 9E 02    BSO232 LDY RODBE
02162  F01A  C8                 INY
02163  F01B  CC 9D 02           CPY RODBS       ;CHECK FOR BUFFER FULL
02164  F01E  F0 F4              BEQ BSOBAD      ;HANG IF SO...TRYING TO RESTART
02165  F020  8C 9E 02           STY RODBE       ;INDICATE NEW START
02166  F023  88                 DEY
02167  F024  A5 9E              LDA T1          ;GET DATA...
02168  F026  91 F9              STA (ROBUF)Y    ;STORE DATA
02169  F028              ;
02170  F028              ; SET UP IF NECESSARY TO OUTPUT
02171  F028              ;
02172  F028  AD A1 02    BSO100 LDA ENABL       ;CHECK FOR A T1 NMI ENABLE
02173  F02B  4A                 LSR A           ;BIT 0
02174  F02C  B0 1E              BCS BSO120      ;RUNNING....SO EXIT
02175  F02E              ;
02176  F02E              ; SET UP T1 NMI'S
02177  F02E              ;
02178  F02E  A9 10       BSO110 LDA #$10        ;TURN OFF TIMER TO PREVENT FALSE START...
02179  F030  8D 0E DD           STA D2CRA
02180  F033  AD 99 02           LDA BAUDOF      ;SET UP TIMER1
02181  F036  8D 04 DD           STA D2T1L
02182  F039  AD 9A 02           LDA BAUDOF+1
02183  F03C  8D 05 DD           STA D2T1H
02184  F03F  A9 81              LDA #$81
02185  F041  20 3B EF           JSR OENABL
02186  F044  20 06 EF           JSR RSTBGN      ;SET UP TO SEND (WILL STOP ON CTS OR DSR ERROR)
02187  F047  A9 11              LDA #$11        ;TURN ON TIMER
02188  F049  8D 0E DD           STA D2CRA
02189  F04C  60          BSO120 RTS























RS232 INOUT......PAGE 0038

LINE# LOC   CODE        LINE


02191  F04D              ; INPUT A FILE OVER USER PORT
02192  F04D              ;  USING RS232
02193  F04D              ;
02194  F04D  85 99       CKI232 STA DFLTN       ;SET DEFAULT INPUT
02195  F04F              ;
02196  F04F  AD 94 02           LDA M51CDR      ;CHECK FOR 3/X LINE
02197  F052  4A                 LSR A
02198  F053  90 28              BCC CKI100      ;3 LINE...NO HANDSHAKE
02199  F055              ;
02200  F055  29 08              AND #$08        ;FULL/HALF CHECK (BYTE SHIFTED ABOVE)
02201  F057  F0 24              BEQ CKI100      ;FULL...NO HANDSHAKE
02202  F059              ;
02203  F059              ;*TURN AROUND LOGIC
02204  F059              ;
02205  F059              ; CHECK IF DSR AND NOT RTS
02206  F059              ;
02207  F059  A9 02              LDA #$02        ;BIT RTS IS ON
02208  F05B  2C 01 DD           BIT D2PRB
02209  F05E  10 AD              BPL CKDSRX      ;NO DSR...ERROR
02210  F060  F0 22              BEQ CKI110      ;RTS LOW...IN CORRECT MODE
02211  F062              ;
02212  F062              ; WAIT FOR ACTIVE OUTPUT TO BE DONE
02213  F062              ;
02214  F062  AD A1 02    CKI010 LDA ENABL
02215  F065  4A                 LSR A           ;CHECK T1 (BIT 0)
02216  F066  B0 FA              BCS CKI010
02217  F068              ;
02218  F068              ; TURN OFF RTS
02219  F068              ;
02220  F068  AD 01 DD           LDA D2PRB
02221  F06B  29 FD              AND #$FF-02
02222  F06D  8D 01 DD           STA D2PRB
02223  F070              ;
02224  F070              ; WAIT FOR DCD TO GO HIGH (IN SPEC)
02225  F070              ;
02226  F070  AD 01 DD    CKI020 LDA D2PRB
02227  F073  29 04              AND #$04
02228  F075  F0 F9              BEQ CKI020
02229  F077              ;
02230  F077              ; ENABLE FLAG FOR RS232 INPUT
02231  F077              ;
02232  F077  A9 90       CKI080 LDA #$90
02233  F079  18                 CLC             ;NO ERROR
02234  F07A  4C 3B EF           JMP OENABL      ;FLAG IN ENABL**********
02235  F07D              ;
02236  F07D              ; IF NOT 3 LINE HALF THEN...
02237  F07D              ;  SEE IF WE NEED TO TURN ON FLAG
02238  F07D              ;
02239  F07D  AD A1 02    CKI100 LDA ENABL       ;CHECK FOR FLAG OR T2 ACTIVE
02240  F080  29 12              AND #$12
02241  F082  F0 F3              BEQ CKI080      ;NO NEED TO TURN ON
02242  F084  18          CKI110 CLC             ;NO ERROR
02243  F085  60                 RTS








RS232 INOUT......PAGE 0039

LINE# LOC   CODE        LINE


02245  F086              ; BSI232 - INPUT A CHAR RS232
02246  F086              ;
02247  F086              ; BUFFER HANDLER
02248  F086              ;
02249  F086  AD 97 02    BSI232 LDA RSSTAT      ;GET STATUS UP TO CHANGE...
02250  F089  AC 9C 02           LDY RIDBS       ;GET LAST BYTE ADDRESS
02251  F08C  CC 9B 02           CPY RIDBE       ;SEE IF BUFFER EMPTY
02252  F08F  F0 0B              BEQ BSI010      ;RETURN A NULL IF NO CHAR
02253  F091              ;
02254  F091  29 F7              AND #$FF-$08    ;CLEAR BUFFER EMPTY STATUS
02255  F093  8D 97 02           STA RSSTAT
02256  F096  B1 F7              LDA (RIBUF)Y    ;GET LAST CHAR
02257  F098  EE 9C 02           INC RIDBS       ;INC TO NEXT POS
02258  F09B              ;
02259  F09B              ; RECEIVER ALWAYS RUNS
02260  F09B              ;
02261  F09B  60                 RTS
02262  F09C              ;
02263  F09C  09 08       BSI010 ORA #$08        ;SET BUFFER EMPTY STATUS
02264  F09E  8D 97 02           STA RSSTAT
02265  F0A1  A9 00              LDA #$0         ;RETURN A NULL
02266  F0A3  60                 RTS




02268  F0A4              ; RSP232 - PROTECT SERIAL/CASS FROM RS232 NMI'S
02269  F0A4              ;
02270  F0A4  48          RSP232 PHA             ;SAVE .A
02271  F0A5  AD A1 02           LDA ENABL       ;DOES RS232 HAVE ANY ENABLES?
02272  F0A8  F0 11              BEQ RSPOK       ;NO...
02273  F0AA  AD A1 02    RSPOFF LDA ENABL       ;WAIT UNTILL DONE
02274  F0AD  29 03              AND #%00000011  ; WITH T1 & T2
02275  F0AF  D0 F9              BNE RSPOFF
02276  F0B1  A9 10              LDA #%00010000  ; DISABLE FLAG (NEED TO RENABLE IN USER CODE)
02277  F0B3  8D 0D DD           STA D2ICR       ;TURN OF ENABL************
02278  F0B6  A9 00              LDA #0
02279  F0B8  8D A1 02           STA ENABL       ;CLEAR ALL ENABLS
02280  F0BB  68          RSPOK  PLA             ;ALL DONE
02281  F0BC  60                 RTS
02282  F0BD              .END
02283  F0BD              .LIB   MESSAGES



















MESSAGES......PAGE 003A

LINE# LOC   CODE        LINE


02285  F0BD  0D          MS1    .BYT $D,'I/O ERROR ',$A3
02285  F0BE  49 2F 
02285  F0C8  A3 
02286  F0C9  0D          MS5    .BYT $D,'SEARCHING',$A0
02286  F0CA  53 45 
02286  F0D3  A0 
02287  F0D4  46 4F 52    MS6    .BYT 'FOR',$A0
02287  F0D7  A0 
02288  F0D8  0D          MS7    .BYT $D,'PRESS PLAY ON TAP',$C5
02288  F0D9  50 52 
02288  F0EA  C5 
02289  F0EB  50 52       MS8    .BYT 'PRESS RECORD & PLAY ON TAP',$C5
02289  F105  C5 
02290  F106  0D          MS10   .BYT $D,'LOADIN',$C7
02290  F107  4C 4F 
02290  F10D  C7 
02291  F10E  0D          MS11   .BYT $D,'SAVING',$A0
02291  F10F  53 41 
02291  F115  A0 
02292  F116  0D          MS21   .BYT $D,'VERIFYIN',$C7
02292  F117  56 45 
02292  F11F  C7 
02293  F120  0D          MS17   .BYT $D,'FOUND',$A0
02293  F121  46 4F 
02293  F126  A0 
02294  F127  0D          MS18   .BYT $D,'OK',$8D
02294  F128  4F 4B 
02294  F12A  8D 
02295  F12B              ; MS34 .BYT $D,'MONITOR',$8D
02296  F12B              ; MS36 .BYT $D,'BREA',$CB





02298  F12B              ;PRINT MESSAGE TO SCREEN ONLY IF
02299  F12B              ;OUTPUT ENABLED
02300  F12B              ;
02301  F12B  24 9D       SPMSG  BIT MSGFLG      ;PRINTING MESSAGES?
02302  F12D  10 0D              BPL MSG10       ;NO...
02303  F12F  B9 BD F0    MSG    LDA MS1,Y
02304  F132  08                 PHP
02305  F133  29 7F              AND #$7F
02306  F135  20 D2 FF           JSR BSOUT
02307  F138  C8                 INY
02308  F139  28                 PLP
02309  F13A  10 F3              BPL MSG
02310  F13C  18          MSG10  CLC
02311  F13D  60                 RTS
02312  F13E              .END
02313  F13E              .LIB   CHANNELIO










CHANNEL I/O......PAGE 003B

LINE# LOC   CODE        LINE


02315  F13E              ;***************************************
02316  F13E              ;* GETIN -- GET CHARACTER FROM CHANNEL *
02317  F13E              ;*      CHANNEL IS DETERMINED BY DFLTN.*
02318  F13E              ;* IF DEVICE IS 0, KEYBOARD QUEUE IS   *
02319  F13E              ;* EXAMINED AND A CHARACTER REMOVED IF *
02320  F13E              ;* AVAILABLE.  IF QUEUE IS EMPTY, Z    *
02321  F13E              ;* FLAG IS RETURNED SET.  DEVICES 1-31 *
02322  F13E              ;* ADVANCE TO BASIN.                   *
02323  F13E              ;***************************************
02324  F13E              ;
02325  F13E  A5 99       NGETIN LDA DFLTN       ;CHECK DEVICE
02326  F140  D0 08              BNE GN10        ;NOT KEYBOARD
02327  F142              ;
02328  F142  A5 C6              LDA NDX         ;QUEUE INDEX
02329  F144  F0 0F              BEQ GN20        ;NOBODY THERE...EXIT
02330  F146              ;
02331  F146  78                 SEI
02332  F147  4C B4 E5           JMP LP2         ;GO REMOVE A CHARACTER
02333  F14A              ;
02334  F14A  C9 02       GN10   CMP #2          ;IS IT RS-232
02335  F14C  D0 18              BNE BN10        ;NO...USE BASIN
02336  F14E              ;
02337  F14E  84 97       GN232  STY XSAV        ;SAVE .Y, USED IN RS232
02338  F150  20 86 F0           JSR BSI232
02339  F153  A4 97              LDY XSAV        ;RESTORE .Y
02340  F155  18          GN20   CLC             ;GOOD RETURN
02341  F156  60                 RTS



02343  F157              ;***************************************
02344  F157              ;* BASIN-- INPUT CHARACTER FROM CHANNEL*
02345  F157              ;*     INPUT DIFFERS FROM GET ON DEVICE*
02346  F157              ;* #0 FUNCTION WHICH IS KEYBOARD. THE  *
02347  F157              ;* SCREEN EDITOR MAKES READY AN ENTIRE *
02348  F157              ;* LINE WHICH IS PASSED CHAR BY CHAR   *
02349  F157              ;* UP TO THE CARRIAGE RETURN.  OTHER   *
02350  F157              ;* DEVICES ARE:                        *
02351  F157              ;*      0 -- KEYBOARD                  *
02352  F157              ;*      1 -- CASSETTE #1               *
02353  F157              ;*      2 -- RS232                     *
02354  F157              ;*      3 -- SCREEN                    *
02355  F157              ;*   4-31 -- SERIAL BUS                *
02356  F157              ;***************************************
02357  F157              ;
02358  F157  A5 99       NBASIN LDA DFLTN       ;CHECK DEVICE
02359  F159  D0 0B              BNE BN10        ;IS NOT KEYBOARD...
02360  F15B              ;
02361  F15B              ;INPUT FROM KEYBOARD
02362  F15B              ;
02363  F15B  A5 D3              LDA PNTR        ;SAVE CURRENT...
02364  F15D  85 CA              STA LSTP        ;... CURSOR COLUMN
02365  F15F  A5 D6              LDA TBLX        ;SAVE CURRENT...
02366  F161  85 C9              STA LSXP        ;... LINE NUMBER
02367  F163  4C 32 E6           JMP LOOP5       ;BLINK CURSOR UNTIL RETURN






CHANNEL I/O......PAGE 003C

LINE# LOC   CODE        LINE


02368  F166              ;
02369  F166  C9 03       BN10   CMP #3          ;IS INPUT FROM SCREEN?
02370  F168  D0 09              BNE BN20        ;NO...
02371  F16A              ;
02372  F16A  85 D0              STA CRSW        ;FAKE A CARRIAGE RETURN
02373  F16C  A5 D5              LDA LNMX        ;SAY WE ENDED...
02374  F16E  85 C8              STA INDX        ;...UP ON THIS LINE
02375  F170  4C 32 E6           JMP LOOP5       ;PICK UP CHARACTERS
02376  F173              ;
02377  F173  B0 38       BN20   BCS BN30        ;DEVICES >3
02378  F175  C9 02              CMP #2          ;RS232?
02379  F177  F0 3F              BEQ BN50
02380  F179              ;
02381  F179              ;INPUT FROM CASSETTE BUFFERS
02382  F179              ;
02383  F179  86 97              STX XSAV
02384  F17B  20 99 F1           JSR JTGET
02385  F17E  B0 16              BCS JTG37       ;STOP KEY/ERROR
02386  F180  48                 PHA
02387  F181  20 99 F1           JSR JTGET
02388  F184  B0 0D              BCS JTG36       ;STOP KEY/ERROR
02389  F186  D0 05              BNE JTG35       ;NOT AN END OF FILE
02390  F188  A9 40              LDA #64         ;TELL USER EOF
02391  F18A  20 1C FE           JSR UDST        ;IN STATUS
02392  F18D  C6 A6       JTG35  DEC BUFPT
02393  F18F  A6 97              LDX XSAV        ;.X PRESERVED
02394  F191  68                 PLA             ;CHARACTER RETURNED
02395  F192              ;C-CLEAR FROM JTGET
02396  F192  60                 RTS             ;ALL DONE
02397  F193              ;
02398  F193  AA          JTG36  TAX             ;SAVE ERROR INFO
02399  F194  68                 PLA             ;TOSS DATA
02400  F195  8A                 TXA             ;RESTORE ERROR
02401  F196  A6 97       JTG37  LDX XSAV        ;RETURN
02402  F198  60                 RTS             ;ERROR RETURN C-SET FROM JTGET



02404  F199              ;GET A CHARACTER FROM APPROPRIATE
02405  F199              ;CASSETTE BUFFER
02406  F199              ;
02407  F199  20 0D F8    JTGET  JSR JTP20       ;BUFFER POINTER WRAP?
02408  F19C  D0 0B              BNE JTG10       ;NO...
02409  F19E  20 41 F8           JSR RBLK        ;YES...READ NEXT BLOCK
02410  F1A1  B0 11              BCS BN33        ;STOP KEY PRESSED
02411  F1A3  A9 00              LDA #0
02412  F1A5  85 A6              STA BUFPT       ;POINT TO BEGIN.
02413  F1A7  F0 F0              BEQ JTGET       ;BRANCH ALWAYS
02414  F1A9              ;
02415  F1A9  B1 B2       JTG10  LDA (TAPE1)Y    ;GET CHAR FROM BUF
02416  F1AB  18                 CLC             ;GOOD RETURN
02417  F1AC  60                 RTS 









CHANNEL I/O......PAGE 003D

LINE# LOC   CODE        LINE


02419  F1AD              ;INPUT FROM SERIAL BUS
02420  F1AD              ;
02421  F1AD  A5 90       BN30   LDA STATUS      ;STATUS FROM LAST
02422  F1AF  F0 04              BEQ BN35        ;WAS GOOD
02423  F1B1  A9 0D       BN31   LDA #$D         ;BAD...ALL DONE
02424  F1B3  18          BN32   CLC             ;VALID DATA
02425  F1B4  60          BN33   RTS
02426  F1B5              ;
02427  F1B5  4C 13 EE    BN35   JMP ACPTR       ;GOOD...HANDSHAKE
02428  F1B8              ;
02429  F1B8              ;INPUT FROM RS232
02430  F1B8              ;
02431  F1B8  20 4E F1    BN50   JSR GN232       ;GET INFO
02432  F1BB  B0 F7              BCS BN33        ;ERROR RETURN
02433  F1BD  C9 00              CMP #00
02434  F1BF  D0 F2              BNE BN32        ;GOOD DATA...EXIT
02435  F1C1  AD 97 02           LDA RSSTAT      ;CHECK FOR DSR OR DCD ERROR
02436  F1C4  29 60              AND #$60
02437  F1C6  D0 E9              BNE BN31        ;AN ERROR...EXIT WITH C/R
02438  F1C8  F0 EE              BEQ BN50        ;NO ERROR...STAY IN LOOP









































CHANNEL OUTPUT......PAGE 003E

LINE# LOC   CODE        LINE


02440  F1CA              ;***************************************
02441  F1CA              ;* BSOUT -- OUT CHARACTER TO CHANNEL   *
02442  F1CA              ;*     DETERMINED BY VARIABLE DFLTO:   *
02443  F1CA              ;*     0 -- INVALID                    *
02444  F1CA              ;*     1 -- CASSETTE #1                *
02445  F1CA              ;*     2 -- RS232                      *
02446  F1CA              ;*     3 -- SCREEN                     *
02447  F1CA              ;*  4-31 -- SERIAL BUS                 *
02448  F1CA              ;***************************************
02449  F1CA              ;
02450  F1CA  48          NBSOUT PHA             ;PRESERVE .A
02451  F1CB  A5 9A              LDA DFLTO       ;CHECK DEVICE
02452  F1CD  C9 03              CMP #3          ;IS IT THE SCREEN?
02453  F1CF  D0 04              BNE BO10        ;NO...
02454  F1D1              ;
02455  F1D1              ;PRINT TO CRT
02456  F1D1              ;
02457  F1D1  68                 PLA             ;RESTORE DATA
02458  F1D2  4C 16 E7           JMP PRT         ;PRINT ON CRT
02459  F1D5              ;
02460  F1D5              BO10
02461  F1D5  90 04              BCC BO20        ;DEVICE 1 OR 2
02462  F1D7              ;
02463  F1D7              ;PRINT TO SERIAL BUS
02464  F1D7              ;
02465  F1D7  68                 PLA
02466  F1D8  4C DD ED           JMP CIOUT
02467  F1DB              ;
02468  F1DB              ;PRINT TO CASSETTE DEVICES
02469  F1DB              ;
02470  F1DB  4A          BO20   LSR A           ;RS232?
02471  F1DC  68                 PLA             ;GET DATA OFF STACK...
02472  F1DD              ;
02473  F1DD  85 9E       CASOUT STA T1          ;PASS DATA IN T1
02474  F1DF              ; CASOUT MUST BE ENTERED WITH CARRY SET!!!
02475  F1DF              ;PRESERVE REGISTERS
02476  F1DF              ;
02477  F1DF  8A                 TXA
02478  F1E0  48                 PHA
02479  F1E1  98                 TYA
02480  F1E2  48                 PHA
02481  F1E3  90 23              BCC BO50        ;C-CLR MEANS DFLTO=2 (RS232)
02482  F1E5              ;
02483  F1E5  20 0D F8           JSR JTP20       ;CHECK BUFFER POINTER
02484  F1E8  D0 0E              BNE JTP10       ;HAS NOT REACHED END
02485  F1EA  20 64 F8           JSR WBLK        ;WRITE FULL BUFFER
02486  F1ED  B0 0E              BCS RSTOR       ;ABORT ON STOP KEY
02487  F1EF              ;
02488  F1EF              ;PUT BUFFER TYPE BYTE
02489  F1EF              ;
02490  F1EF  A9 02              LDA #BDF
02491  F1F1  A0 00              LDY #0
02492  F1F3  91 B2              STA (TAPE1)Y
02493  F1F5              ;
02494  F1F5              ;RESET BUFFER POINTER






CHANNEL OUTPUT......PAGE 003F

LINE# LOC   CODE        LINE


02495  F1F5              ;
02496  F1F5  C8                 INY             ;MAKE .Y=1
02497  F1F6  84 A6              STY BUFPT       ;BUFPT=1
02498  F1F8              ;
02499  F1F8  A5 9E       JTP10  LDA T1
02500  F1FA  91 B2              STA (TAPE1)Y    ;DATA TO BUFFER
02501  F1FC              ;
02502  F1FC              ;RESTORE .X AND .Y
02503  F1FC              ;
02504  F1FC  18          RSTOA  CLC             ;GOOD RETURN
02505  F1FD  68          RSTOR  PLA
02506  F1FE  A8                 TAY
02507  F1FF  68                 PLA
02508  F200  AA                 TAX
02509  F201  A5 9E              LDA T1          ;GET .A FOR RETURN
02510  F203  90 02              BCC RSTOR1      ;NO ERROR
02511  F205  A9 00              LDA #00         ;STOP ERROR IF C-SET
02512  F207  60          RSTOR1 RTS
02513  F208              ;
02514  F208              ;OUTPUT TO RS232
02515  F208              ;
02516  F208  20 17 F0    BO50   JSR BSO232      ;PASS DATA THROUGH VARIABLE T1
02517  F20B  4C FC F1           JMP RSTOA       ;GO RESTORE ALL..ALWAYS GOOD
02518  F20E              .END
02519  F20E              .LIB   OPENCHANNEL




































OPEN CHANNEL......PAGE 0040

LINE# LOC   CODE        LINE


02521  F20E              ;***************************************
02522  F20E              ;* CHKIN -- OPEN CHANNEL FOR INPUT     *
02523  F20E              ;*                                     *
02524  F20E              ;* THE NUMBER OF THE LOGICAL FILE TO BE*
02525  F20E              ;* OPENED FOR INPUT IS PASSED IN .X.   *
02526  F20E              ;* CHKIN SEARCHES THE LOGICAL FILE     *
02527  F20E              ;* TO LOOK UP DEVICE AND COMMAND INFO. *
02528  F20E              ;* ERRORS ARE REPORTED IF THE DEVICE   *
02529  F20E              ;* WAS NOT OPENED FOR INPUT ,(E.G.     *
02530  F20E              ;* CASSETTE WRITE FILE), OR THE LOGICAL*
02531  F20E              ;* FILE HAS NO REFERENCE IN THE TABLES.*
02532  F20E              ;* DEVICE 0, (KEYBOARD), AND DEVICE 3  *
02533  F20E              ;* (SCREEN), REQUIRE NO TABLE ENTRIES  *
02534  F20E              ;* AND ARE HANDLED SEPARATE.           *
02535  F20E              ;***************************************
02536  F20E              ;
02537  F20E  20 0F F3    NCHKIN JSR LOOKUP      ;SEE IF FILE KNOWN
02538  F211  F0 03              BEQ JX310       ;YUP...
02539  F213              ;
02540  F213  4C 01 F7           JMP ERROR3      ;NO...FILE NOT OPEN
02541  F216              ;
02542  F216  20 1F F3    JX310  JSR JZ100       ;EXTRACT FILE INFO
02543  F219              ;
02544  F219  A5 BA              LDA FA
02545  F21B  F0 16              BEQ JX320       ;IS KEYBOARD...DONE.
02546  F21D              ;
02547  F21D              ;COULD BE SCREEN, KEYBOARD, OR SERIAL
02548  F21D              ;
02549  F21D  C9 03              CMP #3
02550  F21F  F0 12              BEQ JX320       ;IS SCREEN...DONE.
02551  F221  B0 14              BCS JX330       ;IS SERIAL...ADDRESS IT
02552  F223  C9 02              CMP #2          ;RS232?
02553  F225  D0 03              BNE JX315       ;NO...
02554  F227              ;
02555  F227  4C 4D F0           JMP CKI232
02556  F22A              ;
02557  F22A              ;SOME EXTRA CHECKS FOR TAPE
02558  F22A              ;
02559  F22A  A6 B9       JX315  LDX SA
02560  F22C  E0 60              CPX #$60        ;IS COMMAND A READ?
02561  F22E  F0 03              BEQ JX320       ;YES...O.K....DONE
02562  F230              ;
02563  F230  4C 0A F7           JMP ERROR6      ;NOT INPUT FILE
02564  F233              ;
02565  F233  85 99       JX320  STA DFLTN       ;ALL INPUT COME FROM HERE
02566  F235              ;
02567  F235  18                 CLC             ;GOOD EXIT
02568  F236  60                 RTS
02569  F237              ;
02570  F237              ;AN SERIAL DEVICE HAS TO BE A TALKER
02571  F237              ;
02572  F237  AA          JX330  TAX             ;DEVICE # FOR DFLTO
02573  F238  20 09 ED           JSR TALK        ;TELL HIM TO TALK
02574  F23B              ;
02575  F23B  A5 B9              LDA SA          ;A SECOND?






OPEN CHANNEL......PAGE 0041

LINE# LOC   CODE        LINE


02576  F23D  10 06              BPL JX340       ;YES...SEND IT
02577  F23F  20 CC ED           JSR TKATN       ;NO...LET GO
02578  F242  4C 48 F2           JMP JX350
02579  F245              ;
02580  F245  20 C7 ED    JX340  JSR TKSA        ;SEND SECOND
02581  F248              ;
02582  F248  8A          JX350  TXA
02583  F249  24 90              BIT STATUS      ;DID HE LISTEN?
02584  F24B  10 E6              BPL JX320       ;YES
02585  F24D              ;
02586  F24D  4C 07 F7           JMP ERROR5      ;DEVICE NOT PRESENT


















































OPEN CHANNEL OUT......PAGE 0042

LINE# LOC   CODE        LINE


02588  F250              ;***************************************
02589  F250              ;* CHKOUT -- OPEN CHANNEL FOR OUTPUT     *
02590  F250              ;*                                     *
02591  F250              ;* THE NUMBER OF THE LOGICAL FILE TO BE*
02592  F250              ;* OPENED FOR OUTPUT IS PASSED IN .X.  *
02593  F250              ;* CHKOUT SEARCHES THE LOGICAL FILE    *
02594  F250              ;* TO LOOK UP DEVICE AND COMMAND INFO. *
02595  F250              ;* ERRORS ARE REPORTED IF THE DEVICE   *
02596  F250              ;* WAS NOT OPENED FOR INPUT ,(E.G.     *
02597  F250              ;* KEYBOARD), OR THE LOGICAL FILE HAS   *
02598  F250              ;* REFERENCE IN THE TABLES.             *
02599  F250              ;* DEVICE 0, (KEYBOARD), AND DEVICE 3  *
02600  F250              ;* (SCREEN), REQUIRE NO TABLE ENTRIES  *
02601  F250              ;* AND ARE HANDLED SEPARATE.           *
02602  F250              ;***************************************
02603  F250              ;
02604  F250  20 0F F3    NCKOUT JSR LOOKUP      ;IS FILE IN TABLE?
02605  F253  F0 03              BEQ CK5         ;YES...
02606  F255              ;
02607  F255  4C 01 F7           JMP ERROR3      ;NO...FILE NOT OPEN
02608  F258              ;
02609  F258  20 1F F3    CK5    JSR JZ100       ;EXTRACT TABLE INFO
02610  F25B              ;
02611  F25B  A5 BA              LDA FA          ;IS IT KEYBOARD?
02612  F25D  D0 03              BNE CK10        ;NO...SOMETHING ELSE.
02613  F25F              ;
02614  F25F  4C 0D F7    CK20   JMP ERROR7      ;YES...NOT OUTPUT FILE
02615  F262              ;
02616  F262              ;COULD BE SCREEN,SERIAL,OR TAPES
02617  F262              ;
02618  F262  C9 03       CK10   CMP #3
02619  F264  F0 0F              BEQ CK30        ;IS SCREEN...DONE
02620  F266  B0 11              BCS CK40        ;IS SERIAL...ADDRESS IT
02621  F268  C9 02              CMP #2          ;RS232?
02622  F26A  D0 03              BNE CK15
02623  F26C              ;
02624  F26C  4C E1 EF           JMP CKO232
02625  F26F              ;
02626  F26F              ;
02627  F26F              ;SPECIAL TAPE CHANNEL HANDLING
02628  F26F              ;
02629  F26F  A6 B9       CK15   LDX SA
02630  F271  E0 60              CPX #$60        ;IS COMMAND READ?
02631  F273  F0 EA              BEQ CK20        ;YES...ERROR
02632  F275              ;
02633  F275  85 9A       CK30   STA DFLTO       ;ALL OUTPUT GOES HERE
02634  F277              ;
02635  F277  18                 CLC             ;GOOD EXIT
02636  F278  60                 RTS
02637  F279              ;
02638  F279  AA          CK40   TAX             ;SAVE DEVICE FOR DFLTO
02639  F27A  20 0C ED           JSR LISTN       ;TELL HIM TO LISTEN
02640  F27D              ;
02641  F27D  A5 B9              LDA SA          ;IS THERE A SECOND?
02642  F27F  10 05              BPL CK50        ;YES...






OPEN CHANNEL OUT......PAGE 0043

LINE# LOC   CODE        LINE


02643  F281              ;
02644  F281  20 BE ED           JSR SCATN       ;NO...RELEASE LINES
02645  F284  D0 03              BNE CK60        ;BRANCH ALWAYS
02646  F286              ;
02647  F286  20 B9 ED    CK50   JSR SECND       ;SEND SECOND...
02648  F289              ;
02649  F289  8A          CK60   TXA
02650  F28A  24 90              BIT STATUS      ;DID HE LISTEN?
02651  F28C  10 E7              BPL CK30        ;YES...FINISH UP
02652  F28E              ;
02653  F28E  4C 07 F7           JMP ERROR5      ;NO...DEVICE NOT PRESENT
02654  F291              .END
02655  F291              .LIB   CLOSE
















































CLOSE......PAGE 0044

LINE# LOC   CODE        LINE


02657  F291              ;***************************************
02658  F291              ;* CLOSE -- CLOSE LOGICAL FILE       *
02659  F291              ;*                                   *
02660  F291              ;*     THE LOGICAL FILE NUMBER OF THE*
02661  F291              ;* FILE TO BE CLOSED IS PASSED IN .A.*
02662  F291              ;* KEYBOARD, SCREEN, AND FILES NOT   *
02663  F291              ;* OPEN PASS STRAIGHT THROUGH. TAPE  *
02664  F291              ;* FILES OPEN FOR WRITE ARE CLOSED BY*
02665  F291              ;* DUMPING THE LAST BUFFER AND       *
02666  F291              ;* CONDITIONALLY WRITING AN END OF   *
02667  F291              ;* TAPE BLOCK.SERIAL FILES ARE CLOSED*
02668  F291              ;* BY SENDING A CLOSE FILE COMMAND IF*
02669  F291              ;* A SECONDARY ADDRESS WAS SPECIFIED *
02670  F291              ;* IN ITS OPEN COMMAND.              *
02671  F291              ;***************************************
02672  F291              ;
02673  F291  20 14 F3    NCLOSE JSR JLTLK       ;LOOK FILE UP
02674  F294  F0 02              BEQ JX050       ;OPEN...
02675  F296  18                 CLC             ;ELSE RETURN
02676  F297  60                 RTS
02677  F298              ;
02678  F298  20 1F F3    JX050  JSR JZ100       ;EXTRACT TABLE DATA
02679  F29B  8A                 TXA             ;SAVE TABLE INDEX
02680  F29C  48                 PHA
02681  F29D              ;
02682  F29D  A5 BA              LDA FA          ;CHECK DEVICE NUMBER
02683  F29F  F0 50              BEQ JX150       ;IS KEYBOARD...DONE
02684  F2A1  C9 03              CMP #3
02685  F2A3  F0 4C              BEQ JX150       ;IS SCREEN...DONE
02686  F2A5  B0 47              BCS JX120       ;IS SERIAL...PROCESS
02687  F2A7  C9 02              CMP #2          ;RS232?
02688  F2A9  D0 1D              BNE JX115       ;NO...
02689  F2AB              ;
02690  F2AB              ; RS-232 CLOSE
02691  F2AB              ;
02692  F2AB              ; REMOVE FILE FROM TABLES
02693  F2AB  68                 PLA
02694  F2AC  20 F2 F2           JSR JXRMV
02695  F2AF              ;
02696  F2AF  20 83 F4           JSR CLN232      ;CLEAN UP RS232 FOR CLOSE
02697  F2B2              ;
02698  F2B2              ; DEALLOCATE BUFFERS
02699  F2B2              ;
02700  F2B2  20 27 FE           JSR GETTOP      ;GET MEMSIZ
02701  F2B5  A5 F8              LDA RIBUF+1     ;CHECK INPUT ALLOCATION
02702  F2B7  F0 01              BEQ CLS010      ;NOT...ALLOCATED
02703  F2B9  C8                 INY
02704  F2BA  A5 FA       CLS010 LDA ROBUF+1     ;CHECK OUTPUT ALLOCATION
02705  F2BC  F0 01              BEQ CLS020
02706  F2BE  C8                 INY
02707  F2BF  A9 00       CLS020 LDA #00         ;DEALLOCATE
02708  F2C1  85 F8              STA RIBUF+1
02709  F2C3  85 FA              STA ROBUF+1
02710  F2C5              ; FLAG TOP OF MEMORY CHANGE
02711  F2C5  4C 7D F4           JMP MEMTCF      ;GO SET NEW TOP






CLOSE......PAGE 0045

LINE# LOC   CODE        LINE


02712  F2C8              ;
02713  F2C8              ;CLOSE CASSETTE FILE
02714  F2C8              ;
02715  F2C8  A5 B9       JX115  LDA SA          ;WAS IT A TAPE READ?
02716  F2CA  29 0F              AND #$F
02717  F2CC  F0 23              BEQ JX150       ;YES
02718  F2CE              ;
02719  F2CE  20 D0 F7           JSR ZZZ         ;NO. . .IT IS WRITE
02720  F2D1  A9 00              LDA #0          ;END OF FILE CHARACTER
02721  F2D3  38                 SEC             ;NEED TO SET CARRY FOR CASOUT (ELSE RS232 OUTPUT!)
02722  F2D4  20 DD F1           JSR CASOUT      ;PUT IN END OF FILE
02723  F2D7  20 64 F8           JSR WBLK
02724  F2DA  90 04              BCC JX117       ;NO ERRORS...
02725  F2DC  68                 PLA             ;CLEAN STACK FOR ERROR
02726  F2DD  A9 00              LDA #0          ;BREAK KEY ERROR
02727  F2DF  60                 RTS
02728  F2E0              ;
02729  F2E0  A5 B9       JX117  LDA SA
02730  F2E2  C9 62              CMP #$62        ;WRITE END OF TAPE BLOCK?
02731  F2E4  D0 0B              BNE JX150       ;NO...
02732  F2E6              ;
02733  F2E6  A9 05              LDA #EOT
02734  F2E8  20 6A F7           JSR TAPEH       ;WRITE END OF TAPE BLOCK
02735  F2EB  4C F1 F2           JMP JX150
02736  F2EE              ;
02737  F2EE              ;CLOSE AN SERIAL FILE
02738  F2EE              ;
02739  F2EE  20 42 F6    JX120  JSR CLSEI
02740  F2F1              ;
02741  F2F1              ;ENTRY TO REMOVE A GIVE LOGICAL FILE
02742  F2F1              ;FROM TABLE OF LOGICAL, PRIMARY,
02743  F2F1              ;AND SECONDARY ADDRESSES
02744  F2F1              ;
02745  F2F1  68          JX150  PLA             ;GET TABLE INDEX OFF STACK
02746  F2F2              ;
02747  F2F2              ; JXRMV - ENTRY TO USE AS AN RS-232 SUBROUTINE
02748  F2F2              ;
02749  F2F2  AA          JXRMV  TAX
02750  F2F3  C6 98              DEC LDTND
02751  F2F5  E4 98              CPX LDTND       ;IS DELETED FILE AT END?
02752  F2F7  F0 14              BEQ JX170       ;YES...DONE
02753  F2F9              ;
02754  F2F9              ;DELETE ENTRY IN MIDDLE BY MOVING
02755  F2F9              ;LAST ENTRY TO THAT POSITION.
02756  F2F9              ;
02757  F2F9  A4 98              LDY LDTND
02758  F2FB  B9 59 02           LDA LAT,Y
02759  F2FE  9D 59 02           STA LAT,X
02760  F301  B9 63 02           LDA FAT,Y
02761  F304  9D 63 02           STA FAT,X
02762  F307  B9 6D 02           LDA SAT,Y
02763  F30A  9D 6D 02           STA SAT,X
02764  F30D              ;
02765  F30D  18          JX170  CLC             ;CLOSE EXIT
02766  F30E  60          JX175  RTS






CLOSE......PAGE 0046

LINE# LOC   CODE        LINE


02768  F30F              ;LOOKUP TABLIZED LOGICAL FILE DATA
02769  F30F              ;
02770  F30F  A9 00       LOOKUP LDA #0
02771  F311  85 90              STA STATUS
02772  F313  8A                 TXA
02773  F314  A6 98       JLTLK  LDX LDTND
02774  F316  CA          JX600  DEX
02775  F317  30 15              BMI JZ101
02776  F319  DD 59 02           CMP LAT,X
02777  F31C  D0 F8              BNE JX600
02778  F31E  60                 RTS





02780  F31F              ;ROUTINE TO FETCH TABLE ENTRIES
02781  F31F              ;
02782  F31F  BD 59 02    JZ100  LDA LAT,X
02783  F322  85 B8              STA LA
02784  F324  BD 63 02           LDA FAT,X
02785  F327  85 BA              STA FA
02786  F329  BD 6D 02           LDA SAT,X
02787  F32C  85 B9              STA SA
02788  F32E  60          JZ101  RTS
02789  F32F              .END
02790  F32F              .LIB   CLALL


































CLOSE ALL FILES......PAGE 0047

LINE# LOC   CODE        LINE


02792  F32F              ;***************************************
02793  F32F              ;* CLALL -- CLOSE ALL LOGICAL FILES  *
02794  F32F              ;*      DELETES ALL TABLE ENTRIES AND*
02795  F32F              ;* RESTORES DEFAULT I/O CHANNELS     *
02796  F32F              ;* AND CLEARS IEEE PORT DEVICES      *
02797  F32F              ;*************************************
02798  F32F              ;
02799  F32F  A9 00       NCLALL LDA #0
02800  F331  85 98              STA LDTND       ;FORGET ALL FILES



02802  F333              ;********************************************
02803  F333              ;* CLRCH -- CLEAR CHANNELS                  *
02804  F333              ;*   UNLISTEN OR UNTALK IEEE DEVICES, BUT   *
02805  F333              ;* LEAVE OTHERS ALONE.  DEFAULT CHANNELS    *
02806  F333              ;* ARE RESTORED.                            *
02807  F333              ;********************************************
02808  F333              ;
02809  F333  A2 03       NCLRCH LDX #3
02810  F335  E4 9A              CPX DFLTO       ;IS OUTPUT CHANNEL IEEE?
02811  F337  B0 03              BCS JX750       ;NO...
02812  F339              ;
02813  F339  20 FE ED           JSR UNLSN       ;YES...UNLISTEN IT
02814  F33C              ;
02815  F33C  E4 99       JX750  CPX DFLTN       ;IS INPUT CHANNEL IEEE?
02816  F33E  B0 03              BCS CLALL2      ;NO...
02817  F340              ;
02818  F340  20 EF ED           JSR UNTLK       ;YES...UNTALK IT
02819  F343              ;
02820  F343              ;RESTORE DEFAULT VALUES
02821  F343              ;
02822  F343              ;
02823  F343  86 9A       CLALL2 STX DFLTO       ;OUTPUT CHAN=3=SCREEN
02824  F345  A9 00              LDA #0
02825  F347  85 99              STA DFLTN       ;INPUT CHAN=0=KEYBOARD
02826  F349  60                 RTS
02827  F34A              .END
02828  F34A              .LIB   OPEN






















OPEN FILE......PAGE 0048

LINE# LOC   CODE        LINE


02830  F34A              ;***********************************
02831  F34A              ;*                                 *
02832  F34A              ;* OPEN FUNCTION                   *
02833  F34A              ;*                                 *
02834  F34A              ;* CREATES AN ENTRY IN THE LOGICAL *
02835  F34A              ;* FILES TABLES CONSISTING OF      *
02836  F34A              ;* LOGICAL FILE NUMBER--LA, DEVICE *
02837  F34A              ;* NUMBER--FA, AND SECONDARY CMD-- *
02838  F34A              ;* SA.                             *
02839  F34A              ;*                                 *
02840  F34A              ;* A FILE NAME DESCRIPTOR, FNADR & *
02841  F34A              ;* FNLEN ARE PASSED TO THIS ROUTINE*
02842  F34A              ;*                                 *
02843  F34A              ;***********************************
02844  F34A              ;
02845  F34A  A6 B8       NOPEN  LDX LA          ;CHECK FILE #
02846  F34C  D0 03              BNE OP98        ;IS NOT THE KEYBOARD
02847  F34E              ;
02848  F34E  4C 0A F7           JMP ERROR6      ;NOT INPUT FILE...
02849  F351              ;
02850  F351  20 0F F3    OP98   JSR LOOKUP      ;SEE IF IN TABLE
02851  F354  D0 03              BNE OP100       ;NOT FOUND...O.K.
02852  F356              ;
02853  F356  4C FE F6           JMP ERROR2      ;FILE OPEN
02854  F359              ;
02855  F359  A6 98       OP100  LDX LDTND       ;LOGICAL DEVICE TABLE END
02856  F35B  E0 0A              CPX #10         ;MAXIMUM # OF OPEN FILES
02857  F35D  90 03              BCC OP110       ;LESS THAN 10...O.K.
02858  F35F              ;
02859  F35F  4C FB F6           JMP ERROR1      ;TOO MANY FILES
02860  F362              ;
02861  F362  E6 98       OP110  INC LDTND       ;NEW FILE
02862  F364  A5 B8              LDA LA
02863  F366  9D 59 02           STA LAT,X       ;STORE LOGICAL FILE #
02864  F369  A5 B9              LDA SA
02865  F36B  09 60              ORA #$60        ;MAKE SA AN SERIAL COMMAND
02866  F36D  85 B9              STA SA
02867  F36F  9D 6D 02           STA SAT,X       ;STORE COMMAND #
02868  F372  A5 BA              LDA FA
02869  F374  9D 63 02           STA FAT,X       ;STORE DEVICE #
02870  F377              ;
02871  F377              ;PERFORM DEVICE SPECIFIC OPEN TASKS
02872  F377              ;
02873  F377  F0 5A              BEQ OP175       ;IS KEYBOARD...DONE.
02874  F379  C9 03              CMP #3
02875  F37B  F0 56              BEQ OP175       ;IS SCREEN...DONE.
02876  F37D  90 05              BCC OP150       ;ARE CASSETTES 1 & 2
02877  F37F              ;
02878  F37F  20 D5 F3           JSR OPENI       ;IS ON SERIAL...OPEN IT
02879  F382  90 4F              BCC OP175       ;BRANCH ALWAYS...DONE
02880  F384              ;
02881  F384              ;PERFORM TAPE OPEN STUFF
02882  F384              ;
02883  F384  C9 02       OP150  CMP #2
02884  F386  D0 03              BNE OP152






OPEN FILE......PAGE 0049

LINE# LOC   CODE        LINE


02885  F388              ;
02886  F388  4C 09 F4           JMP OPN232
02887  F38B              ;
02888  F38B  20 D0 F7    OP152  JSR ZZZ         ;SEE IF TAPE BUFFER
02889  F38E  B0 03              BCS OP155       ;YES
02890  F390              ;
02891  F390  4C 13 F7           JMP ERROR9      ;NO...DEALLOCATED
02892  F393              ;
02893  F393  A5 B9       OP155  LDA SA
02894  F395  29 0F              AND #$F         ;MASK OFF COMMAND
02895  F397  D0 1F              BNE OP200       ;NON ZERO IS TAPE WRITE
02896  F399              ;
02897  F399              ;OPEN CASSETE TAPE FILE TO READ
02898  F399              ;
02899  F399  20 17 F8           JSR CSTE1       ;TELL "PRESS PLAY"
02900  F39C  B0 36              BCS OP180       ;STOP KEY PRESSED
02901  F39E              ;
02902  F39E  20 AF F5           JSR LUKING      ;TELL USER "SEARCHING"
02903  F3A1              ;
02904  F3A1  A5 B7              LDA FNLEN
02905  F3A3  F0 0A              BEQ OP170       ;LOOKING FOR ANY FILE
02906  F3A5              ;
02907  F3A5  20 EA F7           JSR FAF         ;LOOKING FOR NAMED FILE
02908  F3A8  90 18              BCC OP171       ;FOUND IT!!!
02909  F3AA  F0 28              BEQ OP180       ;STOP KEY PRESSED
02910  F3AC              ;
02911  F3AC  4C 04 F7    OP160  JMP ERROR4      ;FILE NOT FOUND
02912  F3AF              ;
02913  F3AF  20 2C F7    OP170  JSR FAH         ;GET ANY OLD HEADER
02914  F3B2  F0 20              BEQ OP180       ;STOP KEY PRESSED
02915  F3B4  90 0C              BCC OP171       ;ALL O.K.
02916  F3B6  B0 F4              BCS OP160       ;FILE NOT FOUND...
02917  F3B8              ;
02918  F3B8              ;OPEN CASSETTE TAPE FOR WRITE
02919  F3B8              ;
02920  F3B8  20 38 F8    OP200  JSR CSTE2       ;TELL "PRESS PLAY AND RECORD"
02921  F3BB  B0 17              BCS OP180       ;STOP KEY PRESSED
02922  F3BD  A9 04              LDA #BDFH       ;DATA FILE HEADER TYPE
02923  F3BF  20 6A F7           JSR TAPEH       ;WRITE IT
02924  F3C2              ;
02925  F3C2              ;FINISH OPEN FOR TAPE READ/WRITE
02926  F3C2              ;
02927  F3C2  A9 BF       OP171  LDA #BUFSZ-1    ;ASSUME FORCE READ
02928  F3C4              ;
02929  F3C4  A4 B9              LDY SA
02930  F3C6  C0 60              CPY #$60        ;OPEN FOR READ?
02931  F3C8  F0 07              BEQ OP172
02932  F3CA              ;
02933  F3CA              ;SET POINTERS FOR BUFFERING DATA
02934  F3CA              ;
02935  F3CA  A0 00              LDY #0
02936  F3CC  A9 02              LDA #BDF        ;TYPE FLAG FOR BLOCK
02937  F3CE  91 B2              STA (TAPE1)Y    ;TO BEGIN OF BUFFER
02938  F3D0  98                 TYA
02939  F3D1              ;






OPEN FILE......PAGE 004A

LINE# LOC   CODE        LINE


02940  F3D1  85 A6       OP172  STA BUFPT       ;POINT TO DATA
02941  F3D3  18          OP175  CLC             ;FLAG GOOD OPEN
02942  F3D4  60          OP180  RTS             ;EXIT IN PEACE





02944  F3D5  A5 B9       OPENI  LDA SA
02945  F3D7  30 FA              BMI OP175       ;NO SA...DONE
02946  F3D9              ;
02947  F3D9  A4 B7              LDY FNLEN
02948  F3DB  F0 F6              BEQ OP175       ;NO FILE NAME...DONE
02949  F3DD              ;
02950  F3DD  A9 00              LDA #0          ;CLEAR THE SERIAL STATUS
02951  F3DF  85 90              STA STATUS
02952  F3E1              ;
02953  F3E1  A5 BA              LDA FA
02954  F3E3  20 0C ED           JSR LISTN       ;DEVICE LA TO LISTEN
02955  F3E6              ;
02956  F3E6  A5 B9              LDA SA
02957  F3E8  09 F0              ORA #$F0
02958  F3EA  20 B9 ED           JSR SECND
02959  F3ED              ;
02960  F3ED  A5 90              LDA STATUS      ;ANYBODY HOME?
02961  F3EF  10 05              BPL OP35        ;YES...CONTINUE
02962  F3F1              ;
02963  F3F1              ;THIS ROUTINE IS CALLED BY OTHER
02964  F3F1              ;KERNAL ROUTINES WHICH ARE CALLED
02965  F3F1              ;DIRECTLY BY OS.  KILL RETURN
02966  F3F1              ;ADDRESS TO RETURN TO OS.
02967  F3F1              ;
02968  F3F1  68                 PLA
02969  F3F2  68                 PLA
02970  F3F3  4C 07 F7           JMP ERROR5      ;DEVICE NOT PRESENT
02971  F3F6              ;
02972  F3F6  A5 B7       OP35   LDA FNLEN
02973  F3F8  F0 0C              BEQ OP45        ;NO NAME...DONE SEQUENCE
02974  F3FA              ;
02975  F3FA              ;SEND FILE NAME OVER SERIAL
02976  F3FA              ;
02977  F3FA  A0 00              LDY #0
02978  F3FC  B1 BB       OP40   LDA (FNADR)Y
02979  F3FE  20 DD ED           JSR CIOUT
02980  F401  C8                 INY
02981  F402  C4 B7              CPY FNLEN
02982  F404  D0 F6              BNE OP40
02983  F406              ;
02984  F406  4C 54 F6    OP45   JMP CUNLSN      ;JSR UNLSN: CLC: RTS












OPEN RS232 FILE......PAGE 004B

LINE# LOC   CODE        LINE


02986  F409              ; OPN232 - OPEN AN RS-232 OR PARALLEL PORT FILE
02987  F409              ;
02988  F409              ; VARIABLES INITILIZED
02989  F409              ;   BITNUM - # OF BITS TO BE SENT CALC FROM M51CTR
02990  F409              ;   BAUDOF - BAUD RATE FULL
02991  F409              ;   RSSTAT - RS-232 STATUS REG
02992  F409              ;   M51CTR - 6551 CONTROL REG
02993  F409              ;   M51CDR - 6551 COMMAND REG
02994  F409              ;   M51AJB - USER BAUD RATE (CLOCK/BAUD/2-100)
02995  F409              ;   ENABL  - 6526 NMI ENABLES (1-NMI BIT ON)
02996  F409              ;
02997  F409  20 83 F4    OPN232 JSR CLN232      ;SET UP RS232, .Y=0 ON RETURN
02998  F40C              ;
02999  F40C              ; PASS PRAMS TO M51REGS
03000  F40C              ;
03001  F40C  8C 97 02           STY RSSTAT      ;CLEAR STATUS
03002  F40F              ;
03003  F40F  C4 B7       OPN020 CPY FNLEN       ;CHECK IF AT END OF FILENAME
03004  F411  F0 0A              BEQ OPN025      ;YES...
03005  F413              ;
03006  F413  B1 BB              LDA (FNADR)Y    ;MOVE DATA
03007  F415  99 93 02           STA M51CTR,Y    ;TO M51REGS
03008  F418  C8                 INY
03009  F419  C0 04              CPY #4          ;ONLY 4 POSSIBLE PRAMS
03010  F41B  D0 F2              BNE OPN020
03011  F41D              ;
03012  F41D              ; CALC # OF BITS
03013  F41D              ;
03014  F41D  20 4A EF    OPN025 JSR BITCNT
03015  F420  8E 98 02           STX BITNUM
03016  F423              ;
03017  F423              ; CALC BAUD RATE
03018  F423              ;
03019  F423  AD 93 02           LDA M51CTR
03020  F426  29 0F              AND #$0F
03021  F428  F0 1C              BEQ OPN028
03022  F42A              ;
03023  F42A              ; CALCULATE START-TEST RATE...
03024  F42A              ;  DIFFERENT THAN ORIGINAL RELEASE 901227-01
03025  F42A              ;
03026  F42A  0A                 ASL A           ;GET OFFSET INTO TABLES
03027  F42B  AA                 TAX
03028  F42C  AD A6 02           LDA PALNTS      ;GET TV STANDARD
03029  F42F  D0 09              BNE OPN026
03030  F431  BC C1 FE           LDY BAUDO-1,X   ;NTSC STANDARD
03031  F434  BD C0 FE           LDA BAUDO-2,X
03032  F437  4C 40 F4           JMP OPN027
03033  F43A              ;
03034  F43A  BC EB E4    OPN026 LDY BAUDOP-1,X  ;PAL STANDARD
03035  F43D  BD EA E4           LDA BAUDOP-2,X
03036  F440  8C 96 02    OPN027 STY M51AJB+1    ;HOLD START RATE IN M51AJB
03037  F443  8D 95 02           STA M51AJB
03038  F446  AD 95 02    OPN028 LDA M51AJB      ;CALCULATE BAUD RATE
03039  F449  0A                 ASL A
03040  F44A  20 2E FF           JSR POPEN       ;GOTO PATCH AREA






OPEN RS232 FILE......PAGE 004C

LINE# LOC   CODE        LINE


03041  F44D              ;
03042  F44D              ; CHECK FOR 3/X LINE RESPONSE
03043  F44D              ;
03044  F44D  AD 94 02    OPN030 LDA M51CDR      ;BIT 0 OF M51CDR
03045  F450  4A                 LSR A
03046  F451  90 09              BCC OPN050      ;...3 LINE
03047  F453              ;
03048  F453              ; CHECK FOR X LINE PROPER STATES
03049  F453              ;
03050  F453  AD 01 DD           LDA D2PRB
03051  F456  0A                 ASL A
03052  F457  B0 03              BCS OPN050
03053  F459  20 0D F0           JSR CKDSRX      ;CHANGE FROM JMP TO PREVENT SYSTEM DAMAGE (901227-02)
03054  F45C              ;
03055  F45C              ; SET UP BUFFER POINTERS (DBE=DBS)
03056  F45C              ;
03057  F45C  AD 9B 02    OPN050 LDA RIDBE
03058  F45F  8D 9C 02           STA RIDBS
03059  F462  AD 9E 02           LDA RODBE
03060  F465  8D 9D 02           STA RODBS
03061  F468              ;
03062  F468              ; ALLOCATE BUFFERS
03063  F468              ;
03064  F468  20 27 FE    OPN055 JSR GETTOP      ;GET MEMSIZ
03065  F46B  A5 F8              LDA RIBUF+1     ;IN ALLOCATION...
03066  F46D  D0 05              BNE OPN060      ;ALREADY
03067  F46F  88                 DEY             ;THERE GOES 256 BYTES
03068  F470  84 F8              STY RIBUF+1
03069  F472  86 F7              STX RIBUF
03070  F474  A5 FA       OPN060 LDA ROBUF+1     ;OUT ALLOCATION...
03071  F476  D0 05              BNE MEMTCF      ;ALREAY
03072  F478  88                 DEY             ;THERE GOES 256 BYTES
03073  F479  84 FA              STY ROBUF+1
03074  F47B  86 F9              STX ROBUF
03075  F47D  38          MEMTCF SEC             ;SIGNAL TOP OF MEMORY CHANGE
03076  F47E  A9 F0              LDA #$F0
03077  F480  4C 2D FE           JMP SETTOP      ;TOP CHANGED
03078  F483              ;
03079  F483              ; CLN232 - CLEAN UP 232 SYSTEM FOR OPEN/CLOSE
03080  F483              ;  SET UP DDRB AND CB2 FOR RS-232
03081  F483              ;
03082  F483  A9 7F       CLN232 LDA #$7F        ;CLEAR NMI'S
03083  F485  8D 0D DD           STA D2ICR
03084  F488  A9 06              LDA #%00000110  ;DDRB
03085  F48A  8D 03 DD           STA D2DDRB
03086  F48D  8D 01 DD           STA D2PRB       ;DTR,RTS HIGH
03087  F490  A9 04              LDA #$04        ;OUTPUT HIGH PA2
03088  F492  0D 00 DD           ORA D2PRA
03089  F495  8D 00 DD           STA D2PRA
03090  F498  A0 00              LDY #00
03091  F49A  8C A1 02           STY ENABL       ;CLEAR ENABLS
03092  F49D  60                 RTS
03093  F49E              .END
03094  F49E              .LIB   LOAD







LOAD FUNCTION......PAGE 004D

LINE# LOC   CODE        LINE


03096  F49E              ;**********************************
03097  F49E              ;* LOAD RAM FUNCTION              *
03098  F49E              ;*                                *
03099  F49E              ;* LOADS FROM CASSETTE 1 OR 2, OR *
03100  F49E              ;* SERIAL BUS DEVICES >=4 TO 31   *
03101  F49E              ;* AS DETERMINED BY CONTENTS OF   *
03102  F49E              ;* VARIABLE FA. VERIFY FLAG IN .A *
03103  F49E              ;*                                *
03104  F49E              ;* ALT LOAD IF SA=0, NORMAL SA=1  *
03105  F49E              ;* .X , .Y LOAD ADDRESS IF SA=0   *
03106  F49E              ;* .A=0 PERFORMS LOAD,<> IS VERIFY*
03107  F49E              ;*                                *
03108  F49E              ;* HIGH LOAD RETURN IN X,Y.       *
03109  F49E              ;*                                *
03110  F49E              ;**********************************



03112  F49E  86 C3       LOADSP STX MEMUSS      ;.X HAS LOW ALT START
03113  F4A0  84 C4              STY MEMUSS+1
03114  F4A2  6C 30 03    LOAD   JMP (ILOAD)     ;MONITOR LOAD ENTRY
03115  F4A5              ;
03116  F4A5  85 93       NLOAD  STA VERCK       ;STORE VERIFY FLAG
03117  F4A7  A9 00              LDA #0
03118  F4A9  85 90              STA STATUS
03119  F4AB              ;
03120  F4AB  A5 BA              LDA FA          ;CHECK DEVICE NUMBER
03121  F4AD  D0 03              BNE LD20
03122  F4AF              ;
03123  F4AF  4C 13 F7    LD10   JMP ERROR9      ;BAD DEVICE #-KEYBOARD
03124  F4B2              ;
03125  F4B2  C9 03       LD20   CMP #3
03126  F4B4  F0 F9              BEQ LD10        ;DISALLOW SCREEN LOAD
03127  F4B6  90 7B              BCC LD100       ;HANDLE TAPES DIFFERENT
03128  F4B8              ;
03129  F4B8              ;LOAD FROM CBM IEEE DEVICE
03130  F4B8              ;
03131  F4B8  A4 B7              LDY FNLEN       ;MUST HAVE FILE NAME
03132  F4BA  D0 03              BNE LD25        ;YES...OK
03133  F4BC              ;
03134  F4BC  4C 10 F7           JMP ERROR8      ;MISSING FILE NAME
03135  F4BF              ;
03136  F4BF  A6 B9       LD25   LDX SA          ;SAVE SA IN .X
03137  F4C1  20 AF F5           JSR LUKING      ;TELL USER LOOKING
03138  F4C4  A9 60              LDA #$60        ;SPECIAL LOAD COMMAND
03139  F4C6  85 B9              STA SA
03140  F4C8  20 D5 F3           JSR OPENI       ;OPEN THE FILE
03141  F4CB              ;
03142  F4CB  A5 BA              LDA FA
03143  F4CD  20 09 ED           JSR TALK        ;ESTABLISH THE CHANNEL
03144  F4D0  A5 B9              LDA SA
03145  F4D2  20 C7 ED           JSR TKSA        ;TELL IT TO LOAD
03146  F4D5              ;
03147  F4D5  20 13 EE           JSR ACPTR       ;GET FIRST BYTE
03148  F4D8  85 AE              STA EAL






LOAD FUNCTION......PAGE 004E

LINE# LOC   CODE        LINE


03149  F4DA              ;
03150  F4DA  A5 90              LDA STATUS      ;TEST STATUS FOR ERROR
03151  F4DC  4A                 LSR A
03152  F4DD  4A                 LSR A
03153  F4DE  B0 50              BCS LD90        ;FILE NOT FOUND...
03154  F4E0  20 13 EE           JSR ACPTR
03155  F4E3  85 AF              STA EAH
03156  F4E5              ;
03157  F4E5  8A                 TXA             ;FIND OUT OLD SA
03158  F4E6  D0 08              BNE LD30        ;SA<>0 USE DISK ADDRESS
03159  F4E8  A5 C3              LDA MEMUSS      ;ELSE LOAD WHERE USER WANTS
03160  F4EA  85 AE              STA EAL
03161  F4EC  A5 C4              LDA MEMUSS+1
03162  F4EE  85 AF              STA EAH
03163  F4F0  20 D2 F5    LD30   JSR LODING      ;TELL USER LOADING
03164  F4F3              ;
03165  F4F3  A9 FD       LD40   LDA #$FD        ;MASK OFF TIMEOUT
03166  F4F5  25 90              AND STATUS
03167  F4F7  85 90              STA STATUS
03168  F4F9              ;
03169  F4F9  20 E1 FF           JSR STOP        ;STOP KEY?
03170  F4FC  D0 03              BNE LD45        ;NO...
03171  F4FE              ;
03172  F4FE  4C 33 F6           JMP BREAK       ;STOP KEY PRESSED
03173  F501              ;
03174  F501  20 13 EE    LD45   JSR ACPTR       ;GET BYTE OFF IEEE
03175  F504  AA                 TAX
03176  F505  A5 90              LDA STATUS      ;WAS THERE A TIMEOUT?
03177  F507  4A                 LSR A
03178  F508  4A                 LSR A
03179  F509  B0 E8              BCS LD40        ;YES...TRY AGAIN
03180  F50B  8A                 TXA
03181  F50C  A4 93              LDY VERCK       ;PERFORMING VERIFY?
03182  F50E  F0 0C              BEQ LD50        ;NO...LOAD
03183  F510  A0 00              LDY #0
03184  F512  D1 AE              CMP (EAL)Y      ;VERIFY IT
03185  F514  F0 08              BEQ LD60        ;O.K....
03186  F516  A9 10              LDA #SPERR      ;NO GOOD...VERIFY ERROR
03187  F518  20 1C FE           JSR UDST        ;UPDATE STATUS
03188  F51B  2C                 .BYT $2C        ;SKIP NEXT STORE
03189  F51C              ;
03190  F51C  91 AE       LD50   STA (EAL)Y
03191  F51E  E6 AE       LD60   INC EAL         ;INCREMENT STORE ADDR
03192  F520  D0 02              BNE LD64
03193  F522  E6 AF              INC EAH
03194  F524  24 90       LD64   BIT STATUS      ;EOI?
03195  F526  50 CB              BVC LD40        ;NO...CONTINUE LOAD
03196  F528              ;
03197  F528  20 EF ED           JSR UNTLK       ;CLOSE CHANNEL
03198  F52B  20 42 F6           JSR CLSEI       ;CLOSE THE FILE
03199  F52E  90 79              BCC LD180       ;BRANCH ALWAYS
03200  F530              ;
03201  F530  4C 04 F7    LD90   JMP ERROR4      ;FILE NOT FOUND
03202  F533              ;
03203  F533              ;LOAD FROM TAPE






LOAD FUNCTION......PAGE 004F

LINE# LOC   CODE        LINE


03204  F533              ;
03205  F533  4A          LD100  LSR A
03206  F534  B0 03              BCS LD102       ;IF C-SET THEN IT'S CASSETTE
03207  F536              ;
03208  F536  4C 13 F7           JMP ERROR9      ;BAD DEVICE #
03209  F539              ;
03210  F539  20 D0 F7    LD102  JSR ZZZ         ;SET POINTERS AT TAPE
03211  F53C  B0 03              BCS LD104
03212  F53E  4C 13 F7           JMP ERROR9      ;DEALLOCATED...
03213  F541  20 17 F8    LD104  JSR CSTE1       ;TELL USER ABOUT BUTTONS
03214  F544  B0 68              BCS LD190       ;STOP KEY PRESSED?
03215  F546  20 AF F5           JSR LUKING      ;TELL USER SEARCHING
03216  F549              ;
03217  F549  A5 B7       LD112  LDA FNLEN       ;IS THERE A NAME?
03218  F54B  F0 09              BEQ LD150       ;NONE...LOAD ANYTHING
03219  F54D  20 EA F7           JSR FAF         ;FIND A FILE ON TAPE
03220  F550  90 0B              BCC LD170       ;GOT IT!
03221  F552  F0 5A              BEQ LD190       ;STOP KEY PRESSED
03222  F554  B0 DA              BCS LD90        ;NOPE...END OF TAPE
03223  F556              ;
03224  F556  20 2C F7    LD150  JSR FAH         ;FIND ANY HEADER
03225  F559  F0 53              BEQ LD190       ;STOP KEY PRESSED
03226  F55B  B0 D3              BCS LD90        ;NO HEADER
03227  F55D              ;
03228  F55D  A5 90       LD170  LDA STATUS
03229  F55F  29 10              AND #SPERR      ;MUST GOT HEADER RIGHT
03230  F561  38                 SEC
03231  F562  D0 4A              BNE LD190       ;IS BAD
03232  F564              ;
03233  F564  E0 01              CPX #BLF        ;IS IT A MOVABLE PROGRAM...
03234  F566  F0 11              BEQ LD178       ;YES
03235  F568              ;
03236  F568  E0 03              CPX #PLF        ;IS IT A PROGRAM
03237  F56A  D0 DD              BNE LD112       ;NO...ITS SOMETHING ELSE
03238  F56C              ;
03239  F56C  A0 01       LD177  LDY #1          ;FIXED LOAD...
03240  F56E  B1 B2              LDA (TAPE1)Y    ;...THE ADDRESS IN THE...
03241  F570  85 C3              STA MEMUSS      ;...BUFFER IS THE START ADDRESS
03242  F572  C8                 INY
03243  F573  B1 B2              LDA (TAPE1)Y
03244  F575  85 C4              STA MEMUSS+1
03245  F577  B0 04              BCS LD179       ;JMP ..CARRY SET BY CPX'S
03246  F579              ;
03247  F579  A5 B9       LD178  LDA SA          ;CHECK FOR MONITOR LOAD...
03248  F57B  D0 EF              BNE LD177       ;...YES WE WANT FIXED TYPE
03249  F57D              ;
03250  F57D  A0 03       LD179  LDY #3          ;TAPEA - TAPESTA
03251  F57F              ;CARRY SET BY CPX'S
03252  F57F  B1 B2              LDA (TAPE1)Y
03253  F581  A0 01              LDY #1
03254  F583  F1 B2              SBC (TAPE1)Y
03255  F585  AA                 TAX             ;LOW TO .X
03256  F586  A0 04              LDY #4
03257  F588  B1 B2              LDA (TAPE1)Y
03258  F58A  A0 02              LDY #2






LOAD FUNCTION......PAGE 0050

LINE# LOC   CODE        LINE


03259  F58C  F1 B2              SBC (TAPE1)Y
03260  F58E  A8                 TAY             ;HIGH TO .Y
03261  F58F              ;
03262  F58F  18                 CLC             ;EA = STA+(TAPEA-TAPESTA)
03263  F590  8A                 TXA
03264  F591  65 C3              ADC MEMUSS      ;
03265  F593  85 AE              STA EAL
03266  F595  98                 TYA
03267  F596  65 C4              ADC MEMUSS+1
03268  F598  85 AF              STA EAH
03269  F59A  A5 C3              LDA MEMUSS      ;SET UP STARTING ADDRESS
03270  F59C  85 C1              STA STAL
03271  F59E  A5 C4              LDA MEMUSS+1
03272  F5A0  85 C2              STA STAH
03273  F5A2  20 D2 F5           JSR LODING      ;TELL USER LOADING
03274  F5A5  20 4A F8           JSR TRD         ;DO TAPE BLOCK LOAD
03275  F5A8  24                 .BYT $24        ;CARRY FROM TRD
03276  F5A9              ;
03277  F5A9  18          LD180  CLC             ;GOOD EXIT
03278  F5AA              ;
03279  F5AA              ; SET UP END LOAD ADDRESS
03280  F5AA              ;
03281  F5AA  A6 AE              LDX EAL
03282  F5AC  A4 AF              LDY EAH
03283  F5AE              ;
03284  F5AE  60          LD190  RTS





03286  F5AF              ;SUBROUTINE TO PRINT TO CONSOLE:
03287  F5AF              ;
03288  F5AF              ;SEARCHING [FOR NAME]
03289  F5AF              ;
03290  F5AF  A5 9D       LUKING LDA MSGFLG      ;SUPPOSED TO PRINT?
03291  F5B1  10 1E              BPL LD115       ;...NO
03292  F5B3  A0 0C              LDY #MS5-MS1    ;"SEARCHING"
03293  F5B5  20 2F F1           JSR MSG
03294  F5B8  A5 B7              LDA FNLEN
03295  F5BA  F0 15              BEQ LD115
03296  F5BC  A0 17              LDY #MS6-MS1    ;"FOR"
03297  F5BE  20 2F F1           JSR MSG



03299  F5C1              ;SUBROUTINE TO OUTPUT FILE NAME
03300  F5C1              ;
03301  F5C1  A4 B7       OUTFN  LDY FNLEN       ;IS THERE A NAME?
03302  F5C3  F0 0C              BEQ LD115       ;NO...DONE
03303  F5C5  A0 00              LDY #0
03304  F5C7  B1 BB       LD110  LDA (FNADR)Y
03305  F5C9  20 D2 FF           JSR BSOUT
03306  F5CC  C8                 INY
03307  F5CD  C4 B7              CPY FNLEN






LOAD FUNCTION......PAGE 0051

LINE# LOC   CODE        LINE


03308  F5CF  D0 F6              BNE LD110
03309  F5D1              ;
03310  F5D1  60          LD115  RTS



03312  F5D2              ;SUBROUTINE TO PRINT:
03313  F5D2              ;
03314  F5D2              ;LOADING/VERIFING
03315  F5D2              ;
03316  F5D2  A0 49       LODING LDY #MS10-MS1   ;ASSUME 'LOADING'
03317  F5D4  A5 93              LDA VERCK       ;CHECK FLAG
03318  F5D6  F0 02              BEQ LD410       ;ARE DOING LOAD
03319  F5D8  A0 59              LDY #MS21-MS1   ;ARE 'VERIFYING'
03320  F5DA  4C 2B F1    LD410  JMP SPMSG
03321  F5DD              .END
03322  F5DD              .LIB   SAVE












































SAVE FUNCTION......PAGE 0052

LINE# LOC   CODE        LINE


03324  F5DD              ;***********************************
03325  F5DD              ;* SAVE                            *
03326  F5DD              ;*                                 *
03327  F5DD              ;* SAVES TO CASSETTE 1 OR 2, OR    *
03328  F5DD              ;* IEEE DEVICES 4>=N>=31 AS SELECT-*
03329  F5DD              ;* ED BY VARIABLE FA.              *
03330  F5DD              ;*                                 *
03331  F5DD              ;*START OF SAVE IS INDIRECT AT .A  *
03332  F5DD              ;*END OF SAVE IS .X,.Y             *
03333  F5DD              ;***********************************



03335  F5DD  86 AE       SAVESP STX EAL
03336  F5DF  84 AF              STY EAH
03337  F5E1  AA                 TAX             ;SET UP START
03338  F5E2  B5 00              LDA $00,X
03339  F5E4  85 C1              STA STAL
03340  F5E6  B5 01              LDA $01,X
03341  F5E8  85 C2              STA STAH
03342  F5EA              ;
03343  F5EA  6C 32 03    SAVE   JMP (ISAVE)
03344  F5ED  A5 BA       NSAVE  LDA FA  ***MONITOR ENTRY
03345  F5EF  D0 03              BNE SV20
03346  F5F1              ;
03347  F5F1  4C 13 F7    SV10   JMP ERROR9      ;BAD DEVICE #
03348  F5F4              ;
03349  F5F4  C9 03       SV20   CMP #3
03350  F5F6  F0 F9              BEQ SV10
03351  F5F8  90 5F              BCC SV100
03352  F5FA  A9 61              LDA #$61
03353  F5FC  85 B9              STA SA
03354  F5FE  A4 B7              LDY FNLEN
03355  F600  D0 03              BNE SV25
03356  F602              ;
03357  F602  4C 10 F7           JMP ERROR8      ;MISSING FILE NAME
03358  F605              ;
03359  F605  20 D5 F3    SV25   JSR OPENI
03360  F608  20 8F F6           JSR SAVING
03361  F60B  A5 BA              LDA FA
03362  F60D  20 0C ED           JSR LISTN
03363  F610  A5 B9              LDA SA
03364  F612  20 B9 ED           JSR SECND
03365  F615  A0 00              LDY #0
03366  F617  20 8E FB           JSR RD300
03367  F61A  A5 AC              LDA SAL
03368  F61C  20 DD ED           JSR CIOUT
03369  F61F  A5 AD              LDA SAH
03370  F621  20 DD ED           JSR CIOUT
03371  F624  20 D1 FC    SV30   JSR CMPSTE      ;COMPARE START TO END
03372  F627  B0 16              BCS SV50        ;HAVE REACHED END
03373  F629  B1 AC              LDA (SAL)Y
03374  F62B  20 DD ED           JSR CIOUT
03375  F62E  20 E1 FF           JSR STOP
03376  F631  D0 07              BNE SV40






SAVE FUNCTION......PAGE 0053

LINE# LOC   CODE        LINE


03377  F633              ;
03378  F633  20 42 F6    BREAK  JSR CLSEI
03379  F636  A9 00              LDA #0
03380  F638  38                 SEC
03381  F639  60                 RTS
03382  F63A              ;
03383  F63A  20 DB FC    SV40   JSR INCSAL      ;INCREMENT CURRENT ADDR.
03384  F63D  D0 E5              BNE SV30
03385  F63F  20 FE ED    SV50   JSR UNLSN





03387  F642  24 B9       CLSEI  BIT SA
03388  F644  30 11              BMI CLSEI2
03389  F646  A5 BA              LDA FA
03390  F648  20 0C ED           JSR LISTN
03391  F64B  A5 B9              LDA SA
03392  F64D  29 EF              AND #$EF
03393  F64F  09 E0              ORA #$E0
03394  F651  20 B9 ED           JSR SECND
03395  F654              ;
03396  F654  20 FE ED    CUNLSN JSR UNLSN       ;ENTRY FOR OPENI
03397  F657              ;
03398  F657  18          CLSEI2 CLC
03399  F658  60                 RTS





03401  F659  4A          SV100  LSR A
03402  F65A  B0 03              BCS SV102       ;IF C-SET THEN IT'S CASSETTE
03403  F65C              ;
03404  F65C  4C 13 F7           JMP ERROR9      ;BAD DEVICE #
03405  F65F              ;
03406  F65F  20 D0 F7    SV102  JSR ZZZ         ;GET ADDR OF TAPE
03407  F662  90 8D              BCC SV10        ;BUFFER IS DEALLOCATED
03408  F664  20 38 F8           JSR CSTE2
03409  F667  B0 25              BCS SV115       ;STOP KEY PRESSED
03410  F669  20 8F F6           JSR SAVING      ;TELL USER 'SAVING'
03411  F66C  A2 03       SV105  LDX #PLF        ;DECIDE TYPE TO SAVE
03412  F66E  A5 B9              LDA SA          ;1-PLF 0-BLF
03413  F670  29 01              AND #01
03414  F672  D0 02              BNE SV106
03415  F674  A2 01              LDX #BLF
03416  F676  8A          SV106  TXA
03417  F677  20 6A F7           JSR TAPEH
03418  F67A  B0 12              BCS SV115       ;STOP KEY PRESSED
03419  F67C  20 67 F8           JSR TWRT
03420  F67F  B0 0D              BCS SV115       ;STOP KEY PRESSED
03421  F681  A5 B9              LDA SA
03422  F683  29 02              AND #2          ;WRITE END OF TAPE?
03423  F685  F0 06              BEQ SV110       ;NO...






SAVE FUNCTION......PAGE 0054

LINE# LOC   CODE        LINE


03424  F687              ;
03425  F687  A9 05              LDA #EOT
03426  F689  20 6A F7           JSR TAPEH
03427  F68C  24                 .BYT $24        ;SKIP 1 BYTE
03428  F68D              ;
03429  F68D  18          SV110  CLC
03430  F68E  60          SV115  RTS



03432  F68F              ;SUBROUTINE TO OUTPUT:
03433  F68F              ;'SAVING <FILE NAME>'
03434  F68F              ;
03435  F68F  A5 9D       SAVING LDA MSGFLG
03436  F691  10 FB              BPL SV115       ;NO PRINT
03437  F693              ;
03438  F693  A0 51              LDY #MS11-MS1   ;'SAVING'
03439  F695  20 2F F1           JSR MSG
03440  F698  4C C1 F5           JMP OUTFN       ;<FILE NAME>
03441  F69B              .END
03442  F69B              .LIB   TIME








































TIME FUNCTION......PAGE 0055

LINE# LOC   CODE        LINE


03444  F69B              ;***********************************
03445  F69B              ;*                                 *
03446  F69B              ;* TIME                            *
03447  F69B              ;*                                 *
03448  F69B              ;*CONSISTS OF THREE FUNCTIONS:     *
03449  F69B              ;* (1) UDTIM-- UPDATE TIME. USUALLY*
03450  F69B              ;*     CALLED EVERY 60TH SECOND.   *
03451  F69B              ;* (2) SETTIM-- SET TIME. .Y=MSD,  *
03452  F69B              ;*     .X=NEXT SIGNIFICANT,.A=LSD  *
03453  F69B              ;* (3) RDTIM-- READ TIME. .Y=MSD,  *
03454  F69B              ;*     .X=NEXT SIGNIFICANT,.A=LSD  *
03455  F69B              ;*                                 *
03456  F69B              ;***********************************

03458  F69B              ;INTERRUPTS ARE COMING FROM THE 6526 TIMERS
03459  F69B              ;
03460  F69B  A2 00       UDTIM  LDX #0          ;PRE-LOAD FOR LATER
03461  F69D              ;
03462  F69D              ;HERE WE PROCEED WITH AN INCREMENT
03463  F69D              ;OF THE TIME REGISTER.
03464  F69D              ;
03465  F69D  E6 A2       UD20   INC TIME+2
03466  F69F  D0 06              BNE UD30
03467  F6A1  E6 A1              INC TIME+1
03468  F6A3  D0 02              BNE UD30
03469  F6A5  E6 A0              INC TIME
03470  F6A7              ;
03471  F6A7              ;HERE WE CHECK FOR ROLL-OVER 23:59:59
03472  F6A7              ;AND RESET THE CLOCK TO ZERO IF TRUE
03473  F6A7              ;
03474  F6A7  38          UD30   SEC
03475  F6A8  A5 A2              LDA TIME+2
03476  F6AA  E9 01              SBC #$01
03477  F6AC  A5 A1              LDA TIME+1
03478  F6AE  E9 1A              SBC #$1A
03479  F6B0  A5 A0              LDA TIME
03480  F6B2  E9 4F              SBC #$4F
03481  F6B4  90 06              BCC UD60
03482  F6B6              ;
03483  F6B6              ;TIME HAS ROLLED--ZERO REGISTER
03484  F6B6              ;
03485  F6B6  86 A0              STX TIME
03486  F6B8  86 A1              STX TIME+1
03487  F6BA  86 A2              STX TIME+2
03488  F6BC              ;
03489  F6BC              ;SET STOP KEY FLAG HERE
03490  F6BC              ;
03491  F6BC  AD 01 DC    UD60   LDA ROWS        ;WAIT FOR IT TO SETTLE
03492  F6BF  CD 01 DC           CMP ROWS
03493  F6C2  D0 F8              BNE UD60        ;STILL BOUNCING
03494  F6C4  AA                 TAX             ;SET FLAGS...
03495  F6C5  30 13              BMI UD80        ;NO STOP KEY...EXIT  STOP KEY=$7F
03496  F6C7  A2 BD              LDX #$FF-$42    ;CHECK FOR A SHIFT KEY (C64 KEYBOARD)
03497  F6C9  8E 00 DC           STX COLM
03498  F6CC  AE 01 DC    UD70   LDX ROWS        ;WAIT TO SETTLE...






TIME FUNCTION......PAGE 0056

LINE# LOC   CODE        LINE


03499  F6CF  EC 01 DC           CPX ROWS
03500  F6D2  D0 F8              BNE UD70
03501  F6D4  8D 00 DC           STA COLM        ;!!!!!WATCH OUT...STOP KEY .A=$7F...SAME AS COLMS WAS...
03502  F6D7  E8                 INX             ;ANY KEY DOWN ABORTS
03503  F6D8  D0 02              BNE UD90        ;LEAVE SAME AS BEFORE...
03504  F6DA  85 91       UD80   STA STKEY       ;SAVE FOR OTHER ROUTINES
03505  F6DC  60          UD90   RTS





03507  F6DD  78          RDTIM  SEI             ;KEEP TIME FROM ROLLING
03508  F6DE  A5 A2              LDA TIME+2      ;GET LSD
03509  F6E0  A6 A1              LDX TIME+1      ;GET NEXT MOST SIG.
03510  F6E2  A4 A0              LDY TIME        ;GET MSD





03512  F6E4  78          SETTIM SEI             ;KEEP TIME FROM CHANGING
03513  F6E5  85 A2              STA TIME+2      ;STORE LSD
03514  F6E7  86 A1              STX TIME+1      ;NEXT MOST SIGNIFICANT
03515  F6E9  84 A0              STY TIME        ;STORE MSD
03516  F6EB  58                 CLI
03517  F6EC  60                 RTS
03518  F6ED              .END
03519  F6ED              .LIB   ERRORHANDLER
































ERROR HANDLER......PAGE 0057

LINE# LOC   CODE        LINE


03521  F6ED              ;***************************************
03522  F6ED              ;* STOP -- CHECK STOP KEY FLAG AND     *
03523  F6ED              ;* RETURN Z FLAG SET IF FLAG TRUE.     *
03524  F6ED              ;* ALSO CLOSES ACTIVE CHANNELS AND     *
03525  F6ED              ;* FLUSHES KEYBOARD QUEUE.             *
03526  F6ED              ;* ALSO RETURNS KEY DOWNS FROM LAST    *
03527  F6ED              ;* KEYBOARD ROW IN .A.                 *
03528  F6ED              ;***************************************
03529  F6ED  A5 91       NSTOP  LDA STKEY       ;VALUE OF LAST ROW
03530  F6EF  C9 7F              CMP #$7F        ;CHECK STOP KEY POSITION
03531  F6F1  D0 07              BNE STOP2       ;NOT DOWN
03532  F6F3  08                 PHP
03533  F6F4  20 CC FF           JSR CLRCH       ;CLEAR CHANNELS
03534  F6F7  85 C6              STA NDX         ;FLUSH QUEUE
03535  F6F9  28                 PLP
03536  F6FA  60          STOP2  RTS





03538  F6FB              ;************************************
03539  F6FB              ;*                                  *
03540  F6FB              ;* ERROR HANDLER                    *
03541  F6FB              ;*                                  *
03542  F6FB              ;* PRINTS KERNAL ERROR MESSAGE IF   *
03543  F6FB              ;* BIT 6 OF MSGFLG SET.  RETURNS    *
03544  F6FB              ;* WITH ERROR # IN .A AND CARRY.    *
03545  F6FB              ;*                                  *
03546  F6FB              ;************************************
03547  F6FB              ;
03548  F6FB  A9 01       ERROR1 LDA #1          ;TOO MANY FILES
03549  F6FD  2C                 .BYT $2C
03550  F6FE  A9 02       ERROR2 LDA #2          ;FILE OPEN
03551  F700  2C                 .BYT $2C
03552  F701  A9 03       ERROR3 LDA #3          ;FILE NOT OPEN
03553  F703  2C                 .BYT $2C
03554  F704  A9 04       ERROR4 LDA #4          ;FILE NOT FOUND
03555  F706  2C                 .BYT $2C
03556  F707  A9 05       ERROR5 LDA #5          ;DEVICE NOT PRESENT
03557  F709  2C                 .BYT $2C
03558  F70A  A9 06       ERROR6 LDA #6          ;NOT INPUT FILE
03559  F70C  2C                 .BYT $2C
03560  F70D  A9 07       ERROR7 LDA #7          ;NOT OUTPUT FILE
03561  F70F  2C                 .BYT $2C
03562  F710  A9 08       ERROR8 LDA #8          ;MISSING FILE NAME
03563  F712  2C                 .BYT $2C
03564  F713  A9 09       ERROR9 LDA #9          ;BAD DEVICE #
03565  F715              ;
03566  F715  48                 PHA             ;ERROR NUMBER ON STACK
03567  F716  20 CC FF           JSR CLRCH       ;RESTORE I/O CHANNELS
03568  F719              ;
03569  F719  A0 00              LDY #MS1-MS1
03570  F71B  24 9D              BIT MSGFLG      ;ARE WE PRINTING ERROR?
03571  F71D  50 0A              BVC EREXIT      ;NO...






ERROR HANDLER......PAGE 0058

LINE# LOC   CODE        LINE


03572  F71F              ;
03573  F71F  20 2F F1           JSR MSG         ;PRINT "CBM I/O ERROR #"
03574  F722  68                 PLA
03575  F723  48                 PHA
03576  F724  09 30              ORA #$30        ;MAKE ERROR # ASCII
03577  F726  20 D2 FF           JSR BSOUT       ;PRINT IT
03578  F729              ;
03579  F729  68          EREXIT PLA
03580  F72A  38                 SEC
03581  F72B  60                 RTS
03582  F72C              .END
03583  F72C              .LIB   TAPEFILE

















































TAPE FILES......PAGE 0059

LINE# LOC   CODE        LINE


03585  F72C              ;FAH -- FIND ANY HEADER
03586  F72C              ;
03587  F72C              ;READS TAPE DEVICE UNTIL ONE OF FOLLOWING
03588  F72C              ;BLOCK TYPES FOUND: BDFH--BASIC DATA
03589  F72C              ;FILE HEADER, BLF--BASIC LOAD FILE
03590  F72C              ;FOR SUCCESS CARRY IS CLEAR ON RETURN.
03591  F72C              ;FOR FAILURE CARRY IS SET ON RETURN.
03592  F72C              ;IN ADDITION ACCUMULATOR IS 0 IF STOP
03593  F72C              ;KEY WAS PRESSED.
03594  F72C              ;
03595  F72C  A5 93       FAH    LDA VERCK       ;SAVE OLD VERIFY
03596  F72E  48                 PHA
03597  F72F  20 41 F8           JSR RBLK        ;READ TAPE BLOCK
03598  F732  68                 PLA
03599  F733  85 93              STA VERCK       ;RESTORE VERIFY FLAG
03600  F735  B0 32              BCS FAH40       ;READ TERMINATED
03601  F737              ;
03602  F737  A0 00              LDY #0
03603  F739  B1 B2              LDA (TAPE1)Y    ;GET HEADER TYPE
03604  F73B              ;
03605  F73B  C9 05              CMP #EOT        ;CHECK END OF TAPE?
03606  F73D  F0 2A              BEQ FAH40       ;YES...FAILURE
03607  F73F              ;
03608  F73F  C9 01              CMP #BLF        ;BASIC LOAD FILE?
03609  F741  F0 08              BEQ FAH50       ;YES...SUCCESS
03610  F743              ;
03611  F743  C9 03              CMP #PLF        ;FIXED LOAD FILE?
03612  F745  F0 04              BEQ FAH50       ;YES...SUCCESS
03613  F747              ;
03614  F747  C9 04              CMP #BDFH       ;BASIC DATA FILE?
03615  F749  D0 E1              BNE FAH         ;NO...KEEP TRYING
03616  F74B              ;
03617  F74B  AA          FAH50  TAX             ;RETURN FILE TYPE IN .X
03618  F74C  24 9D              BIT MSGFLG      ;PRINTING MESSAGES?
03619  F74E  10 17              BPL FAH45       ;NO...
03620  F750              ;
03621  F750  A0 63              LDY #MS17-MS1   ;PRINT "FOUND"
03622  F752  20 2F F1           JSR MSG
03623  F755              ;
03624  F755              ;OUTPUT COMPLETE FILE NAME
03625  F755              ;
03626  F755  A0 05              LDY #5
03627  F757  B1 B2       FAH55  LDA (TAPE1)Y
03628  F759  20 D2 FF           JSR BSOUT
03629  F75C  C8                 INY
03630  F75D  C0 15              CPY #21
03631  F75F  D0 F6              BNE FAH55
03632  F761              ;
03633  F761  A5 A1       FAH56  LDA TIME+1      ;SET UP FOR TIME OUT...
03634  F763  20 E0 E4           JSR FPATCH      ;GOTO PATCH...
03635  F766  EA                 NOP
03636  F767              ;
03637  F767  18          FAH45  CLC             ;SUCCESS FLAG
03638  F768  88                 DEY             ;MAKE NONZERO FOR OKAY RETURN
03639  F769              ;






TAPE FILES......PAGE 005A

LINE# LOC   CODE        LINE


03640  F769  60          FAH40  RTS





03642  F76A              ;TAPEH--WRITE TAPE HEADER
03643  F76A              ;ERROR IF TAPE BUFFER DE-ALLOCATED
03644  F76A              ;CARRY CLEAR IF O.K.
03645  F76A              ;
03646  F76A  85 9E       TAPEH  STA T1
03647  F76C              ;
03648  F76C              ;DETERMINE ADDRESS OF BUFFER
03649  F76C              ;
03650  F76C  20 D0 F7           JSR ZZZ
03651  F76F  90 5E              BCC TH40        ;BUFFER WAS DE-ALLOCATED
03652  F771              ;
03653  F771              ;PRESERVE START AND END ADDRESSES
03654  F771              ;FOR CASE OF HEADER FOR LOAD FILE
03655  F771              ;
03656  F771  A5 C2              LDA STAH
03657  F773  48                 PHA
03658  F774  A5 C1              LDA STAL
03659  F776  48                 PHA
03660  F777  A5 AF              LDA EAH
03661  F779  48                 PHA
03662  F77A  A5 AE              LDA EAL
03663  F77C  48                 PHA
03664  F77D              ;
03665  F77D              ;PUT BLANKS IN TAPE BUFFER
03666  F77D              ;
03667  F77D  A0 BF              LDY #BUFSZ-1
03668  F77F  A9 20              LDA #' 
03669  F781  91 B2       BLNK2  STA (TAPE1)Y
03670  F783  88                 DEY
03671  F784  D0 FB              BNE BLNK2
03672  F786              ;
03673  F786              ;PUT BLOCK TYPE IN HEADER
03674  F786              ;
03675  F786  A5 9E              LDA T1
03676  F788  91 B2              STA (TAPE1)Y
03677  F78A              ;
03678  F78A              ;PUT START LOAD ADDRESS IN HEADER
03679  F78A              ;
03680  F78A  C8                 INY
03681  F78B  A5 C1              LDA STAL
03682  F78D  91 B2              STA (TAPE1)Y
03683  F78F  C8                 INY
03684  F790  A5 C2              LDA STAH
03685  F792  91 B2              STA (TAPE1)Y
03686  F794              ;
03687  F794              ;PUT END LOAD ADDRESS IN HEADER
03688  F794              ;
03689  F794  C8                 INY
03690  F795  A5 AE              LDA EAL






TAPE FILES......PAGE 005B

LINE# LOC   CODE        LINE


03691  F797  91 B2              STA (TAPE1)Y
03692  F799  C8                 INY
03693  F79A  A5 AF              LDA EAH
03694  F79C  91 B2              STA (TAPE1)Y
03695  F79E              ;
03696  F79E              ;PUT FILE NAME IN HEADER
03697  F79E              ;
03698  F79E  C8                 INY
03699  F79F  84 9F              STY T2
03700  F7A1  A0 00              LDY #0
03701  F7A3  84 9E              STY T1
03702  F7A5  A4 9E       TH20   LDY T1
03703  F7A7  C4 B7              CPY FNLEN
03704  F7A9  F0 0C              BEQ TH30
03705  F7AB  B1 BB              LDA (FNADR)Y
03706  F7AD  A4 9F              LDY T2
03707  F7AF  91 B2              STA (TAPE1)Y
03708  F7B1  E6 9E              INC T1
03709  F7B3  E6 9F              INC T2
03710  F7B5  D0 EE              BNE TH20
03711  F7B7              ;
03712  F7B7              ;SET UP START AND END ADDRESS OF HEADER
03713  F7B7              ;
03714  F7B7  20 D7 F7    TH30   JSR LDAD1
03715  F7BA              ;
03716  F7BA              ;SET UP TIME FOR LEADER
03717  F7BA              ;
03718  F7BA  A9 69              LDA #$69
03719  F7BC  85 AB              STA SHCNH
03720  F7BE              ;
03721  F7BE  20 6B F8           JSR TWRT2       ;WRITE HEADER ON TAPE
03722  F7C1              ;
03723  F7C1              ;RESTORE START AND END ADDRESS OF
03724  F7C1              ;LOAD FILE.
03725  F7C1              ;
03726  F7C1  A8                 TAY             ;SAVE ERROR CODE IN .Y
03727  F7C2  68                 PLA
03728  F7C3  85 AE              STA EAL
03729  F7C5  68                 PLA 
03730  F7C6  85 AF              STA EAH
03731  F7C8  68                 PLA
03732  F7C9  85 C1              STA STAL
03733  F7CB  68                 PLA
03734  F7CC  85 C2              STA STAH
03735  F7CE  98                 TYA             ;RESTORE ERROR CODE FOR RETURN
03736  F7CF              ;
03737  F7CF  60          TH40   RTS





03739  F7D0              ;FUNCTION TO RETURN TAPE BUFFER
03740  F7D0              ;ADDRESS IN TAPE1
03741  F7D0              ;






TAPE FILES......PAGE 005C

LINE# LOC   CODE        LINE


03742  F7D0  A6 B2       ZZZ    LDX TAPE1       ;ASSUME TAPE1
03743  F7D2  A4 B3              LDY TAPE1+1
03744  F7D4  C0 02              CPY #>BUF       ;CHECK FOR ALLOCATION...
03745  F7D6              ;...[TAPE1+1]=0 OR 1 MEANS DEALLOCATED
03746  F7D6              ;...C CLR => DEALLOCATED
03747  F7D6  60                 RTS





03749  F7D7  20 D0 F7    LDAD1  JSR ZZZ         ;GET PTR TO CASSETTE
03750  F7DA  8A                 TXA
03751  F7DB  85 C1              STA STAL        ;SAVE START LOW
03752  F7DD  18                 CLC
03753  F7DE  69 C0              ADC #BUFSZ      ;COMPUTE POINTER TO END
03754  F7E0  85 AE              STA EAL         ;SAVE END LOW
03755  F7E2  98                 TYA
03756  F7E3  85 C2              STA STAH        ;SAVE START HIGH
03757  F7E5  69 00              ADC #0          ;COMPUTE POINTER TO END
03758  F7E7  85 AF              STA EAH         ;SAVE END HIGH
03759  F7E9  60                 RTS





03761  F7EA  20 2C F7    FAF    JSR FAH         ;FIND ANY HEADER
03762  F7ED  B0 1D              BCS FAF40       ;FAILED
03763  F7EF              ;
03764  F7EF              ;SUCCESS...SEE IF RIGHT NAME
03765  F7EF              ;
03766  F7EF  A0 05              LDY #5          ;OFFSET INTO TAPE HEADER
03767  F7F1  84 9F              STY T2
03768  F7F3  A0 00              LDY #0          ;OFFSET INTO FILE NAME
03769  F7F5  84 9E              STY T1
03770  F7F7  C4 B7       FAF20  CPY FNLEN       ;COMPARE THIS MANY
03771  F7F9  F0 10              BEQ FAF30       ;DONE
03772  F7FB              ;
03773  F7FB  B1 BB              LDA (FNADR)Y
03774  F7FD  A4 9F              LDY T2
03775  F7FF  D1 B2              CMP (TAPE1)Y
03776  F801  D0 E7              BNE FAF         ;MISMATCH--TRY NEXT HEADER
03777  F803  E6 9E              INC T1
03778  F805  E6 9F              INC T2
03779  F807  A4 9E              LDY T1
03780  F809  D0 EC              BNE FAF20       ;BRANCH ALWAYS
03781  F80B              ;
03782  F80B  18          FAF30  CLC             ;SUCCESS FLAG
03783  F80C  60          FAF40  RTS
03784  F80D              .END
03785  F80D              .LIB   TAPECONTROL









TAPE CONTROL......PAGE 005D

LINE# LOC   CODE        LINE


03787  F80D  20 D0 F7    JTP20  JSR ZZZ
03788  F810  E6 A6              INC BUFPT
03789  F812  A4 A6              LDY BUFPT
03790  F814  C0 C0              CPY #BUFSZ
03791  F816  60                 RTS





03793  F817              ;STAYS IN ROUTINE D2T1LL PLAY SWITCH
03794  F817              ;
03795  F817  20 2E F8    CSTE1  JSR CS10
03796  F81A  F0 1A              BEQ CS25
03797  F81C  A0 1B              LDY #MS7-MS1    ;"PRESS PLAY..."
03798  F81E  20 2F F1    CS30   JSR MSG
03799  F821  20 D0 F8    CS40   JSR TSTOP       ;WATCH FOR STOP KEY
03800  F824  20 2E F8           JSR CS10        ;WATCH CASSETTE SWITCHES
03801  F827  D0 F8              BNE CS40
03802  F829  A0 6A              LDY #MS18-MS1   ;"OK"
03803  F82B  4C 2F F1           JMP MSG





03805  F82E              ;SUBR RETURNS <> FOR CASSETTE SWITCH
03806  F82E              ;
03807  F82E  A9 10       CS10   LDA #$10        ;CHECK PORT
03808  F830  24 01              BIT R6510       ;CLOSED?...
03809  F832  D0 02              BNE CS25        ;NO. . .
03810  F834  24 01              BIT R6510       ;CHECK AGAIN TO DEBOUNCE
03811  F836  18          CS25   CLC             ;GOOD RETURN
03812  F837  60                 RTS





03814  F838              ;CHECKS FOR PLAY & RECORD
03815  F838              ;
03816  F838  20 2E F8    CSTE2  JSR CS10
03817  F83B  F0 F9              BEQ CS25
03818  F83D  A0 2E              LDY #MS8-MS1    ;"RECORD"
03819  F83F  D0 DD              BNE CS30





03821  F841              ;READ HEADER BLOCK ENTRY
03822  F841              ;
03823  F841  A9 00       RBLK   LDA #0
03824  F843  85 90              STA STATUS
03825  F845  85 93              STA VERCK






TAPE CONTROL......PAGE 005E

LINE# LOC   CODE        LINE


03826  F847  20 D7 F7           JSR LDAD1



03828  F84A              ;READ LOAD BLOCK ENTRY
03829  F84A              ;
03830  F84A  20 17 F8    TRD    JSR CSTE1       ;SAY 'PRESS PLAY'
03831  F84D  B0 1F              BCS TWRT3       ;STOP KEY PRESSED
03832  F84F  78                 SEI
03833  F850  A9 00              LDA #0          ;CLEAR FLAGS...
03834  F852  85 AA              STA RDFLG
03835  F854  85 B4              STA SNSW1
03836  F856  85 B0              STA CMP0
03837  F858  85 9E              STA PTR1
03838  F85A  85 9F              STA PTR2
03839  F85C  85 9C              STA DPSW
03840  F85E  A9 90              LDA #$90        ;ENABLE FOR CA1 IRQ...READ LINE
03841  F860  A2 0E              LDX #14         ;POINT IRQ VECTOR TO READ
03842  F862  D0 11              BNE TAPE        ;JMP





03844  F864              ;WRITE HEADER BLOCK ENTRY
03845  F864              ;
03846  F864  20 D7 F7    WBLK   JSR LDAD1
03847  F867              ;
03848  F867              ;WRITE LOAD BLOCK ENTRY
03849  F867              ;
03850  F867  A9 14       TWRT   LDA #20         ;BETWEEN BLOCK SHORTS
03851  F869  85 AB              STA SHCNH
03852  F86B  20 38 F8    TWRT2  JSR CSTE2       ;SAY 'PRESS PLAY & RECORD'
03853  F86E  B0 6C       TWRT3  BCS STOP3       ;STOP KEY PRESSED
03854  F870  78                 SEI
03855  F871  A9 82              LDA #$82        ;ENABLE T2 IRQS...WRITE TIME
03856  F873  A2 08              LDX #8          ;VECTOR IRQ TO WRTZ





03858  F875              ;START TAPE OPERATION ENTRY POINT
03859  F875              ;
03860  F875  A0 7F       TAPE   LDY #$7F        ;KILL UNWANTED IRQ'S
03861  F877  8C 0D DC           STY D1ICR
03862  F87A  8D 0D DC           STA D1ICR       ;TURN ON WANTED
03863  F87D  AD 0E DC           LDA D1CRA       ;CALC TIMER ENABLES
03864  F880  09 19              ORA #$19
03865  F882  8D 0F DC           STA D1CRB       ;TURN ON T2 IRQ'S FOR CASS WRITE(ONE SHOT)
03866  F885  29 91              AND #$91        ;SAVE TOD 50/60 INDICATION
03867  F887  8D A2 02           STA CASTON      ;PLACE IN AUTO MODE FOR T1
03868  F88A              ; WAIT FOR RS-232 TO FINISH
03869  F88A  20 A4 F0           JSR RSP232
03870  F88D              ; DISABLE SCREEN DISPLAY






TAPE CONTROL......PAGE 005F

LINE# LOC   CODE        LINE


03871  F88D  AD 11 D0           LDA VICREG+17
03872  F890  29 EF              AND #$FF-$10    ;DISABLE SCREEN
03873  F892  8D 11 D0           STA VICREG+17
03874  F895              ; MOVE IRQ TO IRQTEMP FOR CASS OPS
03875  F895  AD 14 03           LDA CINV
03876  F898  8D 9F 02           STA IRQTMP
03877  F89B  AD 15 03           LDA CINV+1
03878  F89E  8D A0 02           STA IRQTMP+1
03879  F8A1  20 BD FC           JSR BSIV        ;GO CHANGE IRQ VECTOR
03880  F8A4  A9 02              LDA #2          ;FSBLK STARTS AT 2
03881  F8A6  85 BE              STA FSBLK
03882  F8A8  20 97 FB           JSR NEWCH       ;PREP LOCAL COUNTERS AND FLAGS
03883  F8AB  A5 01              LDA R6510       ;TURN MOTOR ON
03884  F8AD  29 1F              AND #%011111    ;LOW TURNS ON
03885  F8AF  85 01              STA R6510
03886  F8B1  85 C0              STA CAS1        ;FLAG INTERNAL CONTROL OF CASS MOTOR
03887  F8B3  A2 FF              LDX #$FF        ;DELAY BETWEEN BLOCKS
03888  F8B5  A0 FF       TP32   LDY #$FF
03889  F8B7  88          TP35   DEY
03890  F8B8  D0 FD              BNE TP35
03891  F8BA  CA                 DEX
03892  F8BB  D0 F8              BNE TP32
03893  F8BD  58                 CLI
03894  F8BE  AD A0 02    TP40   LDA IRQTMP+1    ;CHECK FOR INTERRUPT VECTOR...
03895  F8C1  CD 15 03           CMP CINV+1      ;...POINTING AT KEY ROUTINE
03896  F8C4  18                 CLC
03897  F8C5  F0 15              BEQ STOP3       ;...YES RETURN
03898  F8C7  20 D0 F8           JSR TSTOP       ;...NO CHECK FOR STOP KEY
03899  F8CA              ;
03900  F8CA              ; 60 HZ KEYSCAN IGNORED
03901  F8CA              ;
03902  F8CA  20 BC F6           JSR UD60        ; STOP KEY CHECK
03903  F8CD  4C BE F8           JMP TP40        ;STAY IN LOOP UNTILL TAPES ARE DONE





03905  F8D0  20 E1 FF    TSTOP  JSR STOP        ;STOP KEY DOWN?
03906  F8D3  18                 CLC             ;ASSUME NO STOP
03907  F8D4  D0 0B              BNE STOP4       ;WE WERE RIGHT
03908  F8D6              ;
03909  F8D6              ;STOP KEY DOWN...
03910  F8D6              ;
03911  F8D6  20 93 FC           JSR TNIF        ;TURN OFF CASSETTES
03912  F8D9  38                 SEC             ;FAILURE FLAG
03913  F8DA  68                 PLA             ;BACK ONE SQUARE...
03914  F8DB  68                 PLA
03915  F8DC              ;
03916  F8DC              ; LDA #0 ;STOP KEY FLAG
03917  F8DC              ;
03918  F8DC  A9 00       STOP3  LDA #0          ;DEALLOCATE IRQTMP
03919  F8DE  8D A0 02           STA IRQTMP+1    ;IF C-SET THEN STOP KEY
03920  F8E1  60          STOP4  RTS







TAPE CONTROL......PAGE 0060

LINE# LOC   CODE        LINE


03922  F8E2              ;
03923  F8E2              ; STT1 - SET UP TIMEOUT WATCH FOR NEXT DIPOLE
03924  F8E2              ;
03925  F8E2  86 B1       STT1   STX TEMP        ;.X HAS CONSTANT FOR TIMEOUT
03926  F8E4  A5 B0              LDA CMP0        ;CMP0*5
03927  F8E6  0A                 ASL A
03928  F8E7  0A                 ASL A
03929  F8E8  18                 CLC
03930  F8E9  65 B0              ADC CMP0
03931  F8EB  18                 CLC 
03932  F8EC  65 B1              ADC TEMP        ;ADJUST LONG BYTE COUNT
03933  F8EE  85 B1              STA TEMP
03934  F8F0  A9 00              LDA #0
03935  F8F2  24 B0              BIT CMP0        ;CHECK CMP0 ...
03936  F8F4  30 01              BMI STT2        ;...MINUS, NO ADJUST
03937  F8F6  2A                 ROL A           ;...PLUS SO ADJUST POS
03938  F8F7  06 B1       STT2   ASL TEMP        ;MULTIPLY CORRECTED VALUE BY 4
03939  F8F9  2A                 ROL A
03940  F8FA  06 B1              ASL TEMP
03941  F8FC  2A                 ROL A
03942  F8FD  AA                 TAX
03943  F8FE  AD 06 DC    STT3   LDA D1T2L       ;WATCH OUT FOR D1T2H ROLLOVER...
03944  F901  C9 16              CMP #22         ;...TIME FOR ROUTINE...!!!...
03945  F903  90 F9              BCC STT3        ;...TOO CLOSE SO WAIT UNTILL PAST
03946  F905  65 B1              ADC TEMP        ;CALCULATE AND...
03947  F907  8D 04 DC           STA D1T1L       ;...STORE ADUSTED TIME COUNT
03948  F90A  8A                 TXA
03949  F90B  6D 07 DC           ADC D1T2H       ;ADJUST FOR HIGH TIME COUNT
03950  F90E  8D 05 DC           STA D1T1H
03951  F911  AD A2 02           LDA CASTON      ;ENABLE TIMERS
03952  F914  8D 0E DC           STA D1CRA
03953  F917  8D A4 02           STA STUPID      ;NON-ZERO MEANS AN T1 IRQ HAS NOT OCCURED YET
03954  F91A  AD 0D DC           LDA D1ICR       ;CLEAR OLD T1 INTERRUPT
03955  F91D  29 10              AND #$10        ;CHECK FOR OLD-FLAG IRQ
03956  F91F  F0 09              BEQ STT4        ;NO...NORMAL EXIT
03957  F921  A9 F9              LDA #>STT4      ;PUSH SIMULATED RETURN ADDRESS ON STACK
03958  F923  48                 PHA
03959  F924  A9 2A              LDA #<STT4
03960  F926  48                 PHA
03961  F927  4C 43 FF           JMP SIMIRQ
03962  F92A  58          STT4   CLI             ;ALLOW FOR RE-ENTRY CODE
03963  F92B  60                 RTS
03964  F92C              .END
03965  F92C              .LIB   READ

















CASSETTE READ......PAGE 0061

LINE# LOC   CODE        LINE


03967  F92C              ; VARIABLES USED IN CASSETTE READ ROUTINES
03968  F92C              ;
03969  F92C              ;  REZ - COUNTS ZEROS (IF Z THEN CORRECT # OF DIPOLES)
03970  F92C              ;  RER - FLAGS ERRORS (IF Z THEN NO ERROR)
03971  F92C              ;  DIFF - USED TO PRESERVE SYNO (OUTSIDE OF BIT ROUTINES)
03972  F92C              ;  SYNO - FLAGS IF WE HAVE BLOCK SYNC (16 ZERO DIPOLES)
03973  F92C              ;  SNSW1 - FLAGS IF WE HAVE BYTE SYNC (A LONGLONG)
03974  F92C              ;  DATA - HOLDS MOST RECENT DIPOLE BIT VALUE
03975  F92C              ;  MYCH - HOLDS INPUT BYTE BEING BUILT
03976  F92C              ;  FIRT - USED TO INDICATE WHICH HALF OF DIPOLE WE'RE IN
03977  F92C              ;  SVXT - TEMP USED TO ADJUST SOFTWARE SERVO
03978  F92C              ;  TEMP - USED TO HOLD DIPOLE TIME DURING TYPE CALCULATIONS
03979  F92C              ;  PRTY - HOLDS CURRENT CALCULATED PARITY BIT
03980  F92C              ;  PRP - HAS COMBINED ERROR VALUES FROM BIT ROUTINES
03981  F92C              ;  FSBLK - INDICATE WHICH BLOCK WE'RE LOOKING AT (0 TO EXIT)
03982  F92C              ;  SHCNL - HOLDS FSBLK, USED TO DIRECT ROUTINES, BECAUSE OF EXIT CASE
03983  F92C              ;  RDFLG - HOLDS FUNCTION MODE
03984  F92C              ;     MI - WAITING FOR BLOCK SYNC
03985  F92C              ;     VS - IN DATA BLOCK READING DATA
03986  F92C              ;     NE - WAITING FOR BYTE SYNC
03987  F92C              ;  SAL - INDIRECT TO DATA STORAGE AREA
03988  F92C              ;  SHCNH - LEFT OVER FROM DEBUGGING
03989  F92C              ;  BAD - STORAGE SPACE FOR BAD READ LOCATIONS (BOTTOM OF STACK)
03990  F92C              ;  PTR1 - COUNT OF READ LOCATIONS IN ERROR (POINTER INTO BAD, MAX 61)
03991  F92C              ;  PTR2 - COUNT OF RE-READ LOCATIONS (POINTER INTO BAD, DURING RE-READ)
03992  F92C              ;  VERCHK - VERIFY OR LOAD FLAG (Z - LOADING)
03993  F92C              ;  CMP0 - SOFTWARE SERVO (+/- ADJUST TO TIME CALCS)
03994  F92C              ;  DPSW - IF NZ THEN EXPECTING LL/L COMBINATION THAT ENDS A BYTE
03995  F92C              ;  PCNTR - COUNTS DOWN FROM 8-0 FOR DATA THEN TO FF FOR PARITY
03996  F92C              ;  STUPID - HOLD INDICATOR (NZ - NO T1IRQ YET) FOR T1IRQ
03997  F92C              ;  KIKA26 - HOLDS OLD D1ICR AFTER CLEAR ON READ
03998  F92C              ;





























CASSETTE READ......PAGE 0062

LINE# LOC   CODE        LINE


04000  F92C  AE 07 DC    READ   LDX D1T2H       ;GET TIME SINCE LAST INTERRUPT
04001  F92F  A0 FF              LDY #$FF        ;COMPUTE COUNTER DIFFERENCE
04002  F931  98                 TYA
04003  F932  ED 06 DC           SBC D1T2L
04004  F935  EC 07 DC           CPX D1T2H       ;CHECK FOR TIMER HIGH ROLLOVER...
04005  F938  D0 F2              BNE READ        ;...YES THEN RECOMPUTE
04006  F93A  86 B1              STX TEMP
04007  F93C  AA                 TAX
04008  F93D  8C 06 DC           STY D1T2L       ;RELOAD TIMER2 (COUNT DOWN FROM $FFFF)
04009  F940  8C 07 DC           STY D1T2H
04010  F943  A9 19              LDA #$19        ;ENABLE TIMER
04011  F945  8D 0F DC           STA D1CRB
04012  F948  AD 0D DC           LDA D1ICR       ;CLEAR READ INTERRUPT
04013  F94B  8D A3 02           STA KIKA26      ;SAVE FOR LATTER
04014  F94E  98                 TYA
04015  F94F  E5 B1              SBC TEMP        ;CALCULATE HIGH
04016  F951  86 B1              STX TEMP
04017  F953  4A                 LSR A           ;MOVE TWO BITS FROM HIGH TO TEMP
04018  F954  66 B1              ROR TEMP
04019  F956  4A                 LSR A
04020  F957  66 B1              ROR TEMP
04021  F959  A5 B0              LDA CMP0        ;CALC MIN PULSE VALUE
04022  F95B  18                 CLC
04023  F95C  69 3C              ADC #60
04024  F95E  C5 B1              CMP TEMP        ;IF PULSE LESS THAN MIN...
04025  F960  B0 4A              BCS RDBK        ;...THEN IGNORE AS NOISE
04026  F962  A6 9C              LDX DPSW        ;CHECK IF LAST BIT...
04027  F964  F0 03              BEQ RJDJ        ;...NO THEN CONTINUE
04028  F966  4C 60 FA           JMP RADJ        ;...YES THEN GO FINISH BYTE


04030  F969  A6 A3       RJDJ   LDX PCNTR       ;IF 9 BITS READ...
04031  F96B  30 1B              BMI JRAD2       ;... THEN GOTO ENDING
04032  F96D  A2 00              LDX #0          ;SET BIT VALUE TO ZERO
04033  F96F  69 30              ADC #48         ;ADD UP TO HALF WAY BETWEEN...
04034  F971  65 B0              ADC CMP0        ;...SHORT PULSE AND SYNC PULSE
04035  F973  C5 B1              CMP TEMP        ;CHECK FOR SHORT...
04036  F975  B0 1C              BCS RADX2       ;...YES IT'S A SHORT
04037  F977  E8                 INX             ;SET BIT VALUE TO ONE
04038  F978  69 26              ADC #38         ;MOVE TO MIDDLE OF HIGH
04039  F97A  65 B0              ADC CMP0
04040  F97C  C5 B1              CMP TEMP        ;CHECK FOR ONE...
04041  F97E  B0 17              BCS RADL        ;...YES IT'S A ONE
04042  F980  69 2C              ADC #44         ;MOVE TO LONGLONG
04043  F982  65 B0              ADC CMP0
04044  F984  C5 B1              CMP TEMP        ;CHECK FOR LONGLONG...
04045  F986  90 03              BCC SRER        ;...GREATER THAN IS ERROR
04046  F988  4C 10 FA    JRAD2  JMP RAD2        ;...IT'S A LONGLONG


04048  F98B  A5 B4       SRER   LDA SNSW1       ;IF NOT SYNCRONIZED...
04049  F98D  F0 1D              BEQ RDBK        ;...THEN NO ERROR
04050  F98F  85 A8              STA RER         ;...ELSE FLAG RER
04051  F991  D0 19              BNE RDBK        ;JMP







CASSETTE READ......PAGE 0063

LINE# LOC   CODE        LINE


04053  F993  E6 A9       RADX2  INC REZ         ;COUNT REZ UP ON ZEROS
04054  F995  B0 02              BCS RAD5        ;JMP
04055  F997  C6 A9       RADL   DEC REZ         ;COUNT REZ DOWN ON ONES
04056  F999  38          RAD5   SEC             ;CALC ACTUAL VALUE FOR COMPARE STORE
04057  F99A  E9 13              SBC #19
04058  F99C  E5 B1              SBC TEMP        ;SUBTRACT INPUT VALUE FROM CONSTANT...
04059  F99E  65 92              ADC SVXT        ;...ADD DIFFERENCE TO TEMP STORAGE...
04060  F9A0  85 92              STA SVXT        ;...USED LATER TO ADJUST SOFT SERVO
04061  F9A2  A5 A4              LDA FIRT        ;FLIP DIPOLE FLAG
04062  F9A4  49 01              EOR #1
04063  F9A6  85 A4              STA FIRT
04064  F9A8  F0 2B              BEQ RAD3        ;SECOND HALF OF DIPOLE
04065  F9AA  86 D7              STX DATA        ;FIRST HALF SO STORE ITS VALUE



04067  F9AC  A5 B4       RDBK   LDA SNSW1       ;IF NO BYTE START...
04068  F9AE  F0 22              BEQ RADBK       ;...THEN RETURN
04069  F9B0  AD A3 02           LDA KIKA26      ;CHECK TO SEE IF TIMER1 IRQD US...
04070  F9B3  29 01              AND #$01
04071  F9B5  D0 05              BNE RADKX       ;...YES
04072  F9B7  AD A4 02           LDA STUPID      ;CHECK FOR OLD T1IRQ
04073  F9BA  D0 16              BNE RADBK       ;NO...SO EXIT
04074  F9BC              ;
04075  F9BC  A9 00       RADKX  LDA #0          ;...YES, SET DIPOLE FLAG FOR FIRST HALF
04076  F9BE  85 A4              STA FIRT
04077  F9C0  8D A4 02           STA STUPID      ;SET T1IRQ FLAG
04078  F9C3  A5 A3              LDA PCNTR       ;CHECK WHERE WE ARE IN BYTE...
04079  F9C5  10 30              BPL RAD4        ;...DOING DATA
04080  F9C7  30 BF              BMI JRAD2       ;...PROCESS PARITY


04082  F9C9  A2 A6       RADP   LDX #166        ;SET UP FOR LONGLONG TIMEOUT
04083  F9CB  20 E2 F8           JSR STT1
04084  F9CE  A5 9B              LDA PRTY        ;IF PARITY NOT EVEN...
04085  F9D0  D0 B9              BNE SRER        ;...THEN GO SET ERROR
04086  F9D2  4C BC FE    RADBK  JMP PREND       ;GO RESTORE REGS AND RTI



04088  F9D5  A5 92       RAD3   LDA SVXT        ;ADJUST THE SOFTWARE SERVO (CMP0)
04089  F9D7  F0 07              BEQ ROUT1       ;NO ADJUST
04090  F9D9  30 03              BMI ROUT2       ;ADJUST FOR MORE BASE TIME
04091  F9DB  C6 B0              DEC CMP0        ;ADJUST FOR LESS BASE TIME
04092  F9DD  2C                 .BYT $2C        ;SKIP TWO BYTES
04093  F9DE  E6 B0       ROUT2  INC CMP0
04094  F9E0  A9 00       ROUT1  LDA #0          ;CLEAR DIFFERENCE VALUE
04095  F9E2  85 92              STA SVXT
04096  F9E4              ;CHECK FOR CONSECUTIVE LIKE VALUES IN DIPOLE...
04097  F9E4  E4 D7              CPX DATA
04098  F9E6  D0 0F              BNE RAD4        ;...NO, GO PROCESS INFO
04099  F9E8  8A                 TXA             ;...YES SO CHECK THE VALUES...
04100  F9E9  D0 A0              BNE SRER        ;IF THEY WERE ONES THEN  ERROR
04101  F9EB              ; CONSECUTIVE ZEROS
04102  F9EB  A5 A9              LDA REZ         ;...CHECK HOW MANY ZEROS HAVE HAPPENED






CASSETTE READ......PAGE 0064

LINE# LOC   CODE        LINE


04103  F9ED  30 BD              BMI RDBK        ;...IF MANY DON'T CHECK
04104  F9EF  C9 10              CMP #16         ;... DO WE HAVE 16 YET?...
04105  F9F1  90 B9              BCC RDBK        ;....NO SO CONTINUE
04106  F9F3  85 96              STA SYNO        ;....YES SO FLAG SYNO (BETWEEN BLOCKS)
04107  F9F5  B0 B5              BCS RDBK        ;JMP



04109  F9F7  8A          RAD4   TXA             ;MOVE READ DATA TO .A
04110  F9F8  45 9B              EOR PRTY        ;CALCULATE PARITY
04111  F9FA  85 9B              STA PRTY
04112  F9FC  A5 B4              LDA SNSW1       ;REAL DATA?...
04113  F9FE  F0 D2              BEQ RADBK       ;...NO SO FORGET BY EXITING
04114  FA00  C6 A3              DEC PCNTR       ;DEC BIT COUNT
04115  FA02  30 C5              BMI RADP        ;IF MINUS THEN  TIME FOR PARITY
04116  FA04  46 D7              LSR DATA        ;SHIFT BIT FROM DATA...
04117  FA06  66 BF              ROR MYCH        ;...INTO BYTE STORAGE (MYCH) BUFFER
04118  FA08  A2 DA              LDX #218        ;SET UP FOR NEXT DIPOLE
04119  FA0A  20 E2 F8           JSR STT1
04120  FA0D  4C BC FE           JMP PREND       ;RESTORE REGS AND RTI



04122  FA10              ; RAD2 - LONGLONG HANDLER (COULD BE A LONG ONE)
04123  FA10  A5 96       RAD2   LDA SYNO        ;HAVE WE GOTTEN BLOCK SYNC...
04124  FA12  F0 04              BEQ RAD2Y       ;...NO
04125  FA14  A5 B4              LDA SNSW1       ;CHECK IF WE'VE HAD A REAL BYTE START...
04126  FA16  F0 07              BEQ RAD2X       ;...NO
04127  FA18  A5 A3       RAD2Y  LDA PCNTR       ;ARE WE AT END OF BYTE...
04128  FA1A  30 03              BMI RAD2X       ;YES...GO ADJUST FOR LONGLONG
04129  FA1C  4C 97 F9           JMP RADL        ;...NO SO TREAT IT AS A LONG ONE READ


04131  FA1F  46 B1       RAD2X  LSR TEMP        ;ADJUST TIMEOUT FOR...
04132  FA21  A9 93              LDA #147        ;...LONGLONG PULSE VALUE
04133  FA23  38                 SEC
04134  FA24  E5 B1              SBC TEMP
04135  FA26  65 B0              ADC CMP0
04136  FA28  0A                 ASL A
04137  FA29  AA                 TAX             ;AND SET TIMEOUT FOR LAST BIT
04138  FA2A  20 E2 F8           JSR STT1
04139  FA2D  E6 9C              INC DPSW        ;SET BIT THROW AWAY FLAG
04140  FA2F  A5 B4              LDA SNSW1       ;IF BYTE SYNCRONIZED....
04141  FA31  D0 11              BNE RADQ2       ;...THEN SKIP TO PASS CHAR
04142  FA33  A5 96              LDA SYNO        ;THROWS OUT DATA UNTILL BLOCK SYNC...
04143  FA35  F0 26              BEQ RDBK2       ;...NO BLOCK SYNC
04144  FA37  85 A8              STA RER         ;FLAG DATA AS ERROR
04145  FA39  A9 00              LDA #0          ;KILL 16 SYNC FLAG
04146  FA3B  85 96              STA SYNO
04147  FA3D  A9 81              LDA #$81        ;SET UP FOR TIMER1 INTERRUPTS
04148  FA3F  8D 0D DC           STA D1ICR
04149  FA42  85 B4              STA SNSW1       ;FLAG THAT WE HAVE BYTE SYNCRONIZED
04150  FA44              ;
04151  FA44  A5 96       RADQ2  LDA SYNO        ;SAVE SYNO STATUS
04152  FA46  85 B5              STA DIFF






CASSETTE READ......PAGE 0065

LINE# LOC   CODE        LINE


04153  FA48  F0 09              BEQ RADK        ;NO BLOCK SYNC, NO BYTE LOOKING
04154  FA4A  A9 00              LDA #0          ;TURN OFF BYTE SYNC SWITCH
04155  FA4C  85 B4              STA SNSW1
04156  FA4E  A9 01              LDA #$01        ;DISABLE TIMER1 INTERRUPTS
04157  FA50  8D 0D DC           STA D1ICR
04158  FA53  A5 BF       RADK   LDA MYCH        ;PASS CHARACTER TO BYTE ROUTINE
04159  FA55  85 BD              STA OCHAR
04160  FA57  A5 A8              LDA RER         ;COMBINE ERROR VALUES WITH ZERO COUNT...
04161  FA59  05 A9              ORA REZ
04162  FA5B  85 B6              STA PRP         ;...AND SAVE IN PRP
04163  FA5D  4C BC FE    RDBK2  JMP PREND       ;GO BACK AND GET LAST BYTE


04165  FA60  20 97 FB    RADJ   JSR NEWCH       ;FINISH BYTE, CLR FLAGS
04166  FA63  85 9C              STA DPSW        ;CLEAR BIT THROW AWAY FLAG
04167  FA65  A2 DA              LDX #218        ;INITILIZE FOR NEXT DIPOLE
04168  FA67  20 E2 F8           JSR STT1
04169  FA6A  A5 BE              LDA FSBLK       ;CHECK FOR LAST VALUE
04170  FA6C  F0 02              BEQ RD15
04171  FA6E  85 A7              STA SHCNL









































BYTE HANDLER......PAGE 0066

LINE# LOC   CODE        LINE


04173  FA70              ;*************************************************
04174  FA70              ;* BYTE HANDLER OF CASSETTE READ                 *
04175  FA70              ;*                                               *
04176  FA70              ;* THIS PORTION OF IN LINE CODE IS PASSED THE    *
04177  FA70              ;* BYTE ASSEMBLED FROM READING TAPE IN OCHAR.    *
04178  FA70              ;* RER IS SET IF THE BYTE READ IS IN ERROR.      *
04179  FA70              ;* REZ IS SET IF THE INTERRUPT PROGRAM IS READING*
04180  FA70              ;* ZEROS.  RDFLG TELLS US WHAT WE ARE DOING.     *
04181  FA70              ;* BIT 7 SAYS TO IGNORE BYTES UNTIL REZ IS SET   *
04182  FA70              ;* BIT 6 SAYS TO LOAD THE BYTE. OTHERWISE RDFLG  *
04183  FA70              ;* IS A COUNTDOWN AFTER SYNC.  IF VERCK IS SET   *
04184  FA70              ;* WE DO A COMPARE INSTEAD OF A STORE AND SET    *
04185  FA70              ;* STATUS.  FSBLK COUNTS THE TWO BLOCKS. PTR1 IS *
04186  FA70              ;* INDEX TO ERROR TABLE FOR PASS1.  PTR2 IS INDEX*
04187  FA70              ;* TO CORRECTION TABLE FOR PASS2.                *
04188  FA70              ;*************************************************
04189  FA70              ;
04190  FA70              SPERR=16
04191  FA70              CKERR=32
04192  FA70              SBERR=4
04193  FA70              LBERR=8
04194  FA70              ;
04195  FA70  A9 0F       RD15   LDA #$F
04196  FA72              ;
04197  FA72  24 AA              BIT RDFLG       ;TEST FUNCTION MODE
04198  FA74  10 17              BPL RD20        ;NOT WAITING FOR ZEROS
04199  FA76              ;
04200  FA76  A5 B5              LDA DIFF        ;ZEROS YET?
04201  FA78  D0 0C              BNE RD12        ;YES...WAIT FOR SYNC
04202  FA7A  A6 BE              LDX FSBLK       ;IS PASS OVER?
04203  FA7C  CA                 DEX             ;...IF FSBLK ZERO THEN NO ERROR (FIRST GOOD)
04204  FA7D  D0 0B              BNE RD10        ;NO...
04205  FA7F              ;
04206  FA7F  A9 08              LDA #LBERR
04207  FA81  20 1C FE           JSR UDST        ;YES...LONG BLOCK ERROR
04208  FA84  D0 04              BNE RD10        ;BRANCH ALWAYS
04209  FA86              ;
04210  FA86  A9 00       RD12   LDA #0
04211  FA88  85 AA              STA RDFLG       ;NEW MODE IS WAIT FOR SYNC
04212  FA8A  4C BC FE    RD10   JMP PREND       ;EXIT...DONE
04213  FA8D              ;
04214  FA8D  70 31       RD20   BVS RD60        ;WE ARE LOADING
04215  FA8F  D0 18              BNE RD200       ;WE ARE SYNCING
04216  FA91              ;
04217  FA91  A5 B5              LDA DIFF        ;DO WE HAVE BLOCK SYNC...
04218  FA93  D0 F5              BNE RD10        ;...YES, EXIT
04219  FA95  A5 B6              LDA PRP         ;IF FIRST BYTE HAS ERROR...
04220  FA97  D0 F1              BNE RD10        ;...THEN SKIP (EXIT)
04221  FA99  A5 A7              LDA SHCNL       ;MOVE FSBLK TO CARRY...
04222  FA9B  4A                 LSR A
04223  FA9C  A5 BD              LDA OCHAR       ; SHOULD BE A HEADER COUNT CHAR
04224  FA9E  30 03              BMI RD22        ;IF NEG THEN FIRSTBLOCK DATA
04225  FAA0  90 18              BCC RD40        ;...EXPECTING FIRSTBLOCK DATA...YES
04226  FAA2  18                 CLC
04227  FAA3  B0 15       RD22   BCS RD40        ;EXPECTING SECOND BLOCK?...YES






BYTE HANDLER......PAGE 0067

LINE# LOC   CODE        LINE


04228  FAA5  29 0F              AND #$F         ;MASK OFF HIGH STORE HEADER COUNT...
04229  FAA7  85 AA              STA RDFLG       ;...IN MODE FLAG (HAVE CORRECT BLOCK)
04230  FAA9  C6 AA       RD200  DEC RDFLG       ;WAIT UNTILL WE GET REAL DATA...
04231  FAAB  D0 DD              BNE RD10        ;...9876543210 REAL
04232  FAAD  A9 40              LDA #$40        ;NEXT UP IS REAL DATA...
04233  FAAF  85 AA              STA RDFLG       ;...SET DATA MODE
04234  FAB1  20 8E FB           JSR RD300       ;GO SETUP ADDRESS POINTERS
04235  FAB4  A9 00              LDA #0          ;DEBUG CODE##################################################
04236  FAB6  85 AB              STA SHCNH
04237  FAB8  F0 D0              BEQ RD10        ;JMP TO CONTINUE


04239  FABA  A9 80       RD40   LDA #$80        ;WE WANT TO...
04240  FABC  85 AA              STA RDFLG       ;IGNORE BYTES MODE
04241  FABE  D0 CA              BNE RD10        ;JMP


04243  FAC0  A5 B5       RD60   LDA DIFF        ;CHECK FOR END OF BLOCK...
04244  FAC2  F0 0A              BEQ RD70        ;...OKAY
04245  FAC4              ;
04246  FAC4  A9 04              LDA #SBERR      ;SHORT BLOCK ERROR
04247  FAC6  20 1C FE           JSR UDST
04248  FAC9  A9 00              LDA #0          ;FORCE RDFLG FOR AN END
04249  FACB  4C 4A FB           JMP RD161


04251  FACE  20 D1 FC    RD70   JSR CMPSTE      ;CHECK FOR END OF STORAGE AREA
04252  FAD1  90 03              BCC *+5         ;NOT DONE YET
04253  FAD3  4C 48 FB           JMP RD160
04254  FAD6  A6 A7              LDX SHCNL       ;CHECK WHICH PASS...
04255  FAD8  CA                 DEX
04256  FAD9  F0 2D              BEQ RD58        ;...SECOND PASS
04257  FADB  A5 93              LDA VERCK       ;CHECK IF LOAD OR VERIFY...
04258  FADD  F0 0C              BEQ RD80        ;...LOADING
04259  FADF  A0 00              LDY #0          ;...JUST VERIFYING
04260  FAE1  A5 BD              LDA OCHAR
04261  FAE3  D1 AC              CMP (SAL)Y      ;COMPARE WITH DATA IN PET
04262  FAE5  F0 04              BEQ RD80        ;...GOOD SO CONTINUE
04263  FAE7  A9 01              LDA #1          ;...BAD SO FLAG...
04264  FAE9  85 B6              STA PRP         ;...AS AN ERROR

04266  FAEB              ; STORE BAD LOCATIONS FOR SECOND PASS RE-TRY
04267  FAEB  A5 B6       RD80   LDA PRP         ;CHK FOR ERRORS...
04268  FAED  F0 4B              BEQ RD59        ;...NO ERRORS
04269  FAEF  A2 3D              LDX #61         ;MAX ALLOWED IS 30
04270  FAF1  E4 9E              CPX PTR1        ;ARE WE AT MAX?...
04271  FAF3  90 3E              BCC RD55        ;...YES, FLAG AS SECOND PASS ERROR
04272  FAF5  A6 9E              LDX PTR1        ;GET INDEX INTO BAD...
04273  FAF7  A5 AD              LDA SAH         ;...AND STORE THE BAD LOCATION
04274  FAF9  9D 01 01           STA BAD+1,X     ;...IN BAD TABLE
04275  FAFC  A5 AC              LDA SAL
04276  FAFE  9D 00 01           STA BAD,X
04277  FB01  E8                 INX             ;ADVANCE POINTER TO NEXT
04278  FB02  E8                 INX
04279  FB03  86 9E              STX PTR1






BYTE HANDLER......PAGE 0068

LINE# LOC   CODE        LINE


04280  FB05  4C 3A FB           JMP RD59        ;GO STORE CHARACTER


04282  FB08              ; CHECK BAD TABLE FOR RE-TRY (SECOND PASS)
04283  FB08  A6 9F       RD58   LDX PTR2        ;HAVE WE DONE ALL IN THE TABLE?...
04284  FB0A  E4 9E              CPX PTR1
04285  FB0C  F0 35              BEQ RD90        ;...YES
04286  FB0E  A5 AC              LDA SAL         ;SEE IF THIS IS NEXT IN THE TABLE...
04287  FB10  DD 00 01           CMP BAD,X
04288  FB13  D0 2E              BNE RD90        ;...NO
04289  FB15  A5 AD              LDA SAH
04290  FB17  DD 01 01           CMP BAD+1,X
04291  FB1A  D0 27              BNE RD90        ;...NO
04292  FB1C  E6 9F              INC PTR2        ;WE FOUND NEXT ONE, SO ADVANCE POINTER
04293  FB1E  E6 9F              INC PTR2
04294  FB20  A5 93              LDA VERCK       ;DOING A LOAD OR VERIFY?...
04295  FB22  F0 0B              BEQ RD52        ;...LOADING
04296  FB24  A5 BD              LDA OCHAR       ;...VERIFYING, SO CHECK
04297  FB26  A0 00              LDY #0
04298  FB28  D1 AC              CMP (SAL)Y
04299  FB2A  F0 17              BEQ RD90        ;...OKAY
04300  FB2C  C8                 INY             ;MAKE .Y= 1
04301  FB2D  84 B6              STY PRP         ;FLAG IT AS AN ERROR


04303  FB2F  A5 B6       RD52   LDA PRP         ;A SECOND PASS ERROR?...
04304  FB31  F0 07              BEQ RD59        ;...NO
04305  FB33              ;SECOND PASS ERR
04306  FB33  A9 10       RD55   LDA #SPERR
04307  FB35  20 1C FE           JSR UDST
04308  FB38  D0 09              BNE RD90        ;JMP


04310  FB3A  A5 93       RD59   LDA VERCK       ;LOAD OR VERIFY?...
04311  FB3C  D0 05              BNE RD90        ;...VERIFY, DON'T STORE
04312  FB3E  A8                 TAY             ;MAKE Y ZERO
04313  FB3F  A5 BD              LDA OCHAR
04314  FB41  91 AC              STA (SAL)Y      ;STORE CHARACTER
04315  FB43  20 DB FC    RD90   JSR INCSAL      ;INCREMENT ADDR.
04316  FB46  D0 43              BNE RD180       ;BRANCH ALWAYS



04318  FB48  A9 80       RD160  LDA #$80        ;SET MODE SKIP NEXT DATA
04319  FB4A  85 AA       RD161  STA RDFLG
04320  FB4C              ;
04321  FB4C              ; MODIFY FOR C64 6526'S
04322  FB4C              ;
04323  FB4C  78                 SEI             ;PROTECT CLEARING OF T1 INFORMATION
04324  FB4D  A2 01              LDX #$01
04325  FB4F  8E 0D DC           STX D1ICR       ;CLEAR T1 ENABLE...
04326  FB52  AE 0D DC           LDX D1ICR       ;CLEAR THE INTERRUPT
04327  FB55  A6 BE              LDX FSBLK       ;DEC FSBLK FOR NEXT PASS...
04328  FB57  CA                 DEX
04329  FB58  30 02              BMI RD167       ;WE ARE DONE...FSBLK=0






BYTE HANDLER......PAGE 0069

LINE# LOC   CODE        LINE


04330  FB5A  86 BE              STX FSBLK       ;...ELSE FSBLK=NEXT
04331  FB5C  C6 A7       RD167  DEC SHCNL       ;DEC PASS CALC...
04332  FB5E  F0 08              BEQ RD175       ;...ALL DONE
04333  FB60  A5 9E              LDA PTR1        ;CHECK FOR FIRST PASS ERRORS...
04334  FB62  D0 27              BNE RD180       ;...YES SO CONTINUE
04335  FB64  85 BE              STA FSBLK       ;CLEAR FSBLK IF NO ERRORS...
04336  FB66  F0 23              BEQ RD180       ;JMP TO EXIT


04338  FB68  20 93 FC    RD175  JSR TNIF        ;READ IT ALL...EXIT
04339  FB6B  20 8E FB           JSR RD300       ;RESTORE SAL & SAH
04340  FB6E  A0 00              LDY #0          ;SET SHCNH TO ZERO...
04341  FB70  84 AB              STY SHCNH       ;...USED TO CALC PARITY BYTE
04342  FB72              ;
04343  FB72              ;COMPUTE PARITY OVER LOAD
04344  FB72              ;
04345  FB72  B1 AC       VPRTY  LDA (SAL)Y      ;CALC BLOCK BCC
04346  FB74  45 AB              EOR SHCNH
04347  FB76  85 AB              STA SHCNH
04348  FB78  20 DB FC           JSR INCSAL      ;INCREMENT ADDRESS
04349  FB7B  20 D1 FC           JSR CMPSTE      ;TEST AGAINST END
04350  FB7E  90 F2              BCC VPRTY       ;NOT DONE YET...
04351  FB80  A5 AB              LDA SHCNH       ;CHECK FOR BCC CHAR MATCH...
04352  FB82  45 BD              EOR OCHAR
04353  FB84  F0 05              BEQ RD180       ;...YES, EXIT
04354  FB86              ;CHKSUM ERROR
04355  FB86  A9 20              LDA #CKERR
04356  FB88  20 1C FE           JSR UDST
04357  FB8B  4C BC FE    RD180  JMP PREND




04359  FB8E  A5 C2       RD300  LDA STAH        ; RESTORE STARTING ADDRESS...
04360  FB90  85 AD              STA SAH         ;...POINTERS (SAH & SAL)
04361  FB92  A5 C1              LDA STAL
04362  FB94  85 AC              STA SAL
04363  FB96  60                 RTS




04365  FB97  A9 08       NEWCH  LDA #8          ;SET UP FOR 8 BITS+PARITY
04366  FB99  85 A3              STA PCNTR
04367  FB9B  A9 00              LDA #0          ;INITILIZE...
04368  FB9D  85 A4              STA FIRT        ;..DIPOLE COUNTER
04369  FB9F  85 A8              STA RER         ;..ERROR FLAG
04370  FBA1  85 9B              STA PRTY        ;..PARITY BIT
04371  FBA3  85 A9              STA REZ         ;..ZERO COUNT
04372  FBA5  60                 RTS             ;.A=0 ON RETURN
04373  FBA6              .END
04374  FBA6              .LIB   WRITE









TAPE WRITE......PAGE 006A

LINE# LOC   CODE        LINE


04376  FBA6              ; CASSETTE INFO - FSBLK IS BLOCK COUNTER FOR RECORD
04377  FBA6              ;       FSBLK = 2 -FIRST HEADER
04378  FBA6              ;             = 1 -FIRST DATA
04379  FBA6              ;             = 0 -SECOND DATA
04380  FBA6              ;
04381  FBA6              ; WRITE - TOGGLE WRITE BIT ACCORDING TO LSB IN OCHAR
04382  FBA6              ;
04383  FBA6  A5 BD       WRITE  LDA OCHAR       ;SHIFT BIT TO WRITE INTO CARRY
04384  FBA8  4A                 LSR A
04385  FBA9  A9 60              LDA #96         ;...C CLR WRITE SHORT
04386  FBAB  90 02              BCC WRT1
04387  FBAD  A9 B0       WRTW   LDA #176        ;...C SET WRITE LONG
04388  FBAF  A2 00       WRT1   LDX #0          ;SET AND STORE TIME
04389  FBB1  8D 06 DC    WRTX   STA D1T2L
04390  FBB4  8E 07 DC           STX D1T2H
04391  FBB7  AD 0D DC           LDA D1ICR       ;CLEAR IRQ
04392  FBBA  A9 19              LDA #$19        ;ENABLE TIMER (ONE-SHOT)
04393  FBBC  8D 0F DC           STA D1CRB
04394  FBBF  A5 01              LDA R6510       ;TOGGLE WRITE BIT
04395  FBC1  49 08              EOR #$08
04396  FBC3  85 01              STA R6510
04397  FBC5  29 08              AND #$08        ;LEAVE ONLY WRITE BIT
04398  FBC7  60                 RTS
04399  FBC8              ;
04400  FBC8  38          WRTL3  SEC             ;FLAG PRP FOR END OF BLOCK
04401  FBC9  66 B6              ROR PRP
04402  FBCB  30 3C              BMI WRT3        ; JMP
04403  FBCD              ;
04404  FBCD              ; WRTN - CALLED AT THE END OF EACH BYTE
04405  FBCD              ;   TO WRITE A LONG RER    REZ
04406  FBCD              ;              HHHHHHLLLLLLHHHLLL...
04407  FBCD              ;
04408  FBCD  A5 A8       WRTN   LDA RER         ;CHECK FOR ONE LONG
04409  FBCF  D0 12              BNE WRTN1
04410  FBD1  A9 10              LDA #16         ;WRITE A LONG BIT
04411  FBD3  A2 01              LDX #1
04412  FBD5  20 B1 FB           JSR WRTX
04413  FBD8  D0 2F              BNE WRT3
04414  FBDA  E6 A8              INC RER
04415  FBDC  A5 B6              LDA PRP         ;IF END OF BLOCK(BIT SET BY WRTL3)...
04416  FBDE  10 29              BPL WRT3        ;...NO END CONTINUE
04417  FBE0  4C 57 FC           JMP WRNC        ;...END ...FINISH OFF
04418  FBE3              ;
04419  FBE3  A5 A9       WRTN1  LDA REZ         ;CHECK FOR A ONE BIT
04420  FBE5  D0 09              BNE WRTN2
04421  FBE7  20 AD FB           JSR WRTW
04422  FBEA  D0 1D              BNE WRT3
04423  FBEC  E6 A9              INC REZ
04424  FBEE  D0 19              BNE WRT3
04425  FBF0              ;
04426  FBF0  20 A6 FB    WRTN2  JSR WRITE
04427  FBF3  D0 14              BNE WRT3        ;ON BIT LOW EXIT
04428  FBF5  A5 A4              LDA FIRT        ;CHECK FOR FIRST OF DIPOLE
04429  FBF7  49 01              EOR #1
04430  FBF9  85 A4              STA FIRT






TAPE WRITE......PAGE 006B

LINE# LOC   CODE        LINE


04431  FBFB  F0 0F              BEQ WRT2        ;DIPOLE DONE
04432  FBFD  A5 BD              LDA OCHAR       ;FLIPS BIT FOR COMPLEMENTARY RIGHT
04433  FBFF  49 01              EOR #1
04434  FC01  85 BD              STA OCHAR
04435  FC03  29 01              AND #1          ;TOGGLE PARITY
04436  FC05  45 9B              EOR PRTY
04437  FC07  85 9B              STA PRTY
04438  FC09  4C BC FE    WRT3   JMP PREND       ;RESTORE REGS AND RTI EXIT
04439  FC0C              ;
04440  FC0C  46 BD       WRT2   LSR OCHAR       ;MOVE TO NEXT BIT
04441  FC0E  C6 A3              DEC PCNTR       ;DEC COUNTER FOR # OF BITS
04442  FC10  A5 A3              LDA PCNTR       ;CHECK FOR 8 BITS SENT...
04443  FC12  F0 3A              BEQ WRT4        ;...IF YES MOVE IN PARITY
04444  FC14  10 F3              BPL WRT3        ;...ELSE SEND REST
04445  FC16              ;
04446  FC16  20 97 FB    WRTS   JSR NEWCH       ;CLEAN UP COUNTERS
04447  FC19  58                 CLI             ;ALLOW FOR INTERRUPTS TO NEST
04448  FC1A  A5 A5              LDA CNTDN       ;ARE WE WRITING HEADER COUNTERS?...
04449  FC1C  F0 12              BEQ WRT6        ;...NO
04450  FC1E              ; WRITE HEADER COUNTERS (9876543210 TO HELP WITH READ)
04451  FC1E  A2 00              LDX #0          ;CLEAR BCC
04452  FC20  86 D7              STX DATA
04453  FC22  C6 A5       WRTS1  DEC CNTDN
04454  FC24  A6 BE              LDX FSBLK       ;CHECK FOR FIRST BLOCK HEADER
04455  FC26  E0 02              CPX #2
04456  FC28  D0 02              BNE WRT61       ;...NO
04457  FC2A  09 80              ORA #$80        ;...YES MARK FIRST BLOCK HEADER
04458  FC2C  85 BD       WRT61  STA OCHAR       ;WRITE CHARACTERS IN HEADER
04459  FC2E  D0 D9              BNE WRT3
04460  FC30              ;
04461  FC30  20 D1 FC    WRT6   JSR CMPSTE      ;COMPARE START:END
04462  FC33  90 0A              BCC WRT7        ;NOT DONE
04463  FC35  D0 91              BNE WRTL3       ;GO MARK END
04464  FC37  E6 AD              INC SAH
04465  FC39  A5 D7              LDA DATA        ;WRITE OUT BCC
04466  FC3B  85 BD              STA OCHAR
04467  FC3D  B0 CA              BCS WRT3        ;JMP
04468  FC3F              ;
04469  FC3F  A0 00       WRT7   LDY #0          ;GET NEXT CHARACTER
04470  FC41  B1 AC              LDA (SAL)Y
04471  FC43  85 BD              STA OCHAR       ;STORE IN OUTPUT CHARACTER
04472  FC45  45 D7              EOR DATA        ;UPDATE BCC
04473  FC47  85 D7              STA DATA
04474  FC49  20 DB FC           JSR INCSAL      ;INCREMENT FETCH ADDRESS
04475  FC4C  D0 BB              BNE WRT3        ;BRANCH ALWAYS
04476  FC4E              ;
04477  FC4E  A5 9B       WRT4   LDA PRTY        ;MOVE PARITY INTO OCHAR...
04478  FC50  49 01              EOR #1
04479  FC52  85 BD              STA OCHAR       ;...TO BE WRITTEN AS NEXT BIT
04480  FC54  4C BC FE    WRTBK  JMP PREND       ;RESTORE REGS AND RTI EXIT
04481  FC57              ;
04482  FC57  C6 BE       WRNC   DEC FSBLK       ;CHECK FOR END
04483  FC59  D0 03              BNE WREND       ;...BLOCK ONLY
04484  FC5B  20 CA FC           JSR TNOF        ;...WRITE, SO TURN OFF MOTOR
04485  FC5E  A9 50       WREND  LDA #80         ;PUT 80 CASSETTE SYNCS AT END






TAPE WRITE......PAGE 006C

LINE# LOC   CODE        LINE


04486  FC60  85 A7              STA SHCNL
04487  FC62  A2 08              LDX #8
04488  FC64  78                 SEI
04489  FC65  20 BD FC           JSR BSIV        ;SET VECTOR TO WRITE ZEROS
04490  FC68  D0 EA              BNE WRTBK       ;JMP
04491  FC6A              ;
04492  FC6A  A9 78       WRTZ   LDA #120        ;WRITE LEADING ZEROS FOR SYNC
04493  FC6C  20 AF FB           JSR WRT1
04494  FC6F  D0 E3              BNE WRTBK
04495  FC71  C6 A7              DEC SHCNL       ;CHECK IF DONE WITH LOW SYNC...
04496  FC73  D0 DF              BNE WRTBK       ;...NO
04497  FC75  20 97 FB           JSR NEWCH       ;...YES CLEAR UP COUNTERS
04498  FC78  C6 AB              DEC SHCNH       ;CHECK IF DONE WITH SYNC...
04499  FC7A  10 D8              BPL WRTBK       ;...NO
04500  FC7C  A2 0A              LDX #10         ;...YES SO SET VECTOR FOR DATA
04501  FC7E  20 BD FC           JSR BSIV
04502  FC81  58                 CLI
04503  FC82  E6 AB              INC SHCNH       ;ZERO SHCNH
04504  FC84  A5 BE              LDA FSBLK       ;IF DONE THEN...
04505  FC86  F0 30              BEQ STKY        ;...GOTO SYSTEM RESTORE
04506  FC88  20 8E FB           JSR RD300
04507  FC8B  A2 09              LDX #9          ;SET UP FOR HEADER COUNT
04508  FC8D  86 A5              STX CNTDN
04509  FC8F  86 B6              STX PRP         ;CLEAR ENDOF BLOCK FLAG
04510  FC91  D0 83              BNE WRTS        ;JMP
04511  FC93              ;
04512  FC93  08          TNIF   PHP             ;CLEAN UP INTERRUPTS AND RESTORE PIA'S
04513  FC94  78                 SEI
04514  FC95  AD 11 D0           LDA VICREG+17   ;UNLOCK VIC
04515  FC98  09 10              ORA #$10        ;ENABLE DISPLAY
04516  FC9A  8D 11 D0           STA VICREG+17
04517  FC9D  20 CA FC           JSR TNOF        ;TURN OFF MOTOR
04518  FCA0  A9 7F              LDA #$7F        ;CLEAR INTERRUPTS
04519  FCA2  8D 0D DC           STA D1ICR
04520  FCA5  20 DD FD           JSR IOKEYS      ;RESTORE KEYBOARD IRQ FROM TIMMER1
04521  FCA8  AD A0 02           LDA IRQTMP+1    ;RESTORE KEYBOARD INTERRUPT VECTOR
04522  FCAB  F0 09              BEQ TNIQ        ;NO IRQ (IRQ VECTOR CANNOT BE Z-PAGE)
04523  FCAD  8D 15 03           STA CINV+1
04524  FCB0  AD 9F 02           LDA IRQTMP
04525  FCB3  8D 14 03           STA CINV
04526  FCB6  28          TNIQ   PLP
04527  FCB7  60                 RTS
04528  FCB8              ;
04529  FCB8  20 93 FC    STKY   JSR TNIF        ;GO RESTORE SYSTEM INTERRUPTS
04530  FCBB  F0 97              BEQ WRTBK       ;CAME FOR CASSETTE IRQ SO RTI
04531  FCBD              ;
04532  FCBD              ; BSIV - SUBROUTINE TO CHANGE IRQ VECTORS
04533  FCBD              ;  ENTRYS - .X = 8 WRITE ZEROS TO TAPE
04534  FCBD              ;           .X = 10 WRITE DATA TO TAPE
04535  FCBD              ;           .X = 12 RESTORE TO KEYSCAN
04536  FCBD              ;           .X = 14 READ DATA FROM TAPE
04537  FCBD              ;
04538  FCBD  BD 93 FD    BSIV   LDA BSIT-8,X    ;MOVE IRQ VECTORS, TABLE TO INDIRECT
04539  FCC0  8D 14 03           STA CINV
04540  FCC3  BD 94 FD           LDA BSIT+1-8,X






TAPE WRITE......PAGE 006D

LINE# LOC   CODE        LINE


04541  FCC6  8D 15 03           STA CINV+1
04542  FCC9  60                 RTS
04543  FCCA              ;
04544  FCCA  A5 01       TNOF   LDA R6510       ;TURN OFF CASSETTE MOTOR
04545  FCCC  09 20              ORA #$20        ;
04546  FCCE  85 01              STA R6510
04547  FCD0  60                 RTS



04549  FCD1              ;COMPARE START AND END LOAD/SAVE
04550  FCD1              ;ADDRESSES.  SUBROUTINE CALLED BY
04551  FCD1              ;TAPE READ, SAVE, TAPE WRITE
04552  FCD1              ;
04553  FCD1  38          CMPSTE SEC
04554  FCD2  A5 AC              LDA SAL
04555  FCD4  E5 AE              SBC EAL
04556  FCD6  A5 AD              LDA SAH
04557  FCD8  E5 AF              SBC EAH
04558  FCDA  60                 RTS



04560  FCDB              ;INCREMENT ADDRESS POINTER SAL
04561  FCDB              ;
04562  FCDB  E6 AC       INCSAL INC SAL
04563  FCDD  D0 02              BNE INCR
04564  FCDF  E6 AD              INC SAH
04565  FCE1  60          INCR   RTS
04566  FCE2              .END
04567  FCE2              .LIB   INIT






























INITIALIZATION......PAGE 006E

LINE# LOC   CODE        LINE


04569  FCE2              ; START - SYSTEM RESET
04570  FCE2              ; WILL GOTO ROM AT $8000...
04571  FCE2              ; IF LOCS $8004-$8008
04572  FCE2              ; = 'CBM80'
04573  FCE2              ;    ^^^  > THESE HAVE MSB SET
04574  FCE2              ; KERNAL EXPECTS...
04575  FCE2              ; $8000- .WORD INITILIZE (HARD START)
04576  FCE2              ; $8002- .WORD PANIC (WARM START)
04577  FCE2              ; ... ELSE BASIC SYSTEM USED
04578  FCE2              ; ******************TESTING ONLY***************
04579  FCE2              ; USE AUTO DISK/CASSETTE LOAD WHEN DEVELOPED...
04580  FCE2              ;
04581  FCE2  A2 FF       START  LDX #$FF
04582  FCE4  78                 SEI
04583  FCE5  9A                 TXS
04584  FCE6  D8                 CLD
04585  FCE7  20 02 FD           JSR A0INT       ;TEST FOR $A0 ROM IN
04586  FCEA  D0 03              BNE START1
04587  FCEC  6C 00 80           JMP ($8000)     ; GO INIT AS $A000 ROM WANTS
04588  FCEF  8E 16 D0    START1 STX VICREG+22   ;SET UP REFRESH (.X=<5)
04589  FCF2  20 A3 FD           JSR IOINIT      ;GO INITILIZE I/O DEVICES
04590  FCF5  20 50 FD           JSR RAMTAS      ;GO RAM TEST AND SET
04591  FCF8  20 15 FD           JSR RESTOR      ;GO SET UP OS VECTORS
04592  FCFB              ;
04593  FCFB  20 5B FF           JSR PCINT       ;GO INITILIZE SCREEN NEWXXX
04594  FCFE  58                 CLI             ;INTERRUPTS OKAY NOW
04595  FCFF  6C 00 A0           JMP ($A000)     ;GO TO BASIC SYSTEM




04597  FD02              ; A0INT - TEST FOR AN $8000 ROM
04598  FD02              ;  RETURNS Z - $8000 IN
04599  FD02              ;
04600  FD02  A2 05       A0INT  LDX #TBLA0E-TBLA0R ;CHECK FOR $8000
04601  FD04  BD 0F FD    A0IN1  LDA TBLA0R-1,X
04602  FD07  DD 03 80           CMP $8004-1,X
04603  FD0A  D0 03              BNE A0IN2
04604  FD0C  CA                 DEX
04605  FD0D  D0 F5              BNE A0IN1
04606  FD0F  60          A0IN2  RTS
04607  FD10              ;
04608  FD10  C3          TBLA0R .BYT $C3,$C2,$CD,'80' ;..CBM80..
04608  FD11  C2 
04608  FD12  CD 
04608  FD13  38 30 
04609  FD15              TBLA0E




04611  FD15              ; RESTOR - SET KERNAL INDIRECTS AND VECTORS (SYSTEM)
04612  FD15              ;
04613  FD15  A2 30       RESTOR LDX #<VECTSS
04614  FD17  A0 FD              LDY #>VECTSS






INITIALIZATION......PAGE 006F

LINE# LOC   CODE        LINE


04615  FD19  18                 CLC
04616  FD1A              ;
04617  FD1A              ; VECTOR - SET KERNAL INDIRECT AND VECTORS (USER)
04618  FD1A              ;
04619  FD1A  86 C3       VECTOR STX TMP2
04620  FD1C  84 C4              STY TMP2+1
04621  FD1E  A0 1F              LDY #VECTSE-VECTSS-1
04622  FD20  B9 14 03    MOVOS1 LDA CINV,Y      ;GET FROM STORAGE
04623  FD23  B0 02              BCS MOVOS2      ;C...WANT STORAGE TO USER
04624  FD25  B1 C3              LDA (TMP2)Y     ;...WANT USER TO STORAGE
04625  FD27  91 C3       MOVOS2 STA (TMP2)Y     ;PUT IN USER
04626  FD29  99 14 03           STA CINV,Y      ;PUT IN STORAGE
04627  FD2C  88                 DEY
04628  FD2D  10 F1              BPL MOVOS1
04629  FD2F  60                 RTS
04630  FD30              ;
04631  FD30  31 EA       VECTSS .WOR KEY,TIMB,NNMI
04631  FD32  66 FE 
04631  FD34  47 FE 
04632  FD36  4A F3              .WOR NOPEN,NCLOSE,NCHKIN
04632  FD38  91 F2 
04632  FD3A  0E F2 
04633  FD3C  50 F2              .WOR NCKOUT,NCLRCH,NBASIN
04633  FD3E  33 F3 
04633  FD40  57 F1 
04634  FD42  CA F1              .WOR NBSOUT,NSTOP,NGETIN
04634  FD44  ED F6 
04634  FD46  3E F1 
04635  FD48  2F F3              .WOR NCLALL,TIMB ;GOTO BREAK ON A USRCMD JMP
04635  FD4A  66 FE 
04636  FD4C  A5 F4              .WOR NLOAD,NSAVE
04636  FD4E  ED F5 
04637  FD50              VECTSE




























INITILIZE CODE......PAGE 0070

LINE# LOC   CODE        LINE


04639  FD50              ; RAMTAS - MEMORY SIZE CHECK AND SET
04640  FD50              ;
04641  FD50  A9 00       RAMTAS LDA #0          ;ZERO LOW MEMORY
04642  FD52  A8                 TAY             ;START AT 0002
04643  FD53  99 02 00    RAMTZ0 STA $0002,Y     ;ZERO PAGE
04644  FD56  99 00 02           STA $0200,Y     ;USER BUFFERS AND VARS
04645  FD59  99 00 03           STA $0300,Y     ;SYSTEM SPACE AND USER SPACE
04646  FD5C  C8                 INY
04647  FD5D  D0 F4              BNE RAMTZ0
04648  FD5F              ;
04649  FD5F              ;ALLOCATE TAPE BUFFERS
04650  FD5F              ;
04651  FD5F  A2 3C              LDX #<TBUFFR
04652  FD61  A0 03              LDY #>TBUFFR
04653  FD63  86 B2              STX TAPE1
04654  FD65  84 B3              STY TAPE1+1
04655  FD67              ;
04656  FD67              ; SET TOP OF MEMORY
04657  FD67              ;
04658  FD67              RAMTBT
04659  FD67  A8                 TAY             ;MOVE $00 TO .Y
04660  FD68  A9 03              LDA #3          ;SET HIGH INITAL INDEX
04661  FD6A  85 C2              STA TMP0+1
04662  FD6C              ;
04663  FD6C  E6 C2       RAMTZ1 INC TMP0+1      ;MOVE INDEX THRU MEMORY
04664  FD6E  B1 C1       RAMTZ2 LDA (TMP0)Y     ;GET PRESENT DATA
04665  FD70  AA                 TAX             ;SAVE IN .X
04666  FD71  A9 55              LDA #$55        ;DO A $55,$AA TEST
04667  FD73  91 C1              STA (TMP0)Y
04668  FD75  D1 C1              CMP (TMP0)Y
04669  FD77  D0 0F              BNE SIZE
04670  FD79  2A                 ROL A
04671  FD7A  91 C1              STA (TMP0)Y
04672  FD7C  D1 C1              CMP (TMP0)Y
04673  FD7E  D0 08              BNE SIZE
04674  FD80  8A                 TXA             ;RESTORE OLD DATA
04675  FD81  91 C1              STA (TMP0)Y
04676  FD83  C8                 INY
04677  FD84  D0 E8              BNE RAMTZ2
04678  FD86  F0 E4              BEQ RAMTZ1
04679  FD88              ;
04680  FD88  98          SIZE   TYA             ;SET TOP OF MEMORY
04681  FD89  AA                 TAX
04682  FD8A  A4 C2              LDY TMP0+1
04683  FD8C  18                 CLC
04684  FD8D  20 2D FE           JSR SETTOP
04685  FD90  A9 08              LDA #$08        ;SET BOTTOM OF MEMORY
04686  FD92  8D 82 02           STA MEMSTR+1    ;ALWAYS AT $0800
04687  FD95  A9 04              LDA #$04        ;SCREEN ALWAYS AT $400
04688  FD97  8D 88 02           STA HIBASE      ;SET BASE OF SCREEN
04689  FD9A  60                 RTS



04691  FD9B  6A FC       BSIT   .WOR WRTZ,WRTN,KEY,READ ;TABLE OF INDIRECTS FOR CASSETTE IRQ'S






INITILIZE CODE......PAGE 0071

LINE# LOC   CODE        LINE


04691  FD9D  CD FB 
04691  FD9F  31 EA 
04691  FDA1  2C F9 


























































INITILIZE CODE......PAGE 0072

LINE# LOC   CODE        LINE


04693  FDA3              ; IOINIT - INITILIZE IO DEVICES
04694  FDA3              ;
04695  FDA3  A9 7F       IOINIT LDA #$7F        ;KILL INTERRUPTS
04696  FDA5  8D 0D DC           STA D1ICR
04697  FDA8  8D 0D DD           STA D2ICR
04698  FDAB  8D 00 DC           STA D1PRA       ;TURN ON STOP KEY
04699  FDAE  A9 08              LDA #%00001000  ;SHUT OFF TIMERS
04700  FDB0  8D 0E DC           STA D1CRA
04701  FDB3  8D 0E DD           STA D2CRA
04702  FDB6  8D 0F DC           STA D1CRB
04703  FDB9  8D 0F DD           STA D2CRB
04704  FDBC              ; CONFIGURE PORTS
04705  FDBC  A2 00              LDX #$00        ;SET UP KEYBOARD INPUTS
04706  FDBE  8E 03 DC           STX D1DDRB      ;KEYBOARD INPUTS
04707  FDC1  8E 03 DD           STX D2DDRB      ;USER PORT (NO RS-232)
04708  FDC4  8E 18 D4           STX SIDREG+24   ;TURN OFF SID
04709  FDC7  CA                 DEX
04710  FDC8  8E 02 DC           STX D1DDRA      ;KEYBOARD OUTPUTS
04711  FDCB  A9 07              LDA #%00000111  ;SET SERIAL/VA14/15 (CLKHI)
04712  FDCD  8D 00 DD           STA D2PRA
04713  FDD0  A9 3F              LDA #%00111111  ;SET SERIAL IN/OUT, VA14/15OUT
04714  FDD2  8D 02 DD           STA D2DDRA
04715  FDD5              ;
04716  FDD5              ; SET UP THE 6510 LINES
04717  FDD5              ;
04718  FDD5  A9 E7              LDA #%11100111  ;MOTOR ON, HIRAM LOWRAM CHAREN HIGH
04719  FDD7  85 01              STA R6510
04720  FDD9  A9 2F              LDA #%00101111  ;MTR OUT,SW IN,WR OUT,CONTROL OUT
04721  FDDB  85 00              STA D6510
04722  FDDD              ;
04723  FDDD              ;JSR CLKHI ;CLKHI TO RELEASE SERIAL DEVICES  ^
04724  FDDD              ;
04725  FDDD  AD A6 02    IOKEYS LDA PALNTS      ;PAL OR NTSC
04726  FDE0  F0 0A              BEQ IO010       ;NTSC
04727  FDE2  A9 25              LDA #<SIXTYP
04728  FDE4  8D 04 DC           STA D1T1L
04729  FDE7  A9 40              LDA #>SIXTYP
04730  FDE9  4C F3 FD           JMP IO020
04731  FDEC  A9 95       IO010  LDA #<SIXTY     ;KEYBOARD SCAN IRQ'S
04732  FDEE  8D 04 DC           STA D1T1L
04733  FDF1  A9 42              LDA #>SIXTY
04734  FDF3  8D 05 DC    IO020  STA D1T1H
04735  FDF6  4C 6E FF           JMP PIOKEY      ;PATCH IOKEYS
04736  FDF9              ; LDA #$81 ;ENABLE T1 IRQ'S
04737  FDF9              ; STA D1ICR
04738  FDF9              ; LDA D1CRA
04739  FDF9              ; AND #$80 ;SAVE ONLY TOD BIT
04740  FDF9              ; ORA #%00010001 ;ENABLE TIMER1
04741  FDF9              ; STA D1CRA
04742  FDF9              ; JMP CLKLO ;RELEASE THE CLOCK LINE
04743  FDF9              ;
04744  FDF9              ; SIXTY HERTZ VALUES
04745  FDF9              ;
04746  FDF9              SIXTY  = 17045         ;NTSC
04747  FDF9              SIXTYP = 16421         ;PAL






INIT - SYS SUBS......PAGE 0073

LINE# LOC   CODE        LINE


04749  FDF9  85 B7       SETNAM STA FNLEN
04750  FDFB  86 BB              STX FNADR
04751  FDFD  84 BC              STY FNADR+1
04752  FDFF  60                 RTS





04754  FE00  85 B8       SETLFS STA LA
04755  FE02  86 BA              STX FA
04756  FE04  84 B9              STY SA
04757  FE06  60                 RTS





04759  FE07  A5 BA       READSS LDA FA          ;SEE WHICH DEVICES' TO READ
04760  FE09  C9 02              CMP #2          ;IS IT RS-232?
04761  FE0B  D0 0D              BNE READST      ;NO...READ SERIAL/CASS
04762  FE0D  AD 97 02           LDA RSSTAT      ;YES...GET RS-232 UP
04763  FE10  48                 PHA
04764  FE11  A9 00              LDA #00         ;CLEAR RS232 STATUS WHEN READ
04765  FE13  8D 97 02           STA RSSTAT
04766  FE16  68                 PLA
04767  FE17  60                 RTS
04768  FE18  85 9D       SETMSG STA MSGFLG
04769  FE1A  A5 90       READST LDA STATUS
04770  FE1C  05 90       UDST   ORA STATUS
04771  FE1E  85 90              STA STATUS
04772  FE20  60                 RTS





04774  FE21  8D 85 02    SETTMO STA TIMOUT
04775  FE24  60                 RTS





04777  FE25  90 06       MEMTOP BCC SETTOP
04778  FE27              ;
04779  FE27              ;CARRY SET--READ TOP OF MEMORY
04780  FE27              ;
04781  FE27  AE 83 02    GETTOP LDX MEMSIZ
04782  FE2A  AC 84 02           LDY MEMSIZ+1
04783  FE2D              ;
04784  FE2D              ;CARRY CLEAR--SET TOP OF MEMORY
04785  FE2D              ;
04786  FE2D  8E 83 02    SETTOP STX MEMSIZ
04787  FE30  8C 84 02           STY MEMSIZ+1






INIT - SYS SUBS......PAGE 0074

LINE# LOC   CODE        LINE


04788  FE33  60                 RTS





04790  FE34              ;MANAGE BOTTOM OF MEMORY
04791  FE34              ;
04792  FE34  90 06       MEMBOT BCC SETBOT
04793  FE36              ;
04794  FE36              ;CARRY SET--READ BOTTOM OF MEMORY
04795  FE36              ;
04796  FE36  AE 81 02           LDX MEMSTR
04797  FE39  AC 82 02           LDY MEMSTR+1
04798  FE3C              ;
04799  FE3C              ;CARRY CLEAR--SET BOTTOM OF MEMORY
04800  FE3C              ;
04801  FE3C  8E 81 02    SETBOT STX MEMSTR
04802  FE3F  8C 82 02           STY MEMSTR+1
04803  FE42  60                 RTS
04804  FE43              .END
04805  FE43              .LIB   RS232NMI







































NMI HANDLER......PAGE 0075

LINE# LOC   CODE        LINE


04807  FE43  78          NMI    SEI             ;NO IRQ'S ALLOWED...
04808  FE44  6C 18 03           JMP (NMINV)     ;...COULD MESS UP CASSETTES
04809  FE47  48          NNMI   PHA
04810  FE48  8A                 TXA
04811  FE49  48                 PHA
04812  FE4A  98                 TYA
04813  FE4B  48                 PHA
04814  FE4C  A9 7F       NNMI10 LDA #$7F        ;DISABLE ALL NMI'S
04815  FE4E  8D 0D DD           STA D2ICR
04816  FE51  AC 0D DD           LDY D2ICR       ;CHECK IF REAL NMI...
04817  FE54  30 1C              BMI NNMI20      ;NO...RS232/OTHER
04818  FE56              ;
04819  FE56  20 02 FD    NNMI18 JSR A0INT       ;CHECK IF $A0 IN...NO .Y
04820  FE59  D0 03              BNE NNMI19      ;...NO
04821  FE5B  6C 02 80           JMP ($8002)     ;...YES
04822  FE5E              ;
04823  FE5E              ; CHECK FOR STOP KEY DOWN
04824  FE5E              ;
04825  FE5E              NNMI19
04826  FE5E  20 BC F6           JSR UD60        ;NO .Y
04827  FE61  20 E1 FF           JSR STOP        ;NO .Y
04828  FE64  D0 0C              BNE NNMI20      ;NO STOP KEY...TEST FOR RS232
04829  FE66              ;
04830  FE66              ; TIMB - WHERE SYSTEM GOES ON A BRK INSTRUCTION
04831  FE66              ;
04832  FE66  20 15 FD    TIMB   JSR RESTOR      ;RESTORE SYSTEM INDIRECTS
04833  FE69  20 A3 FD           JSR IOINIT      ;RESTORE I/O FOR BASIC
04834  FE6C  20 18 E5           JSR CINT        ;RESTORE SCREEN FOR BASIC
04835  FE6F  6C 02 A0           JMP ($A002)     ;...NO, SO BASIC WARM START


04837  FE72              ; DISABLE NMI'S UNTILL READY
04838  FE72              ;  SAVE ON STACK
04839  FE72              ;
04840  FE72  98          NNMI20 TYA             ;.Y SAVED THROUGH RESTORE
04841  FE73  2D A1 02           AND ENABL       ;SHOW ONLY ENABLES
04842  FE76  AA                 TAX             ;SAVE IN .X FOR LATTER
04843  FE77              ;
04844  FE77              ; T1 NMI CHECK - TRANSMITT A BIT
04845  FE77              ;
04846  FE77  29 01              AND #$01        ;CHECK FOR T1
04847  FE79  F0 28              BEQ NNMI30      ;NO...
04848  FE7B              ;
04849  FE7B  AD 00 DD           LDA D2PRA
04850  FE7E  29 FB              AND #$FF-$04    ;FIX FOR CURRENT I/O
04851  FE80  05 B5              ORA NXTBIT      ;LOAD DATA AND...
04852  FE82  8D 00 DD           STA D2PRA       ;...SEND IT
04853  FE85              ;
04854  FE85  AD A1 02           LDA ENABL       ;RESTORE NMI'S
04855  FE88  8D 0D DD           STA D2ICR       ;READY FOR NEXT...
04856  FE8B              ;
04857  FE8B              ; BECAUSE OF 6526 ICR STRUCTURE...
04858  FE8B              ;  HANDLE ANOTHER NMI AS A SUBROUTINE
04859  FE8B              ;
04860  FE8B  8A                 TXA             ;TEST FOR ANOTHER NMI






NMI HANDLER......PAGE 0076

LINE# LOC   CODE        LINE


04861  FE8C  29 12              AND #$12        ;TEST FOR T2 OR FLAG
04862  FE8E  F0 0D              BEQ NNMI25
04863  FE90  29 02              AND #$02        ;CHECK FOR T2
04864  FE92  F0 06              BEQ NNMI22      ;MUST BE A FLAG
04865  FE94              ;
04866  FE94  20 D6 FE           JSR T2NMI       ;HANDLE A NORMAL BIT IN...
04867  FE97  4C 9D FE           JMP NNMI25      ;...THEN CONTINUE OUTPUT
04868  FE9A              ;
04869  FE9A  20 07 FF    NNMI22 JSR FLNMI       ;HANDLE A START BIT...
04870  FE9D              ;
04871  FE9D  20 BB EE    NNMI25 JSR RSTRAB      ;GO CALC INFO (CODE COULD BE IN LINE)
04872  FEA0  4C B6 FE           JMP NMIRTI
04873  FEA3              ;


04875  FEA3              ; T2 NMI CHECK - RECIEVE A BIT
04876  FEA3              ;
04877  FEA3  8A          NNMI30 TXA
04878  FEA4  29 02              AND #$02        ;MASK TO T2
04879  FEA6  F0 06              BEQ NNMI40      ;NO...
04880  FEA8              ;
04881  FEA8  20 D6 FE           JSR T2NMI       ;HANDLE INTERRUPT
04882  FEAB  4C B6 FE           JMP NMIRTI


04884  FEAE              ; FLAG NMI HANDLER - RECIEVE A START BIT
04885  FEAE              ;
04886  FEAE  8A          NNMI40 TXA             ;CHECK FOR EDGE
04887  FEAF  29 10              AND #$10        ;ON FLAG...
04888  FEB1  F0 03              BEQ NMIRTI      ;NO...
04889  FEB3              ;
04890  FEB3  20 07 FF           JSR FLNMI       ;START BIT ROUTINE


04892  FEB6  AD A1 02    NMIRTI LDA ENABL       ;RESTORE NMI'S
04893  FEB9  8D 0D DD           STA D2ICR
04894  FEBC  68          PREND  PLA             ;BECAUSE OF MISSING SCREEN EDITOR
04895  FEBD  A8                 TAY
04896  FEBE  68                 PLA
04897  FEBF  AA                 TAX
04898  FEC0  68                 PLA
04899  FEC1  40                 RTI




04901  FEC2              ; BAUDO TABLE CONTAINS VALUES
04902  FEC2              ;  FOR 14.31818E6/14/BAUD RATE/2 (NTSC)
04903  FEC2              ;
04904  FEC2  C1 27       BAUDO  .WOR 10277-CBIT ; 50 BAUD
04905  FEC4  3E 1A              .WOR 6818-CBIT  ;   75   BAUD
04906  FEC6  C5 11              .WOR 4649-CBIT  ;  110   BAUD
04907  FEC8  74 0E              .WOR 3800-CBIT  ;  134.6 BAUD
04908  FECA  ED 0C              .WOR 3409-CBIT  ;  150   BAUD
04909  FECC  45 06              .WOR 1705-CBIT  ;  300   BAUD






NMI HANDLER......PAGE 0077

LINE# LOC   CODE        LINE


04910  FECE  F0 02              .WOR 852-CBIT   ;  600   BAUD
04911  FED0  46 01              .WOR 426-CBIT   ; 1200   BAUD
04912  FED2  B8 00              .WOR 284-CBIT   ; 1800   BAUD
04913  FED4  71 00              .WOR 213-CBIT   ; 2400   BAUD
04914  FED6              ;
04915  FED6              ; CBIT - AN ADJUSTMENT TO MAKE NEXT T2 HIT NEAR CENTER
04916  FED6              ;   OF THE NEXT BIT.
04917  FED6              ;   APROX THE TIME TO SERVICE A CB1 NMI
04918  FED6              CBIT   =100            ;CYCLES




















































NMI - SUBROUTINES......PAGE 0078

LINE# LOC   CODE        LINE


04920  FED6              ; T2NMI - SUBROUTINE TO HANDLE AN RS232
04921  FED6              ;  BIT INPUT.
04922  FED6              ;
04923  FED6  AD 01 DD    T2NMI  LDA D2PRB       ;GET DATA IN
04924  FED9  29 01              AND #01         ;MASK OFF...
04925  FEDB  85 A7              STA INBIT       ;...SAVE FOR LATTER
04926  FEDD              ;
04927  FEDD              ; UPDATE T2 FOR MID BIT CHECK
04928  FEDD              ;   (WORST CASE <213 CYCLES TO HERE)
04929  FEDD              ;   (CALC 125 CYCLES+43-66 DEAD)
04930  FEDD              ;
04931  FEDD  AD 06 DD           LDA D2T2L       ;CALC NEW TIME & CLR NMI
04932  FEE0  E9 1C              SBC #22+6
04933  FEE2  6D 99 02           ADC BAUDOF
04934  FEE5  8D 06 DD           STA D2T2L
04935  FEE8  AD 07 DD           LDA D2T2H
04936  FEEB  6D 9A 02           ADC BAUDOF+1
04937  FEEE  8D 07 DD           STA D2T2H
04938  FEF1              ;
04939  FEF1  A9 11              LDA #$11        ;ENABLE TIMER
04940  FEF3  8D 0F DD           STA D2CRB
04941  FEF6              ;
04942  FEF6  AD A1 02           LDA ENABL       ;RESTORE NMI'S EARLY...
04943  FEF9  8D 0D DD           STA D2ICR
04944  FEFC              ;
04945  FEFC  A9 FF              LDA #$FF        ;ENABLE COUNT FROM $FFFF
04946  FEFE  8D 06 DD           STA D2T2L
04947  FF01  8D 07 DD           STA D2T2H
04948  FF04              ;
04949  FF04  4C 59 EF           JMP RSRCVR      ;GO SHIFT IN...



04951  FF07              ; FLNMI - SUBROUTINE TO HANDLE THE
04952  FF07              ;  START BIT TIMING..
04953  FF07              ;
04954  FF07              ; CHECK FOR NOISE ?
04955  FF07              ;
04956  FF07              FLNMI
04957  FF07              ;
04958  FF07              ; GET HALF BIT RATE VALUE
04959  FF07              ;
04960  FF07  AD 95 02           LDA M51AJB
04961  FF0A  8D 06 DD           STA D2T2L
04962  FF0D  AD 96 02           LDA M51AJB+1
04963  FF10  8D 07 DD           STA D2T2H
04964  FF13              ;
04965  FF13  A9 11              LDA #$11        ;ENABLE TIMER
04966  FF15  8D 0F DD           STA D2CRB
04967  FF18              ;
04968  FF18  A9 12              LDA #$12        ;DISABLE FLAG, ENABLE T2
04969  FF1A  4D A1 02           EOR ENABL
04970  FF1D  8D A1 02           STA ENABL
04971  FF20              ;ORA #$82
04972  FF20              ;STA D2ICR






NMI - SUBROUTINES......PAGE 0079

LINE# LOC   CODE        LINE


04973  FF20              ;
04974  FF20  A9 FF              LDA #$FF        ;PRESET FOR COUNT DOWN
04975  FF22  8D 06 DD           STA D2T2L
04976  FF25  8D 07 DD           STA D2T2H
04977  FF28              ;
04978  FF28  AE 98 02           LDX BITNUM      ;GET #OF BITS IN
04979  FF2B  86 A8              STX BITCI       ;PUT IN RCVRCNT
04980  FF2D  60                 RTS
04981  FF2E              ;
04982  FF2E              ; POPEN - PATCHES OPEN RS232 FOR UNIVERSAL KERNAL
04983  FF2E              ;
04984  FF2E  AA          POPEN  TAX             ;WE'RE CALCULATING BAUD RATE
04985  FF2F  AD 96 02           LDA M51AJB+1    ; M51AJB=FREQ/BAUD/2-100
04986  FF32  2A                 ROL A
04987  FF33  A8                 TAY
04988  FF34  8A                 TXA
04989  FF35  69 C8              ADC #CBIT+CBIT
04990  FF37  8D 99 02           STA BAUDOF
04991  FF3A  98                 TYA
04992  FF3B  69 00              ADC #0
04993  FF3D  8D 9A 02           STA BAUDOF+1
04994  FF40  60                 RTS
04995  FF41  EA                 NOP
04996  FF42  EA                 NOP
04997  FF43              .END
04998  FF43              .LIB   IRQFILE



































IRQFILE - DISPATCHER......PAGE 007A

LINE# LOC   CODE        LINE


05000  FF43              ; SIMIRQ - SIMULATE AN IRQ (FOR CASSETTE READ)
05001  FF43              ;  ENTER BY A JSR SIMIRQ
05002  FF43              ;
05003  FF43  08          SIMIRQ PHP
05004  FF44  68                 PLA             ;FIX THE BREAK FLAG
05005  FF45  29 EF              AND #$EF
05006  FF47  48                 PHA
05007  FF48              ; PULS - CHECKS FOR REAL IRQ'S OR BREAKS
05008  FF48              ;
05009  FF48  48          PULS   PHA
05010  FF49  8A                 TXA
05011  FF4A  48                 PHA
05012  FF4B  98                 TYA
05013  FF4C  48                 PHA
05014  FF4D  BA                 TSX
05015  FF4E  BD 04 01           LDA $104,X      ;GET OLD P STATUS
05016  FF51  29 10              AND #$10        ;BREAK FLAG?
05017  FF53  F0 03              BEQ PULS1       ;...NO
05018  FF55  6C 16 03           JMP (CBINV)     ;...YES...BREAK INSTR
05019  FF58  6C 14 03    PULS1  JMP (CINV)      ;...IRQ









































PATCHES 6/82......PAGE 007B

LINE# LOC   CODE        LINE


05021  FF5B              ; PCINT - ADD UNIVERSAL TO CINIT
05022  FF5B              ;
05023  FF5B  20 18 E5    PCINT  JSR CINT
05024  FF5E  AD 12 D0    P0010  LDA VICREG+18   ;CHECK RASTER COMPARE FOR ZERO
05025  FF61  D0 FB              BNE P0010       ;IF IT'S ZERO THEN CHECK VALUE...
05026  FF63  AD 19 D0           LDA VICREG+25   ;GET RASTER IRQ VALUE
05027  FF66  29 01              AND #$01
05028  FF68  8D A6 02           STA PALNTS      ;PLACE IN PAL/NTSC INDICATOR
05029  FF6B  4C DD FD           JMP IOKEYS
05030  FF6E              ;
05031  FF6E              ; PIOKEY - ADD UNIVERSAL TO IOKEYS
05032  FF6E              ;
05033  FF6E  A9 81       PIOKEY LDA #$81        ;ENABLE T1 IRQ'S
05034  FF70  8D 0D DC           STA D1ICR
05035  FF73  AD 0E DC           LDA D1CRA
05036  FF76  29 80              AND #$80        ;SAVE ONLY TOD BIT
05037  FF78  09 11              ORA #%00010001  ;ENABLE TIMER1
05038  FF7A  8D 0E DC           STA D1CRA
05039  FF7D  4C 8E EE           JMP CLKLO       ;RELEASE THE CLOCK LINE
05040  FF80              *=$E500-20
05041  E4EC              ;
05042  E4EC              ; BAUDOP - BAUD RATE TABLE FOR PAL
05043  E4EC              ;   .985248E6/BAUD-RATE/2-100
05044  E4EC              ;
05045  E4EC  19 26       BAUDOP .WOR 9853-CBIT  ;50 BAUD
05046  E4EE  44 19              .WOR 6568-CBIT  ;75 BAUD
05047  E4F0  1A 11              .WOR 4478-CBIT  ;110 BAUD
05048  E4F2  E8 0D              .WOR 3660-CBIT  ;134.6 BAUD
05049  E4F4  70 0C              .WOR 3284-CBIT  ;150 BAUD
05050  E4F6  06 06              .WOR 1642-CBIT  ;300 BAUD
05051  E4F8  D1 02              .WOR 821-CBIT   ;600 BAUD
05052  E4FA  37 01              .WOR 411-CBIT   ;1200 BAUD
05053  E4FC  AE 00              .WOR 274-CBIT   ;1800 BAUD
05054  E4FE  69 00              .WOR 205-CBIT   ;2400 BAUD

05056  E500              *=$E500-32             ;(20-12)
05057  E4E0              ; FPATCH - TAPE FILENAME TIMEOUT
05058  E4E0              ;
05059  E4E0  69 02       FPATCH ADC #2          ;TIME IS (8 TO 13 SEC OF DISPLAY)
05060  E4E2  A4 91       FPAT00 LDY STKEY       ;CHECK FOR KEY DOWN ON LAST ROW...
05061  E4E4  C8                 INY
05062  E4E5  D0 04              BNE FPAT01      ;KEY...EXIT LOOP
05063  E4E7  C5 A1              CMP TIME+1      ;WATCH TIMER
05064  E4E9  D0 F7              BNE FPAT00
05065  E4EB  60          FPAT01 RTS


05067  E4EC                     *=$E500-38      ;(32-6)
05068  E4DA              ; CPATCH - FIX TO CLEAR LINE
05069  E4DA              ;  PREVENTS WHITE CHARACTER FLASH...
05070  E4DA              ;
05071  E4DA  AD 21 D0    CPATCH LDA VICREG+33   ;ALWAYS CLEAR TO CURRENT BACKGND COLOR
05072  E4DD  91 F3              STA (USER)Y     ;PLACE IN COLOR POINTER
05073  E4DF  60                 RTS
05074  E4E0              .END






PATCHES 6/82......PAGE 007C

LINE# LOC   CODE        LINE


05075  E4E0              .LIB   VECTORS




























































JUMP TABLE/VECTORS......PAGE 007D

LINE# LOC   CODE        LINE


05077  E4E0                     *=$FF80
05078  FF80  00                 .BYT 0          ;RELEASE NUMBER OF C64 KERNAL
05079  FF81  4C 5B FF           JMP PCINT
05080  FF84  4C A3 FD           JMP IOINIT
05081  FF87  4C 50 FD           JMP RAMTAS
05082  FF8A                     *=$FF8A         ;NEW VECTORS FOR BASIC
05083  FF8A  4C 15 FD           JMP RESTOR      ;RESTORE VECTORS TO INITIAL SYSTEM
05084  FF8D  4C 1A FD           JMP VECTOR      ;CHANGE VECTORS FOR USER
05085  FF90                     * =$FF90
05086  FF90  4C 18 FE           JMP SETMSG      ;CONTROL O.S. MESSAGES
05087  FF93  4C B9 ED           JMP SECND       ;SEND SA AFTER LISTEN
05088  FF96  4C C7 ED           JMP TKSA        ;SEND SA AFTER TALK
05089  FF99  4C 25 FE           JMP MEMTOP      ;SET/READ TOP OF MEMORY
05090  FF9C  4C 34 FE           JMP MEMBOT      ;SET/READ BOTTOM OF MEMORY
05091  FF9F  4C 87 EA           JMP SCNKEY      ;SCAN KEYBOARD
05092  FFA2  4C 21 FE           JMP SETTMO      ;SET TIMEOUT IN IEEE
05093  FFA5  4C 13 EE           JMP ACPTR       ;HANDSHAKE IEEE BYTE IN
05094  FFA8  4C DD ED           JMP CIOUT       ;HANDSHAKE IEEE BYTE OUT
05095  FFAB  4C EF ED           JMP UNTLK       ;SEND UNTALK OUT IEEE
05096  FFAE  4C FE ED           JMP UNLSN       ;SEND UNLISTEN OUT IEEE
05097  FFB1  4C 0C ED           JMP LISTN       ;SEND LISTEN OUT IEEE
05098  FFB4  4C 09 ED           JMP TALK        ;SEND TALK OUT IEEE
05099  FFB7  4C 07 FE           JMP READSS      ;RETURN I/O STATUS BYTE
05100  FFBA  4C 00 FE           JMP SETLFS      ;SET LA, FA, SA
05101  FFBD  4C F9 FD           JMP SETNAM      ;SET LENGTH AND FN ADR
05102  FFC0  6C 1A 03    OPEN   JMP (IOPEN)     ;OPEN LOGICAL FILE
05103  FFC3  6C 1C 03    CLOSE  JMP (ICLOSE)    ;CLOSE LOGICAL FILE
05104  FFC6  6C 1E 03    CHKIN  JMP (ICHKIN)    ;OPEN CHANNEL IN
05105  FFC9  6C 20 03    CKOUT  JMP (ICKOUT)    ;OPEN CHANNEL OUT
05106  FFCC  6C 22 03    CLRCH  JMP (ICLRCH)    ;CLOSE I/O CHANNEL
05107  FFCF  6C 24 03    BASIN  JMP (IBASIN)    ;INPUT FROM CHANNEL
05108  FFD2  6C 26 03    BSOUT  JMP (IBSOUT)    ;OUTPUT TO CHANNEL
05109  FFD5  4C 9E F4           JMP LOADSP      ;LOAD FROM FILE
05110  FFD8  4C DD F5           JMP SAVESP      ;SAVE TO FILE
05111  FFDB  4C E4 F6           JMP SETTIM      ;SET INTERNAL CLOCK
05112  FFDE  4C DD F6           JMP RDTIM       ;READ INTERNAL CLOCK
05113  FFE1  6C 28 03    STOP   JMP (ISTOP)     ;SCAN STOP KEY
05114  FFE4  6C 2A 03    GETIN  JMP (IGETIN)    ;GET CHAR FROM Q
05115  FFE7  6C 2C 03    CLALL  JMP (ICLALL)    ;CLOSE ALL FILES
05116  FFEA  4C 9B F6           JMP UDTIM       ;INCREMENT CLOCK
05117  FFED  4C 05 E5    JSCROG JMP SCRORG      ;SCREEN ORG
05118  FFF0  4C 0A E5    JPLOT  JMP PLOT        ;READ/SET X,Y COORD
05119  FFF3  4C 00 E5    JIOBAS JMP IOBASE      ;RETURN I/O BASE


















JUMP TABLE/VECTORS......PAGE 007E

LINE# LOC   CODE        LINE


05122  FFF6                     *=$FFFA
05123  FFFA  43 FE              .WOR NMI        ;PROGRAM DEFINEABLE
05124  FFFC  E2 FC              .WOR START      ;INITIALIZATION CODE
05125  FFFE  48 FF              .WOR PULS       ;INTERRUPT HANDLER
05126  0000              .END
05127  0000              .END


ERRORS = 00000


SYMBOL TABLE

SYMBOL VALUE
 A0IN1    FD04    A0IN2    FD0F    A0INT    FD02    ACC      0005
 ACP00    EE30    ACP00A   EE1B    ACP00B   EE3E    ACP00C   EE47
 ACP01    EE56    ACP03    EE5A    ACP03A   EE67    ACP04    EE80
 ACPTR    EE13    AUTODN   0292    BACK     E8B0    BAD      0100
 BAK1UP   E759    BAKBAK   E864    BASIN    FFCF    BASZPT   00FF
 BAUDO    FEC2    BAUDOF   0299    BAUDOP   E4EC    BDF      0002
 BDFH     0004    BIT010   EF54    BIT020   EF58    BITCI    00A8
 BITCNT   EF4A    BITNUM   0298    BITTS    00B4    BK1      E75F
 BK15     E762    BK2      E773    BKLN     E701    BKLN1    E70B
 BLF      0001    BLNCT    00CD    BLNK2    F781    BLNON    00CF
 BLNSW    00CC    BLUE     0006    BMT1     E967    BMT2     E96C
 BN10     F166    BN20     F173    BN30     F1AD    BN31     F1B1
 BN32     F1B3    BN33     F1B4    BN35     F1B5    BN50     F1B8
 BO10     F1D5    BO20     F1DB    BO50     F208    BREAK    F633
 BREAKE   EFCD    BSI010   F09C    BSI232   F086    BSIT     FD9B
 BSIV     FCBD    BSO100   F028    BSO110   F02E    BSO120   F04C
 BSO232   F017    BSOBAD   F014    BSOUR    0095    BSOUR1   00A4
 BSOUT    FFD2    BUF      0200    BUFPT    00A6    BUFSZ    00C0
 C3P0     0094    CAS1     00C0    CASOUT   F1DD    CASTON   02A2
 CBINV    0316    CBIT     0064    CHK1A    E8CD    CHK1B    E8D6
 CHKBAK   E8A1    CHKCOL   E8CB    CHKDWN   E8B3    CHKIN    FFC6
 CHKLUP   E8A5    CI2      EDE6    CI4      EDEB    CINT     E518
 CINV     0314    CIOUT    EDDD    CK10     F262    CK15     F26F
 CK20     F25F    CK30     F275    CK40     F279    CK5      F258
 CK50     F286    CK60     F289    CKDSRX   F00D    CKERR    0020
 CKI010   F062    CKI020   F070    CKI080   F077    CKI100   F07D
 CKI110   F084    CKI232   F04D    CKIT     EACC    CKIT1    EADC
 CKIT2    EB26    CKIT3    EB30    CKO020   EFF2    CKO030   EFF9
 CKO040   F006    CKO100   F012    CKO232   EFE1    CKOUT    FFC9
 CKUT     EACB    CLALL    FFE7    CLALL2   F343    CLEAR1   E560
 CLKHI    EE85    CLKLO    EE8E    CLN232   F483    CLOSE    FFC3
 CLP1     E674    CLP2     E65D    CLP21    E672    CLP2A    E66F
 CLP5     E606    CLP6     E60F    CLP7     E682    CLR10    EA07
 CLRCH    FFCC    CLRLN    E9FF    CLS010   F2BA    CLS020   F2BF
 CLSEI    F642    CLSEI2   F657    CLSR     E544    CMP0     00B0
 CMPSTE   FCD1    CNC3     E782    CNC3X    E74C    CNTDN    00A5
 COLM     DC00    COLOR    0286    COLR1    E7CE    COLTAB   E8DA
 CONTRL   EC78    COUNT    00A5    CPATCH   E4DA    CR       000D
 CRSW     00D0    CS10     F82E    CS25     F836    CS30     F81E
 CS40     F821    CSBERR   EDB2    CSTE1    F817    CSTE2    F838








SYMBOL TABLE

SYMBOL VALUE
 CTSERR   EF31    CUNLSN   F654    CURS10   E7C0    D1CRA    DC0E
 D1CRB    DC0F    D1DDRA   DC02    D1DDRB   DC03    D1ICR    DC0D
 D1PRA    DC00    D1PRB    DC01    D1SDR    DC0C    D1T1H    DC05
 D1T1L    DC04    D1T2H    DC07    D1T2L    DC06    D1TOD1   DC08
 D1TODH   DC0B    D1TODM   DC0A    D1TODS   DC09    D2CRA    DD0E
 D2CRB    DD0F    D2DDRA   DD02    D2DDRB   DD03    D2ICR    DD0D
 D2PRA    DD00    D2PRB    DD01    D2SDR    DD0C    D2T1H    DD05
 D2T1L    DD04    D2T2H    DD07    D2T2L    DD06    D2TOD1   DD08
 D2TODH   DD0B    D2TODM   DD0A    D2TODS   DD09    D6510    0000
 DATA     00D7    DATAHI   EE97    DATALO   EEA0    DEBPIA   EEA9
 DELAY    028C    DFLTN    0099    DFLTO    009A    DIFF     00B5
 DLABYE   EE03    DLAD00   EE09    DLADLH   EE06    DNLINE   E8C2
 DPSW     009C    DSPP     EA13    DSPP2    EA1C    DSRERR   EF2E
 DWNBYE   E8CA    DWNCHK   E8B7    EAH      00AF    EAL      00AE
 ENABL    02A1    EOIACP   EE20    EOT      0005    EREXIT   F729
 ERR232   EFD2    ERROR1   F6FB    ERROR2   F6FE    ERROR3   F701
 ERROR4   F704    ERROR5   F707    ERROR6   F70A    ERROR7   F70D
 ERROR8   F710    ERROR9   F713    FA       00BA    FAF      F7EA
 FAF20    F7F7    FAF30    F80B    FAF40    F80C    FAH      F72C
 FAH40    F769    FAH45    F767    FAH50    F74B    FAH55    F757
 FAH56    F761    FAT      0263    FINDST   E6ED    FINX     E6F4
 FIRT     00A4    FLGS     0004    FLNMI    FF07    FNADR    00BB
 FNDEND   E58D    FNDSTR   E570    FNLEN    00B7    FPAT00   E4E2
 FPAT01   E4EB    FPATCH   E4E0    FRAMEE   EFD0    FREKZP   00FB
 FRMERR   EDB0    FSBLK    00BE    GDBLN    00CE    GDCOL    0287
 GETIN    FFE4    GETTOP   FE27    GN10     F14A    GN20     F155
 GN232    F14E    GOTDWN   E7C8    HIBASE   0288    IBASIN   0324
 IBSOUT   0326    ICHKIN   031E    ICKOUT   0320    ICLALL   032C
 ICLOSE   031C    ICLRCH   0322    IGETIN   032A    ILOAD    0330
 INBIT    00A7    INCR     FCE1    INCSAL   FCDB    INDX     00C8
 INITV    E5A8    INS1     E805    INS2     E80A    INS3     E7FE
 INSEXT   E826    INSRT    00D8    INVH     0009    INVL     000A
 IO010    FDEC    IO020    FDF3    IOBASE   E500    IOINIT   FDA3
 IOKEYS   FDDD    IOPEN    031A    IRQTMP   029F    ISAVE    0332
 ISOUR    ED40    ISOURA   ED36    ISR01    ED66    ISR02    ED50
 ISR03    ED55    ISR04    ED9F    ISRCLK   ED7D    ISRHI    ED7A
 ISTOP    0328    JIOBAS   FFF3    JLTLK    F314    JPL2     E871
 JPL3     E7CB    JPL4     E7A8    JPL5     E89E    JPLOT    FFF0
 JRAD2    F988    JSCROG   FFED    JTG10    F1A9    JTG35    F18D
 JTG36    F193    JTG37    F196    JTGET    F199    JTP10    F1F8
 JTP20    F80D    JX050    F298    JX115    F2C8    JX117    F2E0
 JX120    F2EE    JX150    F2F1    JX170    F30D    JX175    F30E
 JX310    F216    JX315    F22A    JX320    F233    JX330    F237
 JX340    F245    JX350    F248    JX600    F316    JX750    F33C
 JXRMV    F2F2    JZ100    F31F    JZ101    F32E    KEEPIT   E7D4
 KEY      EA31    KEY3     EA71    KEY4     EA61    KEY5     EA5C
 KEYCOD   EB79    KEYD     0277    KEYLG2   EB64    KEYLOG   028F
 KEYTAB   00F5    KIKA26   02A3    KL2      EA7B    KL24     EA79
 KOUNT    028B    KPREND   EA7E    LA       00B8    LAT      0259
 LBERR    0008    LD10     F4AF    LD100    F533    LD102    F539
 LD104    F541    LD110    F5C7    LD112    F549    LD115    F5D1
 LD150    F556    LD170    F55D    LD177    F56C    LD178    F579
 LD179    F57D    LD180    F5A9    LD190    F5AE    LD20     F4B2
 LD25     F4BF    LD30     F4F0    LD40     F4F3    LD410    F5DA
 LD45     F501    LD50     F51C    LD60     F51E    LD64     F524








SYMBOL TABLE

SYMBOL VALUE
 LD90     F530    LDAD1    F7D7    LDTB1    00D9    LDTB2    ECF0
 LDTND    0098    LEXIT    EC72    LINTMP   02A5    LINZ0    0400
 LINZ1    0428    LINZ10   0590    LINZ11   05B8    LINZ12   05E0
 LINZ13   0608    LINZ14   0630    LINZ15   0658    LINZ16   0680
 LINZ17   06A8    LINZ18   06D0    LINZ19   06F8    LINZ2    0450
 LINZ20   0720    LINZ21   0748    LINZ22   0770    LINZ23   0798
 LINZ24   07C0    LINZ3    0478    LINZ4    04A0    LINZ5    04C8
 LINZ6    04F0    LINZ7    0518    LINZ8    0540    LINZ9    0568
 LIST1    ED11    LIST2    ED20    LIST5    ED2E    LISTN    ED0C
 LLEN     0028    LLEN2    0050    LNMX     00D5    LOAD     F4A2
 LOADSP   F49E    LOCK     EC5E    LODING   F5D2    LOOKUP   F30F
 LOOP2    E6A8    LOOP3    E5CD    LOOP4    E5CA    LOOP5    E632
 LOP2     E6B0    LOP5     E63A    LOP51    E640    LOP52    E650
 LOP53    E654    LOP54    E64A    LOWER    EC44    LP1      E5B9
 LP2      E5B4    LP21     E5E7    LP22     E5FE    LP23     E5F3
 LPS1     E54D    LPS2     E555    LSTP     00CA    LSTSHF   028E
 LSTX     00C5    LSXP     00C9    LUKING   F5AF    M51AJB   0295
 M51CDR   0294    M51CTR   0293    MAXCHR   0050    MEMBOT   FE34
 MEMSIZ   0283    MEMSTR   0281    MEMTCF   F47D    MEMTOP   FE25
 MEMUSS   00C3    MLP4     E94D    MLP42    E956    MODE     0291
 MODE1    EB81    MODE2    EBC2    MODE3    EC03    MOVOS1   FD20
 MOVOS2   FD27    MS1      F0BD    MS10     F106    MS11     F10E
 MS17     F120    MS18     F127    MS21     F116    MS5      F0C9
 MS6      F0D4    MS7      F0D8    MS8      F0EB    MSG      F12F
 MSG10    F13C    MSGFLG   009D    MYCH     00BF    NBASIN   F157
 NBSOUT   F1CA    NC1      E78B    NC2      E792    NC3      E697
 NC3W     E785    NCHKIN   F20E    NCKOUT   F250    NCLALL   F32F
 NCLOSE   F291    NCLRCH   F333    NCTRL    EB6B    NCX2     E7AD
 NCZ2     E7AA    NDX      00C6    NEWCH    FB97    NEWLIN   E965
 NEWLX    E981    NGETIN   F13E    NJT1     E731    NJT8     E73D
 NJT9     E73F    NLINES   0019    NLOAD    F4A5    NMI      FE43
 NMINV    0318    NMIRTI   FEB6    NNMI     FE47    NNMI10   FE4C
 NNMI18   FE56    NNMI19   FE5E    NNMI20   FE72    NNMI22   FE9A
 NNMI25   FE9D    NNMI30   FEA3    NNMI40   FEAE    NODEV    EDAD
 NOEOI    ED5A    NOPEN    F34A    NOTKAT   EB6B    NOTONE   E63E
 NSAVE    F5ED    NSTOP    F6ED    NTCN     E745    NTCN1    E77E
 NVS      E699    NVS1     E69F    NWRAP    0002    NXLN     E87C
 NXLN1    E888    NXLN2    E880    NXT1     E891    NXT2     E84C
 NXT3     E693    NXT33    E691    NXT6     E854    NXT61    E86A
 NXTBIT   00B5    NXTD     E566    NXTX     E7D4    NXTX1    E7DC
 NXTXA    E7DC    OCHAR    00BD    OENABL   EF3B    OP100    F359
 OP110    F362    OP150    F384    OP152    F38B    OP155    F393
 OP160    F3AC    OP170    F3AF    OP171    F3C2    OP172    F3D1
 OP175    F3D3    OP180    F3D4    OP200    F3B8    OP35     F3F6
 OP40     F3FC    OP45     F406    OP98     F351    OPEN     FFC0
 OPENI    F3D5    OPN020   F40F    OPN025   F41D    OPN026   F43A
 OPN027   F440    OPN028   F446    OPN030   F44D    OPN050   F45C
 OPN055   F468    OPN060   F474    OPN232   F409    OUTFN    F5C1
 OUTHRE   EC5B    P0010    FF5E    PALNTS   02A6    PANIC    E5A0
 PCH      0002    PCINT    FF5B    PCL      0003    PCNTR    00A3
 PIOKEY   FF6E    PLF      0003    PLOT     E50A    PLOT10   E513
 PNT      00D1    PNTR     00D3    POPEN    FF2E    PREND    FEBC
 PRP      00B6    PRT      E716    PRTY     009B    PTR1     009E
 PTR2     009F    PULIND   E958    PULS     FF48    PULS1    FF58
 PUTQUE   EB3C    PX4      E5AA    QTSW     00D4    QTSWC    E684








SYMBOL TABLE

SYMBOL VALUE
 QTSWL    E690    R2D2     00A3    R6510    0001    RAD2     FA10
 RAD2X    FA1F    RAD2Y    FA18    RAD3     F9D5    RAD4     F9F7
 RAD5     F999    RADBK    F9D2    RADJ     FA60    RADK     FA53
 RADKX    F9BC    RADL     F997    RADP     F9C9    RADQ2    FA44
 RADX2    F993    RAMLOC   0800    RAMTAS   FD50    RAMTBT   FD67
 RAMTZ0   FD53    RAMTZ1   FD6C    RAMTZ2   FD6E    RBLK     F841
 RD10     FA8A    RD12     FA86    RD15     FA70    RD160    FB48
 RD161    FB4A    RD167    FB5C    RD175    FB68    RD180    FB8B
 RD20     FA8D    RD200    FAA9    RD22     FAA3    RD300    FB8E
 RD40     FABA    RD52     FB2F    RD55     FB33    RD58     FB08
 RD59     FB3A    RD60     FAC0    RD70     FACE    RD80     FAEB
 RD90     FB43    RDBK     F9AC    RDBK2    FA5D    RDFLG    00AA
 RDTIM    F6DD    READ     F92C    READSS   FE07    READST   FE1A
 RECERR   EFCA    REKEY    EAE0    REPDO    EA3E    RER      00A8
 RESTOR   FD15    REZ      00A9    RIBUF    00F7    RIDATA   00AA
 RIDBE    029B    RIDBS    029C    RINONE   00A9    RIPRTY   00AB
 RJDJ     F969    ROBUF    00F9    RODATA   00B6    RODBE    029E
 RODBS    029D    ROPRTY   00BD    ROUT1    F9E0    ROUT2    F9DE
 ROWS     DC01    RPT10    EAF0    RPT20    EB0D    RPT40    EB17
 RPTFLG   028A    RSODNE   EF39    RSP232   F0A4    RSPEXT   EEE7
 RSPNO    EEF2    RSPOFF   F0AA    RSPOK    F0BB    RSR018   EF6E
 RSR020   EF70    RSR030   EF97    RSR031   EFA9    RSR032   EFB1
 RSR050   EFC5    RSR060   EFDB    RSRABL   EF7E    RSRCVR   EF59
 RSREXT   EF6D    RSRSXT   EF8B    RSRTRT   EF90    RSSTAT   0297
 RST005   EEC8    RST010   EED7    RST030   EEF6    RST040   EEFC
 RST050   EF00    RST060   EF13    RST070   EF1C    RST080   EF1E
 RSTBGN   EF06    RSTEXT   EED1    RSTOA    F1FC    RSTOR    F1FD
 RSTOR1   F207    RSTRAB   EEBB    RSWEXT   EEE6    RUNTB    ECE7
 RVS      00C7    SA       00B9    SAH      00AD    SAL      00AC
 SAT      026D    SAVE     F5EA    SAVESP   F5DD    SAVING   F68F
 SBERR    0004    SCATN    EDBE    SCCL     E874    SCD10    E98F
 SCD20    E9D4    SCN20    EAA8    SCN22    EAAB    SCN30    EAB3
 SCNKEY   EA87    SCNOUT   EAFB    SCNRTS   EB42    SCOLOR   EA24
 SCR10    E8FF    SCR40    E9A6    SCR41    E913    SCRD19   E9BA
 SCRD21   E9AB    SCRD22   E9BF    SCRL3    E922    SCRL5    E918
 SCRLIN   E9C8    SCRO0    E8F6    SCROL    E8EA    SCRORG   E505
 SECND    EDB9    SETBOT   FE3C    SETLFS   FE00    SETMSG   FE18
 SETNAM   FDF9    SETPNT   E9F0    SETTIM   F6E4    SETTMO   FE21
 SETTOP   FE2D    SFDX     00CB    SHCNH    00AB    SHCNL    00A7
 SHFLAG   028D    SHFLOG   EB48    SHFOUT   EB76    SIDREG   D400
 SIMIRQ   FF43    SIXTY    4295    SIXTYP   4025    SIZE     FD88
 SNSW1    00B4    SP       0008    SPCK2    EAC9    SPERR    0010
 SPMSG    F12B    SRER     F98B    STAH     00C2    STAL     00C1
 START    FCE2    START1   FCEF    STATUS   0090    STDONE   E597
 STKEY    0091    STKY     FCB8    STOK     E57C    STOP     FFE1
 STOP2    F6FA    STOP3    F8DC    STOP4    F8E1    STT1     F8E2
 STT2     F8F7    STT3     F8FE    STT4     F92A    STUPID   02A4
 STUPT    E56C    SV10     F5F1    SV100    F659    SV102    F65F
 SV105    F66C    SV106    F676    SV110    F68D    SV115    F68E
 SV20     F5F4    SV25     F605    SV30     F624    SV40     F63A
 SV50     F63F    SVXT     0092    SWITCH   EB59    SYNO     0096
 T1       009E    T2       009F    T2NMI    FED6    TALK     ED09
 TAPE     F875    TAPE1    00B2    TAPEH    F76A    TBLA0E   FD15
 TBLA0R   FD10    TBLX     00D6    TBUFFR   033C    TEMP     00B1
 TH20     F7A5    TH30     F7B7    TH40     F7CF    TIMB     FE66








SYMBOL TABLE

SYMBOL VALUE
 TIME     00A0    TIMOUT   0285    TIMRB    0019    TKATN    EDCC
 TKATN1   EDD6    TKSA     EDC7    TMP0     00C1    TMP2     00C3
 TMPC     009F    TNIF     FC93    TNIQ     FCB6    TNOF     FCCA
 TOFROM   E9E0    TP32     F8B5    TP35     F8B7    TP40     F8BE
 TRD      F84A    TSTOP    F8D0    TVIC     ECB9    TWRT     F867
 TWRT2    F86B    TWRT3    F86E    UD20     F69D    UD30     F6A7
 UD60     F6BC    UD70     F6CC    UD80     F6DA    UD90     F6DC
 UDST     FE1C    UDTIM    F69B    UHUH     E7E3    ULSET    EC58
 UNLOCK   EC69    UNLSN    EDFE    UNTLK    EDEF    UP2      E832
 UP5      E7EA    UP6      E82D    UP9      E829    UPALIN   E847
 UPPER    EC4F    USER     00F3    USRCMD   032E    VECTOR   FD1A
 VECTSE   FD50    VECTSS   FD30    VERCK    0093    VICCOL   D800
 VICREG   D000    VICSCN   0400    VPAN     E59A    VPRTY    FB72
 W1MS     EEB3    W1MS1    EEB6    WBLK     F864    WHITE    0001
 WLGRTS   E700    WLOG10   E6F7    WLOG20   E6CD    WLOG30   E6DA
 WLOGIC   E6B6    WREND    FC5E    WRITE    FBA6    WRNC     FC57
 WRT1     FBAF    WRT2     FC0C    WRT3     FC09    WRT4     FC4E
 WRT6     FC30    WRT61    FC2C    WRT7     FC3F    WRTBK    FC54
 WRTL3    FBC8    WRTN     FBCD    WRTN1    FBE3    WRTN2    FBF0
 WRTS     FC16    WRTS1    FC22    WRTW     FBAD    WRTX     FBB1
 WRTZ     FC6A    XMAX     0289    XR       0006    XSAV     0097
 YR       0007    ZZZ      F7D0   

END OF ASSEMBLY
