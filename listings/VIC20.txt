basic......PAGE 0001

LINE# LOC   CODE        LINE


00001  0000              .LIB   DISCLAIMER




























































basic......PAGE 0002

LINE# LOC   CODE        LINE


00003  0000              ;****************************************
00004  0000              ;*                                      *
00005  0000              ;* BBBBB   AAAA   SSS  IIII  CCCC       *
00006  0000              ;* BB  BB AA  AA SS  S  II  CC   C      *
00007  0000              ;* BB  BB AA  AA  SS    II  CC          *
00008  0000              ;* BBBBB  AAAAAA   SS   II  CC          *
00009  0000              ;* BB  BB AA  AA    SS  II  CC          *
00010  0000              ;* BB  BB AA  AA S  SS  II  CC   C      *
00011  0000              ;* BBBBB  AA  AA  SSS  IIII  CCCC       *
00012  0000              ;*                                      *
00013  0000              ;****************************************
00014  0000              ;
00015  0000              ;****************************************
00016  0000              ;*                                      *
00017  0000              ;* PET BASIC VERSION 2.1                *
00018  0000              ;*      THIS VERSION OF PET BASIC IS    *
00019  0000              ;* DESIGNED TO FUNCTION WITH THE KERNAL *
00020  0000              ;* PROVIDED IN THE FOLOWING MACHINES:   *
00021  0000              ;*      2001-4/8 (B/N)                  *
00022  0000              ;*      4016/4032                       *
00023  0000              ;*      8032                            *
00024  0000              ;*      TOY                             *
00025  0000              ;*      VIC-1001/-20                    *
00026  0000              ;*                                      *
00027  0000              ;* COPYRIGHT (C) 1981 BY                *
00028  0000              ;* COMMODORE BUSINESS MACHINES          *
00029  0000              ;*                                      *
00030  0000              ;****************************************
00031  0000              ;****LISTING DATE --1200 06 MARCH 1980***
00032  0000              ;****************************************
00033  0000              ;* THIS SOFTWARE IS FURNISHED FOR USE IN*
00034  0000              ;* THE ABOVE LISTED MACHINES ONLY.      *
00035  0000              ;*                                      *
00036  0000              ;* COPIES THEREOF MAY NOT BE PROVIDED   *
00037  0000              ;* OR MADE AVAILABLE FOR USE ON ANY     *
00038  0000              ;* SYSTEM.                              *
00039  0000              ;*                                      *
00040  0000              ;* THE INFORMATION IN THIS DOCUMENT IS  *
00041  0000              ;* SUBJECT TO CHANGE WITHOUT NOTICE.    *
00042  0000              ;*                                      *
00043  0000              ;* NO RESPONSIBILITY IS ASSUMED FOR     *
00044  0000              ;* RELIABILITY OF THIS SOFTWARE.        *
00045  0000              ;*                                      *
00046  0000              ;****************************************
00047  0000              .END
00048  0000              .LIB   DECLARE















DECLARATIONS......PAGE 0003

LINE# LOC   CODE        LINE


00050  0000              ADDPRC =1
00051  0000              ROMLOC =$C000          ;VIXEN ROM
00052  0000              LINLEN =22             ;VIXEN SCREEN SIZE ?WHY?
00053  0000              BUFLEN =89             ;VIXEN BUFFER
00054  0000              BUFPAG =2
00055  0000              BUF    =512
00056  0000              STKEND =507
00057  0000              CLMWID =11             ;PRINT WINDOW 11 CHARS
00058  0000              PI     =255
00059  0000              NUMLEV =23
00060  0000              STRSIZ =3
00061  0000                     *=$0000
00062  0000              USRPOK *=*+3
00063  0003              ADRAY1 *=*+2           ;CONVERT FLOAT->INTEGER
00064  0005              ADRAY2 *=*+2           ;CONVERT INTEGER->FLOAT
00065  0007              INTEGR
00066  0007              CHARAC *=*+1
00067  0008              ENDCHR *=*+1
00068  0009              TRMPOS *=*+1
00069  000A              VERCK  *=*+1
00070  000B              COUNT  *=*+1
00071  000C              DIMFLG *=*+1
00072  000D              VALTYP *=*+1
00073  000E              INTFLG *=*+1
00074  000F              GARBFL
00075  000F              DORES  *=*+1
00076  0010              SUBFLG *=*+1
00077  0011              INPFLG *=*+1
00078  0012              DOMASK
00079  0012              TANSGN *=*+1
00080  0013              CHANNL *=*+1
00081  0014              POKER
00082  0014              LINNUM *=*+2
00083  0016              TEMPPT *=*+1
00084  0017              LASTPT *=*+2
00085  0019              TEMPST *=*+9
00086  0022              INDEX
00087  0022              INDEX1 *=*+2
00088  0024              INDEX2 *=*+2
00089  0026              RESHO  *=*+1
00090  0027              RESMOH *=*+1
00091  0028              ADDEND
00092  0028              RESMO  *=*+1
00093  0029              RESLO  *=*+1
00094  002A                     *=*+1
00095  002B              TXTTAB *=*+2
00096  002D              VARTAB *=*+2
00097  002F              ARYTAB *=*+2
00098  0031              STREND *=*+2
00099  0033              FRETOP *=*+2
00100  0035              FRESPC *=*+2
00101  0037              MEMSIZ *=*+2
00102  0039              CURLIN *=*+2
00103  003B              OLDLIN *=*+2
00104  003D              OLDTXT *=*+2






DECLARATIONS......PAGE 0004

LINE# LOC   CODE        LINE


00105  003F              DATLIN *=*+2
00106  0041              DATPTR *=*+2
00107  0043              INPPTR *=*+2
00108  0045              VARNAM *=*+2
00109  0047              FDECPT 
00110  0047              VARPNT *=*+2
00111  0049              LSTPNT
00112  0049              ANDMSK
00113  0049              FORPNT *=*+2
00114  004B              EORMSK =FORPNT+1
00115  004B              VARTXT
00116  004B              OPPTR  *=*+2
00117  004D              OPMASK *=*+1
00118  004E              GRBPNT
00119  004E              TEMPF3
00120  004E              DEFPNT *=*+2
00121  0050              DSCPNT *=*+2
00122  0052                     *=*+1
00123  0053              FOUR6  *=*+1
00124  0054              JMPER  *=*+1
00125  0055              SIZE   *=*+1
00126  0056              OLDOV  *=*+1
00127  0057              TEMPF1 *=*+1
00128  0058              ARYPNT
00129  0058              HIGHDS *=*+2
00130  005A              HIGHTR *=*+2
00131  005C              TEMPF2
00132  005C                     *=*+1
00133  005D              DECCNT
00134  005D              LOWDS  *=*+2
00135  005F              GRBTOP
00136  005F              DPTFLG
00137  005F              LOWTR  *=*+1
00138  0060              EXPSGN *=*+1
00139  0061              TENEXP =LOWDS+1
00140  0061              EPSGN  =LOWTR+1
00141  0061              DSCTMP
00142  0061              FAC
00143  0061              FACEXP *=*+1
00144  0062              FACHO  *=*+1
00145  0063              FACMOH *=*+1
00146  0064              INDICE
00147  0064              FACMO  *=*+1
00148  0065              FACLO  *=*+1
00149  0066              FACSGN *=*+1
00150  0067              DEGREE
00151  0067              SGNFLG *=*+1
00152  0068              BITS   *=*+1
00153  0069              ARGEXP *=*+1
00154  006A              ARGHO  *=*+1
00155  006B              ARGMOH *=*+1
00156  006C              ARGMO  *=*+1
00157  006D              ARGLO  *=*+1
00158  006E              ARGSGN *=*+1
00159  006F              STRNGI






DECLARATIONS......PAGE 0005

LINE# LOC   CODE        LINE


00160  006F              ARISGN *=*+1
00161  0070              FACOV  *=*+1
00162  0071              BUFPTR
00163  0071              STRNG2
00164  0071              POLYPT
00165  0071              CURTOL
00166  0071              FBUFPT *=*+2
00167  0073              CHRGET *=*+6
00168  0079              CHRGOT *=*+1
00169  007A              TXTPTR *=*+6
00170  0080              QNUM   *=*+10
00171  008A              CHRRTS *=*+1
00172  008B              RNDX   *=*+5
00173  0090                     *=255
00174  00FF              LOFBUF *=*+1
00175  0100              FBUFFR *=*+1
00176  0101              STRNG1 =ARISGN
00177  0101              ;
00178  0101                     *=$0300         ;BASIC INDIRECTS
00179  0300              IERROR *=*+2           ;INDIRECT ERROR (OUTPUT ERROR IN .X)
00180  0302              IMAIN  *=*+2           ;INDIRECT MAIN (SYSTEM DIRECT LOOP)
00181  0304              ICRNCH *=*+2           ;INDIRECT CRUNCH (TOKENIZATION ROUTINE)
00182  0306              IQPLOP *=*+2           ;INDIRECT LIST (CHAR LIST)
00183  0308              IGONE  *=*+2           ;INDIRECT GONE (CHAR DISPATCH)
00184  030A              IEVAL  *=*+2           ;INDIRECT EVAL (SYMBOL EVALUATION)
00185  030C              ;TEMP STORAGE UNTILL SYSTEM INTERGRATION
00186  030C              ; SYS 6502 REGS
00187  030C              SAREG  *=*+1           ;.A REG
00188  030D              SXREG  *=*+1           ;.X REG
00189  030E              SYREG  *=*+1           ;.Y REG
00190  030F              SPREG  *=*+1           ;.P REG
00191  0310                     *=$0300+20      ;SYSTEM INDIRECTS FOLLOW
00192  0314              .END
00193  0314              .LIB   TOKENS



























TOKENS......PAGE 0006

LINE# LOC   CODE        LINE


00195  0314                     *=ROMLOC
00196  C000  78 E3              .WOR INIT       ;C000 HARD RESET
00197  C002  67 E4              .WOR PANIC      ;C000 SOFT RESET
00198  C004  43 42              .BYT 'CBMBASIC'
00199  C00C  30 C8       STMDSP .WOR END-1
00200  C00E  41 C7              .WOR FOR-1
00201  C010  1D CD              .WOR NEXT-1
00202  C012  F7 C8              .WOR DATA-1
00203  C014  A4 CB              .WOR INPUTN-1
00204  C016  BE CB              .WOR INPUT-1
00205  C018  80 D0              .WOR DIM-1
00206  C01A  05 CC              .WOR READ-1
00207  C01C  A4 C9              .WOR LET-1
00208  C01E  9F C8              .WOR GOTO-1
00209  C020  70 C8              .WOR RUN-1
00210  C022  27 C9              .WOR IF-1
00211  C024  1C C8              .WOR RESTOR-1
00212  C026  82 C8              .WOR GOSUB-1
00213  C028  D1 C8              .WOR RETURN-1
00214  C02A  3A C9              .WOR REM-1
00215  C02C  2E C8              .WOR STOP-1
00216  C02E  4A C9              .WOR ONGOTO-1
00217  C030  2C D8              .WOR FNWAIT-1
00218  C032  64 E1              .WOR CLOAD-1
00219  C034  52 E1              .WOR CSAVE-1
00220  C036  61 E1              .WOR CVERF-1
00221  C038  B2 D3              .WOR DEF-1
00222  C03A  23 D8              .WOR POKE-1
00223  C03C  7F CA              .WOR PRINTN-1
00224  C03E  9F CA              .WOR PRINT-1
00225  C040  56 C8              .WOR CONT-1
00226  C042  9B C6              .WOR LIST-1
00227  C044  5D C6              .WOR CLEAR-1
00228  C046  85 CA              .WOR CMD-1
00229  C048  26 E1              .WOR CSYS-1 
00230  C04A  BA E1              .WOR COPEN-1
00231  C04C  C3 E1              .WOR CCLOS-1
00232  C04E  7A CB              .WOR GET-1
00233  C050  41 C6              .WOR SCRATH-1
00234  C052  39 DC       FUNDSP .WOR SGN
00235  C054  CC DC              .WOR INT
00236  C056  58 DC              .WOR ABS
00237  C058  00 00       USRLOC .WOR USRPOK
00238  C05A  7D D3              .WOR FRE
00239  C05C  9E D3              .WOR POS
00240  C05E  71 DF              .WOR SQR
00241  C060  94 E0              .WOR RND
00242  C062  EA D9              .WOR LOG
00243  C064  ED DF              .WOR EXP
00244  C066  61 E2              .WOR COS
00245  C068  68 E2              .WOR SIN
00246  C06A  B1 E2              .WOR TAN
00247  C06C  0B E3              .WOR ATN
00248  C06E  0D D8              .WOR PEEK
00249  C070  7C D7              .WOR LEN






TOKENS......PAGE 0007

LINE# LOC   CODE        LINE


00250  C072  65 D4              .WOR STRD
00251  C074  AD D7              .WOR VAL
00252  C076  8B D7              .WOR ASC
00253  C078  EC D6              .WOR CHRD
00254  C07A  00 D7              .WOR LEFTD
00255  C07C  2C D7              .WOR RIGHTD
00256  C07E  37 D7              .WOR MIDD
00257  C080  79          OPTAB  .BYT 121
00258  C081  69 D8              .WOR FADDT-1
00259  C083  79                 .BYT 121
00260  C084  52 D8              .WOR FSUBT-1
00261  C086  7B                 .BYT 123
00262  C087  2A DA              .WOR FMULTT-1
00263  C089  7B                 .BYT 123
00264  C08A  11 DB              .WOR FDIVT-1
00265  C08C  7F                 .BYT 127
00266  C08D  7A DF              .WOR FPWRT-1
00267  C08F  50                 .BYT 80
00268  C090  E8 CF              .WOR ANDOP-1
00269  C092  46                 .BYT 70
00270  C093  E5 CF              .WOR OROP-1
00271  C095  7D          NEGTAB .BYT 125
00272  C096  B3 DF              .WOR NEGOP-1 
00273  C098  5A          NOTTAB .BYT 90
00274  C099  D3 CE              .WOR NOTOP-1
00275  C09B  64          PTDORL .BYT 100
00276  C09C  15 D0              .WOR DOREL-1
00277  C09E              Q=128-1
00278  C09E  45 4E       RESLST .BYT 'EN',$C4
00278  C0A0  C4 
00279  C0A1              ENDTK  =@200
00280  C0A1  46 4F              .BYT 'FO',$D2
00280  C0A3  D2 
00281  C0A4              FORTK  =@201
00282  C0A4  4E 45 58           .BYT 'NEX',$D4
00282  C0A7  D4 
00283  C0A8  44 41 54           .BYT 'DAT',$C1
00283  C0AB  C1 
00284  C0AC              DATATK =@203
00285  C0AC  49 4E              .BYT 'INPUT',$A3
00285  C0B1  A3 
00286  C0B2  49 4E              .BYT 'INPU',$D4
00286  C0B6  D4 
00287  C0B7  44 49              .BYT 'DI',$CD
00287  C0B9  CD 
00288  C0BA  52 45 41           .BYT 'REA',$C4
00288  C0BD  C4 
00289  C0BE  4C 45              .BYT 'LE',$D4
00289  C0C0  D4 
00290  C0C1  47 4F 54           .BYT 'GOT',$CF
00290  C0C4  CF 
00291  C0C5              GOTOTK =@211
00292  C0C5  52 55              .BYT 'RU',$CE
00292  C0C7  CE 
00293  C0C8  49                 .BYT 'I',$C6






TOKENS......PAGE 0008

LINE# LOC   CODE        LINE


00293  C0C9  C6 
00294  C0CA  52 45              .BYT 'RESTOR',$C5
00294  C0D0  C5 
00295  C0D1  47 4F              .BYT 'GOSU',$C2
00295  C0D5  C2 
00296  C0D6              GOSUTK =@215
00297  C0D6  52 45              .BYT 'RETUR',$CE
00297  C0DB  CE 
00298  C0DC  52 45              .BYT 'RE',$CD
00298  C0DE  CD 
00299  C0DF              REMTK  =@217
00300  C0DF  53 54 4F           .BYT 'STO',$D0
00300  C0E2  D0 
00301  C0E3  4F                 .BYT 'O',$CE
00301  C0E4  CE 
00302  C0E5  57 41 49           .BYT 'WAI',$D4
00302  C0E8  D4 
00303  C0E9  4C 4F 41           .BYT 'LOA',$C4
00303  C0EC  C4 
00304  C0ED  53 41 56           .BYT 'SAV',$C5
00304  C0F0  C5 
00305  C0F1  56 45              .BYT 'VERIF',$D9
00305  C0F6  D9 
00306  C0F7  44 45              .BYT 'DE',$C6
00306  C0F9  C6 
00307  C0FA  50 4F 4B           .BYT 'POK',$C5
00307  C0FD  C5 
00308  C0FE  50 52              .BYT 'PRINT',$A3
00308  C103  A3 
00309  C104  50 52              .BYT 'PRIN',$D4
00309  C108  D4 
00310  C109              PRINTK =@231
00311  C109  43 4F 4E           .BYT 'CON',$D4
00311  C10C  D4 
00312  C10D  4C 49 53           .BYT 'LIS',$D4
00312  C110  D4 
00313  C111  43 4C              .BYT 'CL',$D2
00313  C113  D2 
00314  C114  43 4D              .BYT 'CM',$C4
00314  C116  C4 
00315  C117  53 59              .BYT 'SY',$D3
00315  C119  D3 
00316  C11A  4F 50 45           .BYT 'OPE',$CE
00316  C11D  CE 
00317  C11E  43 4C              .BYT 'CLOS',$C5
00317  C122  C5 
00318  C123  47 45              .BYT 'GE',$D4
00318  C125  D4 
00319  C126  4E 45              .BYT 'NE',$D7
00319  C128  D7 
00320  C129              SCRATK =@242
00321  C129              .END
00322  C129              .LIB   TOKEN2








TOKEN2......PAGE 0009

LINE# LOC   CODE        LINE


00324  C129  54 41 42           .BYT 'TAB',$A8
00324  C12C  A8 
00325  C12D              TABTK  =@243
00326  C12D  54                 .BYT 'T',$CF
00326  C12E  CF 
00327  C12F              TOTK   =@244
00328  C12F  46                 .BYT 'F',$CE
00328  C130  CE 
00329  C131              FNTK   =@245
00330  C131  53 50 43           .BYT 'SPC',$A8
00330  C134  A8 
00331  C135              SPCTK  =@246
00332  C135  54 48 45           .BYT 'THE',$CE
00332  C138  CE 
00333  C139              THENTK =@247
00334  C139  4E 4F              .BYT 'NO',$D4
00334  C13B  D4 
00335  C13C              NOTTK  =@250
00336  C13C  53 54 45           .BYT 'STE',$D0
00336  C13F  D0 
00337  C140              STEPTK =@251
00338  C140  AB                 .BYT $AB
00339  C141              PLUSTK =@252
00340  C141  AD                 .BYT $AD
00341  C142              MINUTK =@253
00342  C142  AA                 .BYT $AA
00343  C143  AF                 .BYT $AF
00344  C144  DE                 .BYT $DE
00345  C145  41 4E              .BYT 'AN',$C4
00345  C147  C4 
00346  C148  4F                 .BYT 'O',$D2
00346  C149  D2 
00347  C14A  BE                 .BYT 190
00348  C14B              GREATK =@261
00349  C14B  BD                 .BYT $BD
00350  C14C              EQULTK =@262
00351  C14C  BC                 .BYT 188
00352  C14D              LESSTK =@263
00353  C14D  53 47              .BYT 'SG',$CE
00353  C14F  CE 
00354  C150              ONEFUN =@264
00355  C150  49 4E              .BYT 'IN',$D4
00355  C152  D4 
00356  C153  41 42              .BYT 'AB',$D3
00356  C155  D3 
00357  C156  55 53              .BYT 'US',$D2
00357  C158  D2 
00358  C159  46 52              .BYT 'FR',$C5
00358  C15B  C5 
00359  C15C  50 4F              .BYT 'PO',$D3
00359  C15E  D3 
00360  C15F  53 51              .BYT 'SQ',$D2
00360  C161  D2 
00361  C162  52 4E              .BYT 'RN',$C4
00361  C164  C4 






TOKEN2......PAGE 000A

LINE# LOC   CODE        LINE


00362  C165  4C 4F              .BYT 'LO',$C7
00362  C167  C7 
00363  C168  45 58              .BYT 'EX',$D0
00363  C16A  D0 
00364  C16B  43 4F              .BYT 'CO',$D3
00364  C16D  D3 
00365  C16E  53 49              .BYT 'SI',$CE
00365  C170  CE 
00366  C171  54 41              .BYT 'TA',$CE
00366  C173  CE 
00367  C174  41 54              .BYT 'AT',$CE
00367  C176  CE 
00368  C177  50 45 45           .BYT 'PEE',$CB
00368  C17A  CB 
00369  C17B  4C 45              .BYT 'LE',$CE
00369  C17D  CE 
00370  C17E  53 54 52           .BYT 'STR',$A4
00370  C181  A4 
00371  C182  56 41              .BYT 'VA',$CC
00371  C184  CC 
00372  C185  41 53              .BYT 'AS',$C3
00372  C187  C3 
00373  C188  43 48 52           .BYT 'CHR',$A4
00373  C18B  A4 
00374  C18C              LASNUM =@307
00375  C18C  4C 45              .BYT 'LEFT',$A4
00375  C190  A4 
00376  C191  52 49              .BYT 'RIGHT',$A4
00376  C196  A4 
00377  C197  4D 49 44           .BYT 'MID',$A4
00377  C19A  A4 
00378  C19B  47                 .BYT 'G',$CF
00378  C19C  CF 
00379  C19D              GOTK   =@313
00380  C19D  00                 .BYT 0


























ERROR MESSAGES......PAGE 000B

LINE# LOC   CODE        LINE


00382  C19E  54 4F       ERR01  .BYT 'TOO MANY FILE',$D3
00382  C1AB  D3 
00383  C1AC  46 49       ERR02  .BYT 'FILE OPE',$CE
00383  C1B4  CE 
00384  C1B5  46 49       ERR03  .BYT 'FILE NOT OPE',$CE
00384  C1C1  CE 
00385  C1C2  46 49       ERR04  .BYT 'FILE NOT FOUN',$C4
00385  C1CF  C4 
00386  C1D0  44 45       ERR05  .BYT 'DEVICE NOT PRESEN',$D4
00386  C1E1  D4 
00387  C1E2  4E 4F       ERR06  .BYT 'NOT INPUT FIL',$C5
00387  C1EF  C5 
00388  C1F0  4E 4F       ERR07  .BYT 'NOT OUTPUT FIL',$C5
00388  C1FE  C5 
00389  C1FF  4D 49       ERR08  .BYT 'MISSING FILE NAM',$C5
00389  C20F  C5 
00390  C210  49 4C       ERR09  .BYT 'ILLEGAL DEVICE NUMBE',$D2
00390  C224  D2 
00391  C225  4E 45       ERR10  .BYT 'NEXT WITHOUT FO',$D2
00391  C234  D2 
00392  C235              ERRNF  =10
00393  C235  53 59       ERR11  .BYT 'SYNTA',$D8
00393  C23A  D8 
00394  C23B              ERRSN  =11
00395  C23B  52 45       ERR12  .BYT 'RETURN WITHOUT GOSU',$C2
00395  C24E  C2 
00396  C24F              ERRRG  =12
00397  C24F  4F 55       ERR13  .BYT 'OUT OF DAT',$C1
00397  C259  C1 
00398  C25A              ERROD  =13
00399  C25A  49 4C       ERR14  .BYT 'ILLEGAL QUANTIT',$D9
00399  C269  D9 
00400  C26A              ERRFC  =14
00401  C26A  4F 56       ERR15  .BYT 'OVERFLO',$D7
00401  C271  D7 
00402  C272              ERROV  =15
00403  C272  4F 55       ERR16  .BYT 'OUT OF MEMOR',$D9
00403  C27E  D9 
00404  C27F              ERROM  =16
00405  C27F  55 4E       ERR17  .BYT 'UNDEF',$27
00405  C284  27 
00406  C285  44 20              .BYT 'D STATEMEN',$D4
00406  C28F  D4 
00407  C290              ERRUS  =17
00408  C290  42 41       ERR18  .BYT 'BAD SUBSCRIP',$D4
00408  C29C  D4 
00409  C29D              ERRBS  =18
00410  C29D  52 45       ERR19  .BYT 'REDIM',$27,'D ARRA',$D9
00410  C2A2  27 
00410  C2A3  44 20 
00410  C2A9  D9 
00411  C2AA              ERRDD  =19
00412  C2AA  44 49       ERR20  .BYT 'DIVISION BY ZER',$CF
00412  C2B9  CF 
00413  C2BA              ERRDVO =20






ERROR MESSAGES......PAGE 000C

LINE# LOC   CODE        LINE


00414  C2BA  49 4C       ERR21  .BYT 'ILLEGAL DIREC',$D4
00414  C2C7  D4 
00415  C2C8              ERRID  =21
00416  C2C8  54 59       ERR22  .BYT 'TYPE MISMATC',$C8
00416  C2D4  C8 
00417  C2D5              ERRTM  =22
00418  C2D5  53 54       ERR23  .BYT 'STRING TOO LON',$C7
00418  C2E3  C7 
00419  C2E4              ERRLS  =23
00420  C2E4  46 49       ERR24  .BYT 'FILE DAT',$C1
00420  C2EC  C1 
00421  C2ED              ERRBD  =24
00422  C2ED  46 4F       ERR25  .BYT 'FORMULA TOO COMPLE',$D8
00422  C2FF  D8 
00423  C300              ERRST  =25
00424  C300  43 41 4E    ERR26  .BYT 'CAN',$27,'T CONTINU',$C5
00424  C303  27 
00424  C304  54 20 
00424  C30D  C5 
00425  C30E              ERRCN  =26
00426  C30E  55 4E       ERR27  .BYT 'UNDEF',$27,'D FUNCTIO',$CE
00426  C313  27 
00426  C314  44 20 
00426  C31D  CE 
00427  C31E              ERRUF  =27
00428  C31E  56 45       ERR28  .BYT 'VERIF',$D9
00428  C323  D9 
00429  C324              ERVFY  =28
00430  C324  4C 4F 41    ERR29  .BYT 'LOA',$C4
00430  C327  C4 
00431  C328              ERLOAD =29






























ERROR MESSAGES......PAGE 000D

LINE# LOC   CODE        LINE


00433  C328              ; TABLE TO TRANSLATE ERROR MESSAGE #
00434  C328              ; TO ADDRESS OF STRING CONTAINING MESSAGE
00435  C328              ;
00436  C328  9E C1       ERRTAB .WOR ERR01
00437  C32A  AC C1              .WOR ERR02
00438  C32C  B5 C1              .WOR ERR03
00439  C32E  C2 C1              .WOR ERR04
00440  C330  D0 C1              .WOR ERR05
00441  C332  E2 C1              .WOR ERR06
00442  C334  F0 C1              .WOR ERR07
00443  C336  FF C1              .WOR ERR08
00444  C338  10 C2              .WOR ERR09
00445  C33A  25 C2              .WOR ERR10
00446  C33C  35 C2              .WOR ERR11
00447  C33E  3B C2              .WOR ERR12
00448  C340  4F C2              .WOR ERR13
00449  C342  5A C2              .WOR ERR14
00450  C344  6A C2              .WOR ERR15
00451  C346  72 C2              .WOR ERR16
00452  C348  7F C2              .WOR ERR17
00453  C34A  90 C2              .WOR ERR18
00454  C34C  9D C2              .WOR ERR19
00455  C34E  AA C2              .WOR ERR20
00456  C350  BA C2              .WOR ERR21
00457  C352  C8 C2              .WOR ERR22
00458  C354  D5 C2              .WOR ERR23
00459  C356  E4 C2              .WOR ERR24
00460  C358  ED C2              .WOR ERR25
00461  C35A  00 C3              .WOR ERR26
00462  C35C  0E C3              .WOR ERR27
00463  C35E  1E C3              .WOR ERR28
00464  C360  24 C3              .WOR ERR29
00465  C362  83 C3              .WOR ERR30
00466  C364  0D          OKMSG  .BYT $D,'OK',$D,$0
00466  C365  4F 4B 
00466  C367  0D 
00466  C368  00 
00467  C369  0D          ERR    .BYT $D,' ERROR',0 ;ADD A C/R FOR VIXEN SCREEN
00467  C36A  20 45 
00467  C370  00 
00468  C371  20 49       INTXT  .BYT ' IN ',0
00468  C375  00 
00469  C376  0D          REDDY  .BYT $D,$A,'READY.',$D,$A,0
00469  C377  0A 
00469  C378  52 45 
00469  C37E  0D 
00469  C37F  0A 
00469  C380  00 
00470  C381              ERBRK  =30
00471  C381  0D          BRKTXT .BYT $D,$A
00471  C382  0A 
00472  C383  42 52       ERR30  .BYT 'BREAK',0,$A0 ;SHIFTED SPACE
00472  C388  00 
00472  C389  A0 







ERROR MESSAGES......PAGE 000E

LINE# LOC   CODE        LINE


00474  C38A              FORSIZ =@22
00475  C38A  BA          FNDFOR TSX
00476  C38B  E8                 INX
00477  C38C  E8                 INX
00478  C38D  E8                 INX
00479  C38E  E8                 INX
00480  C38F  BD 01 01    FFLOOP LDA 257,X
00481  C392  C9 81              CMP #FORTK
00482  C394  D0 21              BNE FFRTS
00483  C396  A5 4A              LDA FORPNT+1
00484  C398  D0 0A              BNE CMPFOR
00485  C39A  BD 02 01           LDA 258,X
00486  C39D  85 49              STA FORPNT
00487  C39F  BD 03 01           LDA 259,X
00488  C3A2  85 4A              STA FORPNT+1
00489  C3A4  DD 03 01    CMPFOR CMP 259,X
00490  C3A7  D0 07              BNE ADDFRS
00491  C3A9  A5 49              LDA FORPNT
00492  C3AB  DD 02 01           CMP 258,X
00493  C3AE  F0 07              BEQ FFRTS
00494  C3B0  8A          ADDFRS TXA 
00495  C3B1  18                 CLC
00496  C3B2  69 12              ADC #FORSIZ
00497  C3B4  AA                 TAX
00498  C3B5  D0 D8              BNE FFLOOP
00499  C3B7  60          FFRTS  RTS
00500  C3B8  20 08 C4    BLTU   JSR REASON
00501  C3BB  85 31              STA STREND
00502  C3BD  84 32              STY STREND+1
00503  C3BF  38          BLTUC  SEC
00504  C3C0  A5 5A              LDA HIGHTR
00505  C3C2  E5 5F              SBC LOWTR
00506  C3C4  85 22              STA INDEX
00507  C3C6  A8                 TAY
00508  C3C7  A5 5B              LDA HIGHTR+1
00509  C3C9  E5 60              SBC LOWTR+1
00510  C3CB  AA                 TAX
00511  C3CC  E8                 INX
00512  C3CD  98                 TYA
00513  C3CE  F0 23              BEQ DECBLT
00514  C3D0  A5 5A              LDA HIGHTR
00515  C3D2  38                 SEC
00516  C3D3  E5 22              SBC INDEX
00517  C3D5  85 5A              STA HIGHTR
00518  C3D7  B0 03              BCS BLT1
00519  C3D9  C6 5B              DEC HIGHTR+1
00520  C3DB  38                 SEC
00521  C3DC  A5 58       BLT1   LDA HIGHDS
00522  C3DE  E5 22              SBC INDEX
00523  C3E0  85 58              STA HIGHDS
00524  C3E2  B0 08              BCS MOREN1
00525  C3E4  C6 59              DEC HIGHDS+1
00526  C3E6  90 04              BCC MOREN1
00527  C3E8  B1 5A       BLTLP  LDA (HIGHTR)Y
00528  C3EA  91 58              STA (HIGHDS)Y






ERROR MESSAGES......PAGE 000F

LINE# LOC   CODE        LINE


00529  C3EC  88          MOREN1 DEY
00530  C3ED  D0 F9              BNE BLTLP
00531  C3EF  B1 5A              LDA (HIGHTR),Y
00532  C3F1  91 58              STA (HIGHDS),Y
00533  C3F3  C6 5B       DECBLT DEC HIGHTR+1
00534  C3F5  C6 59              DEC HIGHDS+1
00535  C3F7  CA                 DEX
00536  C3F8  D0 F2              BNE MOREN1
00537  C3FA  60                 RTS
00538  C3FB  0A          GETSTK ASL A
00539  C3FC  69 3E              ADC #NUMLEV+NUMLEV+16
00540  C3FE  B0 35              BCS OMERR
00541  C400  85 22              STA INDEX
00542  C402  BA                 TSX
00543  C403  E4 22              CPX INDEX
00544  C405  90 2E              BCC OMERR
00545  C407  60                 RTS
00546  C408  C4 34       REASON CPY FRETOP+1
00547  C40A  90 28              BCC REARTS
00548  C40C  D0 04              BNE TRYMOR
00549  C40E  C5 33              CMP FRETOP
00550  C410  90 22              BCC REARTS
00551  C412  48          TRYMOR PHA
00552  C413  A2 09              LDX #8+ADDPRC
00553  C415  98                 TYA
00554  C416  48          REASAV PHA
00555  C417  B5 57              LDA HIGHDS-1,X
00556  C419  CA                 DEX
00557  C41A  10 FA              BPL REASAV
00558  C41C  20 26 D5           JSR GARBA2
00559  C41F  A2 F7              LDX #248-ADDPRC
00560  C421  68          REASTO PLA
00561  C422  95 61              STA HIGHDS+8+ADDPRC,X
00562  C424  E8                 INX
00563  C425  30 FA              BMI REASTO
00564  C427  68                 PLA
00565  C428  A8                 TAY
00566  C429  68                 PLA
00567  C42A  C4 34              CPY FRETOP+1
00568  C42C  90 06              BCC REARTS
00569  C42E  D0 05              BNE OMERR
00570  C430  C5 33              CMP FRETOP
00571  C432  B0 01              BCS OMERR
00572  C434  60          REARTS RTS
00573  C435              .END
00574  C435              .LIB   CODE1















CODE1......PAGE 0010

LINE# LOC   CODE        LINE


00576  C435  A2 10       OMERR  LDX #ERROM
00577  C437  6C 00 03    ERROR  JMP (IERROR)
00578  C43A  8A          NERROR TXA
00579  C43B  0A                 ASL A
00580  C43C  AA                 TAX
00581  C43D  BD 26 C3           LDA ERRTAB-2,X
00582  C440  85 22              STA INDEX1
00583  C442  BD 27 C3           LDA ERRTAB-1,X
00584  C445  85 23              STA INDEX1+1
00585  C447  20 CC FF           JSR CLSCHN
00586  C44A  A9 00              LDA #0
00587  C44C  85 13              STA CHANNL
00588  C44E  20 D7 CA    ERRCRD JSR CRDO
00589  C451  20 45 CB           JSR OUTQST
00590  C454  A0 00              LDY #0
00591  C456  B1 22       GETERR LDA (INDEX1)Y
00592  C458  48                 PHA
00593  C459  29 7F              AND #127
00594  C45B  20 47 CB           JSR OUTDO
00595  C45E  C8                 INY
00596  C45F  68                 PLA
00597  C460  10 F4              BPL GETERR
00598  C462  20 7A C6           JSR STKINI
00599  C465  A9 69              LDA #<ERR
00600  C467  A0 C3              LDY #>ERR
00601  C469  20 1E CB    ERRFIN JSR STROUT
00602  C46C  A4 3A              LDY CURLIN+1
00603  C46E  C8                 INY
00604  C46F  F0 03              BEQ READY
00605  C471  20 C2 DD           JSR INPRT





00607  C474  A9 76       READY  LDA #<REDDY
00608  C476  A0 C3              LDY #>REDDY
00609  C478  20 1E CB           JSR STROUT
00610  C47B  A9 80              LDA #$80        ;DIRECT MESSAGES ON
00611  C47D  20 90 FF           JSR SETMSG      ;FROM KERNAL





00613  C480  6C 02 03    MAIN   JMP (IMAIN)
00614  C483  20 60 C5    NMAIN  JSR INLIN
00615  C486  86 7A              STX TXTPTR
00616  C488  84 7B              STY TXTPTR+1
00617  C48A  20 73 00           JSR CHRGET
00618  C48D  AA                 TAX
00619  C48E  F0 F0              BEQ MAIN
00620  C490  A2 FF              LDX #255
00621  C492  86 3A              STX CURLIN+1
00622  C494  90 06              BCC MAIN1






CODE1......PAGE 0011

LINE# LOC   CODE        LINE


00623  C496  20 79 C5           JSR CRUNCH
00624  C499  4C E1 C7           JMP GONE
00625  C49C  20 6B C9    MAIN1  JSR LINGET
00626  C49F  20 79 C5           JSR CRUNCH
00627  C4A2  84 0B              STY COUNT
00628  C4A4  20 13 C6           JSR FNDLIN
00629  C4A7  90 44              BCC NODEL
00630  C4A9  A0 01              LDY #1
00631  C4AB  B1 5F              LDA (LOWTR)Y
00632  C4AD  85 23              STA INDEX1+1
00633  C4AF  A5 2D              LDA VARTAB
00634  C4B1  85 22              STA INDEX1
00635  C4B3  A5 60              LDA LOWTR+1
00636  C4B5  85 25              STA INDEX2+1
00637  C4B7  A5 5F              LDA LOWTR
00638  C4B9  88                 DEY
00639  C4BA  F1 5F              SBC (LOWTR)Y 
00640  C4BC  18                 CLC
00641  C4BD  65 2D              ADC VARTAB
00642  C4BF  85 2D              STA VARTAB
00643  C4C1  85 24              STA INDEX2
00644  C4C3  A5 2E              LDA VARTAB+1
00645  C4C5  69 FF              ADC #255
00646  C4C7  85 2E              STA VARTAB+1
00647  C4C9  E5 60              SBC LOWTR+1
00648  C4CB  AA                 TAX
00649  C4CC  38                 SEC
00650  C4CD  A5 5F              LDA LOWTR
00651  C4CF  E5 2D              SBC VARTAB
00652  C4D1  A8                 TAY
00653  C4D2  B0 03              BCS QDECT1
00654  C4D4  E8                 INX
00655  C4D5  C6 25              DEC INDEX2+1
00656  C4D7  18          QDECT1 CLC
00657  C4D8  65 22              ADC INDEX1
00658  C4DA  90 03              BCC MLOOP
00659  C4DC  C6 23              DEC INDEX1+1
00660  C4DE  18                 CLC
00661  C4DF  B1 22       MLOOP  LDA (INDEX1)Y
00662  C4E1  91 24              STA (INDEX2)Y
00663  C4E3  C8                 INY 
00664  C4E4  D0 F9              BNE MLOOP
00665  C4E6  E6 23              INC INDEX1+1
00666  C4E8  E6 25              INC INDEX2+1
00667  C4EA  CA                 DEX
00668  C4EB  D0 F2              BNE MLOOP
00669  C4ED  20 59 C6    NODEL  JSR RUNC
00670  C4F0  20 33 C5           JSR LNKPRG
00671  C4F3  AD 00 02           LDA BUF
00672  C4F6  F0 88              BEQ MAIN
00673  C4F8  18                 CLC
00674  C4F9  A5 2D              LDA VARTAB
00675  C4FB  85 5A              STA HIGHTR 
00676  C4FD  65 0B              ADC COUNT
00677  C4FF  85 58              STA HIGHDS






CODE1......PAGE 0012

LINE# LOC   CODE        LINE


00678  C501  A4 2E              LDY VARTAB+1
00679  C503  84 5B              STY HIGHTR+1
00680  C505  90 01              BCC NODELC
00681  C507  C8                 INY
00682  C508  84 59       NODELC STY HIGHDS+1
00683  C50A  20 B8 C3           JSR BLTU
00684  C50D  A5 14              LDA LINNUM
00685  C50F  A4 15              LDY LINNUM+1
00686  C511  8D FE 01           STA BUF-2
00687  C514  8C FF 01           STY BUF-1
00688  C517  A5 31              LDA STREND
00689  C519  A4 32              LDY STREND+1
00690  C51B  85 2D              STA VARTAB
00691  C51D  84 2E              STY VARTAB+1
00692  C51F  A4 0B              LDY COUNT
00693  C521  88                 DEY
00694  C522  B9 FC 01    STOLOP LDA BUF-4,Y
00695  C525  91 5F              STA (LOWTR)Y
00696  C527  88                 DEY
00697  C528  10 F8              BPL STOLOP
00698  C52A  20 59 C6    FINI   JSR RUNC
00699  C52D  20 33 C5           JSR LNKPRG
00700  C530  4C 80 C4           JMP MAIN
00701  C533  A5 2B       LNKPRG LDA TXTTAB
00702  C535  A4 2C              LDY TXTTAB+1
00703  C537  85 22              STA INDEX
00704  C539  84 23              STY INDEX+1
00705  C53B  18                 CLC 
00706  C53C  A0 01       CHEAD  LDY #1
00707  C53E  B1 22              LDA (INDEX)Y
00708  C540  F0 1D              BEQ LNKRTS
00709  C542  A0 04              LDY #4
00710  C544  C8          CZLOOP INY
00711  C545  B1 22              LDA (INDEX)Y
00712  C547  D0 FB              BNE CZLOOP
00713  C549  C8                 INY
00714  C54A  98                 TYA
00715  C54B  65 22              ADC INDEX
00716  C54D  AA                 TAX
00717  C54E  A0 00              LDY #0
00718  C550  91 22              STA (INDEX)Y
00719  C552  A5 23              LDA INDEX+1
00720  C554  69 00              ADC #0
00721  C556  C8                 INY
00722  C557  91 22              STA (INDEX)Y
00723  C559  86 22              STX INDEX
00724  C55B  85 23              STA INDEX+1
00725  C55D  90 DD              BCC CHEAD
00726  C55F  60          LNKRTS RTS





00728  C560              ;FUNCTION TO GET A LINE ONE CHARACTER AT






CODE1......PAGE 0013

LINE# LOC   CODE        LINE


00729  C560              ;A TIME FROM THE INPUT CHANNEL AND
00730  C560              ;BUILD IT IN THE INPUT BUFFER.
00731  C560              ;
00732  C560  A2 00       INLIN  LDX #0
00733  C562              ;
00734  C562  20 0F E1    INLINC JSR INCHR
00735  C565  C9 0D              CMP #13         ;A CARRIAGE RETURN?
00736  C567  F0 0D              BEQ FININ1      ;YES...DONE BUILD
00737  C569              ;
00738  C569  9D 00 02           STA BUF,X       ;PUT IT AWAY
00739  C56C  E8                 INX
00740  C56D  E0 59              CPX #BUFLEN     ;MAX CHARACTER LINE?
00741  C56F  90 F1              BCC INLINC      ;NO...O.K.
00742  C571              ;
00743  C571  A2 17              LDX #ERRLS      ;STRING TOO LONG ERROR
00744  C573  4C 37 C4           JMP ERROR
00745  C576              ;
00746  C576  4C CA CA    FININ1 JMP FININL
00747  C579              .END
00748  C579              .LIB   CODE2









































CODE2......PAGE 0014

LINE# LOC   CODE        LINE


00750  C579              BUFOFS =@1000
00751  C579  6C 04 03    CRUNCH JMP (ICRNCH)
00752  C57C  A6 7A       NCRNCH LDX TXTPTR
00753  C57E  A0 04              LDY #4
00754  C580  84 0F              STY DORES
00755  C582  BD 00 02    KLOOP  LDA BUFOFS,X
00756  C585  10 07              BPL CMPSPC
00757  C587  C9 FF              CMP #PI
00758  C589  F0 3E              BEQ STUFFH
00759  C58B  E8                 INX
00760  C58C  D0 F4              BNE KLOOP
00761  C58E  C9 20       CMPSPC CMP #' 
00762  C590  F0 37              BEQ STUFFH
00763  C592  85 08              STA ENDCHR
00764  C594  C9 22              CMP #34
00765  C596  F0 56              BEQ STRNG
00766  C598  24 0F              BIT DORES
00767  C59A  70 2D              BVS STUFFH
00768  C59C  C9 3F              CMP #'?
00769  C59E  D0 04              BNE KLOOP1
00770  C5A0  A9 99              LDA #PRINTK
00771  C5A2  D0 25              BNE STUFFH
00772  C5A4  C9 30       KLOOP1 CMP #'0
00773  C5A6  90 04              BCC MUSTCR
00774  C5A8  C9 3C              CMP #60
00775  C5AA  90 1D              BCC STUFFH
00776  C5AC  84 71       MUSTCR STY BUFPTR
00777  C5AE  A0 00              LDY #0
00778  C5B0  84 0B              STY COUNT
00779  C5B2  88                 DEY
00780  C5B3  86 7A              STX TXTPTR
00781  C5B5  CA                 DEX
00782  C5B6  C8          RESER  INY
00783  C5B7  E8                 INX
00784  C5B8  BD 00 02    RESCON LDA BUFOFS,X
00785  C5BB  38                 SEC
00786  C5BC  F9 9E C0           SBC RESLST,Y
00787  C5BF  F0 F5              BEQ RESER
00788  C5C1  C9 80              CMP #128
00789  C5C3  D0 30              BNE NTHIS
00790  C5C5  05 0B              ORA COUNT
00791  C5C7  A4 71       GETBPT LDY BUFPTR
00792  C5C9  E8          STUFFH INX
00793  C5CA  C8                 INY
00794  C5CB  99 FB 01           STA BUF-5,Y
00795  C5CE  B9 FB 01           LDA BUF-5,Y
00796  C5D1  F0 36              BEQ CRDONE
00797  C5D3  38                 SEC
00798  C5D4  E9 3A              SBC #':
00799  C5D6  F0 04              BEQ COLIS
00800  C5D8  C9 49              CMP #DATATK-$3A
00801  C5DA  D0 02              BNE NODATT
00802  C5DC  85 0F       COLIS  STA DORES
00803  C5DE  38          NODATT SEC
00804  C5DF  E9 55              SBC #REMTK-$3A






CODE2......PAGE 0015

LINE# LOC   CODE        LINE


00805  C5E1  D0 9F              BNE KLOOP
00806  C5E3  85 08              STA ENDCHR
00807  C5E5  BD 00 02    STR1   LDA BUFOFS,X
00808  C5E8  F0 DF              BEQ STUFFH
00809  C5EA  C5 08              CMP ENDCHR
00810  C5EC  F0 DB              BEQ STUFFH
00811  C5EE  C8          STRNG  INY
00812  C5EF  99 FB 01           STA BUF-5,Y
00813  C5F2  E8                 INX
00814  C5F3  D0 F0              BNE STR1
00815  C5F5  A6 7A       NTHIS  LDX TXTPTR
00816  C5F7  E6 0B              INC COUNT
00817  C5F9  C8          NTHIS1 INY
00818  C5FA  B9 9D C0           LDA RESLST-1,Y
00819  C5FD  10 FA              BPL NTHIS1
00820  C5FF  B9 9E C0           LDA RESLST,Y
00821  C602  D0 B4              BNE RESCON
00822  C604  BD 00 02           LDA BUFOFS,X
00823  C607  10 BE              BPL GETBPT
00824  C609  99 FD 01    CRDONE STA BUF-3,Y
00825  C60C  C6 7B              DEC TXTPTR+1
00826  C60E              ZZ1    =BUF-1
00827  C60E  A9 FF              LDA #<ZZ1
00828  C610  85 7A              STA TXTPTR
00829  C612  60                 RTS
00830  C613  A5 2B       FNDLIN LDA TXTTAB
00831  C615  A6 2C              LDX TXTTAB+1
00832  C617  A0 01       FNDLNC LDY #1
00833  C619  85 5F              STA LOWTR
00834  C61B  86 60              STX LOWTR+1
00835  C61D  B1 5F              LDA (LOWTR)Y
00836  C61F  F0 1F              BEQ FLINRT
00837  C621  C8                 INY
00838  C622  C8                 INY
00839  C623  A5 15              LDA LINNUM+1
00840  C625  D1 5F              CMP (LOWTR)Y
00841  C627  90 18              BCC FLNRTS
00842  C629  F0 03              BEQ FNDLO1 
00843  C62B  88                 DEY
00844  C62C  D0 09              BNE AFFRTS
00845  C62E  A5 14       FNDLO1 LDA LINNUM
00846  C630  88                 DEY
00847  C631  D1 5F              CMP (LOWTR)Y
00848  C633  90 0C              BCC FLNRTS
00849  C635  F0 0A              BEQ FLNRTS
00850  C637  88          AFFRTS DEY
00851  C638  B1 5F              LDA (LOWTR)Y
00852  C63A  AA                 TAX
00853  C63B  88                 DEY
00854  C63C  B1 5F              LDA (LOWTR)Y
00855  C63E  B0 D7              BCS FNDLNC
00856  C640  18          FLINRT CLC
00857  C641  60          FLNRTS RTS
00858  C642  D0 FD       SCRATH BNE FLNRTS
00859  C644  A9 00       SCRTCH LDA #0






CODE2......PAGE 0016

LINE# LOC   CODE        LINE


00860  C646  A8                 TAY
00861  C647  91 2B              STA (TXTTAB)Y
00862  C649  C8                 INY
00863  C64A  91 2B              STA (TXTTAB)Y
00864  C64C  A5 2B              LDA TXTTAB
00865  C64E  18                 CLC
00866  C64F  69 02              ADC #2
00867  C651  85 2D              STA VARTAB
00868  C653  A5 2C              LDA TXTTAB+1
00869  C655  69 00              ADC #0
00870  C657  85 2E              STA VARTAB+1
00871  C659  20 8E C6    RUNC   JSR STXTPT
00872  C65C  A9 00              LDA #0
00873  C65E  D0 2D       CLEAR  BNE STKRTS
00874  C660  20 E7 FF    CLEARC JSR CCALL       ;MOVED FOR V2 ORIG FOR RS-232
00875  C663  A5 37       CLEART LDA MEMSIZ      ;ENTRY FOR OPEN & CLOSE MEMSIZ CHANGES
00876  C665  A4 38              LDY MEMSIZ+1
00877  C667  85 33              STA FRETOP
00878  C669  84 34              STY FRETOP+1
00879  C66B  A5 2D              LDA VARTAB
00880  C66D  A4 2E              LDY VARTAB+1
00881  C66F  85 2F              STA ARYTAB
00882  C671  84 30              STY ARYTAB+1
00883  C673  85 31              STA STREND
00884  C675  84 32              STY STREND+1
00885  C677  20 1D C8    FLOAD  JSR RESTOR
00886  C67A  A2 19       STKINI LDX #TEMPST
00887  C67C  86 16              STX TEMPPT
00888  C67E  68                 PLA 
00889  C67F  A8                 TAY
00890  C680  68                 PLA
00891  C681  A2 FA              LDX #STKEND-257
00892  C683  9A                 TXS
00893  C684  48                 PHA
00894  C685  98                 TYA
00895  C686  48                 PHA
00896  C687  A9 00              LDA #0
00897  C689  85 3E              STA OLDTXT+1
00898  C68B  85 10              STA SUBFLG
00899  C68D  60          STKRTS RTS
00900  C68E  18          STXTPT CLC
00901  C68F  A5 2B              LDA TXTTAB
00902  C691  69 FF              ADC #255
00903  C693  85 7A              STA TXTPTR
00904  C695  A5 2C              LDA TXTTAB+1
00905  C697  69 FF              ADC #255
00906  C699  85 7B              STA TXTPTR+1
00907  C69B  60                 RTS
00908  C69C              .END
00909  C69C              .LIB   CODE3











CODE3......PAGE 0017

LINE# LOC   CODE        LINE


00911  C69C  90 06       LIST   BCC GOLST
00912  C69E  F0 04              BEQ GOLST
00913  C6A0  C9 AB              CMP #MINUTK
00914  C6A2  D0 E9              BNE STKRTS
00915  C6A4  20 6B C9    GOLST  JSR LINGET
00916  C6A7  20 13 C6           JSR FNDLIN
00917  C6AA  20 79 00           JSR CHRGOT
00918  C6AD  F0 0C              BEQ LSTEND
00919  C6AF  C9 AB              CMP #MINUTK
00920  C6B1  D0 8E              BNE FLNRTS
00921  C6B3  20 73 00           JSR CHRGET
00922  C6B6  20 6B C9           JSR LINGET
00923  C6B9  D0 86              BNE FLNRTS
00924  C6BB  68          LSTEND PLA
00925  C6BC  68                 PLA
00926  C6BD  A5 14              LDA LINNUM
00927  C6BF  05 15              ORA LINNUM+1
00928  C6C1  D0 06              BNE LIST4
00929  C6C3  A9 FF              LDA #255
00930  C6C5  85 14              STA LINNUM
00931  C6C7  85 15              STA LINNUM+1
00932  C6C9  A0 01       LIST4  LDY #1
00933  C6CB  84 0F              STY DORES
00934  C6CD  B1 5F              LDA (LOWTR)Y
00935  C6CF  F0 43              BEQ GRODY
00936  C6D1  20 2C C8           JSR ISCNTC
00937  C6D4  20 D7 CA           JSR CRDO
00938  C6D7  C8                 INY
00939  C6D8  B1 5F              LDA (LOWTR)Y
00940  C6DA  AA                 TAX
00941  C6DB  C8                 INY
00942  C6DC  B1 5F              LDA (LOWTR)Y
00943  C6DE  C5 15              CMP LINNUM+1
00944  C6E0  D0 04              BNE TSTDUN
00945  C6E2  E4 14              CPX LINNUM
00946  C6E4  F0 02              BEQ TYPLIN
00947  C6E6  B0 2C       TSTDUN BCS GRODY
00948  C6E8  84 49       TYPLIN STY LSTPNT
00949  C6EA  20 CD DD           JSR LINPRT
00950  C6ED  A9 20              LDA #' 
00951  C6EF  A4 49       PRIT4  LDY LSTPNT
00952  C6F1  29 7F              AND #127
00953  C6F3  20 47 CB    PLOOP  JSR OUTDO
00954  C6F6  C9 22              CMP #34
00955  C6F8  D0 06              BNE PLOOP1
00956  C6FA  A5 0F              LDA DORES
00957  C6FC  49 FF              EOR #@377
00958  C6FE  85 0F              STA DORES
00959  C700  C8          PLOOP1 INY
00960  C701  F0 11              BEQ GRODY
00961  C703  B1 5F              LDA (LOWTR)Y
00962  C705  D0 10              BNE QPLOP
00963  C707  A8                 TAY
00964  C708  B1 5F              LDA (LOWTR)Y
00965  C70A  AA                 TAX






CODE3......PAGE 0018

LINE# LOC   CODE        LINE


00966  C70B  C8                 INY
00967  C70C  B1 5F              LDA (LOWTR)Y
00968  C70E  86 5F              STX LOWTR
00969  C710  85 60              STA LOWTR+1
00970  C712  D0 B5              BNE LIST4
00971  C714  4C 74 C4    GRODY  JMP READY
00972  C717  6C 06 03    QPLOP  JMP (IQPLOP)
00973  C71A  10 D7       NQPLOP BPL PLOOP
00974  C71C  C9 FF              CMP #PI
00975  C71E  F0 D3              BEQ PLOOP
00976  C720  24 0F              BIT DORES
00977  C722  30 CF              BMI PLOOP
00978  C724  38                 SEC
00979  C725  E9 7F              SBC #127
00980  C727  AA                 TAX
00981  C728  84 49              STY LSTPNT
00982  C72A  A0 FF              LDY #255
00983  C72C  CA          RESRCH DEX
00984  C72D  F0 08              BEQ PRIT3
00985  C72F  C8          RESCR1 INY
00986  C730  B9 9E C0           LDA RESLST,Y
00987  C733  10 FA              BPL RESCR1
00988  C735  30 F5              BMI RESRCH
00989  C737  C8          PRIT3  INY
00990  C738  B9 9E C0           LDA RESLST,Y
00991  C73B  30 B2              BMI PRIT4
00992  C73D  20 47 CB           JSR OUTDO
00993  C740  D0 F5              BNE PRIT3
00994  C742  A9 80       FOR    LDA #128
00995  C744  85 10              STA SUBFLG
00996  C746  20 A5 C9           JSR LET
00997  C749  20 8A C3           JSR FNDFOR
00998  C74C  D0 05              BNE NOTOL
00999  C74E  8A                 TXA
01000  C74F  69 0F              ADC #FORSIZ-3
01001  C751  AA                 TAX
01002  C752  9A                 TXS
01003  C753  68          NOTOL  PLA
01004  C754  68                 PLA
01005  C755  A9 09              LDA #8+ADDPRC
01006  C757  20 FB C3           JSR GETSTK
01007  C75A  20 06 C9           JSR DATAN
01008  C75D  18                 CLC
01009  C75E  98                 TYA
01010  C75F  65 7A              ADC TXTPTR
01011  C761  48                 PHA
01012  C762  A5 7B              LDA TXTPTR+1
01013  C764  69 00              ADC #0
01014  C766  48                 PHA
01015  C767  A5 3A              LDA CURLIN+1
01016  C769  48                 PHA
01017  C76A  A5 39              LDA CURLIN
01018  C76C  48                 PHA
01019  C76D  A9 A4              LDA #TOTK
01020  C76F  20 FF CE           JSR SYNCHR






CODE3......PAGE 0019

LINE# LOC   CODE        LINE


01021  C772  20 8D CD           JSR CHKNUM
01022  C775  20 8A CD           JSR FRMNUM
01023  C778  A5 66              LDA FACSGN
01024  C77A  09 7F              ORA #127
01025  C77C  25 62              AND FACHO
01026  C77E  85 62              STA FACHO
01027  C780  A9 8B              LDA #<LDFONE
01028  C782  A0 C7              LDY #>LDFONE
01029  C784  85 22              STA INDEX1
01030  C786  84 23              STY INDEX1+1
01031  C788  4C 43 CE           JMP FORPSH
01032  C78B  A9 BC       LDFONE LDA #<FONE
01033  C78D  A0 D9              LDY #>FONE
01034  C78F  20 A2 DB           JSR MOVFM
01035  C792  20 79 00           JSR CHRGOT
01036  C795  C9 A9              CMP #STEPTK
01037  C797  D0 06              BNE ONEON
01038  C799  20 73 00           JSR CHRGET
01039  C79C  20 8A CD           JSR FRMNUM
01040  C79F  20 2B DC    ONEON  JSR SIGN
01041  C7A2  20 38 CE           JSR PUSHF
01042  C7A5  A5 4A              LDA FORPNT+1
01043  C7A7  48                 PHA
01044  C7A8  A5 49              LDA FORPNT
01045  C7AA  48                 PHA
01046  C7AB  A9 81              LDA #FORTK
01047  C7AD  48                 PHA
01048  C7AE              .END
01049  C7AE              .LIB   CODE4
































CODE4......PAGE 001A

LINE# LOC   CODE        LINE


01051  C7AE  20 2C C8    NEWSTT JSR ISCNTC
01052  C7B1  A5 7A              LDA TXTPTR
01053  C7B3  A4 7B              LDY TXTPTR+1
01054  C7B5  C0 02              CPY #BUFPAG
01055  C7B7  EA                 NOP
01056  C7B8  F0 04              BEQ DIRCON
01057  C7BA  85 3D              STA OLDTXT
01058  C7BC  84 3E              STY OLDTXT+1
01059  C7BE  A0 00       DIRCON LDY #0
01060  C7C0  B1 7A              LDA (TXTPTR)Y
01061  C7C2  D0 43              BNE MORSTS
01062  C7C4  A0 02              LDY #2
01063  C7C6  B1 7A              LDA (TXTPTR)Y
01064  C7C8  18                 CLC
01065  C7C9  D0 03              BNE DIRCN1
01066  C7CB  4C 4B C8           JMP ENDCON
01067  C7CE  C8          DIRCN1 INY
01068  C7CF  B1 7A              LDA (TXTPTR)Y
01069  C7D1  85 39              STA CURLIN
01070  C7D3  C8                 INY
01071  C7D4  B1 7A              LDA (TXTPTR)Y
01072  C7D6  85 3A              STA CURLIN+1
01073  C7D8  98                 TYA
01074  C7D9  65 7A              ADC TXTPTR
01075  C7DB  85 7A              STA TXTPTR
01076  C7DD  90 02              BCC GONE
01077  C7DF  E6 7B              INC TXTPTR+1
01078  C7E1  6C 08 03    GONE   JMP (IGONE)
01079  C7E4  20 73 00    NGONE  JSR CHRGET
01080  C7E7  20 ED C7    NGONE1 JSR GONE3
01081  C7EA  4C AE C7           JMP NEWSTT
01082  C7ED  F0 3C       GONE3  BEQ ISCRTS
01083  C7EF  E9 80       GONE2  SBC #ENDTK
01084  C7F1  90 11              BCC GLET
01085  C7F3  C9 23              CMP #SCRATK-ENDTK+1
01086  C7F5  B0 17              BCS SNERRX
01087  C7F7  0A                 ASL A
01088  C7F8  A8                 TAY
01089  C7F9  B9 0D C0           LDA STMDSP+1,Y
01090  C7FC  48                 PHA
01091  C7FD  B9 0C C0           LDA STMDSP,Y
01092  C800  48                 PHA
01093  C801  4C 73 00           JMP CHRGET
01094  C804  4C A5 C9    GLET   JMP LET
01095  C807  C9 3A       MORSTS CMP #':
01096  C809  F0 D6              BEQ GONE
01097  C80B  4C 08 CF    SNERR1 JMP SNERR
01098  C80E  C9 4B       SNERRX CMP #GOTK-ENDTK
01099  C810  D0 F9              BNE SNERR1
01100  C812  20 73 00           JSR CHRGET
01101  C815  A9 A4              LDA #TOTK
01102  C817  20 FF CE           JSR SYNCHR
01103  C81A  4C A0 C8           JMP GOTO
01104  C81D  38          RESTOR SEC
01105  C81E  A5 2B              LDA TXTTAB






CODE4......PAGE 001B

LINE# LOC   CODE        LINE


01106  C820  E9 01              SBC #1
01107  C822  A4 2C              LDY TXTTAB+1
01108  C824  B0 01              BCS RESFIN
01109  C826  88                 DEY
01110  C827  85 41       RESFIN STA DATPTR
01111  C829  84 42              STY DATPTR+1
01112  C82B  60          ISCRTS RTS
01113  C82C  20 E1 FF    ISCNTC JSR $FFE1
01114  C82F  B0 01       STOP   BCS STOPC
01115  C831  18          END    CLC
01116  C832  D0 3C       STOPC  BNE CONTRT
01117  C834  A5 7A              LDA TXTPTR
01118  C836  A4 7B              LDY TXTPTR+1
01119  C838  A6 3A              LDX CURLIN+1
01120  C83A  E8                 INX
01121  C83B  F0 0C              BEQ DIRIS
01122  C83D  85 3D              STA OLDTXT
01123  C83F  84 3E              STY OLDTXT+1
01124  C841  A5 39       STPEND LDA CURLIN
01125  C843  A4 3A              LDY CURLIN+1
01126  C845  85 3B              STA OLDLIN
01127  C847  84 3C              STY OLDLIN+1
01128  C849  68          DIRIS  PLA
01129  C84A  68                 PLA
01130  C84B  A9 81       ENDCON LDA #<BRKTXT
01131  C84D  A0 C3              LDY #>BRKTXT
01132  C84F  90 03              BCC GORDY
01133  C851  4C 69 C4           JMP ERRFIN
01134  C854  4C 74 C4    GORDY  JMP READY
01135  C857  D0 17       CONT   BNE CONTRT
01136  C859  A2 1A              LDX #ERRCN
01137  C85B  A4 3E              LDY OLDTXT+1
01138  C85D  D0 03              BNE *+5
01139  C85F  4C 37 C4           JMP ERROR
01140  C862  A5 3D              LDA OLDTXT
01141  C864  85 7A              STA TXTPTR
01142  C866  84 7B              STY TXTPTR+1
01143  C868  A5 3B              LDA OLDLIN
01144  C86A  A4 3C              LDY OLDLIN+1
01145  C86C  85 39              STA CURLIN
01146  C86E  84 3A              STY CURLIN+1
01147  C870  60          CONTRT RTS
01148  C871  08          RUN    PHP
01149  C872  A9 00              LDA #0          ;NO KERNAL MESSAGES
01150  C874  20 90 FF           JSR SETMSG
01151  C877  28                 PLP
01152  C878  D0 03              BNE *+5
01153  C87A  4C 59 C6           JMP RUNC
01154  C87D  20 60 C6           JSR CLEARC
01155  C880  4C 97 C8           JMP RUNC2
01156  C883  A9 03       GOSUB  LDA #3
01157  C885  20 FB C3           JSR GETSTK
01158  C888  A5 7B              LDA TXTPTR+1
01159  C88A  48                 PHA
01160  C88B  A5 7A              LDA TXTPTR






CODE4......PAGE 001C

LINE# LOC   CODE        LINE


01161  C88D  48                 PHA
01162  C88E  A5 3A              LDA CURLIN+1
01163  C890  48                 PHA
01164  C891  A5 39              LDA CURLIN
01165  C893  48                 PHA
01166  C894  A9 8D              LDA #GOSUTK
01167  C896  48                 PHA
01168  C897  20 79 00    RUNC2  JSR CHRGOT
01169  C89A  20 A0 C8           JSR GOTO
01170  C89D  4C AE C7           JMP NEWSTT
01171  C8A0  20 6B C9    GOTO   JSR LINGET
01172  C8A3  20 09 C9           JSR REMN
01173  C8A6  38                 SEC
01174  C8A7  A5 39              LDA CURLIN
01175  C8A9  E5 14              SBC LINNUM
01176  C8AB  A5 3A              LDA CURLIN+1
01177  C8AD  E5 15              SBC LINNUM+1
01178  C8AF  B0 0B              BCS LUK4IT
01179  C8B1  98                 TYA
01180  C8B2  38                 SEC
01181  C8B3  65 7A              ADC TXTPTR
01182  C8B5  A6 7B              LDX TXTPTR+1
01183  C8B7  90 07              BCC LUKALL
01184  C8B9  E8                 INX
01185  C8BA  B0 04              BCS LUKALL
01186  C8BC  A5 2B       LUK4IT LDA TXTTAB
01187  C8BE  A6 2C              LDX TXTTAB+1
01188  C8C0  20 17 C6    LUKALL JSR FNDLNC
01189  C8C3  90 1E              BCC USERR
01190  C8C5  A5 5F              LDA LOWTR
01191  C8C7  E9 01              SBC #1
01192  C8C9              .END
01193  C8C9              .LIB   CODE5




























CODE5......PAGE 001D

LINE# LOC   CODE        LINE


01195  C8C9  85 7A              STA TXTPTR
01196  C8CB  A5 60              LDA LOWTR+1
01197  C8CD  E9 00              SBC #0
01198  C8CF  85 7B              STA TXTPTR+1
01199  C8D1  60          GORTS  RTS
01200  C8D2  D0 FD       RETURN BNE GORTS
01201  C8D4  A9 FF              LDA #255
01202  C8D6  85 4A              STA FORPNT+1
01203  C8D8  20 8A C3           JSR FNDFOR
01204  C8DB  9A                 TXS
01205  C8DC  C9 8D              CMP #GOSUTK
01206  C8DE  F0 0B              BEQ RETU1
01207  C8E0  A2 0C              LDX #ERRRG
01208  C8E2  2C                 .BYT $2C
01209  C8E3  A2 11       USERR  LDX #ERRUS
01210  C8E5  4C 37 C4           JMP ERROR
01211  C8E8  4C 08 CF    SNERR2 JMP SNERR
01212  C8EB  68          RETU1  PLA
01213  C8EC  68                 PLA
01214  C8ED  85 39              STA CURLIN
01215  C8EF  68                 PLA
01216  C8F0  85 3A              STA CURLIN+1
01217  C8F2  68                 PLA
01218  C8F3  85 7A              STA TXTPTR
01219  C8F5  68                 PLA
01220  C8F6  85 7B              STA TXTPTR+1
01221  C8F8  20 06 C9    DATA   JSR DATAN
01222  C8FB  98          ADDON  TYA
01223  C8FC  18                 CLC
01224  C8FD  65 7A              ADC TXTPTR
01225  C8FF  85 7A              STA TXTPTR
01226  C901  90 02              BCC REMRTS
01227  C903  E6 7B              INC TXTPTR+1
01228  C905  60          REMRTS RTS
01229  C906  A2 3A       DATAN  LDX #':
01230  C908  2C                 .BYT $2C
01231  C909  A2 00       REMN   LDX #0
01232  C90B  86 07              STX CHARAC
01233  C90D  A0 00              LDY #0
01234  C90F  84 08              STY ENDCHR
01235  C911  A5 08       EXCHQT LDA ENDCHR
01236  C913  A6 07              LDX CHARAC
01237  C915  85 07              STA CHARAC
01238  C917  86 08              STX ENDCHR
01239  C919  B1 7A       REMER  LDA (TXTPTR)Y
01240  C91B  F0 E8              BEQ REMRTS
01241  C91D  C5 08              CMP ENDCHR
01242  C91F  F0 E4              BEQ REMRTS
01243  C921  C8                 INY
01244  C922  C9 22              CMP #34
01245  C924  D0 F3              BNE REMER
01246  C926  F0 E9              BEQ EXCHQT
01247  C928  20 9E CD    IF     JSR FRMEVL
01248  C92B  20 79 00           JSR CHRGOT
01249  C92E  C9 89              CMP #GOTOTK






CODE5......PAGE 001E

LINE# LOC   CODE        LINE


01250  C930  F0 05              BEQ OKGOTO
01251  C932  A9 A7              LDA #THENTK
01252  C934  20 FF CE           JSR SYNCHR
01253  C937  A5 61       OKGOTO LDA FACEXP
01254  C939  D0 05              BNE DOCOND
01255  C93B  20 09 C9    REM    JSR REMN
01256  C93E  F0 BB              BEQ ADDON
01257  C940  20 79 00    DOCOND JSR CHRGOT
01258  C943  B0 03              BCS DOCO
01259  C945  4C A0 C8           JMP GOTO
01260  C948  4C ED C7    DOCO   JMP GONE3
01261  C94B  20 9E D7    ONGOTO JSR GETBYT
01262  C94E  48                 PHA
01263  C94F  C9 8D              CMP #GOSUTK
01264  C951  F0 04              BEQ ONGLOP
01265  C953  C9 89       SNERR3 CMP #GOTOTK
01266  C955  D0 91              BNE SNERR2
01267  C957  C6 65       ONGLOP DEC FACLO
01268  C959  D0 04              BNE ONGLP1
01269  C95B  68                 PLA
01270  C95C  4C EF C7           JMP GONE2
01271  C95F  20 73 00    ONGLP1 JSR CHRGET
01272  C962  20 6B C9           JSR LINGET
01273  C965  C9 2C              CMP #44
01274  C967  F0 EE              BEQ ONGLOP
01275  C969  68                 PLA
01276  C96A  60          ONGRTS RTS
01277  C96B  A2 00       LINGET LDX #0
01278  C96D  86 14              STX LINNUM
01279  C96F  86 15              STX LINNUM+1
01280  C971  B0 F7       MORLIN BCS ONGRTS
01281  C973  E9 2F              SBC #$2F
01282  C975  85 07              STA CHARAC
01283  C977  A5 15              LDA LINNUM+1
01284  C979  85 22              STA INDEX
01285  C97B  C9 19              CMP #25
01286  C97D  B0 D4              BCS SNERR3
01287  C97F  A5 14              LDA LINNUM
01288  C981  0A                 ASL A
01289  C982  26 22              ROL INDEX
01290  C984  0A                 ASL A
01291  C985  26 22              ROL INDEX
01292  C987  65 14              ADC LINNUM
01293  C989  85 14              STA LINNUM
01294  C98B  A5 22              LDA INDEX
01295  C98D  65 15              ADC LINNUM+1
01296  C98F  85 15              STA LINNUM+1
01297  C991  06 14              ASL LINNUM
01298  C993  26 15              ROL LINNUM+1
01299  C995  A5 14              LDA LINNUM
01300  C997  65 07              ADC CHARAC
01301  C999  85 14              STA LINNUM
01302  C99B  90 02              BCC NXTLGC
01303  C99D  E6 15              INC LINNUM+1
01304  C99F  20 73 00    NXTLGC JSR CHRGET






CODE5......PAGE 001F

LINE# LOC   CODE        LINE


01305  C9A2  4C 71 C9           JMP MORLIN
01306  C9A5  20 8B D0    LET    JSR PTRGET
01307  C9A8  85 49              STA FORPNT
01308  C9AA  84 4A              STY FORPNT+1
01309  C9AC  A9 B2              LDA #$B2
01310  C9AE  20 FF CE           JSR SYNCHR
01311  C9B1  A5 0E              LDA INTFLG
01312  C9B3  48                 PHA
01313  C9B4  A5 0D              LDA VALTYP
01314  C9B6  48                 PHA
01315  C9B7  20 9E CD           JSR FRMEVL
01316  C9BA  68                 PLA
01317  C9BB  2A                 ROL A
01318  C9BC  20 90 CD           JSR CHKVAL
01319  C9BF  D0 18              BNE COPSTR
01320  C9C1  68                 PLA
01321  C9C2  10 12       QINTGR BPL COPFLT
01322  C9C4  20 1B DC           JSR ROUND
01323  C9C7  20 BF D1           JSR AYINT
01324  C9CA  A0 00              LDY #0
01325  C9CC  A5 64              LDA FACMO
01326  C9CE  91 49              STA (FORPNT)Y
01327  C9D0  C8                 INY
01328  C9D1  A5 65              LDA FACLO
01329  C9D3  91 49              STA (FORPNT)Y
01330  C9D5  60                 RTS
01331  C9D6  4C D0 DB    COPFLT JMP MOVVF
01332  C9D9  68          COPSTR PLA
01333  C9DA  A4 4A       INPCOM LDY FORPNT+1
01334  C9DC  C0 DF              CPY #>ZERO
01335  C9DE  D0 4C              BNE GETSPT
01336  C9E0  20 A6 D6           JSR FREFAC
01337  C9E3  C9 06              CMP #6
01338  C9E5  D0 3D              BNE FCERR2
01339  C9E7  A0 00              LDY #0
01340  C9E9  84 61              STY FACEXP
01341  C9EB  84 66              STY FACSGN
01342  C9ED              .END
01343  C9ED              .LIB   CODE6






















CODE6......PAGE 0020

LINE# LOC   CODE        LINE


01345  C9ED  84 71       TIMELP STY FBUFPT
01346  C9EF  20 1D CA           JSR TIMNUM
01347  C9F2  20 E2 DA           JSR MUL10
01348  C9F5  E6 71              INC FBUFPT
01349  C9F7  A4 71              LDY FBUFPT
01350  C9F9  20 1D CA           JSR TIMNUM
01351  C9FC  20 0C DC           JSR MOVAF
01352  C9FF  AA                 TAX
01353  CA00  F0 05              BEQ NOML6
01354  CA02  E8                 INX
01355  CA03  8A                 TXA
01356  CA04  20 ED DA           JSR FINML6
01357  CA07  A4 71       NOML6  LDY FBUFPT
01358  CA09  C8                 INY
01359  CA0A  C0 06              CPY #6
01360  CA0C  D0 DF              BNE TIMELP
01361  CA0E  20 E2 DA           JSR MUL10
01362  CA11  20 9B DC           JSR QINT
01363  CA14  A6 64              LDX FACMO
01364  CA16  A4 63              LDY FACMOH
01365  CA18  A5 65              LDA FACLO
01366  CA1A  4C DB FF           JMP SETTIM
01367  CA1D  B1 22       TIMNUM LDA (INDEX)Y
01368  CA1F  20 80 00           JSR QNUM
01369  CA22  90 03              BCC GOTNUM
01370  CA24  4C 48 D2    FCERR2 JMP FCERR
01371  CA27  E9 2F       GOTNUM SBC #$2F
01372  CA29  4C 7E DD           JMP FINLOG
01373  CA2C  A0 02       GETSPT LDY #2
01374  CA2E  B1 64              LDA (FACMO)Y
01375  CA30  C5 34              CMP FRETOP+1
01376  CA32  90 17              BCC DNTCPY
01377  CA34  D0 07              BNE QVARIA
01378  CA36  88                 DEY
01379  CA37  B1 64              LDA (FACMO)Y
01380  CA39  C5 33              CMP FRETOP
01381  CA3B  90 0E              BCC DNTCPY
01382  CA3D  A4 65       QVARIA LDY FACLO
01383  CA3F  C4 2E              CPY VARTAB+1
01384  CA41  90 08              BCC DNTCPY
01385  CA43  D0 0D              BNE COPY
01386  CA45  A5 64              LDA FACMO
01387  CA47  C5 2D              CMP VARTAB
01388  CA49  B0 07              BCS COPY
01389  CA4B  A5 64       DNTCPY LDA FACMO
01390  CA4D  A4 65              LDY FACMO+1
01391  CA4F  4C 68 CA           JMP COPYC
01392  CA52  A0 00       COPY   LDY #0
01393  CA54  B1 64              LDA (FACMO)Y
01394  CA56  20 75 D4           JSR STRINI
01395  CA59  A5 50              LDA DSCPNT
01396  CA5B  A4 51              LDY DSCPNT+1
01397  CA5D  85 6F              STA STRNG1
01398  CA5F  84 70              STY STRNG1+1
01399  CA61  20 7A D6           JSR MOVINS






CODE6......PAGE 0021

LINE# LOC   CODE        LINE


01400  CA64  A9 61              LDA #<DSCTMP
01401  CA66  A0 00              LDY #>DSCTMP
01402  CA68  85 50       COPYC  STA DSCPNT
01403  CA6A  84 51              STY DSCPNT+1
01404  CA6C  20 DB D6           JSR FRETMS
01405  CA6F  A0 00              LDY #0
01406  CA71  B1 50              LDA (DSCPNT)Y
01407  CA73  91 49              STA (FORPNT)Y
01408  CA75  C8                 INY
01409  CA76  B1 50              LDA (DSCPNT)Y
01410  CA78  91 49              STA (FORPNT)Y
01411  CA7A  C8                 INY
01412  CA7B  B1 50              LDA (DSCPNT)Y
01413  CA7D  91 49              STA (FORPNT)Y
01414  CA7F  60                 RTS
01415  CA80  20 86 CA    PRINTN JSR CMD
01416  CA83  4C B5 CB           JMP IODONE
01417  CA86  20 9E D7    CMD    JSR GETBYT
01418  CA89  F0 05              BEQ SAVEIT
01419  CA8B  A9 2C              LDA #44
01420  CA8D  20 FF CE           JSR SYNCHR
01421  CA90  08          SAVEIT PHP
01422  CA91  86 13              STX CHANNL
01423  CA93  20 15 E1           JSR COOUT
01424  CA96  28                 PLP
01425  CA97  4C A0 CA           JMP PRINT
01426  CA9A  20 21 CB    STRDON JSR STRPRT
01427  CA9D  20 79 00    NEWCHR JSR CHRGOT
01428  CAA0  F0 35       PRINT  BEQ CRDO
01429  CAA2  F0 43       PRINTC BEQ PRTRTS
01430  CAA4  C9 A3              CMP #TABTK
01431  CAA6  F0 50              BEQ TABER
01432  CAA8  C9 A6              CMP #SPCTK
01433  CAAA  18                 CLC
01434  CAAB  F0 4B              BEQ TABER
01435  CAAD  C9 2C              CMP #44
01436  CAAF  F0 37              BEQ COMPRT
01437  CAB1  C9 3B              CMP #59
01438  CAB3  F0 5E              BEQ NOTABR
01439  CAB5  20 9E CD           JSR FRMEVL
01440  CAB8  24 0D              BIT VALTYP
01441  CABA  30 DE              BMI STRDON
01442  CABC  20 DD DD           JSR FOUT
01443  CABF  20 87 D4           JSR STRLIT
01444  CAC2  20 21 CB           JSR STRPRT
01445  CAC5  20 3B CB           JSR OUTSPC
01446  CAC8  D0 D3              BNE NEWCHR
01447  CACA  A9 00       FININL LDA #0
01448  CACC  9D 00 02           STA BUF,X
01449  CACF              ZZ5=BUF-1
01450  CACF  A2 FF              LDX #<ZZ5
01451  CAD1  A0 01              LDY #>ZZ5
01452  CAD3  A5 13              LDA CHANNL
01453  CAD5  D0 10              BNE PRTRTS
01454  CAD7  A9 0D       CRDO   LDA #13






CODE6......PAGE 0022

LINE# LOC   CODE        LINE


01455  CAD9  20 47 CB           JSR OUTDO
01456  CADC  24 13              BIT CHANNL
01457  CADE  10 05              BPL CRFIN
01458  CAE0              ;
01459  CAE0  A9 0A              LDA #10
01460  CAE2  20 47 CB           JSR OUTDO
01461  CAE5  49 FF       CRFIN  EOR #255
01462  CAE7  60          PRTRTS RTS
01463  CAE8  38          COMPRT SEC
01464  CAE9  20 F0 FF           JSR PLOT        ;GET TAB POSITION IN X
01465  CAEC  98                 TYA
01466  CAED              NCMPOS =@36
01467  CAED  38                 SEC
01468  CAEE  E9 0B       MORCO1 SBC #CLMWID
01469  CAF0  B0 FC              BCS MORCO1
01470  CAF2  49 FF              EOR #255
01471  CAF4  69 01              ADC #1
01472  CAF6  D0 16              BNE ASPAC
01473  CAF8  08          TABER  PHP
01474  CAF9  38                 SEC
01475  CAFA  20 F0 FF           JSR PLOT        ;READ TAB POSITION
01476  CAFD  84 09              STY TRMPOS
01477  CAFF  20 9B D7           JSR GTBYTC
01478  CB02  C9 29              CMP #41
01479  CB04  D0 59              BNE SNERR4
01480  CB06  28                 PLP
01481  CB07  90 06              BCC XSPAC
01482  CB09  8A                 TXA
01483  CB0A  E5 09              SBC TRMPOS
01484  CB0C  90 05              BCC NOTABR
01485  CB0E  AA          ASPAC  TAX
01486  CB0F  E8          XSPAC  INX
01487  CB10  CA          XSPAC2 DEX
01488  CB11  D0 06              BNE XSPAC1
01489  CB13  20 73 00    NOTABR JSR CHRGET
01490  CB16  4C A2 CA           JMP PRINTC
01491  CB19              .END
01492  CB19              .LIB   CODE7























CODE7......PAGE 0023

LINE# LOC   CODE        LINE


01494  CB19  20 3B CB    XSPAC1 JSR OUTSPC
01495  CB1C  D0 F2              BNE XSPAC2
01496  CB1E  20 87 D4    STROUT JSR STRLIT
01497  CB21  20 A6 D6    STRPRT JSR FREFAC
01498  CB24  AA                 TAX
01499  CB25  A0 00              LDY #0
01500  CB27  E8                 INX
01501  CB28  CA          STRPR2 DEX
01502  CB29  F0 BC              BEQ PRTRTS
01503  CB2B  B1 22              LDA (INDEX)Y
01504  CB2D  20 47 CB           JSR OUTDO
01505  CB30  C8                 INY
01506  CB31  C9 0D              CMP #13
01507  CB33  D0 F3              BNE STRPR2
01508  CB35  20 E5 CA           JSR CRFIN
01509  CB38  4C 28 CB           JMP STRPR2
01510  CB3B              OUTSPC
01511  CB3B  A5 13              LDA CHANNL
01512  CB3D  F0 03              BEQ CRTSKP
01513  CB3F  A9 20              LDA #' 
01514  CB41  2C                 .BYT $2C
01515  CB42  A9 1D       CRTSKP LDA #29
01516  CB44  2C                 .BYT $2C
01517  CB45  A9 3F       OUTQST LDA #'?
01518  CB47  20 09 E1    OUTDO  JSR OUTCH
01519  CB4A  29 FF       OUTRTS AND #255
01520  CB4C  60                 RTS
01521  CB4D  A5 11       TRMNOK LDA INPFLG
01522  CB4F  F0 11              BEQ TRMNO1
01523  CB51  30 04              BMI GETDTL
01524  CB53  A0 FF              LDY #255
01525  CB55  D0 04              BNE STCURL
01526  CB57  A5 3F       GETDTL LDA DATLIN
01527  CB59  A4 40              LDY DATLIN+1
01528  CB5B  85 39       STCURL STA CURLIN
01529  CB5D  84 3A              STY CURLIN+1
01530  CB5F  4C 08 CF    SNERR4 JMP SNERR
01531  CB62  A5 13       TRMNO1 LDA CHANNL
01532  CB64  F0 05              BEQ DOAGIN
01533  CB66  A2 18              LDX #ERRBD
01534  CB68  4C 37 C4           JMP ERROR
01535  CB6B  A9 0C       DOAGIN LDA #<TRYAGN
01536  CB6D  A0 CD              LDY #>TRYAGN
01537  CB6F  20 1E CB           JSR STROUT
01538  CB72  A5 3D              LDA OLDTXT
01539  CB74  A4 3E              LDY OLDTXT+1
01540  CB76  85 7A              STA TXTPTR
01541  CB78  84 7B              STY TXTPTR+1
01542  CB7A  60                 RTS
01543  CB7B  20 A6 D3    GET    JSR ERRDIR
01544  CB7E  C9 23              CMP #'#
01545  CB80  D0 10              BNE GETTTY
01546  CB82  20 73 00           JSR CHRGET
01547  CB85  20 9E D7           JSR GETBYT
01548  CB88  A9 2C              LDA #44






CODE7......PAGE 0024

LINE# LOC   CODE        LINE


01549  CB8A  20 FF CE           JSR SYNCHR
01550  CB8D  86 13              STX CHANNL
01551  CB8F  20 1B E1           JSR COIN
01552  CB92              ZZ2=BUF+1
01553  CB92  A2 01       GETTTY LDX #<ZZ2
01554  CB94              ZZ3=BUF+2
01555  CB94  A0 02              LDY #>ZZ3
01556  CB96  A9 00              LDA #0
01557  CB98  8D 01 02           STA BUF+1
01558  CB9B  A9 40              LDA #64
01559  CB9D  20 0F CC           JSR INPCO1
01560  CBA0  A6 13              LDX CHANNL
01561  CBA2  D0 13              BNE IORELE
01562  CBA4  60                 RTS
01563  CBA5  20 9E D7    INPUTN JSR GETBYT
01564  CBA8  A9 2C              LDA #44
01565  CBAA  20 FF CE           JSR SYNCHR
01566  CBAD  86 13              STX CHANNL
01567  CBAF  20 1B E1           JSR COIN
01568  CBB2  20 CE CB           JSR NOTQTI
01569  CBB5  A5 13       IODONE LDA CHANNL
01570  CBB7  20 CC FF    IORELE JSR CLSCHN
01571  CBBA  A2 00              LDX #0
01572  CBBC  86 13              STX CHANNL
01573  CBBE  60                 RTS
01574  CBBF  C9 22       INPUT  CMP #34
01575  CBC1  D0 0B              BNE NOTQTI
01576  CBC3  20 BD CE           JSR STRTXT
01577  CBC6  A9 3B              LDA #59
01578  CBC8  20 FF CE           JSR SYNCHR
01579  CBCB  20 21 CB           JSR STRPRT
01580  CBCE  20 A6 D3    NOTQTI JSR ERRDIR
01581  CBD1  A9 2C              LDA #44
01582  CBD3  8D FF 01           STA BUF-1
01583  CBD6  20 F9 CB    GETAGN JSR QINLIN
01584  CBD9  A5 13              LDA CHANNL
01585  CBDB  F0 0D              BEQ BUFFUL
01586  CBDD  20 B7 FF           JSR READST
01587  CBE0  29 02              AND #2
01588  CBE2  F0 06              BEQ BUFFUL
01589  CBE4  20 B5 CB           JSR IODONE
01590  CBE7  4C F8 C8           JMP DATA
01591  CBEA  AD 00 02    BUFFUL LDA BUF
01592  CBED  D0 1E              BNE INPCON
01593  CBEF  A5 13              LDA CHANNL
01594  CBF1  D0 E3              BNE GETAGN
01595  CBF3  20 06 C9           JSR DATAN
01596  CBF6  4C FB C8           JMP ADDON
01597  CBF9  A5 13       QINLIN LDA CHANNL
01598  CBFB  D0 06              BNE GINLIN
01599  CBFD  20 45 CB           JSR OUTQST
01600  CC00  20 3B CB           JSR OUTSPC
01601  CC03  4C 60 C5    GINLIN JMP INLIN
01602  CC06  A6 41       READ   LDX DATPTR
01603  CC08  A4 42              LDY DATPTR+1






CODE7......PAGE 0025

LINE# LOC   CODE        LINE


01604  CC0A  A9                 .BYT $A9
01605  CC0B  98                 TYA
01606  CC0C  2C                 .BYT $2C
01607  CC0D  A9 00       INPCON LDA #0
01608  CC0F  85 11       INPCO1 STA INPFLG
01609  CC11  86 43              STX INPPTR
01610  CC13  84 44              STY INPPTR+1
01611  CC15  20 8B D0    INLOOP JSR PTRGET
01612  CC18  85 49              STA FORPNT
01613  CC1A  84 4A              STY FORPNT+1
01614  CC1C  A5 7A              LDA TXTPTR
01615  CC1E  A4 7B              LDY TXTPTR+1
01616  CC20  85 4B              STA VARTXT
01617  CC22  84 4C              STY VARTXT+1
01618  CC24  A6 43              LDX INPPTR
01619  CC26  A4 44              LDY INPPTR+1
01620  CC28  86 7A              STX TXTPTR
01621  CC2A  84 7B              STY TXTPTR+1
01622  CC2C  20 79 00           JSR CHRGOT
01623  CC2F  D0 20              BNE DATBK1
01624  CC31  24 11              BIT INPFLG
01625  CC33  50 0C              BVC QDATA
01626  CC35  20 21 E1           JSR CGETL
01627  CC38  8D 00 02           STA BUF
01628  CC3B              ZZ4=BUF-1
01629  CC3B  A2 FF              LDX #<ZZ4
01630  CC3D  A0 01              LDY #>ZZ4
01631  CC3F  D0 0C              BNE DATBK
01632  CC41  30 75       QDATA  BMI DATLOP
01633  CC43  A5 13              LDA CHANNL
01634  CC45  D0 03              BNE GETNTH
01635  CC47  20 45 CB           JSR OUTQST
01636  CC4A  20 F9 CB    GETNTH JSR QINLIN
01637  CC4D  86 7A       DATBK  STX TXTPTR
01638  CC4F  84 7B              STY TXTPTR+1
01639  CC51              .END
01640  CC51              .LIB   CODE8
























CODE8......PAGE 0026

LINE# LOC   CODE        LINE


01642  CC51  20 73 00    DATBK1 JSR CHRGET
01643  CC54  24 0D              BIT VALTYP
01644  CC56  10 31              BPL NUMINS
01645  CC58  24 11              BIT INPFLG
01646  CC5A  50 09              BVC SETQUT
01647  CC5C  E8                 INX
01648  CC5D  86 7A              STX TXTPTR
01649  CC5F  A9 00              LDA #0
01650  CC61  85 07              STA CHARAC
01651  CC63  F0 0C              BEQ RESETC
01652  CC65  85 07       SETQUT STA CHARAC
01653  CC67  C9 22              CMP #34
01654  CC69  F0 07              BEQ NOWGET
01655  CC6B  A9 3A              LDA #':
01656  CC6D  85 07              STA CHARAC
01657  CC6F  A9 2C              LDA #44
01658  CC71  18          RESETC CLC
01659  CC72  85 08       NOWGET STA ENDCHR
01660  CC74  A5 7A              LDA TXTPTR
01661  CC76  A4 7B              LDY TXTPTR+1
01662  CC78  69 00              ADC #0
01663  CC7A  90 01              BCC NOWGE1
01664  CC7C  C8                 INY
01665  CC7D  20 8D D4    NOWGE1 JSR STRLT2
01666  CC80  20 E2 D7           JSR ST2TXT
01667  CC83  20 DA C9           JSR INPCOM
01668  CC86  4C 91 CC           JMP STRDN2
01669  CC89  20 F3 DC    NUMINS JSR FIN
01670  CC8C  A5 0E              LDA INTFLG
01671  CC8E  20 C2 C9           JSR QINTGR
01672  CC91  20 79 00    STRDN2 JSR CHRGOT
01673  CC94  F0 07              BEQ TRMOK
01674  CC96  C9 2C              CMP #44
01675  CC98  F0 03              BEQ *+5
01676  CC9A  4C 4D CB           JMP TRMNOK
01677  CC9D  A5 7A       TRMOK  LDA TXTPTR
01678  CC9F  A4 7B              LDY TXTPTR+1
01679  CCA1  85 43              STA INPPTR
01680  CCA3  84 44              STY INPPTR+1
01681  CCA5  A5 4B              LDA VARTXT
01682  CCA7  A4 4C              LDY VARTXT+1
01683  CCA9  85 7A              STA TXTPTR
01684  CCAB  84 7B              STY TXTPTR+1
01685  CCAD  20 79 00           JSR CHRGOT
01686  CCB0  F0 2D              BEQ VAREND
01687  CCB2  20 FD CE           JSR CHKCOM
01688  CCB5  4C 15 CC           JMP INLOOP
01689  CCB8  20 06 C9    DATLOP JSR DATAN
01690  CCBB  C8                 INY
01691  CCBC  AA                 TAX
01692  CCBD  D0 12              BNE NOWLIN
01693  CCBF  A2 0D              LDX #ERROD
01694  CCC1  C8                 INY
01695  CCC2  B1 7A              LDA (TXTPTR)Y
01696  CCC4  F0 6C              BEQ ERRGO5






CODE8......PAGE 0027

LINE# LOC   CODE        LINE


01697  CCC6  C8                 INY
01698  CCC7  B1 7A              LDA (TXTPTR)Y
01699  CCC9  85 3F              STA DATLIN
01700  CCCB  C8                 INY
01701  CCCC  B1 7A              LDA (TXTPTR)Y
01702  CCCE  C8                 INY
01703  CCCF  85 40              STA DATLIN+1
01704  CCD1  20 FB C8    NOWLIN JSR ADDON       ;TXTPTR+.Y
01705  CCD4  20 79 00           JSR CHRGOT      ;SPAN BLANKS
01706  CCD7  AA                 TAX             ;USED LATER
01707  CCD8  E0 83              CPX #DATATK
01708  CCDA  D0 DC              BNE DATLOP
01709  CCDC  4C 51 CC           JMP DATBK1
01710  CCDF  A5 43       VAREND LDA INPPTR
01711  CCE1  A4 44              LDY INPPTR+1
01712  CCE3  A6 11              LDX INPFLG
01713  CCE5  10 03              BPL VARY0
01714  CCE7  4C 27 C8           JMP RESFIN
01715  CCEA  A0 00       VARY0  LDY #0
01716  CCEC  B1 43              LDA (INPPTR)Y
01717  CCEE  F0 0B              BEQ INPRTS
01718  CCF0  A5 13              LDA CHANNL
01719  CCF2  D0 07              BNE INPRTS
01720  CCF4  A9 FC              LDA #<EXIGNT
01721  CCF6  A0 CC              LDY #>EXIGNT
01722  CCF8  4C 1E CB           JMP STROUT
01723  CCFB  60          INPRTS RTS
01724  CCFC  3F 45       EXIGNT .BYT '?EXTRA IGNORED'
01725  CD0A  0D                 .BYT $D
01726  CD0B  00                 .BYT 0
01727  CD0C  3F 52       TRYAGN .BYT '?REDO FROM START'
01728  CD1C  0D                 .BYT $D
01729  CD1D  00                 .BYT 0
01730  CD1E  D0 04       NEXT   BNE GETFOR
01731  CD20  A0 00              LDY #0
01732  CD22  F0 03              BEQ STXFOR
01733  CD24  20 8B D0    GETFOR JSR PTRGET
01734  CD27  85 49       STXFOR STA FORPNT
01735  CD29  84 4A              STY FORPNT+1
01736  CD2B  20 8A C3           JSR FNDFOR
01737  CD2E  F0 05              BEQ HAVFOR
01738  CD30  A2 0A              LDX #ERRNF
01739  CD32  4C 37 C4    ERRGO5 JMP ERROR       ;CHANGE
01740  CD35  9A          HAVFOR TXS
01741  CD36  8A                 TXA
01742  CD37  18                 CLC
01743  CD38  69 04              ADC #4
01744  CD3A  48                 PHA
01745  CD3B  69 06              ADC #5+ADDPRC
01746  CD3D  85 24              STA INDEX2
01747  CD3F  68                 PLA
01748  CD40  A0 01              LDY #1
01749  CD42  20 A2 DB           JSR MOVFM
01750  CD45  BA                 TSX
01751  CD46  BD 09 01           LDA ADDPRC+264,X






CODE8......PAGE 0028

LINE# LOC   CODE        LINE


01752  CD49  85 66              STA FACSGN
01753  CD4B  A5 49              LDA FORPNT
01754  CD4D  A4 4A              LDY FORPNT+1
01755  CD4F  20 67 D8           JSR FADD
01756  CD52  20 D0 DB           JSR MOVVF
01757  CD55  A0 01              LDY #1
01758  CD57  20 5D DC           JSR FCOMPN
01759  CD5A  BA                 TSX
01760  CD5B  38                 SEC
01761  CD5C  FD 09 01           SBC ADDPRC+264,X
01762  CD5F  F0 17              BEQ LOOPDN
01763  CD61  BD 0F 01           LDA 269+ADDPRC+ADDPRC,X
01764  CD64  85 39              STA CURLIN
01765  CD66  BD 10 01           LDA 270+ADDPRC+ADDPRC,X
01766  CD69  85 3A              STA CURLIN+1
01767  CD6B  BD 12 01           LDA 272+ADDPRC+ADDPRC,X
01768  CD6E  85 7A              STA TXTPTR
01769  CD70  BD 11 01           LDA 271+ADDPRC+ADDPRC,X
01770  CD73  85 7B              STA TXTPTR+1
01771  CD75  4C AE C7    NEWSGO JMP NEWSTT
01772  CD78  8A          LOOPDN TXA
01773  CD79  69 11              ADC #15+ADDPRC+ADDPRC
01774  CD7B  AA                 TAX
01775  CD7C  9A                 TXS 
01776  CD7D  20 79 00           JSR CHRGOT
01777  CD80  C9 2C              CMP #44
01778  CD82  D0 F1              BNE NEWSGO
01779  CD84  20 73 00           JSR CHRGET
01780  CD87  20 24 CD           JSR GETFOR
01781  CD8A  20 9E CD    FRMNUM JSR FRMEVL
01782  CD8D  18          CHKNUM CLC
01783  CD8E  24                 .BYT $24
01784  CD8F  38          CHKSTR SEC
01785  CD90  24 0D       CHKVAL BIT VALTYP
01786  CD92              .END
01787  CD92              .LIB   CODE9

























CODE9......PAGE 0029

LINE# LOC   CODE        LINE


01789  CD92  30 03              BMI DOCSTR
01790  CD94  B0 03              BCS CHKERR
01791  CD96  60          CHKOK  RTS
01792  CD97  B0 FD       DOCSTR BCS CHKOK
01793  CD99  A2 16       CHKERR LDX #ERRTM
01794  CD9B  4C 37 C4    ERRGO4 JMP ERROR
01795  CD9E  A6 7A       FRMEVL LDX TXTPTR
01796  CDA0  D0 02              BNE FRMEV1
01797  CDA2  C6 7B              DEC TXTPTR+1
01798  CDA4  C6 7A       FRMEV1 DEC TXTPTR
01799  CDA6  A2 00              LDX #0
01800  CDA8  24                 .BYT $24
01801  CDA9  48          LPOPER PHA
01802  CDAA  8A                 TXA
01803  CDAB  48                 PHA
01804  CDAC  A9 01              LDA #1
01805  CDAE  20 FB C3           JSR GETSTK
01806  CDB1  20 83 CE           JSR EVAL
01807  CDB4  A9 00              LDA #0
01808  CDB6  85 4D              STA OPMASK
01809  CDB8  20 79 00    TSTOP  JSR CHRGOT
01810  CDBB  38          LOPREL SEC
01811  CDBC  E9 B1              SBC #GREATK
01812  CDBE  90 17              BCC ENDREL
01813  CDC0  C9 03              CMP #LESSTK-GREATK+1
01814  CDC2  B0 13              BCS ENDREL
01815  CDC4  C9 01              CMP #1
01816  CDC6  2A                 ROL A
01817  CDC7  49 01              EOR #1
01818  CDC9  45 4D              EOR OPMASK
01819  CDCB  C5 4D              CMP OPMASK
01820  CDCD  90 61              BCC SNERR5
01821  CDCF  85 4D              STA OPMASK
01822  CDD1  20 73 00           JSR CHRGET
01823  CDD4  4C BB CD           JMP LOPREL
01824  CDD7  A6 4D       ENDREL LDX OPMASK
01825  CDD9  D0 2C              BNE FINREL
01826  CDDB  B0 7B              BCS QOP
01827  CDDD  69 07              ADC #GREATK-PLUSTK
01828  CDDF  90 77              BCC QOP
01829  CDE1  65 0D              ADC VALTYP
01830  CDE3  D0 03              BNE *+5
01831  CDE5  4C 3D D6           JMP CAT
01832  CDE8  69 FF              ADC #$FF
01833  CDEA  85 22              STA INDEX1
01834  CDEC  0A                 ASL A
01835  CDED  65 22              ADC INDEX1
01836  CDEF  A8                 TAY 
01837  CDF0  68          QPREC  PLA
01838  CDF1  D9 80 C0           CMP OPTAB,Y
01839  CDF4  B0 67              BCS QCHNUM
01840  CDF6  20 8D CD           JSR CHKNUM
01841  CDF9  48          DOPREC PHA
01842  CDFA  20 20 CE    NEGPRC JSR DOPRE1
01843  CDFD  68                 PLA






CODE9......PAGE 002A

LINE# LOC   CODE        LINE


01844  CDFE  A4 4B              LDY OPPTR
01845  CE00  10 17              BPL QPREC1
01846  CE02  AA                 TAX
01847  CE03  F0 56              BEQ QOPGO
01848  CE05  D0 5F              BNE PULSTK
01849  CE07  46 0D       FINREL LSR VALTYP
01850  CE09  8A                 TXA
01851  CE0A  2A                 ROL A
01852  CE0B  A6 7A              LDX TXTPTR
01853  CE0D  D0 02              BNE FINRE2
01854  CE0F  C6 7B              DEC TXTPTR+1
01855  CE11  C6 7A       FINRE2 DEC TXTPTR
01856  CE13  A0 1B              LDY #PTDORL-OPTAB
01857  CE15  85 4D              STA OPMASK
01858  CE17  D0 D7              BNE QPREC
01859  CE19  D9 80 C0    QPREC1 CMP OPTAB,Y
01860  CE1C  B0 48              BCS PULSTK
01861  CE1E  90 D9              BCC DOPREC
01862  CE20  B9 82 C0    DOPRE1 LDA OPTAB+2,Y
01863  CE23  48                 PHA
01864  CE24  B9 81 C0           LDA OPTAB+1,Y
01865  CE27  48                 PHA
01866  CE28  20 33 CE           JSR PUSHF1
01867  CE2B  A5 4D              LDA OPMASK
01868  CE2D  4C A9 CD           JMP LPOPER
01869  CE30  4C 08 CF    SNERR5 JMP SNERR
01870  CE33  A5 66       PUSHF1 LDA FACSGN
01871  CE35  BE 80 C0           LDX OPTAB,Y
01872  CE38  A8          PUSHF  TAY
01873  CE39  68                 PLA
01874  CE3A  85 22              STA INDEX1
01875  CE3C  E6 22              INC INDEX1
01876  CE3E  68                 PLA
01877  CE3F  85 23              STA INDEX1+1
01878  CE41  98                 TYA
01879  CE42  48                 PHA
01880  CE43  20 1B DC    FORPSH JSR ROUND
01881  CE46  A5 65              LDA FACLO
01882  CE48  48                 PHA
01883  CE49  A5 64              LDA FACMO
01884  CE4B  48                 PHA
01885  CE4C  A5 63              LDA FACMOH
01886  CE4E  48                 PHA
01887  CE4F  A5 62              LDA FACHO
01888  CE51  48                 PHA
01889  CE52  A5 61              LDA FACEXP
01890  CE54  48                 PHA
01891  CE55  6C 22 00           JMP (INDEX1)
01892  CE58  A0 FF       QOP    LDY #255
01893  CE5A  68                 PLA
01894  CE5B  F0 23       QOPGO  BEQ QOPRTS
01895  CE5D  C9 64       QCHNUM CMP #100
01896  CE5F  F0 03              BEQ UNPSTK
01897  CE61  20 8D CD           JSR CHKNUM
01898  CE64  84 4B       UNPSTK STY OPPTR






CODE9......PAGE 002B

LINE# LOC   CODE        LINE


01899  CE66  68          PULSTK PLA
01900  CE67  4A                 LSR A
01901  CE68  85 12              STA DOMASK
01902  CE6A  68                 PLA
01903  CE6B  85 69              STA ARGEXP
01904  CE6D  68                 PLA
01905  CE6E  85 6A              STA ARGHO
01906  CE70  68                 PLA
01907  CE71  85 6B              STA ARGMOH
01908  CE73  68                 PLA
01909  CE74  85 6C              STA ARGMO
01910  CE76  68                 PLA
01911  CE77  85 6D              STA ARGLO
01912  CE79  68                 PLA
01913  CE7A  85 6E              STA ARGSGN
01914  CE7C  45 66              EOR FACSGN
01915  CE7E  85 6F              STA ARISGN
01916  CE80  A5 61       QOPRTS LDA FACEXP
01917  CE82  60          UNPRTS RTS





01919  CE83  6C 0A 03    EVAL   JMP (IEVAL)
01920  CE86  A9 00       NEVAL  LDA #0
01921  CE88  85 0D              STA VALTYP
01922  CE8A  20 73 00    EVAL0  JSR CHRGET
01923  CE8D  B0 03              BCS EVAL2
01924  CE8F  4C F3 DC    EVAL1  JMP FIN
01925  CE92  20 13 D1    EVAL2  JSR ISLETC
01926  CE95  90 03              BCC *+5
01927  CE97  4C 28 CF           JMP ISVAR
01928  CE9A  C9 FF              CMP #PI
01929  CE9C  D0 0F              BNE QDOT
01930  CE9E  A9 A8              LDA #<PIVAL
01931  CEA0  A0 CE              LDY #>PIVAL
01932  CEA2  20 A2 DB           JSR MOVFM
01933  CEA5  4C 73 00           JMP CHRGET
01934  CEA8  82          PIVAL  .BYT @202
01935  CEA9  49                 .BYT @111
01936  CEAA  0F                 .BYT @017
01937  CEAB  DA                 .BYT @332
01938  CEAC  A1                 .BYT @241
01939  CEAD  C9 2E       QDOT   CMP #'.
01940  CEAF  F0 DE              BEQ EVAL1
01941  CEB1  C9 AB              CMP #MINUTK
01942  CEB3  F0 58              BEQ DOMIN
01943  CEB5  C9 AA              CMP #PLUSTK
01944  CEB7  F0 D1              BEQ EVAL0
01945  CEB9  C9 22              CMP #34
01946  CEBB  D0 0F              BNE EVAL3
01947  CEBD  A5 7A       STRTXT LDA TXTPTR
01948  CEBF  A4 7B              LDY TXTPTR+1
01949  CEC1  69 00              ADC #0






CODE9......PAGE 002C

LINE# LOC   CODE        LINE


01950  CEC3  90 01              BCC STRTX2
01951  CEC5  C8                 INY
01952  CEC6  20 87 D4    STRTX2 JSR STRLIT
01953  CEC9  4C E2 D7           JMP ST2TXT
01954  CECC  C9 A8       EVAL3  CMP #NOTTK
01955  CECE  D0 13              BNE EVAL4
01956  CED0  A0 18              LDY #24
01957  CED2  D0 3B              BNE GONPRC
01958  CED4  20 BF D1    NOTOP  JSR AYINT
01959  CED7  A5 65              LDA FACLO
01960  CED9  49 FF              EOR #255
01961  CEDB  A8                 TAY
01962  CEDC  A5 64              LDA FACMO
01963  CEDE  49 FF              EOR #255
01964  CEE0  4C 91 D3           JMP GIVAYF
01965  CEE3  C9 A5       EVAL4  CMP #FNTK
01966  CEE5  D0 03              BNE *+5
01967  CEE7  4C F4 D3           JMP FNDOER
01968  CEEA  C9 B4              CMP #ONEFUN
01969  CEEC  90 03              BCC PARCHK
01970  CEEE  4C A7 CF           JMP ISFUN
01971  CEF1  20 FA CE    PARCHK JSR CHKOPN
01972  CEF4  20 9E CD           JSR FRMEVL
01973  CEF7  A9 29       CHKCLS LDA #41
01974  CEF9  2C                 .BYT $2C
01975  CEFA  A9 28       CHKOPN LDA #40
01976  CEFC  2C                 .BYT $2C
01977  CEFD  A9 2C       CHKCOM LDA #44
01978  CEFF  A0 00       SYNCHR LDY #0
01979  CF01  D1 7A              CMP (TXTPTR)Y
01980  CF03  D0 03              BNE SNERR
01981  CF05  4C 73 00           JMP CHRGET
01982  CF08  A2 0B       SNERR  LDX #ERRSN
01983  CF0A  4C 37 C4           JMP ERROR
01984  CF0D  A0 15       DOMIN  LDY #21
01985  CF0F  68          GONPRC PLA
01986  CF10  68                 PLA
01987  CF11  4C FA CD           JMP NEGPRC
01988  CF14              .END
01989  CF14              .LIB   CODE10





















CODE10......PAGE 002D

LINE# LOC   CODE        LINE


01991  CF14              ;TEST POINTER TO VARIABLE TO SEE
01992  CF14              ;IF CONSTANT IS CONTAINED IN BASIC.
01993  CF14              ;ARRAY VARIABLES HAVE ZEROES PLACED
01994  CF14              ;IN RAM. UNDEFINED SIMPLE VARIABLES
01995  CF14              ;HAVE POINTER T ZERO IN BASIC.
01996  CF14              ;
01997  CF14  38          TSTROM SEC
01998  CF15  A5 64              LDA FACMO
01999  CF17  E9 00              SBC #<ROMLOC
02000  CF19  A5 65              LDA FACLO
02001  CF1B  E9 C0              SBC #>ROMLOC
02002  CF1D  90 08              BCC TSTR10
02003  CF1F              ;
02004  CF1F  A9 87              LDA #<INITAT
02005  CF21  E5 64              SBC FACMO
02006  CF23  A9 E3              LDA #>INITAT
02007  CF25  E5 65              SBC FACLO
02008  CF27              ;
02009  CF27  60          TSTR10 RTS





02011  CF28  20 8B D0    ISVAR  JSR PTRGET
02012  CF2B  85 64       ISVRET STA FACMO
02013  CF2D  84 65              STY FACMO+1
02014  CF2F  A6 45              LDX VARNAM
02015  CF31  A4 46              LDY VARNAM+1
02016  CF33  A5 0D              LDA VALTYP
02017  CF35  F0 26              BEQ GOOO
02018  CF37  A9 00              LDA #0
02019  CF39  85 70              STA FACOV
02020  CF3B  20 14 CF           JSR TSTROM      ;SEE IF AN ARRAY
02021  CF3E  90 1C              BCC STRRTS      ;DON'T TEST ST(I),TI(I)
02022  CF40  E0 54              CPX #'T
02023  CF42  D0 18              BNE STRRTS
02024  CF44  C0 C9              CPY #$C9
02025  CF46  D0 14              BNE STRRTS
02026  CF48  20 84 CF           JSR GETTIM
02027  CF4B  84 5E              STY TENEXP
02028  CF4D  88                 DEY
02029  CF4E  84 71              STY FBUFPT
02030  CF50  A0 06              LDY #6
02031  CF52  84 5D              STY DECCNT
02032  CF54  A0 24              LDY #FDCEND-FOUTBL
02033  CF56  20 68 DE           JSR FOUTIM
02034  CF59  4C 6F D4           JMP TIMSTR
02035  CF5C  60          STRRTS RTS
02036  CF5D  24 0E       GOOO   BIT INTFLG
02037  CF5F  10 0D              BPL GOOOOO
02038  CF61  A0 00              LDY #0
02039  CF63  B1 64              LDA (FACMO)Y
02040  CF65  AA                 TAX
02041  CF66  C8                 INY






CODE10......PAGE 002E

LINE# LOC   CODE        LINE


02042  CF67  B1 64              LDA (FACMO)Y
02043  CF69  A8                 TAY
02044  CF6A  8A                 TXA
02045  CF6B  4C 91 D3           JMP GIVAYF
02046  CF6E  20 14 CF    GOOOOO JSR TSTROM      ;SEE IF ARRAY
02047  CF71  90 2D              BCC GOMOVF      ;DON'T TEST ST(I),TI(I)
02048  CF73  E0 54              CPX #'T
02049  CF75  D0 1B              BNE QSTATV
02050  CF77  C0 49              CPY #'I
02051  CF79  D0 25              BNE GOMOVF
02052  CF7B  20 84 CF           JSR GETTIM
02053  CF7E  98                 TYA
02054  CF7F  A2 A0              LDX #160
02055  CF81  4C 4F DC           JMP FLOATB
02056  CF84  20 DE FF    GETTIM JSR RDTIM
02057  CF87  86 64              STX FACMO
02058  CF89  84 63              STY FACMOH
02059  CF8B  85 65              STA FACLO
02060  CF8D  A0 00              LDY #0
02061  CF8F  84 62              STY FACHO
02062  CF91  60                 RTS
02063  CF92  E0 53       QSTATV CPX #'S
02064  CF94  D0 0A              BNE GOMOVF
02065  CF96  C0 54              CPY #'T
02066  CF98  D0 06              BNE GOMOVF
02067  CF9A  20 B7 FF           JSR READST
02068  CF9D  4C 3C DC           JMP FLOAT
02069  CFA0  A5 64       GOMOVF LDA FACMO
02070  CFA2  A4 65              LDY FACMO+1
02071  CFA4  4C A2 DB           JMP MOVFM
02072  CFA7  0A          ISFUN  ASL A
02073  CFA8  48                 PHA
02074  CFA9  AA                 TAX
02075  CFAA  20 73 00           JSR CHRGET
02076  CFAD  E0 8F              CPX #LASNUM+LASNUM-255
02077  CFAF  90 20              BCC OKNORM
02078  CFB1  20 FA CE           JSR CHKOPN
02079  CFB4  20 9E CD           JSR FRMEVL
02080  CFB7  20 FD CE           JSR CHKCOM
02081  CFBA  20 8F CD           JSR CHKSTR
02082  CFBD  68                 PLA
02083  CFBE  AA                 TAX
02084  CFBF  A5 65              LDA FACMO+1
02085  CFC1  48                 PHA
02086  CFC2  A5 64              LDA FACMO
02087  CFC4  48                 PHA
02088  CFC5  8A                 TXA
02089  CFC6  48                 PHA
02090  CFC7  20 9E D7           JSR GETBYT
02091  CFCA  68                 PLA
02092  CFCB  A8                 TAY
02093  CFCC  8A                 TXA
02094  CFCD  48                 PHA
02095  CFCE  4C D6 CF           JMP FINGO
02096  CFD1  20 F1 CE    OKNORM JSR PARCHK






CODE10......PAGE 002F

LINE# LOC   CODE        LINE


02097  CFD4  68                 PLA
02098  CFD5  A8                 TAY
02099  CFD6  B9 EA BF    FINGO  LDA FUNDSP-ONEFUN-ONEFUN+256,Y
02100  CFD9  85 55              STA JMPER+1
02101  CFDB  B9 EB BF           LDA FUNDSP-ONEFUN-ONEFUN+257,Y
02102  CFDE  85 56              STA JMPER+2
02103  CFE0  20 54 00           JSR JMPER
02104  CFE3  4C 8D CD           JMP CHKNUM
02105  CFE6  A0 FF       OROP   LDY #255
02106  CFE8  2C                 .BYT $2C
02107  CFE9  A0 00       ANDOP  LDY #0
02108  CFEB  84 0B              STY COUNT
02109  CFED  20 BF D1           JSR AYINT
02110  CFF0  A5 64              LDA FACMO
02111  CFF2  45 0B              EOR COUNT
02112  CFF4  85 07              STA INTEGR
02113  CFF6  A5 65              LDA FACLO
02114  CFF8  45 0B              EOR COUNT
02115  CFFA  85 08              STA INTEGR+1
02116  CFFC  20 FC DB           JSR MOVFA
02117  CFFF  20 BF D1           JSR AYINT
02118  D002  A5 65              LDA FACLO
02119  D004  45 0B              EOR COUNT
02120  D006  25 08              AND INTEGR+1
02121  D008  45 0B              EOR COUNT
02122  D00A  A8                 TAY
02123  D00B  A5 64              LDA FACMO
02124  D00D  45 0B              EOR COUNT
02125  D00F  25 07              AND INTEGR
02126  D011  45 0B              EOR COUNT
02127  D013  4C 91 D3           JMP GIVAYF
02128  D016  20 90 CD    DOREL  JSR CHKVAL
02129  D019  B0 13              BCS STRCMP
02130  D01B  A5 6E              LDA ARGSGN
02131  D01D  09 7F              ORA #127
02132  D01F  25 6A              AND ARGHO
02133  D021  85 6A              STA ARGHO
02134  D023  A9 69              LDA #<ARGEXP
02135  D025  A0 00              LDY #>ARGEXP
02136  D027  20 5B DC           JSR FCOMP
02137  D02A  AA                 TAX
02138  D02B  4C 61 D0           JMP QCOMP
02139  D02E  A9 00       STRCMP LDA #0
02140  D030  85 0D              STA VALTYP
02141  D032  C6 4D              DEC OPMASK
02142  D034  20 A6 D6           JSR FREFAC
02143  D037  85 61              STA DSCTMP
02144  D039  86 62              STX DSCTMP+1
02145  D03B  84 63              STY DSCTMP+2
02146  D03D  A5 6C              LDA ARGMO
02147  D03F  A4 6D              LDY ARGMO+1
02148  D041  20 AA D6           JSR FRETMP
02149  D044  86 6C              STX ARGMO
02150  D046  84 6D              STY ARGMO+1
02151  D048  AA                 TAX






CODE10......PAGE 0030

LINE# LOC   CODE        LINE


02152  D049  38                 SEC
02153  D04A  E5 61              SBC DSCTMP
02154  D04C  F0 08              BEQ STASGN
02155  D04E  A9 01              LDA #1
02156  D050  90 04              BCC STASGN
02157  D052  A6 61              LDX DSCTMP
02158  D054  A9 FF              LDA #$FF
02159  D056  85 66       STASGN STA FACSGN
02160  D058  A0 FF              LDY #255
02161  D05A  E8                 INX
02162  D05B  C8          NXTCMP INY
02163  D05C  CA                 DEX
02164  D05D  D0 07              BNE GETCMP
02165  D05F  A6 66              LDX FACSGN
02166  D061  30 0F       QCOMP  BMI DOCMP
02167  D063  18                 CLC
02168  D064  90 0C              BCC DOCMP
02169  D066  B1 6C       GETCMP LDA (ARGMO)Y
02170  D068              .END
02171  D068              .LIB   CODE11









































CODE11......PAGE 0031

LINE# LOC   CODE        LINE


02173  D068  D1 62              CMP (DSCTMP+1)Y
02174  D06A  F0 EF              BEQ NXTCMP
02175  D06C  A2 FF              LDX #$FF
02176  D06E  B0 02              BCS DOCMP
02177  D070  A2 01              LDX #1
02178  D072  E8          DOCMP  INX
02179  D073  8A                 TXA
02180  D074  2A                 ROL A
02181  D075  25 12              AND DOMASK
02182  D077  F0 02              BEQ GOFLOT
02183  D079  A9 FF              LDA #$FF
02184  D07B  4C 3C DC    GOFLOT JMP FLOAT
02185  D07E  20 FD CE    DIM3   JSR CHKCOM
02186  D081  AA          DIM    TAX
02187  D082  20 90 D0           JSR PTRGT1
02188  D085  20 79 00           JSR CHRGOT
02189  D088  D0 F4              BNE DIM3
02190  D08A  60                 RTS
02191  D08B  A2 00       PTRGET LDX #0
02192  D08D  20 79 00           JSR CHRGOT
02193  D090  86 0C       PTRGT1 STX DIMFLG
02194  D092  85 45       PTRGT2 STA VARNAM
02195  D094  20 79 00           JSR CHRGOT
02196  D097  20 13 D1           JSR ISLETC
02197  D09A  B0 03              BCS PTRGT3
02198  D09C  4C 08 CF    INTERR JMP SNERR
02199  D09F  A2 00       PTRGT3 LDX #0
02200  D0A1  86 0D              STX VALTYP
02201  D0A3  86 0E              STX INTFLG
02202  D0A5  20 73 00           JSR CHRGET
02203  D0A8  90 05              BCC ISSEC
02204  D0AA  20 13 D1           JSR ISLETC
02205  D0AD  90 0B              BCC NOSEC
02206  D0AF  AA          ISSEC  TAX
02207  D0B0  20 73 00    EATEM  JSR CHRGET
02208  D0B3  90 FB              BCC EATEM
02209  D0B5  20 13 D1           JSR ISLETC
02210  D0B8  B0 F6              BCS EATEM
02211  D0BA  C9 24       NOSEC  CMP #'$
02212  D0BC  D0 06              BNE NOTSTR
02213  D0BE  A9 FF              LDA #$FF
02214  D0C0  85 0D              STA VALTYP
02215  D0C2  D0 10              BNE TURNON
02216  D0C4  C9 25       NOTSTR CMP #'%
02217  D0C6  D0 13              BNE STRNAM
02218  D0C8  A5 10              LDA SUBFLG
02219  D0CA  D0 D0              BNE INTERR
02220  D0CC  A9 80              LDA #128
02221  D0CE  85 0E              STA INTFLG
02222  D0D0  05 45              ORA VARNAM
02223  D0D2  85 45              STA VARNAM
02224  D0D4  8A          TURNON TXA
02225  D0D5  09 80              ORA #128
02226  D0D7  AA                 TAX
02227  D0D8  20 73 00           JSR CHRGET






CODE11......PAGE 0032

LINE# LOC   CODE        LINE


02228  D0DB  86 46       STRNAM STX VARNAM+1
02229  D0DD  38                 SEC
02230  D0DE  05 10              ORA SUBFLG
02231  D0E0  E9 28              SBC #40
02232  D0E2  D0 03              BNE *+5
02233  D0E4  4C D1 D1           JMP ISARY
02234  D0E7  A0 00              LDY #0
02235  D0E9  84 10              STY SUBFLG
02236  D0EB  A5 2D              LDA VARTAB
02237  D0ED  A6 2E              LDX VARTAB+1
02238  D0EF  86 60       STXFND STX LOWTR+1
02239  D0F1  85 5F       LOPFND STA LOWTR
02240  D0F3  E4 30              CPX ARYTAB+1
02241  D0F5  D0 04              BNE LOPFN
02242  D0F7  C5 2F              CMP ARYTAB
02243  D0F9  F0 22              BEQ NOTFNS
02244  D0FB  A5 45       LOPFN  LDA VARNAM
02245  D0FD  D1 5F              CMP (LOWTR)Y
02246  D0FF  D0 08              BNE NOTIT
02247  D101  A5 46              LDA VARNAM+1
02248  D103  C8                 INY
02249  D104  D1 5F              CMP (LOWTR)Y
02250  D106  F0 7D              BEQ FINPTR
02251  D108  88                 DEY
02252  D109  18          NOTIT  CLC
02253  D10A  A5 5F              LDA LOWTR
02254  D10C  69 07              ADC #6+ADDPRC
02255  D10E  90 E1              BCC LOPFND
02256  D110  E8                 INX
02257  D111  D0 DC              BNE STXFND
02258  D113  C9 41       ISLETC CMP #'A
02259  D115  90 05              BCC ISLRTS
02260  D117  E9 5B              SBC #$5B
02261  D119  38                 SEC
02262  D11A  E9 A5              SBC #@245
02263  D11C  60          ISLRTS RTS
02264  D11D  68          NOTFNS PLA
02265  D11E  48                 PHA
02266  D11F              ZZ6=ISVRET-1
02267  D11F  C9 2A              CMP #<ZZ6 
02268  D121  D0 05              BNE NOTEVL
02269  D123  A9 13       LDZR   LDA #<ZERO
02270  D125  A0 DF              LDY #>ZERO
02271  D127  60                 RTS
02272  D128  A5 45       NOTEVL LDA VARNAM
02273  D12A  A4 46              LDY VARNAM+1
02274  D12C  C9 54              CMP #'T
02275  D12E  D0 0B              BNE QSTAVR
02276  D130  C0 C9              CPY #@311
02277  D132  F0 EF              BEQ LDZR
02278  D134  C0 49              CPY #@111
02279  D136  D0 03              BNE QSTAVR
02280  D138  4C 08 CF    GOBADV JMP SNERR
02281  D13B              QSTAVR
02282  D13B  C9 53              CMP #'S






CODE11......PAGE 0033

LINE# LOC   CODE        LINE


02283  D13D  D0 04              BNE VAROK
02284  D13F  C0 54              CPY #'T
02285  D141  F0 F5              BEQ GOBADV
02286  D143  A5 2F       VAROK  LDA ARYTAB
02287  D145  A4 30              LDY ARYTAB+1
02288  D147  85 5F              STA LOWTR
02289  D149  84 60              STY LOWTR+1
02290  D14B  A5 31              LDA STREND
02291  D14D  A4 32              LDY STREND+1
02292  D14F  85 5A              STA HIGHTR
02293  D151  84 5B              STY HIGHTR+1
02294  D153  18                 CLC
02295  D154  69 07              ADC #6+ADDPRC
02296  D156  90 01              BCC NOTEVE
02297  D158  C8                 INY
02298  D159  85 58       NOTEVE STA HIGHDS
02299  D15B  84 59              STY HIGHDS+1
02300  D15D  20 B8 C3           JSR BLTU
02301  D160  A5 58              LDA HIGHDS
02302  D162  A4 59              LDY HIGHDS+1
02303  D164  C8                 INY
02304  D165  85 2F              STA ARYTAB
02305  D167  84 30              STY ARYTAB+1
02306  D169  A0 00              LDY #0
02307  D16B  A5 45              LDA VARNAM
02308  D16D  91 5F              STA (LOWTR)Y
02309  D16F  C8                 INY
02310  D170  A5 46              LDA VARNAM+1
02311  D172  91 5F              STA (LOWTR)Y
02312  D174  A9 00              LDA #0
02313  D176  C8                 INY
02314  D177  91 5F              STA (LOWTR)Y
02315  D179  C8                 INY
02316  D17A  91 5F              STA (LOWTR)Y
02317  D17C  C8                 INY
02318  D17D  91 5F              STA (LOWTR)Y
02319  D17F  C8                 INY
02320  D180  91 5F              STA (LOWTR)Y
02321  D182  C8                 INY
02322  D183  91 5F              STA (LOWTR)Y
02323  D185  A5 5F       FINPTR LDA LOWTR
02324  D187  18                 CLC
02325  D188  69 02              ADC #2
02326  D18A  A4 60              LDY LOWTR+1
02327  D18C  90 01              BCC FINNOW
02328  D18E  C8                 INY
02329  D18F  85 47       FINNOW STA VARPNT
02330  D191  84 48              STY VARPNT+1
02331  D193  60                 RTS
02332  D194  A5 0B       FMAPTR LDA COUNT
02333  D196  0A                 ASL A
02334  D197  69 05              ADC #5
02335  D199  65 5F              ADC LOWTR
02336  D19B  A4 60              LDY LOWTR+1
02337  D19D  90 01              BCC JSRGM






CODE11......PAGE 0034

LINE# LOC   CODE        LINE


02338  D19F  C8                 INY
02339  D1A0  85 58       JSRGM  STA ARYPNT
02340  D1A2  84 59              STY ARYPNT+1
02341  D1A4  60                 RTS
02342  D1A5              .END
02343  D1A5              .LIB   CODE12























































CODE12......PAGE 0035

LINE# LOC   CODE        LINE


02345  D1A5  90          N32768 .BYT 144,128,0,0,0
02345  D1A6  80 
02345  D1A7  00 
02345  D1A8  00 
02345  D1A9  00 
02346  D1AA  20 BF D1    FLPINT JSR AYINT
02347  D1AD  A5 64              LDA FACMO
02348  D1AF  A4 65              LDY  FACLO
02349  D1B1  60                 RTS
02350  D1B2  20 73 00    INTIDX JSR CHRGET
02351  D1B5  20 9E CD           JSR FRMEVL
02352  D1B8  20 8D CD    POSINT JSR CHKNUM
02353  D1BB  A5 66              LDA FACSGN
02354  D1BD  30 0D              BMI NONONO
02355  D1BF  A5 61       AYINT  LDA FACEXP
02356  D1C1  C9 90              CMP #144
02357  D1C3  90 09              BCC QINTGO
02358  D1C5  A9 A5              LDA #<N32768
02359  D1C7  A0 D1              LDY #>N32768
02360  D1C9  20 5B DC           JSR FCOMP
02361  D1CC  D0 7A       NONONO BNE FCERR
02362  D1CE  4C 9B DC    QINTGO JMP QINT
02363  D1D1  A5 0C       ISARY  LDA DIMFLG
02364  D1D3  05 0E              ORA INTFLG
02365  D1D5  48                 PHA
02366  D1D6  A5 0D              LDA VALTYP
02367  D1D8  48                 PHA
02368  D1D9  A0 00              LDY #0
02369  D1DB  98          INDLOP TYA
02370  D1DC  48                 PHA
02371  D1DD  A5 46              LDA VARNAM+1
02372  D1DF  48                 PHA
02373  D1E0  A5 45              LDA VARNAM
02374  D1E2  48                 PHA
02375  D1E3  20 B2 D1           JSR INTIDX
02376  D1E6  68                 PLA
02377  D1E7  85 45              STA VARNAM
02378  D1E9  68                 PLA
02379  D1EA  85 46              STA VARNAM+1
02380  D1EC  68                 PLA
02381  D1ED  A8                 TAY
02382  D1EE  BA                 TSX
02383  D1EF  BD 02 01           LDA 258,X
02384  D1F2  48                 PHA
02385  D1F3  BD 01 01           LDA 257,X
02386  D1F6  48                 PHA
02387  D1F7  A5 64              LDA INDICE
02388  D1F9  9D 02 01           STA 258,X
02389  D1FC  A5 65              LDA INDICE+1
02390  D1FE  9D 01 01           STA 257,X
02391  D201  C8                 INY
02392  D202  20 79 00           JSR CHRGOT
02393  D205  C9 2C              CMP #44
02394  D207  F0 D2              BEQ INDLOP
02395  D209  84 0B              STY COUNT






CODE12......PAGE 0036

LINE# LOC   CODE        LINE


02396  D20B  20 F7 CE           JSR CHKCLS
02397  D20E  68                 PLA
02398  D20F  85 0D              STA VALTYP
02399  D211  68                 PLA
02400  D212  85 0E              STA INTFLG
02401  D214  29 7F              AND #127
02402  D216  85 0C              STA DIMFLG
02403  D218  A6 2F              LDX ARYTAB
02404  D21A  A5 30              LDA ARYTAB+1
02405  D21C  86 5F       LOPFDA STX LOWTR
02406  D21E  85 60              STA LOWTR+1
02407  D220  C5 32              CMP STREND+1
02408  D222  D0 04              BNE LOPFDV
02409  D224  E4 31              CPX STREND
02410  D226  F0 39              BEQ NOTFDD
02411  D228  A0 00       LOPFDV LDY #0
02412  D22A  B1 5F              LDA (LOWTR)Y
02413  D22C  C8                 INY
02414  D22D  C5 45              CMP VARNAM
02415  D22F  D0 06              BNE NMARY1
02416  D231  A5 46              LDA VARNAM+1
02417  D233  D1 5F              CMP (LOWTR)Y
02418  D235  F0 16              BEQ GOTARY
02419  D237  C8          NMARY1 INY
02420  D238  B1 5F              LDA (LOWTR)Y
02421  D23A  18                 CLC
02422  D23B  65 5F              ADC LOWTR
02423  D23D  AA                 TAX
02424  D23E  C8                 INY
02425  D23F  B1 5F              LDA (LOWTR)Y
02426  D241  65 60              ADC LOWTR+1
02427  D243  90 D7              BCC LOPFDA
02428  D245  A2 12       BSERR  LDX #ERRBS
02429  D247  2C                 .BYT $2C
02430  D248  A2 0E       FCERR  LDX #ERRFC
02431  D24A  4C 37 C4    ERRGO3 JMP ERROR
02432  D24D  A2 13       GOTARY LDX #ERRDD
02433  D24F  A5 0C              LDA DIMFLG
02434  D251  D0 F7              BNE ERRGO3
02435  D253  20 94 D1           JSR FMAPTR
02436  D256  A5 0B              LDA COUNT
02437  D258  A0 04              LDY #4
02438  D25A  D1 5F              CMP (LOWTR)Y
02439  D25C  D0 E7              BNE BSERR
02440  D25E  4C EA D2           JMP GETDEF
02441  D261  20 94 D1    NOTFDD JSR FMAPTR
02442  D264  20 08 C4           JSR REASON
02443  D267  A0 00              LDY #0
02444  D269  84 72              STY CURTOL+1
02445  D26B  A2 05              LDX #5
02446  D26D  A5 45              LDA VARNAM
02447  D26F  91 5F              STA (LOWTR)Y
02448  D271  10 01              BPL NOTFLT
02449  D273  CA                 DEX
02450  D274  C8          NOTFLT INY






CODE12......PAGE 0037

LINE# LOC   CODE        LINE


02451  D275  A5 46              LDA VARNAM+1
02452  D277  91 5F              STA (LOWTR)Y
02453  D279  10 02              BPL STOMLT
02454  D27B  CA                 DEX
02455  D27C  CA                 DEX
02456  D27D  86 71       STOMLT STX CURTOL
02457  D27F  A5 0B              LDA COUNT
02458  D281  C8                 INY
02459  D282  C8                 INY
02460  D283  C8                 INY
02461  D284  91 5F              STA (LOWTR)Y
02462  D286  A2 0B       LOPPTA LDX #11
02463  D288  A9 00              LDA #0
02464  D28A  24 0C              BIT DIMFLG
02465  D28C  50 08              BVC NOTDIM
02466  D28E  68                 PLA
02467  D28F  18                 CLC
02468  D290  69 01              ADC #1
02469  D292  AA                 TAX
02470  D293  68                 PLA
02471  D294  69 00              ADC #0
02472  D296  C8          NOTDIM INY
02473  D297  91 5F              STA (LOWTR)Y
02474  D299  C8                 INY
02475  D29A  8A                 TXA
02476  D29B  91 5F              STA (LOWTR)Y
02477  D29D  20 4C D3           JSR UMULT
02478  D2A0  86 71              STX CURTOL
02479  D2A2  85 72              STA CURTOL+1
02480  D2A4  A4 22              LDY INDEX
02481  D2A6  C6 0B              DEC COUNT
02482  D2A8  D0 DC              BNE LOPPTA
02483  D2AA  65 59              ADC ARYPNT+1
02484  D2AC  B0 5D              BCS OMERR1
02485  D2AE  85 59              STA ARYPNT+1
02486  D2B0  A8                 TAY
02487  D2B1  8A                 TXA
02488  D2B2  65 58              ADC ARYPNT
02489  D2B4  90 03              BCC GREASE
02490  D2B6  C8                 INY
02491  D2B7  F0 52              BEQ OMERR1
02492  D2B9  20 08 C4    GREASE JSR REASON
02493  D2BC  85 31              STA STREND
02494  D2BE  84 32              STY STREND+1
02495  D2C0  A9 00              LDA #0
02496  D2C2  E6 72              INC CURTOL+1
02497  D2C4              .END
02498  D2C4              .LIB   CODE13













CODE13......PAGE 0038

LINE# LOC   CODE        LINE


02500  D2C4  A4 71              LDY CURTOL
02501  D2C6  F0 05              BEQ DECCUR
02502  D2C8  88          ZERITA DEY
02503  D2C9  91 58              STA (ARYPNT)Y
02504  D2CB  D0 FB              BNE ZERITA
02505  D2CD  C6 59       DECCUR DEC ARYPNT+1
02506  D2CF  C6 72              DEC CURTOL+1
02507  D2D1  D0 F5              BNE ZERITA
02508  D2D3  E6 59              INC ARYPNT+1
02509  D2D5  38                 SEC
02510  D2D6  A5 31              LDA STREND
02511  D2D8  E5 5F              SBC LOWTR
02512  D2DA  A0 02              LDY #2
02513  D2DC  91 5F              STA (LOWTR)Y
02514  D2DE  A5 32              LDA STREND+1
02515  D2E0  C8                 INY
02516  D2E1  E5 60              SBC LOWTR+1
02517  D2E3  91 5F              STA (LOWTR)Y
02518  D2E5  A5 0C              LDA DIMFLG
02519  D2E7  D0 62              BNE DIMRTS
02520  D2E9  C8                 INY
02521  D2EA  B1 5F       GETDEF LDA (LOWTR)Y
02522  D2EC  85 0B              STA COUNT
02523  D2EE  A9 00              LDA #0
02524  D2F0  85 71              STA CURTOL
02525  D2F2  85 72       INLPNM STA CURTOL+1
02526  D2F4  C8                 INY
02527  D2F5  68                 PLA
02528  D2F6  AA                 TAX
02529  D2F7  85 64              STA INDICE
02530  D2F9  68                 PLA
02531  D2FA  85 65              STA INDICE+1
02532  D2FC  D1 5F              CMP (LOWTR)Y
02533  D2FE  90 0E              BCC INLPN2
02534  D300  D0 06              BNE BSERR7
02535  D302  C8                 INY
02536  D303  8A                 TXA
02537  D304  D1 5F              CMP (LOWTR)Y
02538  D306  90 07              BCC INLPN1
02539  D308  4C 45 D2    BSERR7 JMP BSERR
02540  D30B  4C 35 C4    OMERR1 JMP OMERR
02541  D30E  C8          INLPN2 INY
02542  D30F  A5 72       INLPN1 LDA CURTOL+1
02543  D311  05 71              ORA CURTOL
02544  D313  18                 CLC
02545  D314  F0 0A              BEQ ADDIND
02546  D316  20 4C D3           JSR UMULT
02547  D319  8A                 TXA
02548  D31A  65 64              ADC INDICE
02549  D31C  AA                 TAX
02550  D31D  98                 TYA
02551  D31E  A4 22              LDY INDEX1
02552  D320  65 65       ADDIND ADC INDICE+1
02553  D322  86 71              STX CURTOL
02554  D324  C6 0B              DEC COUNT






CODE13......PAGE 0039

LINE# LOC   CODE        LINE


02555  D326  D0 CA              BNE INLPNM
02556  D328  85 72              STA CURTOL+1
02557  D32A  A2 05              LDX #5
02558  D32C  A5 45              LDA VARNAM
02559  D32E  10 01              BPL NOTFL1
02560  D330  CA                 DEX
02561  D331  A5 46       NOTFL1 LDA VARNAM+1
02562  D333  10 02              BPL STOML1
02563  D335  CA                 DEX
02564  D336  CA                 DEX
02565  D337  86 28       STOML1 STX ADDEND
02566  D339  A9 00              LDA #0
02567  D33B  20 55 D3           JSR UMULTD
02568  D33E  8A                 TXA
02569  D33F  65 58              ADC ARYPNT
02570  D341  85 47              STA VARPNT
02571  D343  98                 TYA
02572  D344  65 59              ADC ARYPNT+1
02573  D346  85 48              STA VARPNT+1
02574  D348  A8                 TAY
02575  D349  A5 47              LDA VARPNT
02576  D34B  60          DIMRTS RTS
02577  D34C  84 22       UMULT  STY INDEX
02578  D34E  B1 5F              LDA (LOWTR)Y
02579  D350  85 28              STA ADDEND
02580  D352  88                 DEY
02581  D353  B1 5F              LDA (LOWTR)Y
02582  D355  85 29       UMULTD STA ADDEND+1
02583  D357  A9 10              LDA #16
02584  D359  85 5D              STA DECCNT
02585  D35B  A2 00              LDX #0
02586  D35D  A0 00              LDY #0
02587  D35F  8A          UMULTC TXA
02588  D360  0A                 ASL A
02589  D361  AA                 TAX
02590  D362  98                 TYA
02591  D363  2A                 ROL A
02592  D364  A8                 TAY
02593  D365  B0 A4              BCS OMERR1
02594  D367  06 71              ASL CURTOL
02595  D369  26 72              ROL CURTOL+1
02596  D36B  90 0B              BCC UMLCNT
02597  D36D  18                 CLC
02598  D36E  8A                 TXA
02599  D36F  65 28              ADC ADDEND
02600  D371  AA                 TAX
02601  D372  98                 TYA
02602  D373  65 29              ADC ADDEND+1
02603  D375  A8                 TAY
02604  D376  B0 93              BCS OMERR1
02605  D378  C6 5D       UMLCNT DEC DECCNT
02606  D37A  D0 E3              BNE UMULTC
02607  D37C  60          UMLRTS RTS
02608  D37D  A5 0D       FRE    LDA VALTYP
02609  D37F  F0 03              BEQ NOFREF






CODE13......PAGE 003A

LINE# LOC   CODE        LINE


02610  D381  20 A6 D6           JSR FREFAC
02611  D384  20 26 D5    NOFREF JSR GARBA2
02612  D387  38                 SEC
02613  D388  A5 33              LDA FRETOP
02614  D38A  E5 31              SBC STREND
02615  D38C  A8                 TAY
02616  D38D  A5 34              LDA FRETOP+1
02617  D38F  E5 32              SBC STREND+1
02618  D391  A2 00       GIVAYF LDX #0
02619  D393  86 0D              STX VALTYP
02620  D395  85 62              STA FACHO
02621  D397  84 63              STY FACHO+1
02622  D399  A2 90              LDX #144
02623  D39B  4C 44 DC           JMP FLOATS
02624  D39E  38          POS    SEC
02625  D39F  20 F0 FF           JSR PLOT        ;GET TAB POS IN .Y
02626  D3A2  A9 00       SNGFLT LDA #0
02627  D3A4  F0 EB              BEQ GIVAYF
02628  D3A6  A6 3A       ERRDIR LDX CURLIN+1
02629  D3A8  E8                 INX
02630  D3A9  D0 A0              BNE DIMRTS
02631  D3AB  A2 15              LDX #ERRID
02632  D3AD  2C                 .BYT $2C
02633  D3AE  A2 1B       ERRGUF LDX #ERRUF
02634  D3B0  4C 37 C4           JMP ERROR
02635  D3B3  20 E1 D3    DEF    JSR GETFNM
02636  D3B6  20 A6 D3           JSR ERRDIR
02637  D3B9  20 FA CE           JSR CHKOPN
02638  D3BC  A9 80              LDA #128
02639  D3BE  85 10              STA SUBFLG
02640  D3C0  20 8B D0           JSR PTRGET
02641  D3C3  20 8D CD           JSR CHKNUM
02642  D3C6  20 F7 CE           JSR CHKCLS
02643  D3C9  A9 B2              LDA #$B2
02644  D3CB  20 FF CE           JSR SYNCHR
02645  D3CE  48                 PHA
02646  D3CF  A5 48              LDA VARPNT+1
02647  D3D1  48                 PHA
02648  D3D2  A5 47              LDA VARPNT
02649  D3D4  48                 PHA
02650  D3D5  A5 7B              LDA TXTPTR+1
02651  D3D7              .END
02652  D3D7              .LIB   CODE14


















CODE14......PAGE 003B

LINE# LOC   CODE        LINE


02654  D3D7  48                 PHA
02655  D3D8  A5 7A              LDA TXTPTR
02656  D3DA  48                 PHA
02657  D3DB  20 F8 C8           JSR DATA
02658  D3DE  4C 4F D4           JMP DEFFIN
02659  D3E1  A9 A5       GETFNM LDA #FNTK
02660  D3E3  20 FF CE           JSR SYNCHR
02661  D3E6  09 80              ORA #128
02662  D3E8  85 10              STA SUBFLG
02663  D3EA  20 92 D0           JSR PTRGT2
02664  D3ED  85 4E              STA DEFPNT
02665  D3EF  84 4F              STY DEFPNT+1
02666  D3F1  4C 8D CD           JMP CHKNUM
02667  D3F4  20 E1 D3    FNDOER JSR GETFNM
02668  D3F7  A5 4F              LDA DEFPNT+1
02669  D3F9  48                 PHA
02670  D3FA  A5 4E              LDA DEFPNT
02671  D3FC  48                 PHA
02672  D3FD  20 F1 CE           JSR PARCHK
02673  D400  20 8D CD           JSR CHKNUM
02674  D403  68                 PLA
02675  D404  85 4E              STA DEFPNT
02676  D406  68                 PLA
02677  D407  85 4F              STA DEFPNT+1
02678  D409  A0 02              LDY #2
02679  D40B  B1 4E              LDA (DEFPNT)Y
02680  D40D  85 47              STA VARPNT
02681  D40F  AA                 TAX
02682  D410  C8                 INY
02683  D411  B1 4E              LDA (DEFPNT)Y
02684  D413  F0 99              BEQ ERRGUF
02685  D415  85 48              STA VARPNT+1
02686  D417  C8                 INY
02687  D418  B1 47       DEFSTF LDA (VARPNT)Y
02688  D41A  48                 PHA
02689  D41B  88                 DEY
02690  D41C  10 FA              BPL DEFSTF
02691  D41E  A4 48              LDY VARPNT+1
02692  D420  20 D4 DB           JSR MOVMF
02693  D423  A5 7B              LDA TXTPTR+1
02694  D425  48                 PHA
02695  D426  A5 7A              LDA TXTPTR
02696  D428  48                 PHA
02697  D429  B1 4E              LDA (DEFPNT)Y
02698  D42B  85 7A              STA TXTPTR
02699  D42D  C8                 INY
02700  D42E  B1 4E              LDA (DEFPNT)Y
02701  D430  85 7B              STA TXTPTR+1
02702  D432  A5 48              LDA VARPNT+1
02703  D434  48                 PHA
02704  D435  A5 47              LDA VARPNT
02705  D437  48                 PHA
02706  D438  20 8A CD           JSR FRMNUM
02707  D43B  68                 PLA
02708  D43C  85 4E              STA DEFPNT






CODE14......PAGE 003C

LINE# LOC   CODE        LINE


02709  D43E  68                 PLA
02710  D43F  85 4F              STA DEFPNT+1
02711  D441  20 79 00           JSR CHRGOT
02712  D444  F0 03              BEQ *+5
02713  D446  4C 08 CF           JMP SNERR
02714  D449  68                 PLA
02715  D44A  85 7A              STA TXTPTR
02716  D44C  68                 PLA
02717  D44D  85 7B              STA TXTPTR+1
02718  D44F  A0 00       DEFFIN LDY #0
02719  D451  68                 PLA
02720  D452  91 4E              STA (DEFPNT)Y
02721  D454  68                 PLA
02722  D455  C8                 INY
02723  D456  91 4E              STA (DEFPNT)Y
02724  D458  68                 PLA
02725  D459  C8                 INY
02726  D45A  91 4E              STA (DEFPNT)Y
02727  D45C  68                 PLA
02728  D45D  C8                 INY
02729  D45E  91 4E              STA (DEFPNT)Y
02730  D460  68                 PLA
02731  D461  C8                 INY
02732  D462  91 4E              STA (DEFPNT)Y
02733  D464  60                 RTS
02734  D465  20 8D CD    STRD   JSR CHKNUM
02735  D468  A0 00              LDY #0
02736  D46A  20 DF DD           JSR FOUTC
02737  D46D  68                 PLA
02738  D46E  68                 PLA
02739  D46F  A9 FF       TIMSTR LDA #<LOFBUF
02740  D471  A0 00              LDY #>LOFBUF
02741  D473  F0 12              BEQ STRLIT
02742  D475  A6 64       STRINI LDX FACMO
02743  D477  A4 65              LDY FACMO+1
02744  D479  86 50              STX DSCPNT
02745  D47B  84 51              STY DSCPNT+1
02746  D47D  20 F4 D4    STRSPA JSR GETSPA
02747  D480  86 62              STX DSCTMP+1
02748  D482  84 63              STY DSCTMP+2
02749  D484  85 61              STA DSCTMP
02750  D486  60                 RTS
02751  D487  A2 22       STRLIT LDX #34
02752  D489  86 07              STX CHARAC
02753  D48B  86 08              STX ENDCHR
02754  D48D  85 6F       STRLT2 STA STRNG1
02755  D48F  84 70              STY STRNG1+1
02756  D491  85 62              STA DSCTMP+1
02757  D493  84 63              STY DSCTMP+2
02758  D495  A0 FF              LDY #255
02759  D497  C8          STRGET INY
02760  D498  B1 6F              LDA (STRNG1)Y
02761  D49A  F0 0C              BEQ STRFI1
02762  D49C  C5 07              CMP CHARAC
02763  D49E  F0 04              BEQ STRFIN






CODE14......PAGE 003D

LINE# LOC   CODE        LINE


02764  D4A0  C5 08              CMP ENDCHR
02765  D4A2  D0 F3              BNE STRGET
02766  D4A4  C9 22       STRFIN CMP #34
02767  D4A6  F0 01              BEQ STRFI2
02768  D4A8  18          STRFI1 CLC
02769  D4A9  84 61       STRFI2 STY DSCTMP
02770  D4AB  98                 TYA
02771  D4AC  65 6F              ADC STRNG1
02772  D4AE  85 71              STA STRNG2
02773  D4B0  A6 70              LDX STRNG1+1
02774  D4B2  90 01              BCC STRST2
02775  D4B4  E8                 INX
02776  D4B5  86 72       STRST2 STX STRNG2+1
02777  D4B7  A5 70              LDA STRNG1+1
02778  D4B9  F0 04              BEQ STRCP
02779  D4BB  C9 02              CMP #BUFPAG
02780  D4BD  D0 0B              BNE PUTNEW
02781  D4BF  98          STRCP  TYA
02782  D4C0  20 75 D4           JSR STRINI
02783  D4C3  A6 6F              LDX STRNG1
02784  D4C5  A4 70              LDY STRNG1+1
02785  D4C7  20 88 D6           JSR MOVSTR
02786  D4CA  A6 16       PUTNEW LDX TEMPPT
02787  D4CC  E0 22              CPX #TEMPST+STRSIZ+STRSIZ+STRSIZ
02788  D4CE  D0 05              BNE PUTNW1
02789  D4D0  A2 19              LDX #ERRST
02790  D4D2  4C 37 C4    ERRGO2 JMP ERROR
02791  D4D5  A5 61       PUTNW1 LDA DSCTMP
02792  D4D7  95 00              STA 0,X
02793  D4D9  A5 62              LDA DSCTMP+1
02794  D4DB  95 01              STA 1,X
02795  D4DD  A5 63              LDA DSCTMP+2
02796  D4DF  95 02              STA 2,X
02797  D4E1  A0 00              LDY #0
02798  D4E3  86 64              STX FACMO
02799  D4E5  84 65              STY FACMO+1
02800  D4E7  84 70              STY FACOV
02801  D4E9  88                 DEY
02802  D4EA  84 0D              STY VALTYP
02803  D4EC  86 17              STX LASTPT
02804  D4EE  E8                 INX
02805  D4EF  E8                 INX
02806  D4F0  E8                 INX
02807  D4F1  86 16              STX TEMPPT
02808  D4F3  60                 RTS
02809  D4F4  46 0F       GETSPA LSR GARBFL
02810  D4F6  48          TRYAG2 PHA
02811  D4F7  49 FF              EOR #255
02812  D4F9  38                 SEC
02813  D4FA  65 33              ADC FRETOP
02814  D4FC  A4 34              LDY FRETOP+1
02815  D4FE  B0 01              BCS TRYAG3
02816  D500  88                 DEY
02817  D501  C4 32       TRYAG3 CPY STREND+1
02818  D503  90 11              BCC GARBAG






CODE14......PAGE 003E

LINE# LOC   CODE        LINE


02819  D505  D0 04              BNE STRFRE
02820  D507  C5 31              CMP STREND
02821  D509  90 0B              BCC GARBAG
02822  D50B  85 33       STRFRE STA FRETOP
02823  D50D  84 34              STY FRETOP+1
02824  D50F  85 35              STA FRESPC
02825  D511  84 36              STY FRESPC+1
02826  D513  AA                 TAX
02827  D514  68                 PLA
02828  D515  60                 RTS
02829  D516  A2 10       GARBAG LDX #ERROM
02830  D518  A5 0F              LDA GARBFL
02831  D51A  30 B6              BMI ERRGO2
02832  D51C  20 26 D5           JSR GARBA2
02833  D51F  A9 80              LDA #128
02834  D521  85 0F              STA GARBFL
02835  D523  68                 PLA
02836  D524  D0 D0              BNE TRYAG2
02837  D526  A6 37       GARBA2 LDX MEMSIZ
02838  D528  A5 38              LDA MEMSIZ+1
02839  D52A  86 33       FNDVAR STX FRETOP
02840  D52C  85 34              STA FRETOP+1
02841  D52E  A0 00              LDY #0
02842  D530  84 4F              STY GRBPNT+1
02843  D532  84 4E              STY GRBPNT
02844  D534  A5 31              LDA STREND
02845  D536  A6 32              LDX STREND+1
02846  D538  85 5F              STA GRBTOP
02847  D53A  86 60              STX GRBTOP+1
02848  D53C  A9 19              LDA #<TEMPST
02849  D53E  A2 00              LDX #>TEMPST
02850  D540  85 22              STA INDEX1
02851  D542  86 23              STX INDEX1+1
02852  D544  C5 16       TVAR   CMP TEMPPT
02853  D546  F0 05              BEQ SVARS
02854  D548  20 C7 D5           JSR DVAR
02855  D54B  F0 F7              BEQ TVAR
02856  D54D  A9 07       SVARS  LDA #6+ADDPRC
02857  D54F  85 53              STA FOUR6
02858  D551  A5 2D              LDA VARTAB
02859  D553  A6 2E              LDX VARTAB+1
02860  D555              .END
02861  D555              .LIB   CODE15


















CODE15......PAGE 003F

LINE# LOC   CODE        LINE


02863  D555  85 22              STA INDEX1
02864  D557  86 23              STX INDEX1+1
02865  D559  E4 30       SVAR   CPX ARYTAB+1
02866  D55B  D0 04              BNE SVARGO
02867  D55D  C5 2F              CMP ARYTAB
02868  D55F  F0 05              BEQ ARYVAR
02869  D561  20 BD D5    SVARGO JSR DVARS
02870  D564  F0 F3              BEQ SVAR
02871  D566  85 58       ARYVAR STA ARYPNT
02872  D568  86 59              STX ARYPNT+1
02873  D56A  A9 03              LDA #STRSIZ
02874  D56C  85 53              STA FOUR6
02875  D56E  A5 58       ARYVA2 LDA ARYPNT
02876  D570  A6 59              LDX ARYPNT+1
02877  D572  E4 32       ARYVA3 CPX STREND+1
02878  D574  D0 07              BNE ARYVGO
02879  D576  C5 31              CMP STREND
02880  D578  D0 03              BNE *+5
02881  D57A  4C 06 D6           JMP GRBPAS
02882  D57D  85 22       ARYVGO STA INDEX1
02883  D57F  86 23              STX INDEX1+1
02884  D581  A0 00              LDY #1-ADDPRC
02885  D583  B1 22              LDA (INDEX1)Y
02886  D585  AA                 TAX
02887  D586  C8                 INY
02888  D587  B1 22              LDA (INDEX1)Y
02889  D589  08                 PHP
02890  D58A  C8                 INY
02891  D58B  B1 22              LDA (INDEX1)Y
02892  D58D  65 58              ADC ARYPNT
02893  D58F  85 58              STA ARYPNT
02894  D591  C8                 INY
02895  D592  B1 22              LDA (INDEX1)Y
02896  D594  65 59              ADC ARYPNT+1
02897  D596  85 59              STA ARYPNT+1
02898  D598  28                 PLP
02899  D599  10 D3              BPL ARYVA2
02900  D59B  8A                 TXA
02901  D59C  30 D0              BMI ARYVA2
02902  D59E  C8                 INY
02903  D59F  B1 22              LDA (INDEX1)Y
02904  D5A1  A0 00              LDY #0
02905  D5A3  0A                 ASL A
02906  D5A4  69 05              ADC #5
02907  D5A6  65 22              ADC INDEX1
02908  D5A8  85 22              STA INDEX1
02909  D5AA  90 02              BCC ARYGET
02910  D5AC  E6 23              INC INDEX1+1
02911  D5AE  A6 23       ARYGET LDX INDEX1+1
02912  D5B0  E4 59       ARYSTR CPX ARYPNT+1
02913  D5B2  D0 04              BNE GOGO
02914  D5B4  C5 58              CMP ARYPNT
02915  D5B6  F0 BA              BEQ ARYVA3
02916  D5B8  20 C7 D5    GOGO   JSR DVAR
02917  D5BB  F0 F3              BEQ ARYSTR






CODE15......PAGE 0040

LINE# LOC   CODE        LINE


02918  D5BD  B1 22       DVARS  LDA (INDEX1)Y
02919  D5BF  30 35              BMI DVARTS
02920  D5C1  C8                 INY
02921  D5C2  B1 22              LDA (INDEX1)Y
02922  D5C4  10 30              BPL DVARTS
02923  D5C6  C8                 INY
02924  D5C7  B1 22       DVAR   LDA (INDEX1)Y
02925  D5C9  F0 2B              BEQ DVARTS
02926  D5CB  C8                 INY
02927  D5CC  B1 22              LDA (INDEX1)Y
02928  D5CE  AA                 TAX
02929  D5CF  C8                 INY
02930  D5D0  B1 22              LDA (INDEX1)Y
02931  D5D2  C5 34              CMP FRETOP+1
02932  D5D4  90 06              BCC DVAR2
02933  D5D6  D0 1E              BNE DVARTS
02934  D5D8  E4 33              CPX FRETOP
02935  D5DA  B0 1A              BCS DVARTS
02936  D5DC  C5 60       DVAR2  CMP GRBTOP+1
02937  D5DE  90 16              BCC DVARTS
02938  D5E0  D0 04              BNE DVAR3
02939  D5E2  E4 5F              CPX GRBTOP
02940  D5E4  90 10              BCC DVARTS
02941  D5E6  86 5F       DVAR3  STX GRBTOP
02942  D5E8  85 60              STA GRBTOP+1
02943  D5EA  A5 22              LDA INDEX1
02944  D5EC  A6 23              LDX INDEX1+1
02945  D5EE  85 4E              STA GRBPNT
02946  D5F0  86 4F              STX GRBPNT+1
02947  D5F2  A5 53              LDA FOUR6
02948  D5F4  85 55              STA SIZE
02949  D5F6  A5 53       DVARTS LDA FOUR6
02950  D5F8  18                 CLC
02951  D5F9  65 22              ADC INDEX1
02952  D5FB  85 22              STA INDEX1
02953  D5FD  90 02              BCC GRBRTS
02954  D5FF  E6 23              INC INDEX1+1
02955  D601  A6 23       GRBRTS LDX INDEX1+1
02956  D603  A0 00              LDY #0
02957  D605  60                 RTS
02958  D606  A5 4F       GRBPAS LDA GRBPNT+1
02959  D608  05 4E              ORA GRBPNT
02960  D60A  F0 F5              BEQ GRBRTS
02961  D60C  A5 55              LDA SIZE
02962  D60E  29 04              AND #4
02963  D610  4A                 LSR A
02964  D611  A8                 TAY
02965  D612  85 55              STA SIZE
02966  D614  B1 4E              LDA (GRBPNT)Y
02967  D616  65 5F              ADC LOWTR
02968  D618  85 5A              STA HIGHTR
02969  D61A  A5 60              LDA LOWTR+1
02970  D61C  69 00              ADC #0
02971  D61E  85 5B              STA HIGHTR+1
02972  D620  A5 33              LDA FRETOP






CODE15......PAGE 0041

LINE# LOC   CODE        LINE


02973  D622  A6 34              LDX FRETOP+1
02974  D624  85 58              STA HIGHDS
02975  D626  86 59              STX HIGHDS+1
02976  D628  20 BF C3           JSR BLTUC
02977  D62B  A4 55              LDY SIZE
02978  D62D  C8                 INY
02979  D62E  A5 58              LDA HIGHDS
02980  D630  91 4E              STA (GRBPNT)Y
02981  D632  AA                 TAX
02982  D633  E6 59              INC HIGHDS+1
02983  D635  A5 59              LDA HIGHDS+1
02984  D637  C8                 INY
02985  D638  91 4E              STA (GRBPNT)Y
02986  D63A  4C 2A D5           JMP FNDVAR
02987  D63D  A5 65       CAT    LDA FACLO
02988  D63F  48                 PHA
02989  D640  A5 64              LDA FACMO
02990  D642  48                 PHA
02991  D643  20 83 CE           JSR EVAL
02992  D646  20 8F CD           JSR CHKSTR
02993  D649  68                 PLA
02994  D64A  85 6F              STA STRNG1
02995  D64C  68                 PLA
02996  D64D  85 70              STA STRNG1+1
02997  D64F  A0 00              LDY #0
02998  D651  B1 6F              LDA (STRNG1)Y
02999  D653  18                 CLC
03000  D654  71 64              ADC (FACMO)Y
03001  D656  90 05              BCC SIZEOK
03002  D658  A2 17              LDX #ERRLS
03003  D65A  4C 37 C4           JMP ERROR
03004  D65D  20 75 D4    SIZEOK JSR STRINI
03005  D660  20 7A D6           JSR MOVINS
03006  D663  A5 50              LDA DSCPNT
03007  D665  A4 51              LDY DSCPNT+1
03008  D667  20 AA D6           JSR FRETMP
03009  D66A  20 8C D6           JSR MOVDO
03010  D66D  A5 6F              LDA STRNG1
03011  D66F  A4 70              LDY STRNG1+1
03012  D671  20 AA D6           JSR FRETMP
03013  D674  20 CA D4           JSR PUTNEW
03014  D677  4C B8 CD           JMP TSTOP
03015  D67A  A0 00       MOVINS LDY #0
03016  D67C  B1 6F              LDA (STRNG1)Y
03017  D67E  48                 PHA
03018  D67F  C8                 INY
03019  D680              .END
03020  D680              .LIB   CODE16













CODE16......PAGE 0042

LINE# LOC   CODE        LINE


03022  D680  B1 6F              LDA (STRNG1)Y
03023  D682  AA                 TAX
03024  D683  C8                 INY
03025  D684  B1 6F              LDA (STRNG1)Y
03026  D686  A8                 TAY
03027  D687  68                 PLA
03028  D688  86 22       MOVSTR STX INDEX
03029  D68A  84 23              STY INDEX+1
03030  D68C  A8          MOVDO  TAY
03031  D68D  F0 0A              BEQ MVDONE
03032  D68F  48                 PHA
03033  D690  88          MOVLP  DEY
03034  D691  B1 22              LDA (INDEX)Y
03035  D693  91 35              STA (FRESPC)Y
03036  D695  98                 TYA
03037  D696  D0 F8              BNE MOVLP
03038  D698  68                 PLA
03039  D699  18          MVDONE CLC
03040  D69A  65 35              ADC FRESPC
03041  D69C  85 35              STA FRESPC
03042  D69E  90 02              BCC MVSTRT
03043  D6A0  E6 36              INC FRESPC+1
03044  D6A2  60          MVSTRT RTS
03045  D6A3  20 8F CD    FRESTR JSR CHKSTR
03046  D6A6  A5 64       FREFAC LDA FACMO
03047  D6A8  A4 65              LDY FACMO+1
03048  D6AA  85 22       FRETMP STA INDEX
03049  D6AC  84 23              STY INDEX+1
03050  D6AE  20 DB D6           JSR FRETMS
03051  D6B1  08                 PHP
03052  D6B2  A0 00              LDY #0
03053  D6B4  B1 22              LDA (INDEX)Y
03054  D6B6  48                 PHA
03055  D6B7  C8                 INY
03056  D6B8  B1 22              LDA (INDEX)Y
03057  D6BA  AA                 TAX
03058  D6BB  C8                 INY
03059  D6BC  B1 22              LDA (INDEX)Y
03060  D6BE  A8                 TAY
03061  D6BF  68                 PLA
03062  D6C0  28                 PLP
03063  D6C1  D0 13              BNE FRETRT
03064  D6C3  C4 34              CPY FRETOP+1
03065  D6C5  D0 0F              BNE FRETRT
03066  D6C7  E4 33              CPX FRETOP
03067  D6C9  D0 0B              BNE FRETRT
03068  D6CB  48                 PHA
03069  D6CC  18                 CLC
03070  D6CD  65 33              ADC FRETOP
03071  D6CF  85 33              STA FRETOP
03072  D6D1  90 02              BCC FREPLA
03073  D6D3  E6 34              INC FRETOP+1
03074  D6D5  68          FREPLA PLA
03075  D6D6  86 22       FRETRT STX INDEX
03076  D6D8  84 23              STY INDEX+1






CODE16......PAGE 0043

LINE# LOC   CODE        LINE


03077  D6DA  60                 RTS
03078  D6DB  C4 18       FRETMS CPY LASTPT+1
03079  D6DD  D0 0C              BNE FRERTS
03080  D6DF  C5 17              CMP LASTPT
03081  D6E1  D0 08              BNE FRERTS
03082  D6E3  85 16              STA TEMPPT
03083  D6E5  E9 03              SBC #STRSIZ
03084  D6E7  85 17              STA LASTPT
03085  D6E9  A0 00              LDY #0
03086  D6EB  60          FRERTS RTS
03087  D6EC  20 A1 D7    CHRD   JSR CONINT
03088  D6EF  8A                 TXA
03089  D6F0  48                 PHA
03090  D6F1  A9 01              LDA #1
03091  D6F3  20 7D D4           JSR STRSPA
03092  D6F6  68                 PLA
03093  D6F7  A0 00              LDY #0
03094  D6F9  91 62              STA (DSCTMP+1)Y
03095  D6FB  68                 PLA
03096  D6FC  68                 PLA
03097  D6FD  4C CA D4           JMP PUTNEW
03098  D700  20 61 D7    LEFTD  JSR PREAM
03099  D703  D1 50              CMP (DSCPNT)Y
03100  D705  98                 TYA
03101  D706  90 04       RLEFT  BCC RLEFT1
03102  D708  B1 50              LDA (DSCPNT)Y
03103  D70A  AA                 TAX
03104  D70B  98                 TYA
03105  D70C  48          RLEFT1 PHA
03106  D70D  8A          RLEFT2 TXA
03107  D70E  48          RLEFT3 PHA
03108  D70F  20 7D D4           JSR STRSPA
03109  D712  A5 50              LDA DSCPNT
03110  D714  A4 51              LDY DSCPNT+1
03111  D716  20 AA D6           JSR FRETMP
03112  D719  68                 PLA
03113  D71A  A8                 TAY
03114  D71B  68                 PLA
03115  D71C  18                 CLC
03116  D71D  65 22              ADC INDEX
03117  D71F  85 22              STA INDEX
03118  D721  90 02              BCC PULMOR
03119  D723  E6 23              INC INDEX+1
03120  D725  98          PULMOR TYA
03121  D726  20 8C D6           JSR MOVDO
03122  D729  4C CA D4           JMP PUTNEW
03123  D72C  20 61 D7    RIGHTD JSR PREAM
03124  D72F  18                 CLC
03125  D730  F1 50              SBC (DSCPNT)Y
03126  D732  49 FF              EOR #255
03127  D734  4C 06 D7           JMP RLEFT
03128  D737  A9 FF       MIDD   LDA #255
03129  D739  85 65              STA FACLO
03130  D73B  20 79 00           JSR CHRGOT
03131  D73E  C9 29              CMP #41






CODE16......PAGE 0044

LINE# LOC   CODE        LINE


03132  D740  F0 06              BEQ MID2
03133  D742  20 FD CE           JSR CHKCOM
03134  D745  20 9E D7           JSR GETBYT
03135  D748  20 61 D7    MID2   JSR PREAM
03136  D74B  F0 4B              BEQ GOFUC
03137  D74D  CA                 DEX
03138  D74E  8A                 TXA
03139  D74F  48                 PHA
03140  D750  18                 CLC
03141  D751  A2 00              LDX #0
03142  D753  F1 50              SBC (DSCPNT)Y
03143  D755  B0 B6              BCS RLEFT2
03144  D757  49 FF              EOR #255
03145  D759  C5 65              CMP FACLO
03146  D75B  90 B1              BCC RLEFT3
03147  D75D  A5 65              LDA FACLO
03148  D75F  B0 AD              BCS RLEFT3
03149  D761  20 F7 CE    PREAM  JSR CHKCLS
03150  D764  68                 PLA
03151  D765  A8                 TAY
03152  D766  68                 PLA
03153  D767  85 55              STA JMPER+1
03154  D769  68                 PLA
03155  D76A  68                 PLA
03156  D76B  68                 PLA
03157  D76C  AA                 TAX
03158  D76D  68                 PLA
03159  D76E  85 50              STA DSCPNT
03160  D770  68                 PLA
03161  D771  85 51              STA DSCPNT+1
03162  D773  A5 55              LDA JMPER+1
03163  D775  48                 PHA
03164  D776  98                 TYA
03165  D777  48                 PHA
03166  D778  A0 00              LDY #0
03167  D77A  8A                 TXA
03168  D77B  60                 RTS
03169  D77C  20 82 D7    LEN    JSR LEN1
03170  D77F  4C A2 D3           JMP SNGFLT
03171  D782  20 A3 D6    LEN1   JSR FRESTR
03172  D785  A2 00              LDX #0
03173  D787  86 0D              STX VALTYP
03174  D789  A8                 TAY
03175  D78A  60                 RTS
03176  D78B  20 82 D7    ASC    JSR LEN1
03177  D78E  F0 08              BEQ GOFUC
03178  D790  A0 00              LDY #0
03179  D792  B1 22              LDA (INDEX1)Y
03180  D794  A8                 TAY
03181  D795  4C A2 D3           JMP SNGFLT
03182  D798  4C 48 D2    GOFUC  JMP FCERR
03183  D79B  20 73 00    GTBYTC JSR CHRGET
03184  D79E              .END
03185  D79E              .LIB   CODE17







CODE17......PAGE 0045

LINE# LOC   CODE        LINE


03187  D79E  20 8A CD    GETBYT JSR FRMNUM
03188  D7A1  20 B8 D1    CONINT JSR POSINT
03189  D7A4  A6 64              LDX FACMO
03190  D7A6  D0 F0              BNE GOFUC
03191  D7A8  A6 65              LDX FACLO
03192  D7AA  4C 79 00           JMP CHRGOT
03193  D7AD  20 82 D7    VAL    JSR LEN1
03194  D7B0  D0 03              BNE *+5
03195  D7B2  4C F7 D8           JMP ZEROFC
03196  D7B5  A6 7A              LDX TXTPTR
03197  D7B7  A4 7B              LDY TXTPTR+1
03198  D7B9  86 71              STX STRNG2
03199  D7BB  84 72              STY STRNG2+1
03200  D7BD  A6 22              LDX INDEX1
03201  D7BF  86 7A              STX TXTPTR
03202  D7C1  18                 CLC
03203  D7C2  65 22              ADC INDEX1
03204  D7C4  85 24              STA INDEX2
03205  D7C6  A6 23              LDX INDEX1+1
03206  D7C8  86 7B              STX TXTPTR+1
03207  D7CA  90 01              BCC VAL2
03208  D7CC  E8                 INX
03209  D7CD  86 25       VAL2   STX INDEX2+1
03210  D7CF  A0 00              LDY #0
03211  D7D1  B1 24              LDA (INDEX2)Y
03212  D7D3  48                 PHA
03213  D7D4  98                 TYA             ;A=0
03214  D7D5  91 24              STA (INDEX2)Y
03215  D7D7  20 79 00           JSR CHRGOT
03216  D7DA  20 F3 DC           JSR FIN
03217  D7DD  68                 PLA
03218  D7DE  A0 00              LDY #0
03219  D7E0  91 24              STA (INDEX2)Y
03220  D7E2  A6 71       ST2TXT LDX STRNG2
03221  D7E4  A4 72              LDY STRNG2+1
03222  D7E6  86 7A              STX TXTPTR
03223  D7E8  84 7B              STY TXTPTR+1
03224  D7EA  60          VALRTS RTS
03225  D7EB  20 8A CD    GETNUM JSR FRMNUM
03226  D7EE  20 F7 D7           JSR GETADR
03227  D7F1  20 FD CE    COMBYT JSR CHKCOM
03228  D7F4  4C 9E D7           JMP GETBYT
03229  D7F7  A5 66       GETADR LDA FACSGN
03230  D7F9  30 9D              BMI GOFUC
03231  D7FB  A5 61              LDA FACEXP
03232  D7FD  C9 91              CMP #145
03233  D7FF  B0 97              BCS GOFUC
03234  D801  20 9B DC           JSR QINT
03235  D804  A5 64              LDA FACMO
03236  D806  A4 65              LDY FACMO+1
03237  D808  84 14              STY POKER
03238  D80A  85 15              STA POKER+1
03239  D80C  60                 RTS
03240  D80D  A5 15       PEEK   LDA POKER+1
03241  D80F  48                 PHA






CODE17......PAGE 0046

LINE# LOC   CODE        LINE


03242  D810  A5 14              LDA POKER
03243  D812  48                 PHA
03244  D813  20 F7 D7           JSR GETADR
03245  D816  A0 00              LDY #0
03246  D818  B1 14       GETCON LDA (POKER)Y
03247  D81A  A8                 TAY
03248  D81B  68          DOSGFL PLA
03249  D81C  85 14              STA POKER
03250  D81E  68                 PLA
03251  D81F  85 15              STA POKER+1
03252  D821  4C A2 D3           JMP SNGFLT
03253  D824  20 EB D7    POKE   JSR GETNUM
03254  D827  8A                 TXA
03255  D828  A0 00              LDY #0
03256  D82A  91 14              STA (POKER)Y
03257  D82C  60                 RTS
03258  D82D  20 EB D7    FNWAIT JSR GETNUM
03259  D830  86 49              STX ANDMSK
03260  D832  A2 00              LDX #0
03261  D834  20 79 00           JSR CHRGOT
03262  D837  F0 03              BEQ STORDO
03263  D839  20 F1 D7           JSR COMBYT
03264  D83C  86 4A       STORDO STX EORMSK
03265  D83E  A0 00              LDY #0
03266  D840  B1 14       WAITER LDA (POKER)Y
03267  D842  45 4A              EOR EORMSK
03268  D844  25 49              AND ANDMSK
03269  D846  F0 F8              BEQ WAITER
03270  D848  60          ZERRTS RTS
03271  D849  A9 11       FADDH  LDA #<FHALF
03272  D84B  A0 DF              LDY #>FHALF
03273  D84D  4C 67 D8           JMP FADD
03274  D850  20 8C DA    FSUB   JSR CONUPK
03275  D853  A5 66       FSUBT  LDA FACSGN
03276  D855  49 FF              EOR #@377
03277  D857  85 66              STA FACSGN
03278  D859  45 6E              EOR ARGSGN
03279  D85B  85 6F              STA ARISGN
03280  D85D  A5 61              LDA FACEXP
03281  D85F  4C 6A D8           JMP FADDT
03282  D862  20 99 D9    FADD5  JSR SHIFTR
03283  D865  90 3C              BCC FADD4
03284  D867  20 8C DA    FADD   JSR CONUPK
03285  D86A  D0 03       FADDT  BNE *+5
03286  D86C  4C FC DB           JMP MOVFA
03287  D86F  A6 70              LDX FACOV
03288  D871  86 56              STX OLDOV
03289  D873  A2 69              LDX #ARGEXP
03290  D875  A5 69              LDA ARGEXP
03291  D877  A8          FADDC  TAY
03292  D878  F0 CE              BEQ ZERRTS
03293  D87A  38                 SEC
03294  D87B  E5 61              SBC FACEXP
03295  D87D  F0 24              BEQ FADD4
03296  D87F  90 12              BCC FADDA






CODE17......PAGE 0047

LINE# LOC   CODE        LINE


03297  D881  84 61              STY FACEXP
03298  D883  A4 6E              LDY ARGSGN
03299  D885  84 66              STY FACSGN
03300  D887  49 FF              EOR #@377
03301  D889  69 00              ADC #0
03302  D88B  A0 00              LDY #0
03303  D88D  84 56              STY OLDOV
03304  D88F  A2 61              LDX #FAC
03305  D891  D0 04              BNE FADD1
03306  D893  A0 00       FADDA  LDY #0
03307  D895  84 70              STY FACOV
03308  D897  C9 F9       FADD1  CMP #$F9
03309  D899  30 C7              BMI FADD5
03310  D89B  A8                 TAY
03311  D89C  A5 70              LDA FACOV
03312  D89E  56 01              LSR 1,X
03313  D8A0  20 B0 D9           JSR ROLSHF
03314  D8A3  24 6F       FADD4  BIT ARISGN
03315  D8A5  10 57              BPL FADD2
03316  D8A7  A0 61              LDY #FACEXP
03317  D8A9  E0 69              CPX #ARGEXP
03318  D8AB  F0 02              BEQ SUBIT
03319  D8AD  A0 69              LDY #ARGEXP
03320  D8AF  38          SUBIT  SEC
03321  D8B0  49 FF              EOR #@377
03322  D8B2  65 56              ADC OLDOV
03323  D8B4  85 70              STA FACOV
03324  D8B6  B9 04 00           LDA 3+ADDPRC,Y
03325  D8B9  F5 04              SBC 3+ADDPRC,X
03326  D8BB  85 65              STA FACLO
03327  D8BD  B9 03 00           LDA ADDPRC+2,Y
03328  D8C0  F5 03              SBC 2+ADDPRC,X
03329  D8C2  85 64              STA FACMO
03330  D8C4  B9 02 00           LDA 2,Y
03331  D8C7  F5 02              SBC 2,X
03332  D8C9  85 63              STA FACMOH
03333  D8CB  B9 01 00           LDA 1,Y
03334  D8CE  F5 01              SBC 1,X
03335  D8D0  85 62              STA FACHO
03336  D8D2  B0 03       FADFLT BCS NORMAL
03337  D8D4  20 47 D9           JSR NEGFAC
03338  D8D7  A0 00       NORMAL LDY #0
03339  D8D9  98                 TYA
03340  D8DA  18                 CLC
03341  D8DB  A6 62       NORM3  LDX FACHO
03342  D8DD  D0 4A              BNE NORM1
03343  D8DF  A6 63              LDX FACHO+1
03344  D8E1  86 62              STX FACHO
03345  D8E3  A6 64              LDX FACMOH+1
03346  D8E5              .END
03347  D8E5              .LIB   CODE18










CODE18......PAGE 0048

LINE# LOC   CODE        LINE


03349  D8E5  86 63              STX FACMOH
03350  D8E7  A6 65              LDX FACMO+1
03351  D8E9  86 64              STX FACMO
03352  D8EB  A6 70              LDX FACOV
03353  D8ED  86 65              STX FACLO
03354  D8EF  84 70              STY FACOV
03355  D8F1  69 08              ADC #@10
03356  D8F3              ADDPR2 =ADDPRC+ADDPRC
03357  D8F3              ADDPR4 =ADDPR2+ADDPR2
03358  D8F3              ADDPR8 =ADDPR4+ADDPR4
03359  D8F3  C9 20              CMP #@30+ADDPR8
03360  D8F5  D0 E4              BNE NORM3
03361  D8F7  A9 00       ZEROFC LDA #0
03362  D8F9  85 61       ZEROF1 STA FACEXP
03363  D8FB  85 66       ZEROML STA FACSGN
03364  D8FD  60                 RTS
03365  D8FE  65 56       FADD2  ADC OLDOV
03366  D900  85 70              STA FACOV
03367  D902  A5 65              LDA FACLO
03368  D904  65 6D              ADC ARGLO
03369  D906  85 65              STA FACLO
03370  D908  A5 64              LDA FACMO
03371  D90A  65 6C              ADC ARGMO
03372  D90C  85 64              STA FACMO
03373  D90E  A5 63              LDA FACMOH
03374  D910  65 6B              ADC ARGMOH
03375  D912  85 63              STA FACMOH
03376  D914  A5 62              LDA FACHO
03377  D916  65 6A              ADC ARGHO
03378  D918  85 62              STA FACHO
03379  D91A  4C 36 D9           JMP SQUEEZ
03380  D91D  69 01       NORM2  ADC #1
03381  D91F  06 70              ASL FACOV
03382  D921  26 65              ROL FACLO
03383  D923  26 64              ROL FACMO
03384  D925  26 63              ROL FACMOH
03385  D927  26 62              ROL FACHO
03386  D929  10 F2       NORM1  BPL NORM2
03387  D92B  38                 SEC
03388  D92C  E5 61              SBC FACEXP
03389  D92E  B0 C7              BCS ZEROFC
03390  D930  49 FF              EOR #@377
03391  D932  69 01              ADC #1
03392  D934  85 61              STA FACEXP
03393  D936  90 0E       SQUEEZ BCC RNDRTS
03394  D938  E6 61       RNDSHF INC FACEXP
03395  D93A  F0 42              BEQ OVERR
03396  D93C  66 62              ROR FACHO
03397  D93E  66 63              ROR FACMOH
03398  D940  66 64              ROR FACMO
03399  D942  66 65              ROR FACLO
03400  D944  66 70              ROR FACOV
03401  D946  60          RNDRTS RTS
03402  D947  A5 66       NEGFAC LDA FACSGN
03403  D949  49 FF              EOR #@377






CODE18......PAGE 0049

LINE# LOC   CODE        LINE


03404  D94B  85 66              STA FACSGN
03405  D94D  A5 62       NEGFCH LDA FACHO
03406  D94F  49 FF              EOR #@377
03407  D951  85 62              STA FACHO
03408  D953  A5 63              LDA FACMOH
03409  D955  49 FF              EOR #@377
03410  D957  85 63              STA FACMOH
03411  D959  A5 64              LDA FACMO
03412  D95B  49 FF              EOR #@377
03413  D95D  85 64              STA FACMO
03414  D95F  A5 65              LDA FACLO
03415  D961  49 FF              EOR #@377
03416  D963  85 65              STA FACLO
03417  D965  A5 70              LDA FACOV
03418  D967  49 FF              EOR #@377
03419  D969  85 70              STA FACOV
03420  D96B  E6 70              INC FACOV
03421  D96D  D0 0E              BNE INCFRT
03422  D96F  E6 65       INCFAC INC FACLO
03423  D971  D0 0A              BNE INCFRT
03424  D973  E6 64              INC FACMO
03425  D975  D0 06              BNE INCFRT
03426  D977  E6 63              INC FACMOH
03427  D979  D0 02              BNE INCFRT
03428  D97B  E6 62              INC FACHO
03429  D97D  60          INCFRT RTS
03430  D97E  A2 0F       OVERR  LDX #ERROV
03431  D980  4C 37 C4           JMP ERROR
03432  D983  A2 25       MULSHF LDX #RESHO-1
03433  D985  B4 04       SHFTR2 LDY 3+ADDPRC,X
03434  D987  84 70              STY FACOV
03435  D989  B4 03              LDY 3,X
03436  D98B  94 04              STY 4,X
03437  D98D  B4 02              LDY 2,X
03438  D98F  94 03              STY 3,X
03439  D991  B4 01              LDY 1,X
03440  D993  94 02              STY 2,X
03441  D995  A4 68              LDY BITS
03442  D997  94 01              STY 1,X
03443  D999  69 08       SHIFTR ADC #@10
03444  D99B  30 E8              BMI SHFTR2
03445  D99D  F0 E6              BEQ SHFTR2
03446  D99F  E9 08              SBC #@10
03447  D9A1  A8                 TAY
03448  D9A2  A5 70              LDA FACOV
03449  D9A4  B0 14              BCS SHFTRT
03450  D9A6  16 01       SHFTR3 ASL 1,X
03451  D9A8  90 02              BCC SHFTR4
03452  D9AA  F6 01              INC 1,X
03453  D9AC  76 01       SHFTR4 ROR 1,X
03454  D9AE  76 01              ROR 1,X
03455  D9B0  76 02       ROLSHF ROR 2,X
03456  D9B2  76 03              ROR 3,X
03457  D9B4  76 04              ROR 4,X
03458  D9B6  6A                 ROR A






CODE18......PAGE 004A

LINE# LOC   CODE        LINE


03459  D9B7  C8                 INY
03460  D9B8  D0 EC              BNE SHFTR3
03461  D9BA  18          SHFTRT CLC
03462  D9BB  60                 RTS
03463  D9BC  81          FONE   .BYT @201,0,0,0,0
03463  D9BD  00 
03463  D9BE  00 
03463  D9BF  00 
03463  D9C0  00 
03464  D9C1  03          LOGCN2 .BYT 3,@177,@136,@126
03464  D9C2  7F 
03464  D9C3  5E 
03464  D9C4  56 
03465  D9C5  CB                 .BYT @313,@171,@200,@23
03465  D9C6  79 
03465  D9C7  80 
03465  D9C8  13 
03466  D9C9  9B                 .BYT @233,@13,@144,@200
03466  D9CA  0B 
03466  D9CB  64 
03466  D9CC  80 
03467  D9CD  76                 .BYT @166,@70,@223,@26
03467  D9CE  38 
03467  D9CF  93 
03467  D9D0  16 
03468  D9D1  82                 .BYT @202,@70,@252,@73,@40
03468  D9D2  38 
03468  D9D3  AA 
03468  D9D4  3B 
03468  D9D5  20 
03469  D9D6  80          SQR05  .BYT @200,@65,4,@363,@64
03469  D9D7  35 
03469  D9D8  04 
03469  D9D9  F3 
03469  D9DA  34 
03470  D9DB  81          SQR20  .BYT @201,@65,@4,@363,@64
03470  D9DC  35 
03470  D9DD  04 
03470  D9DE  F3 
03470  D9DF  34 
03471  D9E0  80          NEGHLF .BYT @200,@200,0,0,0
03471  D9E1  80 
03471  D9E2  00 
03471  D9E3  00 
03471  D9E4  00 
03472  D9E5  80          LOG2   .BYT @200,@61,@162,@27,@370
03472  D9E6  31 
03472  D9E7  72 
03472  D9E8  17 
03472  D9E9  F8 
03473  D9EA              .END
03474  D9EA              .LIB   CODE19









CODE19......PAGE 004B

LINE# LOC   CODE        LINE


03476  D9EA  20 2B DC    LOG    JSR SIGN
03477  D9ED  F0 02              BEQ LOGERR
03478  D9EF  10 03              BPL LOG1
03479  D9F1  4C 48 D2    LOGERR JMP FCERR
03480  D9F4  A5 61       LOG1   LDA FACEXP
03481  D9F6  E9 7F              SBC #@177
03482  D9F8  48                 PHA
03483  D9F9  A9 80              LDA #@200
03484  D9FB  85 61              STA FACEXP
03485  D9FD  A9 D6              LDA #<SQR05
03486  D9FF  A0 D9              LDY #>SQR05
03487  DA01  20 67 D8           JSR FADD
03488  DA04  A9 DB              LDA #<SQR20
03489  DA06  A0 D9              LDY #>SQR20
03490  DA08  20 0F DB           JSR FDIV
03491  DA0B  A9 BC              LDA #<FONE
03492  DA0D  A0 D9              LDY #>FONE
03493  DA0F  20 50 D8           JSR FSUB
03494  DA12  A9 C1              LDA #<LOGCN2
03495  DA14  A0 D9              LDY #>LOGCN2
03496  DA16  20 40 E0           JSR POLYX
03497  DA19  A9 E0              LDA #<NEGHLF
03498  DA1B  A0 D9              LDY #>NEGHLF
03499  DA1D  20 67 D8           JSR FADD
03500  DA20  68                 PLA
03501  DA21  20 7E DD           JSR FINLOG
03502  DA24  A9 E5              LDA #<LOG2
03503  DA26  A0 D9              LDY #>LOG2
03504  DA28  20 8C DA    FMULT  JSR CONUPK
03505  DA2B  D0 03       FMULTT BNE *+5
03506  DA2D  4C 8B DA           JMP MULTRT
03507  DA30  20 B7 DA           JSR MULDIV
03508  DA33  A9 00              LDA #0
03509  DA35  85 26              STA RESHO
03510  DA37  85 27              STA RESMOH
03511  DA39  85 28              STA RESMO
03512  DA3B  85 29              STA RESLO
03513  DA3D  A5 70              LDA FACOV
03514  DA3F  20 59 DA           JSR MLTPLY
03515  DA42  A5 65              LDA FACLO
03516  DA44  20 59 DA           JSR MLTPLY
03517  DA47  A5 64              LDA FACMO
03518  DA49  20 59 DA           JSR MLTPLY
03519  DA4C  A5 63              LDA FACMOH
03520  DA4E  20 59 DA           JSR MLTPLY
03521  DA51  A5 62              LDA FACHO
03522  DA53  20 5E DA           JSR MLTPL1
03523  DA56  4C 8F DB           JMP MOVFR
03524  DA59  D0 03       MLTPLY BNE *+5
03525  DA5B  4C 83 D9           JMP MULSHF
03526  DA5E  4A          MLTPL1 LSR A
03527  DA5F  09 80              ORA #@200
03528  DA61  A8          MLTPL2 TAY
03529  DA62  90 19              BCC MLTPL3
03530  DA64  18                 CLC






CODE19......PAGE 004C

LINE# LOC   CODE        LINE


03531  DA65  A5 29              LDA RESLO
03532  DA67  65 6D              ADC ARGLO
03533  DA69  85 29              STA RESLO
03534  DA6B  A5 28              LDA RESMO
03535  DA6D  65 6C              ADC ARGMO
03536  DA6F  85 28              STA RESMO
03537  DA71  A5 27              LDA RESMOH
03538  DA73  65 6B              ADC ARGMOH
03539  DA75  85 27              STA RESMOH
03540  DA77  A5 26              LDA RESHO
03541  DA79  65 6A              ADC ARGHO
03542  DA7B  85 26              STA RESHO
03543  DA7D  66 26       MLTPL3 ROR RESHO
03544  DA7F  66 27              ROR RESMOH
03545  DA81  66 28              ROR RESMO
03546  DA83  66 29              ROR RESLO
03547  DA85  66 70              ROR FACOV
03548  DA87  98                 TYA
03549  DA88  4A                 LSR A
03550  DA89  D0 D6              BNE MLTPL2
03551  DA8B  60          MULTRT RTS
03552  DA8C  85 22       CONUPK STA INDEX1
03553  DA8E  84 23              STY INDEX1+1
03554  DA90  A0 04              LDY #3+ADDPRC
03555  DA92  B1 22              LDA (INDEX1)Y
03556  DA94  85 6D              STA ARGLO
03557  DA96  88                 DEY
03558  DA97  B1 22              LDA (INDEX)Y
03559  DA99  85 6C              STA ARGMO
03560  DA9B  88                 DEY
03561  DA9C  B1 22              LDA (INDEX1)Y
03562  DA9E  85 6B              STA ARGMOH
03563  DAA0  88                 DEY
03564  DAA1  B1 22              LDA (INDEX1)Y
03565  DAA3  85 6E              STA ARGSGN
03566  DAA5  45 66              EOR FACSGN
03567  DAA7  85 6F              STA ARISGN
03568  DAA9  A5 6E              LDA ARGSGN
03569  DAAB  09 80              ORA #@200
03570  DAAD  85 6A              STA ARGHO
03571  DAAF  88                 DEY
03572  DAB0  B1 22              LDA (INDEX1)Y
03573  DAB2  85 69              STA ARGEXP
03574  DAB4  A5 61              LDA FACEXP
03575  DAB6  60                 RTS
03576  DAB7  A5 69       MULDIV LDA ARGEXP
03577  DAB9  F0 1F       MLDEXP BEQ ZEREMV
03578  DABB  18                 CLC
03579  DABC  65 61              ADC FACEXP
03580  DABE  90 04              BCC TRYOFF
03581  DAC0  30 1D              BMI GOOVER
03582  DAC2  18                 CLC
03583  DAC3  2C                 .BYT $2C
03584  DAC4  10 14       TRYOFF BPL ZEREMV
03585  DAC6  69 80              ADC #@200






CODE19......PAGE 004D

LINE# LOC   CODE        LINE


03586  DAC8  85 61              STA FACEXP
03587  DACA  D0 03              BNE *+5
03588  DACC  4C FB D8           JMP ZEROML
03589  DACF  A5 6F              LDA ARISGN
03590  DAD1  85 66              STA FACSGN
03591  DAD3  60                 RTS
03592  DAD4  A5 66       MLDVEX LDA FACSGN
03593  DAD6  49 FF              EOR #@377
03594  DAD8  30 05              BMI GOOVER
03595  DADA  68          ZEREMV PLA
03596  DADB  68                 PLA
03597  DADC  4C F7 D8           JMP ZEROFC
03598  DADF  4C 7E D9    GOOVER JMP OVERR
03599  DAE2  20 0C DC    MUL10  JSR MOVAF
03600  DAE5  AA                 TAX
03601  DAE6  F0 10              BEQ MUL10R
03602  DAE8  18                 CLC
03603  DAE9  69 02              ADC #2
03604  DAEB  B0 F2              BCS GOOVER
03605  DAED  A2 00       FINML6 LDX #0
03606  DAEF  86 6F              STX ARISGN
03607  DAF1  20 77 D8           JSR FADDC
03608  DAF4  E6 61              INC FACEXP
03609  DAF6  F0 E7              BEQ GOOVER
03610  DAF8  60          MUL10R RTS
03611  DAF9  84          TENC   .BYT @204,@40,0,0,0
03611  DAFA  20 
03611  DAFB  00 
03611  DAFC  00 
03611  DAFD  00 
03612  DAFE  20 0C DC    DIV10  JSR MOVAF
03613  DB01  A9 F9              LDA #<TENC
03614  DB03  A0 DA              LDY #>TENC
03615  DB05  A2 00              LDX #0
03616  DB07  86 6F       FDIVF  STX ARISGN
03617  DB09  20 A2 DB           JSR MOVFM
03618  DB0C  4C 12 DB           JMP FDIVT
03619  DB0F  20 8C DA    FDIV   JSR CONUPK
03620  DB12  F0 76       FDIVT  BEQ DV0ERR
03621  DB14  20 1B DC           JSR ROUND
03622  DB17  A9 00              LDA #0
03623  DB19  38                 SEC
03624  DB1A  E5 61              SBC FACEXP
03625  DB1C  85 61              STA FACEXP
03626  DB1E  20 B7 DA           JSR MULDIV
03627  DB21  E6 61              INC FACEXP
03628  DB23  F0 BA              BEQ GOOVER
03629  DB25  A2 FC              LDX #253-ADDPRC
03630  DB27  A9 01              LDA #1
03631  DB29  A4 6A       DIVIDE LDY ARGHO
03632  DB2B  C4 62              CPY FACHO
03633  DB2D  D0 10              BNE SAVQUO
03634  DB2F  A4 6B              LDY ARGMOH
03635  DB31  C4 63              CPY FACMOH
03636  DB33  D0 0A              BNE SAVQUO






CODE19......PAGE 004E

LINE# LOC   CODE        LINE


03637  DB35  A4 6C              LDY ARGMO
03638  DB37  C4 64              CPY FACMO
03639  DB39  D0 04              BNE SAVQUO
03640  DB3B  A4 6D              LDY ARGLO
03641  DB3D  C4 65              CPY FACLO
03642  DB3F  08          SAVQUO PHP
03643  DB40  2A                 ROL A
03644  DB41  90 09              BCC QSHFT
03645  DB43  E8                 INX
03646  DB44  95 29              STA RESLO,X
03647  DB46  F0 32              BEQ LD100
03648  DB48  10 34              BPL DIVNRM
03649  DB4A  A9 01              LDA #1
03650  DB4C  28          QSHFT  PLP
03651  DB4D  B0 0E              BCS DIVSUB
03652  DB4F  06 6D       SHFARG ASL ARGLO
03653  DB51  26 6C              ROL ARGMO
03654  DB53  26 6B              ROL ARGMOH
03655  DB55  26 6A              ROL ARGHO
03656  DB57  B0 E6              BCS SAVQUO
03657  DB59  30 CE              BMI DIVIDE
03658  DB5B  10 E2              BPL SAVQUO
03659  DB5D  A8          DIVSUB TAY
03660  DB5E  A5 6D              LDA ARGLO
03661  DB60  E5 65              SBC FACLO
03662  DB62  85 6D              STA ARGLO
03663  DB64  A5 6C              LDA ARGMO
03664  DB66  E5 64              SBC FACMO
03665  DB68  85 6C              STA ARGMO
03666  DB6A  A5 6B              LDA ARGMOH
03667  DB6C  E5 63              SBC FACMOH
03668  DB6E  85 6B              STA ARGMOH
03669  DB70  A5 6A              LDA ARGHO
03670  DB72  E5 62              SBC FACHO
03671  DB74  85 6A              STA ARGHO
03672  DB76  98                 TYA
03673  DB77  4C 4F DB           JMP SHFARG
03674  DB7A  A9 40       LD100  LDA #@100
03675  DB7C  D0 CE              BNE QSHFT
03676  DB7E  0A          DIVNRM ASL A
03677  DB7F  0A                 ASL A
03678  DB80  0A                 ASL A
03679  DB81  0A                 ASL A
03680  DB82  0A                 ASL A
03681  DB83  0A                 ASL A
03682  DB84  85 70              STA FACOV
03683  DB86  28                 PLP
03684  DB87  4C 8F DB           JMP MOVFR
03685  DB8A  A2 14       DV0ERR LDX #ERRDVO
03686  DB8C  4C 37 C4           JMP ERROR
03687  DB8F              .END
03688  DB8F              .LIB   CODE20









CODE20......PAGE 004F

LINE# LOC   CODE        LINE


03690  DB8F  A5 26       MOVFR  LDA RESHO
03691  DB91  85 62              STA FACHO
03692  DB93  A5 27              LDA RESMOH
03693  DB95  85 63              STA FACMOH
03694  DB97  A5 28              LDA RESMO
03695  DB99  85 64              STA FACMO
03696  DB9B  A5 29              LDA RESLO
03697  DB9D  85 65              STA FACLO
03698  DB9F  4C D7 D8           JMP NORMAL
03699  DBA2  85 22       MOVFM  STA INDEX1
03700  DBA4  84 23              STY INDEX1+1
03701  DBA6  A0 04              LDY #3+ADDPRC
03702  DBA8  B1 22              LDA (INDEX1)Y
03703  DBAA  85 65              STA FACLO
03704  DBAC  88                 DEY
03705  DBAD  B1 22              LDA (INDEX1)Y
03706  DBAF  85 64              STA FACMO
03707  DBB1  88                 DEY
03708  DBB2  B1 22              LDA (INDEX1)Y
03709  DBB4  85 63              STA FACMOH
03710  DBB6  88                 DEY
03711  DBB7  B1 22              LDA (INDEX1)Y
03712  DBB9  85 66              STA FACSGN
03713  DBBB  09 80              ORA #@200
03714  DBBD  85 62              STA FACHO
03715  DBBF  88                 DEY
03716  DBC0  B1 22              LDA (INDEX1)Y
03717  DBC2  85 61              STA FACEXP
03718  DBC4  84 70              STY FACOV
03719  DBC6  60                 RTS   
03720  DBC7  A2 5C       MOV2F  LDX #TEMPF2
03721  DBC9  2C                 .BYT $2C
03722  DBCA  A2 57       MOV1F  LDX #TEMPF1
03723  DBCC  A0 00              LDY #0
03724  DBCE  F0 04              BEQ MOVMF
03725  DBD0  A6 49       MOVVF  LDX FORPNT
03726  DBD2  A4 4A              LDY FORPNT+1
03727  DBD4  20 1B DC    MOVMF  JSR ROUND
03728  DBD7  86 22              STX INDEX1
03729  DBD9  84 23              STY INDEX1+1
03730  DBDB  A0 04              LDY #3+ADDPRC
03731  DBDD  A5 65              LDA FACLO
03732  DBDF  91 22              STA (INDEX)Y
03733  DBE1  88                 DEY
03734  DBE2  A5 64              LDA FACMO
03735  DBE4  91 22              STA (INDEX)Y
03736  DBE6  88                 DEY
03737  DBE7  A5 63              LDA FACMOH
03738  DBE9  91 22              STA (INDEX)Y
03739  DBEB  88                 DEY
03740  DBEC  A5 66              LDA FACSGN
03741  DBEE  09 7F              ORA #@177
03742  DBF0  25 62              AND FACHO
03743  DBF2  91 22              STA (INDEX)Y
03744  DBF4  88                 DEY






CODE20......PAGE 0050

LINE# LOC   CODE        LINE


03745  DBF5  A5 61              LDA FACEXP
03746  DBF7  91 22              STA (INDEX)Y
03747  DBF9  84 70              STY FACOV
03748  DBFB  60                 RTS
03749  DBFC  A5 6E       MOVFA  LDA ARGSGN
03750  DBFE  85 66       MOVFA1 STA FACSGN
03751  DC00  A2 05              LDX #4+ADDPRC
03752  DC02  B5 68       MOVFAL LDA ARGEXP-1,X
03753  DC04  95 60              STA FACEXP-1,X
03754  DC06  CA                 DEX
03755  DC07  D0 F9              BNE MOVFAL
03756  DC09  86 70              STX FACOV
03757  DC0B  60                 RTS
03758  DC0C  20 1B DC    MOVAF  JSR ROUND
03759  DC0F  A2 06       MOVEF  LDX #5+ADDPRC
03760  DC11  B5 60       MOVAFL LDA FACEXP-1,X
03761  DC13  95 68              STA ARGEXP-1,X
03762  DC15  CA                 DEX
03763  DC16  D0 F9              BNE MOVAFL
03764  DC18  86 70              STX FACOV
03765  DC1A  60          MOVRTS RTS
03766  DC1B  A5 61       ROUND  LDA FACEXP
03767  DC1D  F0 FB              BEQ MOVRTS
03768  DC1F  06 70              ASL FACOV
03769  DC21  90 F7              BCC MOVRTS
03770  DC23  20 6F D9    INCRND JSR INCFAC
03771  DC26  D0 F2              BNE MOVRTS
03772  DC28  4C 38 D9           JMP RNDSHF
03773  DC2B  A5 61       SIGN   LDA FACEXP
03774  DC2D  F0 09              BEQ SIGNRT
03775  DC2F  A5 66       FCSIGN LDA FACSGN
03776  DC31  2A          FCOMPS ROL A
03777  DC32  A9 FF              LDA #$FF
03778  DC34  B0 02              BCS SIGNRT
03779  DC36  A9 01              LDA #1
03780  DC38  60          SIGNRT RTS
03781  DC39  20 2B DC    SGN    JSR SIGN
03782  DC3C  85 62       FLOAT  STA FACHO
03783  DC3E  A9 00              LDA #0
03784  DC40  85 63              STA FACHO+1
03785  DC42  A2 88              LDX #@210
03786  DC44  A5 62       FLOATS LDA FACHO
03787  DC46  49 FF              EOR #@377
03788  DC48  2A                 ROL A
03789  DC49  A9 00       FLOATC LDA #0
03790  DC4B  85 65              STA FACLO
03791  DC4D  85 64              STA FACMO
03792  DC4F  86 61       FLOATB STX FACEXP
03793  DC51  85 70              STA FACOV
03794  DC53  85 66              STA FACSGN
03795  DC55  4C D2 D8           JMP FADFLT
03796  DC58  46 66       ABS    LSR FACSGN
03797  DC5A  60                 RTS
03798  DC5B  85 24       FCOMP  STA INDEX2
03799  DC5D  84 25       FCOMPN STY INDEX2+1






CODE20......PAGE 0051

LINE# LOC   CODE        LINE


03800  DC5F  A0 00              LDY #0
03801  DC61  B1 24              LDA (INDEX2)Y
03802  DC63  C8                 INY
03803  DC64  AA                 TAX
03804  DC65  F0 C4              BEQ SIGN
03805  DC67  B1 24              LDA (INDEX2)Y
03806  DC69  45 66              EOR FACSGN
03807  DC6B  30 C2              BMI FCSIGN
03808  DC6D  E4 61              CPX FACEXP
03809  DC6F  D0 21              BNE FCOMPC
03810  DC71  B1 24              LDA (INDEX2)Y
03811  DC73  09 80              ORA #@200
03812  DC75  C5 62              CMP FACHO
03813  DC77  D0 19              BNE FCOMPC
03814  DC79  C8                 INY
03815  DC7A  B1 24              LDA (INDEX2)Y
03816  DC7C  C5 63              CMP FACMOH
03817  DC7E  D0 12              BNE FCOMPC
03818  DC80  C8                 INY
03819  DC81  B1 24              LDA (INDEX2)Y
03820  DC83  C5 64              CMP FACMO
03821  DC85  D0 0B              BNE FCOMPC
03822  DC87  C8                 INY
03823  DC88  A9 7F              LDA #@177
03824  DC8A  C5 70              CMP FACOV
03825  DC8C  B1 24              LDA (INDEX2)Y
03826  DC8E  E5 65              SBC FACLO
03827  DC90  F0 28              BEQ QINTRT
03828  DC92  A5 66       FCOMPC LDA FACSGN
03829  DC94  90 02              BCC FCOMPD
03830  DC96  49 FF              EOR #@377
03831  DC98  4C 31 DC    FCOMPD JMP FCOMPS
03832  DC9B              .END
03833  DC9B              .LIB   CODE21



























CODE21......PAGE 0052

LINE# LOC   CODE        LINE


03835  DC9B  A5 61       QINT   LDA FACEXP
03836  DC9D  F0 4A              BEQ CLRFAC
03837  DC9F  38                 SEC
03838  DCA0  E9 A0              SBC #ADDPR8+@230
03839  DCA2  24 66              BIT FACSGN
03840  DCA4  10 09              BPL QISHFT
03841  DCA6  AA                 TAX
03842  DCA7  A9 FF              LDA #@377
03843  DCA9  85 68              STA BITS
03844  DCAB  20 4D D9           JSR NEGFCH
03845  DCAE  8A                 TXA
03846  DCAF  A2 61       QISHFT LDX #FAC
03847  DCB1  C9 F9              CMP #$F9
03848  DCB3  10 06              BPL QINT1
03849  DCB5  20 99 D9           JSR SHIFTR
03850  DCB8  84 68              STY BITS
03851  DCBA  60          QINTRT RTS
03852  DCBB  A8          QINT1  TAY
03853  DCBC  A5 66              LDA FACSGN
03854  DCBE  29 80              AND #@200
03855  DCC0  46 62              LSR FACHO
03856  DCC2  05 62              ORA FACHO
03857  DCC4  85 62              STA FACHO
03858  DCC6  20 B0 D9           JSR ROLSHF
03859  DCC9  84 68              STY BITS
03860  DCCB  60                 RTS
03861  DCCC  A5 61       INT    LDA FACEXP
03862  DCCE  C9 A0              CMP #ADDPR8+@230
03863  DCD0  B0 20              BCS INTRTS
03864  DCD2  20 9B DC           JSR QINT
03865  DCD5  84 70              STY FACOV
03866  DCD7  A5 66              LDA FACSGN
03867  DCD9  84 66              STY FACSGN
03868  DCDB  49 80              EOR #@200
03869  DCDD  2A                 ROL A
03870  DCDE  A9 A0              LDA #@230+8
03871  DCE0  85 61              STA FACEXP
03872  DCE2  A5 65              LDA FACLO
03873  DCE4  85 07              STA INTEGR
03874  DCE6  4C D2 D8           JMP FADFLT
03875  DCE9  85 62       CLRFAC STA FACHO
03876  DCEB  85 63              STA FACMOH
03877  DCED  85 64              STA FACMO
03878  DCEF  85 65              STA FACLO
03879  DCF1  A8                 TAY 
03880  DCF2  60          INTRTS RTS
03881  DCF3  A0 00       FIN    LDY #@0
03882  DCF5  A2 0A              LDX #@11+ADDPRC
03883  DCF7  94 5D       FINZLP STY DECCNT,X
03884  DCF9  CA                 DEX
03885  DCFA  10 FB              BPL FINZLP
03886  DCFC  90 0F              BCC FINDGQ
03887  DCFE  C9 2D              CMP #'-
03888  DD00  D0 04              BNE QPLUS
03889  DD02  86 67              STX SGNFLG






CODE21......PAGE 0053

LINE# LOC   CODE        LINE


03890  DD04  F0 04              BEQ FINC
03891  DD06  C9 2B       QPLUS  CMP #'+
03892  DD08  D0 05              BNE FIN1
03893  DD0A  20 73 00    FINC   JSR CHRGET
03894  DD0D  90 5B       FINDGQ BCC FINDIG
03895  DD0F  C9 2E       FIN1   CMP #'.
03896  DD11  F0 2E              BEQ FINDP
03897  DD13  C9 45              CMP #'E
03898  DD15  D0 30              BNE FINE
03899  DD17  20 73 00           JSR CHRGET
03900  DD1A  90 17              BCC FNEDG1
03901  DD1C  C9 AB              CMP #MINUTK
03902  DD1E  F0 0E              BEQ FINEC1
03903  DD20  C9 2D              CMP #'-
03904  DD22  F0 0A              BEQ FINEC1
03905  DD24  C9 AA              CMP #PLUSTK
03906  DD26  F0 08              BEQ FINEC
03907  DD28  C9 2B              CMP #'+
03908  DD2A  F0 04              BEQ FINEC
03909  DD2C  D0 07              BNE FINEC2
03910  DD2E  66 60       FINEC1 ROR EXPSGN
03911  DD30  20 73 00    FINEC  JSR CHRGET
03912  DD33  90 5C       FNEDG1 BCC FINEDG
03913  DD35  24 60       FINEC2 BIT EXPSGN
03914  DD37  10 0E              BPL FINE
03915  DD39  A9 00              LDA #0
03916  DD3B  38                 SEC
03917  DD3C  E5 5E              SBC TENEXP
03918  DD3E  4C 49 DD           JMP FINE1
03919  DD41  66 5F       FINDP  ROR DPTFLG
03920  DD43  24 5F              BIT DPTFLG
03921  DD45  50 C3              BVC FINC
03922  DD47  A5 5E       FINE   LDA TENEXP
03923  DD49  38          FINE1  SEC
03924  DD4A  E5 5D              SBC DECCNT
03925  DD4C  85 5E              STA TENEXP
03926  DD4E  F0 12              BEQ FINQNG
03927  DD50  10 09              BPL FINMUL
03928  DD52  20 FE DA    FINDIV JSR DIV10
03929  DD55  E6 5E              INC TENEXP
03930  DD57  D0 F9              BNE FINDIV
03931  DD59  F0 07              BEQ FINQNG
03932  DD5B  20 E2 DA    FINMUL JSR MUL10
03933  DD5E  C6 5E              DEC TENEXP
03934  DD60  D0 F9              BNE FINMUL
03935  DD62  A5 67       FINQNG LDA SGNFLG
03936  DD64  30 01              BMI NEGXQS
03937  DD66  60                 RTS
03938  DD67  4C B4 DF    NEGXQS JMP NEGOP
03939  DD6A  48          FINDIG PHA
03940  DD6B  24 5F              BIT DPTFLG
03941  DD6D  10 02              BPL FINDG1
03942  DD6F  E6 5D              INC DECCNT
03943  DD71  20 E2 DA    FINDG1 JSR MUL10
03944  DD74  68                 PLA






CODE21......PAGE 0054

LINE# LOC   CODE        LINE


03945  DD75  38                 SEC
03946  DD76  E9 30              SBC #'0
03947  DD78  20 7E DD           JSR FINLOG
03948  DD7B  4C 0A DD           JMP FINC
03949  DD7E  48          FINLOG PHA
03950  DD7F  20 0C DC           JSR MOVAF
03951  DD82  68                 PLA
03952  DD83  20 3C DC           JSR FLOAT
03953  DD86  A5 6E              LDA ARGSGN
03954  DD88  45 66              EOR FACSGN
03955  DD8A  85 6F              STA ARISGN
03956  DD8C  A6 61              LDX FACEXP
03957  DD8E  4C 6A D8           JMP FADDT
03958  DD91  A5 5E       FINEDG LDA TENEXP
03959  DD93  C9 0A              CMP #@12
03960  DD95  90 09              BCC MLEX10
03961  DD97  A9 64              LDA #@144
03962  DD99  24 60              BIT EXPSGN
03963  DD9B  30 11              BMI MLEXMI
03964  DD9D  4C 7E D9           JMP OVERR
03965  DDA0  0A          MLEX10 ASL A
03966  DDA1  0A                 ASL A
03967  DDA2  18                 CLC
03968  DDA3  65 5E              ADC TENEXP
03969  DDA5  0A                 ASL A
03970  DDA6  18                 CLC
03971  DDA7  A0 00              LDY #0
03972  DDA9  71 7A              ADC (TXTPTR)Y
03973  DDAB  38                 SEC
03974  DDAC  E9 30              SBC #'0
03975  DDAE  85 5E       MLEXMI STA TENEXP
03976  DDB0  4C 30 DD           JMP FINEC
03977  DDB3              .END
03978  DDB3              .LIB   CODE22



























CODE22......PAGE 0055

LINE# LOC   CODE        LINE


03980  DDB3  9B          N0999  .BYT @233,@76,@274,@37,@375
03980  DDB4  3E 
03980  DDB5  BC 
03980  DDB6  1F 
03980  DDB7  FD 
03981  DDB8  9E          N9999  .BYT @236,@156,@153,@47,@375
03981  DDB9  6E 
03981  DDBA  6B 
03981  DDBB  27 
03981  DDBC  FD 
03982  DDBD  9E          NMIL   .BYT @236,@156,@153,@50,0
03982  DDBE  6E 
03982  DDBF  6B 
03982  DDC0  28 
03982  DDC1  00 
03983  DDC2  A9 71       INPRT  LDA #<INTXT
03984  DDC4  A0 C3              LDY #>INTXT
03985  DDC6  20 DA DD           JSR STROU2
03986  DDC9  A5 3A              LDA CURLIN+1
03987  DDCB  A6 39              LDX CURLIN
03988  DDCD  85 62       LINPRT STA FACHO
03989  DDCF  86 63              STX FACHO+1
03990  DDD1  A2 90              LDX #@220
03991  DDD3  38                 SEC
03992  DDD4  20 49 DC           JSR FLOATC
03993  DDD7  20 DF DD           JSR FOUTC
03994  DDDA  4C 1E CB    STROU2 JMP STROUT
03995  DDDD  A0 01       FOUT   LDY #1
03996  DDDF  A9 20       FOUTC  LDA #' 
03997  DDE1  24 66              BIT FACSGN
03998  DDE3  10 02              BPL FOUT1
03999  DDE5  A9 2D              LDA #'-
04000  DDE7  99 FF 00    FOUT1  STA FBUFFR-1,Y
04001  DDEA  85 66              STA FACSGN
04002  DDEC  84 71              STY FBUFPT
04003  DDEE  C8                 INY
04004  DDEF  A9 30              LDA #'0
04005  DDF1  A6 61              LDX FACEXP
04006  DDF3  D0 03              BNE *+5
04007  DDF5  4C 04 DF           JMP FOUT19
04008  DDF8  A9 00              LDA #0
04009  DDFA  E0 80              CPX #@200
04010  DDFC  F0 02              BEQ FOUT37
04011  DDFE  B0 09              BCS FOUT7
04012  DE00  A9 BD       FOUT37 LDA #<NMIL
04013  DE02  A0 DD              LDY #>NMIL
04014  DE04  20 28 DA           JSR FMULT
04015  DE07  A9 F7              LDA #250-ADDPR2-ADDPRC
04016  DE09  85 5D       FOUT7  STA DECCNT
04017  DE0B  A9 B8       FOUT4  LDA #<N9999
04018  DE0D  A0 DD              LDY #>N9999
04019  DE0F  20 5B DC           JSR FCOMP
04020  DE12  F0 1E              BEQ BIGGES
04021  DE14  10 12              BPL FOUT9
04022  DE16  A9 B3       FOUT3  LDA #<N0999






CODE22......PAGE 0056

LINE# LOC   CODE        LINE


04023  DE18  A0 DD              LDY #>N0999
04024  DE1A  20 5B DC           JSR FCOMP
04025  DE1D  F0 02              BEQ FOUT38
04026  DE1F  10 0E              BPL FOUT5
04027  DE21  20 E2 DA    FOUT38 JSR MUL10
04028  DE24  C6 5D              DEC DECCNT
04029  DE26  D0 EE              BNE FOUT3
04030  DE28  20 FE DA    FOUT9  JSR DIV10
04031  DE2B  E6 5D              INC DECCNT
04032  DE2D  D0 DC              BNE FOUT4
04033  DE2F  20 49 D8    FOUT5  JSR FADDH
04034  DE32  20 9B DC    BIGGES JSR QINT
04035  DE35  A2 01              LDX #1
04036  DE37  A5 5D              LDA DECCNT
04037  DE39  18                 CLC
04038  DE3A  69 0A              ADC #ADDPR2+ADDPRC+7
04039  DE3C  30 09              BMI FOUTPI
04040  DE3E  C9 0B              CMP #ADDPR2+ADDPRC+@10
04041  DE40  B0 06              BCS FOUT6
04042  DE42  69 FF              ADC #$FF
04043  DE44  AA                 TAX
04044  DE45  A9 02              LDA #2
04045  DE47  38          FOUTPI SEC
04046  DE48  E9 02       FOUT6  SBC #2
04047  DE4A  85 5E              STA TENEXP
04048  DE4C  86 5D              STX DECCNT
04049  DE4E  8A                 TXA
04050  DE4F  F0 02              BEQ FOUT39
04051  DE51  10 13              BPL FOUT8
04052  DE53  A4 71       FOUT39 LDY FBUFPT
04053  DE55  A9 2E              LDA #'.
04054  DE57  C8                 INY
04055  DE58  99 FF 00           STA FBUFFR-1,Y
04056  DE5B  8A                 TXA
04057  DE5C  F0 06              BEQ FOUT16
04058  DE5E  A9 30              LDA #'0
04059  DE60  C8                 INY
04060  DE61  99 FF 00           STA FBUFFR-1,Y
04061  DE64  84 71       FOUT16 STY FBUFPT
04062  DE66  A0 00       FOUT8  LDY #0
04063  DE68  A2 80       FOUTIM LDX #@200
04064  DE6A  A5 65       FOUT2  LDA FACLO
04065  DE6C  18                 CLC
04066  DE6D  79 19 DF           ADC FOUTBL+2+ADDPRC,Y
04067  DE70  85 65              STA FACLO
04068  DE72  A5 64              LDA FACMO
04069  DE74  79 18 DF           ADC FOUTBL+1+ADDPRC,Y
04070  DE77  85 64              STA FACMO
04071  DE79  A5 63              LDA FACMOH
04072  DE7B  79 17 DF           ADC FOUTBL+1,Y
04073  DE7E  85 63              STA FACMOH
04074  DE80  A5 62              LDA FACHO
04075  DE82  79 16 DF           ADC FOUTBL,Y
04076  DE85  85 62              STA FACHO
04077  DE87  E8                 INX






CODE22......PAGE 0057

LINE# LOC   CODE        LINE


04078  DE88  B0 04              BCS FOUT41
04079  DE8A  10 DE              BPL FOUT2
04080  DE8C  30 02              BMI FOUT40
04081  DE8E  30 DA       FOUT41 BMI FOUT2
04082  DE90  8A          FOUT40 TXA
04083  DE91  90 04              BCC FOUTYP
04084  DE93  49 FF              EOR #@377
04085  DE95  69 0A              ADC #@12
04086  DE97  69 2F       FOUTYP ADC #@57
04087  DE99  C8                 INY
04088  DE9A  C8                 INY
04089  DE9B  C8                 INY
04090  DE9C  C8                 INY
04091  DE9D  84 47              STY FDECPT
04092  DE9F  A4 71              LDY FBUFPT
04093  DEA1  C8                 INY
04094  DEA2  AA                 TAX
04095  DEA3  29 7F              AND #@177
04096  DEA5  99 FF 00           STA FBUFFR-1,Y
04097  DEA8  C6 5D              DEC DECCNT
04098  DEAA  D0 06              BNE STXBUF
04099  DEAC  A9 2E              LDA #'.
04100  DEAE  C8                 INY
04101  DEAF  99 FF 00           STA FBUFFR-1,Y
04102  DEB2  84 71       STXBUF STY FBUFPT
04103  DEB4  A4 47              LDY FDECPT
04104  DEB6  8A                 TXA
04105  DEB7  49 FF              EOR #@377
04106  DEB9  29 80              AND #@200
04107  DEBB  AA                 TAX
04108  DEBC  C0 24              CPY #FDCEND-FOUTBL
04109  DEBE  F0 04              BEQ FOULDY
04110  DEC0  C0 3C              CPY #TIMEND-FOUTBL
04111  DEC2  D0 A6              BNE FOUT2
04112  DEC4  A4 71       FOULDY LDY FBUFPT
04113  DEC6  B9 FF 00    FOUT11 LDA FBUFFR-1,Y
04114  DEC9  88                 DEY
04115  DECA  C9 30              CMP #'0
04116  DECC  F0 F8              BEQ FOUT11
04117  DECE  C9 2E              CMP #'.
04118  DED0  F0 01              BEQ FOUT12
04119  DED2  C8                 INY
04120  DED3  A9 2B       FOUT12 LDA #'+
04121  DED5  A6 5E              LDX TENEXP
04122  DED7  F0 2E              BEQ FOUT17
04123  DED9  10 08              BPL FOUT14
04124  DEDB  A9 00              LDA #0
04125  DEDD  38                 SEC
04126  DEDE  E5 5E              SBC TENEXP
04127  DEE0  AA                 TAX
04128  DEE1              .END
04129  DEE1              .LIB   CODE23









CODE23......PAGE 0058

LINE# LOC   CODE        LINE


04131  DEE1  A9 2D              LDA #'-
04132  DEE3  99 01 01    FOUT14 STA FBUFFR+1,Y
04133  DEE6  A9 45              LDA #'E
04134  DEE8  99 00 01           STA FBUFFR,Y
04135  DEEB  8A                 TXA
04136  DEEC  A2 2F              LDX #@57
04137  DEEE  38                 SEC
04138  DEEF  E8          FOUT15 INX
04139  DEF0  E9 0A              SBC #@12
04140  DEF2  B0 FB              BCS FOUT15
04141  DEF4  69 3A              ADC #@72
04142  DEF6  99 03 01           STA FBUFFR+3,Y
04143  DEF9  8A                 TXA
04144  DEFA  99 02 01           STA FBUFFR+2,Y
04145  DEFD  A9 00              LDA #0
04146  DEFF  99 04 01           STA FBUFFR+4,Y
04147  DF02  F0 08              BEQ FOUT20
04148  DF04  99 FF 00    FOUT19 STA FBUFFR-1,Y
04149  DF07  A9 00       FOUT17 LDA #0
04150  DF09  99 00 01           STA FBUFFR,Y
04151  DF0C  A9 00       FOUT20 LDA #<FBUFFR
04152  DF0E  A0 01              LDY #>FBUFFR
04153  DF10  60                 RTS
04154  DF11  80          FHALF  .BYT @200,0
04154  DF12  00 
04155  DF13  00          ZERO   .BYT 0,0,0
04155  DF14  00 
04155  DF15  00 
04156  DF16  FA          FOUTBL .BYT @372,@12,@37,0,0
04156  DF17  0A 
04156  DF18  1F 
04156  DF19  00 
04156  DF1A  00 
04157  DF1B  98                 .BYT @230,@226,@200,@377
04157  DF1C  96 
04157  DF1D  80 
04157  DF1E  FF 
04158  DF1F  F0                 .BYT @360,@275,@300,0
04158  DF20  BD 
04158  DF21  C0 
04158  DF22  00 
04159  DF23  01                 .BYT 1,@206,@240,@377
04159  DF24  86 
04159  DF25  A0 
04159  DF26  FF 
04160  DF27  FF                 .BYT @377,@330,@360,0,0
04160  DF28  D8 
04160  DF29  F0 
04160  DF2A  00 
04160  DF2B  00 
04161  DF2C  03                 .BYT 3,@350,@377,@377
04161  DF2D  E8 
04161  DF2E  FF 
04161  DF2F  FF 
04162  DF30  FF                 .BYT @377,@234,0,0,0,@12






CODE23......PAGE 0059

LINE# LOC   CODE        LINE


04162  DF31  9C 
04162  DF32  00 
04162  DF33  00 
04162  DF34  00 
04162  DF35  0A 
04163  DF36  FF                 .BYT @377,@377,@377,@377
04163  DF37  FF 
04163  DF38  FF 
04163  DF39  FF 
04164  DF3A  FF          FDCEND .BYT @377,@337,@12,@200
04164  DF3B  DF 
04164  DF3C  0A 
04164  DF3D  80 
04165  DF3E  00                 .BYT 0,3,@113,@300,@377
04165  DF3F  03 
04165  DF40  4B 
04165  DF41  C0 
04165  DF42  FF 
04166  DF43  FF                 .BYT @377,@163,@140,0,0
04166  DF44  73 
04166  DF45  60 
04166  DF46  00 
04166  DF47  00 
04167  DF48  0E                 .BYT @16,@20,@377,@377
04167  DF49  10 
04167  DF4A  FF 
04167  DF4B  FF 
04168  DF4C  FD                 .BYT @375,@250,0,0,0,@74
04168  DF4D  A8 
04168  DF4E  00 
04168  DF4F  00 
04168  DF50  00 
04168  DF51  3C 
04169  DF52              TIMEND
04170  DF52              ;
04171  DF52              CKSMC0 *=*+1           ;$C000 8K ROM CHECKSUM ADJ
04172  DF53              PATCHS *=*+30          ; PATCH AREA
04173  DF71              ;
04174  DF71  20 0C DC    SQR    JSR MOVAF
04175  DF74  A9 11              LDA #<FHALF
04176  DF76  A0 DF              LDY #>FHALF
04177  DF78  20 A2 DB           JSR MOVFM
04178  DF7B  F0 70       FPWRT  BEQ EXP
04179  DF7D  A5 69              LDA ARGEXP
04180  DF7F  D0 03              BNE FPWRT1
04181  DF81  4C F9 D8           JMP ZEROF1
04182  DF84  A2 4E       FPWRT1 LDX #<TEMPF3
04183  DF86  A0 00              LDY #>TEMPF3
04184  DF88  20 D4 DB           JSR MOVMF
04185  DF8B  A5 6E              LDA ARGSGN
04186  DF8D  10 0F              BPL FPWR1
04187  DF8F  20 CC DC           JSR INT
04188  DF92  A9 4E              LDA #<TEMPF3
04189  DF94  A0 00              LDY #>TEMPF3
04190  DF96  20 5B DC           JSR FCOMP






CODE23......PAGE 005A

LINE# LOC   CODE        LINE


04191  DF99  D0 03              BNE FPWR1
04192  DF9B  98                 TYA
04193  DF9C  A4 07              LDY INTEGR
04194  DF9E  20 FE DB    FPWR1  JSR MOVFA1
04195  DFA1  98                 TYA
04196  DFA2  48                 PHA
04197  DFA3  20 EA D9           JSR LOG
04198  DFA6  A9 4E              LDA #<TEMPF3
04199  DFA8  A0 00              LDY #>TEMPF3
04200  DFAA  20 28 DA           JSR FMULT
04201  DFAD  20 ED DF           JSR EXP
04202  DFB0  68                 PLA
04203  DFB1  4A                 LSR A
04204  DFB2  90 0A              BCC NEGRTS
04205  DFB4  A5 61       NEGOP  LDA FACEXP
04206  DFB6  F0 06              BEQ NEGRTS
04207  DFB8  A5 66              LDA FACSGN
04208  DFBA  49 FF              EOR #@377
04209  DFBC  85 66              STA FACSGN
04210  DFBE  60          NEGRTS RTS
04211  DFBF              .END
04212  DFBF              .LIB   CODE24







































CODE24......PAGE 005B

LINE# LOC   CODE        LINE


04214  DFBF  81          LOGEB2 .BYT @201,@70,@252,@73,@51
04214  DFC0  38 
04214  DFC1  AA 
04214  DFC2  3B 
04214  DFC3  29 
04215  DFC4  07          EXPCON .BYT 7,@161,@64,@130,@76
04215  DFC5  71 
04215  DFC6  34 
04215  DFC7  58 
04215  DFC8  3E 
04216  DFC9  56                 .BYT @126,@164,@26,@176
04216  DFCA  74 
04216  DFCB  16 
04216  DFCC  7E 
04217  DFCD  B3                 .BYT @263,@33,@167,@57
04217  DFCE  1B 
04217  DFCF  77 
04217  DFD0  2F 
04218  DFD1  EE                 .BYT @356,@343,@205,@172
04218  DFD2  E3 
04218  DFD3  85 
04218  DFD4  7A 
04219  DFD5  1D                 .BYT @35,@204,@34,@52
04219  DFD6  84 
04219  DFD7  1C 
04219  DFD8  2A 
04220  DFD9  7C                 .BYT @174,@143,@131,@130
04220  DFDA  63 
04220  DFDB  59 
04220  DFDC  58 
04221  DFDD  0A                 .BYT @12,@176,@165,@375
04221  DFDE  7E 
04221  DFDF  75 
04221  DFE0  FD 
04222  DFE1  E7                 .BYT @347,@306,@200,@61
04222  DFE2  C6 
04222  DFE3  80 
04222  DFE4  31 
04223  DFE5  72                 .BYT @162,@30,@20,@201
04223  DFE6  18 
04223  DFE7  10 
04223  DFE8  81 
04224  DFE9  00                 .BYT 0,0,0,0
04224  DFEA  00 
04224  DFEB  00 
04224  DFEC  00 
04225  DFED              ;
04226  DFED              ; START OF KERNAL ROM
04227  DFED              ;
04228  DFED  A9 BF       EXP    LDA #<LOGEB2
04229  DFEF  A0 DF              LDY #>LOGEB2
04230  DFF1  20 28 DA           JSR FMULT
04231  DFF4  A5 70              LDA FACOV
04232  DFF6  69 50              ADC #@120
04233  DFF8  90 03              BCC STOLD






CODE24......PAGE 005C

LINE# LOC   CODE        LINE


04234  DFFA  20 23 DC           JSR INCRND
04235  DFFD              .END
04236  DFFD              .LIB   CODE25


























































CODE25......PAGE 005D

LINE# LOC   CODE        LINE


04238  DFFD  85 56       STOLD  STA OLDOV
04239  DFFF  20 0F DC           JSR MOVEF
04240  E002  A5 61              LDA FACEXP
04241  E004  C9 88              CMP #@210
04242  E006  90 03              BCC EXP1
04243  E008  20 D4 DA    GOMLDV JSR MLDVEX
04244  E00B  20 CC DC    EXP1   JSR INT
04245  E00E  A5 07              LDA INTEGR
04246  E010  18                 CLC
04247  E011  69 81              ADC #@201
04248  E013  F0 F3              BEQ GOMLDV
04249  E015  38                 SEC
04250  E016  E9 01              SBC #1
04251  E018  48                 PHA
04252  E019  A2 05              LDX #4+ADDPRC
04253  E01B  B5 69       SWAPLP LDA ARGEXP,X
04254  E01D  B4 61              LDY FACEXP,X
04255  E01F  95 61              STA FACEXP,X
04256  E021  94 69              STY ARGEXP,X
04257  E023  CA                 DEX
04258  E024  10 F5              BPL SWAPLP
04259  E026  A5 56              LDA OLDOV
04260  E028  85 70              STA FACOV
04261  E02A  20 53 D8           JSR FSUBT
04262  E02D  20 B4 DF           JSR NEGOP
04263  E030  A9 C4              LDA #<EXPCON
04264  E032  A0 DF              LDY #>EXPCON
04265  E034  20 56 E0           JSR POLY
04266  E037  A9 00              LDA #0
04267  E039  85 6F              STA ARISGN
04268  E03B  68                 PLA
04269  E03C  20 B9 DA           JSR MLDEXP
04270  E03F  60                 RTS
04271  E040  85 71       POLYX  STA POLYPT
04272  E042  84 72              STY POLYPT+1
04273  E044  20 CA DB           JSR MOV1F
04274  E047  A9 57              LDA #TEMPF1
04275  E049  20 28 DA           JSR FMULT
04276  E04C  20 5A E0           JSR POLY1
04277  E04F  A9 57              LDA #<TEMPF1
04278  E051  A0 00              LDY #>TEMPF1
04279  E053  4C 28 DA           JMP FMULT
04280  E056  85 71       POLY   STA POLYPT
04281  E058  84 72              STY POLYPT+1
04282  E05A  20 C7 DB    POLY1  JSR MOV2F
04283  E05D  B1 71              LDA (POLYPT)Y
04284  E05F  85 67              STA DEGREE
04285  E061  A4 71              LDY POLYPT
04286  E063  C8                 INY
04287  E064  98                 TYA
04288  E065  D0 02              BNE POLY3
04289  E067  E6 72              INC POLYPT+1
04290  E069  85 71       POLY3  STA POLYPT
04291  E06B  A4 72              LDY POLYPT+1
04292  E06D  20 28 DA    POLY2  JSR FMULT






CODE25......PAGE 005E

LINE# LOC   CODE        LINE


04293  E070  A5 71              LDA POLYPT
04294  E072  A4 72              LDY POLYPT+1
04295  E074  18                 CLC
04296  E075  69 05              ADC #4+ADDPRC
04297  E077  90 01              BCC POLY4
04298  E079  C8                 INY
04299  E07A  85 71       POLY4  STA POLYPT
04300  E07C  84 72              STY POLYPT+1
04301  E07E  20 67 D8           JSR FADD
04302  E081  A9 5C              LDA #<TEMPF2
04303  E083  A0 00              LDY #>TEMPF2
04304  E085  C6 67              DEC DEGREE
04305  E087  D0 E4              BNE POLY2
04306  E089  60                 RTS
04307  E08A  98          RMULC  .BYT @230,@65,@104,@172,0
04307  E08B  35 
04307  E08C  44 
04307  E08D  7A 
04307  E08E  00 
04308  E08F  68          RADDC  .BYT @150,@50,@261,@106,0
04308  E090  28 
04308  E091  B1 
04308  E092  46 
04308  E093  00 
04309  E094  20 2B DC    RND    JSR SIGN
04310  E097  30 37              BMI RND1
04311  E099  D0 20              BNE QSETNR
04312  E09B  20 F3 FF           JSR RDBAS
04313  E09E  86 22              STX INDEX1
04314  E0A0  84 23              STY INDEX1+1
04315  E0A2  A0 04              LDY #4
04316  E0A4  B1 22              LDA (INDEX1)Y
04317  E0A6  85 62              STA FACHO
04318  E0A8  C8                 INY
04319  E0A9  B1 22              LDA (INDEX1)Y
04320  E0AB  85 64              STA FACMO
04321  E0AD  A0 08              LDY #8
04322  E0AF  B1 22              LDA (INDEX1)Y
04323  E0B1  85 63              STA FACMOH
04324  E0B3  C8                 INY
04325  E0B4  B1 22              LDA (INDEX1)Y
04326  E0B6  85 65              STA FACLO
04327  E0B8  4C E0 E0           JMP STRNEX
04328  E0BB  A9 8B       QSETNR LDA #<RNDX
04329  E0BD  A0 00              LDY #>RNDX
04330  E0BF  20 A2 DB           JSR MOVFM
04331  E0C2  A9 8A              LDA #<RMULC
04332  E0C4  A0 E0              LDY #>RMULC
04333  E0C6  20 28 DA           JSR FMULT
04334  E0C9  A9 8F              LDA #<RADDC
04335  E0CB  A0 E0              LDY #>RADDC
04336  E0CD  20 67 D8           JSR FADD
04337  E0D0  A6 65       RND1   LDX FACLO
04338  E0D2  A5 62              LDA FACHO
04339  E0D4  85 65              STA FACLO






CODE25......PAGE 005F

LINE# LOC   CODE        LINE


04340  E0D6  86 62              STX FACHO
04341  E0D8  A6 63              LDX FACMOH
04342  E0DA  A5 64              LDA FACMO
04343  E0DC  85 63              STA FACMOH
04344  E0DE  86 64              STX FACMO
04345  E0E0  A9 00       STRNEX LDA #0
04346  E0E2  85 66              STA FACSGN
04347  E0E4  A5 61              LDA FACEXP
04348  E0E6  85 70              STA FACOV
04349  E0E8  A9 80              LDA #@200
04350  E0EA  85 61              STA FACEXP
04351  E0EC  20 D7 D8           JSR NORMAL
04352  E0EF  A2 8B              LDX #<RNDX
04353  E0F1  A0 00              LDY #>RNDX
04354  E0F3  4C D4 DB    GMOVMF JMP MOVMF
04355  E0F6              .END
04356  E0F6              .LIB   CODE26












































CODE26......PAGE 0060

LINE# LOC   CODE        LINE


04358  E0F6              ;MOST REFERENCES TO KERNAL ARE DEFINED HERE
04359  E0F6              ;
04360  E0F6  C9 F0       EREXIT CMP #$F0        ;CHECK FOR SPECIAL CASE
04361  E0F8  D0 07              BNE EREXIX
04362  E0FA              ; TOP OF MEMORY HAS CHANGED
04363  E0FA  84 38              STY MEMSIZ+1
04364  E0FC  86 37              STX MEMSIZ
04365  E0FE  4C 63 C6           JMP CLEART      ;ACT AS IF HE TYPED CLEAR
04366  E101  AA          EREXIX TAX             ;SET TERMINATION FLAGS
04367  E102  D0 02              BNE EREXIY
04368  E104  A2 1E              LDX #ERBRK      ;BREAK ERROR
04369  E106  4C 37 C4    EREXIY JMP ERROR       ;NORMAL ERROR





04371  E109              CLSCHN =$FFCC





04373  E109  20 D2 FF    OUTCH  JSR $FFD2
04374  E10C  B0 E8              BCS EREXIT
04375  E10E  60                 RTS





04377  E10F  20 CF FF    INCHR  JSR $FFCF
04378  E112  B0 E2              BCS EREXIT
04379  E114  60                 RTS





04381  E115              CCALL  =$FFE7





04383  E115              SETTIM =$FFDB
04384  E115              RDTIM  =$FFDE





04386  E115  20 C9 FF    COOUT  JSR $FFC9
04387  E118  B0 DC              BCS EREXIT
04388  E11A  60                 RTS






CODE26......PAGE 0061

LINE# LOC   CODE        LINE


04390  E11B  20 C6 FF    COIN   JSR $FFC6
04391  E11E  B0 D6              BCS EREXIT
04392  E120  60                 RTS





04394  E121              READST =$FFB7





04396  E121  20 E4 FF    CGETL  JSR $FFE4
04397  E124  B0 D0              BCS EREXIT
04398  E126  60                 RTS





04400  E127              RDBAS  =$FFF3





04402  E127              SETMSG =$FF90





04404  E127              PLOT   =$FFF0





04406  E127  20 8A CD    CSYS   JSR FRMNUM      ;EVAL FORMULA
04407  E12A  20 F7 D7           JSR GETADR      ;CONVERT TO INT. ADDR
04408  E12D  A9 E1              LDA #>CSYSRZ    ;PUSH RETURN ADDRESS
04409  E12F  48                 PHA
04410  E130  A9 43              LDA #<CSYSRZ
04411  E132  48                 PHA
04412  E133  AD 0F 03           LDA SPREG       ;STATUS REG
04413  E136  48                 PHA
04414  E137  AD 0C 03           LDA SAREG       ;LOAD 6502 REGS
04415  E13A  AE 0D 03           LDX SXREG
04416  E13D  AC 0E 03           LDY SYREG
04417  E140  28                 PLP             ;LOAD 6502 STATUS REG
04418  E141  6C 14 00           JMP (LINNUM)    ;GO DO IT
04419  E144              CSYSRZ =*-1            ;RETURN TO HERE
04420  E144  08                 PHP             ;SAVE STATUS REG






CODE26......PAGE 0062

LINE# LOC   CODE        LINE


04421  E145  8D 0C 03           STA SAREG       ;SAVE 6502 REGS
04422  E148  8E 0D 03           STX SXREG
04423  E14B  8C 0E 03           STY SYREG
04424  E14E  68                 PLA             ;GET STATUS REG
04425  E14F  8D 0F 03           STA SPREG
04426  E152  60                 RTS             ;RETURN TO SYSTEM





04428  E153  20 D1 E1    CSAVE  JSR PLSV        ;PARSE PARMS
04429  E156  A6 2D              LDX VARTAB      ;END SAVE ADDR
04430  E158  A4 2E              LDY VARTAB+1
04431  E15A  A9 2B              LDA #<TXTTAB    ;INDIRECT WITH START ADDRESS
04432  E15C  20 D8 FF           JSR $FFD8       ;SAVE IT
04433  E15F  B0 95              BCS EREXIT
04434  E161  60                 RTS





04436  E162  A9 01       CVERF  LDA #1          ;VERIFY FLAG
04437  E164  2C                 .BYT $2C        ;SKIP TWO BYTES





04439  E165  A9 00       CLOAD  LDA #0          ;LOAD FLAG
04440  E167  85 0A              STA VERCK
04441  E169  20 D1 E1           JSR PLSV        ;PARSE PARAMETERS
04442  E16C              ;
04443  E16C              CLD10                  ; JSR $FFE1 ;CHECK RUN/STOP
04444  E16C              ; CMP #$FF ;DONE YET?
04445  E16C              ; BNE CLD10 ;STILL BOUNCING
04446  E16C  A5 0A              LDA VERCK
04447  E16E  A6 2B              LDX TXTTAB      ;.X AND .Y HAVE ALT...
04448  E170  A4 2C              LDY TXTTAB+1    ;...LOAD ADDRESS
04449  E172  20 D5 FF           JSR $FFD5       ;LOAD IT
04450  E175  B0 57              BCS JERXIT      ;PROBLEMS
04451  E177              ;
04452  E177  A5 0A              LDA VERCK
04453  E179  F0 1A              BEQ CLD50       ;WAS LOAD
04454  E17B              ;
04455  E17B              ;FINISH VERIFY
04456  E17B              ;
04457  E17B  A2 1C              LDX #ERVFY      ;ASSUME ERROR
04458  E17D  20 B7 FF           JSR $FFB7       ;READ STATUS
04459  E180  29 10              AND #$10        ;CHECK ERROR
04460  E182  F0 03              BEQ *+5
04461  E184  4C 37 C4           JMP ERROR
04462  E187              ;
04463  E187              ;PRINT VERIFY 'OK' IF DIRECT






CODE26......PAGE 0063

LINE# LOC   CODE        LINE


04464  E187              ;
04465  E187  A5 7A              LDA TXTPTR
04466  E189  C9 02              CMP #BUFPAG
04467  E18B  F0 07              BEQ CLD20
04468  E18D  A9 64              LDA #<OKMSG
04469  E18F  A0 C3              LDY #>OKMSG
04470  E191  4C 1E CB           JMP STROUT
04471  E194              ;
04472  E194  60          CLD20  RTS





04474  E195              ;
04475  E195              ;FINISH LOAD
04476  E195              ;
04477  E195  20 B7 FF    CLD50  JSR $FFB7       ;READ STATUS
04478  E198  29 BF              AND #$FF-$40    ;CLEAR E.O.I.
04479  E19A  F0 05              BEQ CLD60       ;WAS O.K.
04480  E19C  A2 1D              LDX #ERLOAD
04481  E19E  4C 37 C4           JMP ERROR
04482  E1A1              ;
04483  E1A1  A5 7B       CLD60  LDA TXTPTR+1
04484  E1A3  C9 02              CMP #BUFPAG     ;DIRECT?
04485  E1A5  D0 0E              BNE CLD70       ;NO...
04486  E1A7              ;
04487  E1A7  86 2D              STX VARTAB
04488  E1A9  84 2E              STY VARTAB+1    ;END LOAD ADDRESS
04489  E1AB  A9 76              LDA #<REDDY
04490  E1AD  A0 C3              LDY #>REDDY
04491  E1AF  20 1E CB           JSR STROUT
04492  E1B2  4C 2A C5           JMP FINI
04493  E1B5              ;
04494  E1B5              ;PROGRAM LOAD
04495  E1B5              ;
04496  E1B5  20 8E C6    CLD70  JSR STXTPT
04497  E1B8  4C 76 E4           JMP PLINK       ;************PATCH TO LINK OFFSET PROGS*****





04499  E1BB  20 16 E2    COPEN  JSR PAOC        ;PARSE STATEMENT
04500  E1BE  20 C0 FF           JSR $FFC0       ;OPEN IT
04501  E1C1  B0 0B              BCS JERXIT      ;BAD STUFF OR MEMSIZ CHANGE
04502  E1C3  60                 RTS             ;A.O.K.





04504  E1C4  20 16 E2    CCLOS  JSR PAOC        ;PARSE STATEMENT
04505  E1C7  A5 49              LDA ANDMSK      ;GET LA
04506  E1C9  20 C3 FF           JSR $FFC3       ;CLOSE IT






CODE26......PAGE 0064

LINE# LOC   CODE        LINE


04507  E1CC  90 C6              BCC CLD20       ;IT'S OKAY...NO MEMSIZE CHANGE
04508  E1CE              ;
04509  E1CE  4C F6 E0    JERXIT JMP EREXIT





04511  E1D1              ;
04512  E1D1              ;PARSE LOAD AND SAVE COMMANDS
04513  E1D1              ;
04514  E1D1              PLSV
04515  E1D1              ;DEFAULT FILE NAME
04516  E1D1              ;
04517  E1D1  A9 00              LDA #0          ;LENGTH=0
04518  E1D3  20 BD FF           JSR $FFBD
04519  E1D6              ;
04520  E1D6              ;DEFAULT DEVICE #
04521  E1D6              ;
04522  E1D6  A2 01              LDX #1          ;DEVICE #1
04523  E1D8  A0 00              LDY #0          ;COMMAND 0
04524  E1DA  20 BA FF           JSR $FFBA
04525  E1DD              ;
04526  E1DD  20 03 E2           JSR PAOC20      ;BY-PASS JUNK
04527  E1E0  20 54 E2           JSR PAOC15      ;GET/SET FILE NAME
04528  E1E3  20 03 E2           JSR PAOC20      ;BY-PASS JUNK
04529  E1E6  20 FD E1           JSR PLSV7       ;GET ',FA'
04530  E1E9  A0 00              LDY #0          ;COMMAND 0
04531  E1EB  86 49              STX ANDMSK
04532  E1ED  20 BA FF           JSR $FFBA
04533  E1F0  20 03 E2           JSR PAOC20      ;BY-PASS JUNK
04534  E1F3  20 FD E1           JSR PLSV7       ;GET ',SA'
04535  E1F6  8A                 TXA             ;NEW COMMAND
04536  E1F7  A8                 TAY
04537  E1F8  A6 49              LDX ANDMSK      ;DEVICE #
04538  E1FA  4C BA FF           JMP $FFBA





04540  E1FD              ;LOOK FOR COMMA FOLLOWED BY BYTE
04541  E1FD  20 0B E2    PLSV7  JSR PAOC30
04542  E200  4C 9E D7           JMP GETBYT





04544  E203              ;SKIP RETURN IF NEXT CHAR IS END
04545  E203              ;
04546  E203  20 79 00    PAOC20 JSR CHRGOT
04547  E206  D0 02              BNE PAOCX
04548  E208  68                 PLA
04549  E209  68                 PLA






CODE26......PAGE 0065

LINE# LOC   CODE        LINE


04550  E20A  60          PAOCX  RTS





04552  E20B              ;CHECK FOR COMMA AND GOOD STUFF
04553  E20B              ;
04554  E20B  20 FD CE    PAOC30 JSR CHKCOM      ;CHECK COMMA
04555  E20E  20 79 00    PAOC32 JSR CHRGOT      ;GET CURRENT
04556  E211  D0 F7              BNE PAOCX       ;IS O.K.
04557  E213  4C 08 CF    PAOC40 JMP SNERR       ;BAD...END OF LINE





04559  E216              ;PARSE OPEN/CLOSE
04560  E216              ;
04561  E216  A9 00       PAOC   LDA #0
04562  E218  20 BD FF           JSR $FFBD       ;DEFAULT FILE NAME
04563  E21B              ;
04564  E21B  20 0E E2           JSR PAOC32      ;MUST GOT SOMETHING
04565  E21E  20 9E D7           JSR GETBYT      ;GET LA
04566  E221  86 49              STX ANDMSK
04567  E223  8A                 TXA
04568  E224  A2 01              LDX #1          ;DEFAULT DEVICE
04569  E226  A0 00              LDY #0          ;DEFAULT COMMAND
04570  E228  20 BA FF           JSR $FFBA       ;STORE IT
04571  E22B  20 03 E2           JSR PAOC20      ;SKIP JUNK
04572  E22E  20 FD E1           JSR PLSV7
04573  E231  86 4A              STX EORMSK
04574  E233  A0 00              LDY #0          ;DEFAULT COMMAND
04575  E235  A5 49              LDA ANDMSK      ;GET LA
04576  E237  E0 03              CPX #3
04577  E239  90 01              BCC PAOC5
04578  E23B  88                 DEY             ;DEFAULT IEEE TO $FF
04579  E23C  20 BA FF    PAOC5  JSR $FFBA       ;STORE THEM
04580  E23F  20 03 E2           JSR PAOC20      ;SKIP JUNK
04581  E242  20 FD E1           JSR PLSV7       ;GET SA
04582  E245  8A                 TXA
04583  E246  A8                 TAY
04584  E247  A6 4A              LDX EORMSK
04585  E249  A5 49              LDA ANDMSK
04586  E24B  20 BA FF           JSR $FFBA       ;SET UP REAL EVEYTHING
04587  E24E  20 03 E2    PAOC7  JSR PAOC20
04588  E251  20 0B E2           JSR PAOC30
04589  E254  20 9E CD    PAOC15 JSR FRMEVL
04590  E257  20 A3 D6           JSR FRESTR      ;LENGTH IN .A
04591  E25A  A6 22              LDX INDEX1
04592  E25C  A4 23              LDY INDEX1+1
04593  E25E  4C BD FF           JMP $FFBD
04594  E261              .END
04595  E261              .LIB   TRIG







TRIG FUNCTIONS......PAGE 0066

LINE# LOC   CODE        LINE


04597  E261  A9 DD       COS    LDA #<PI2
04598  E263  A0 E2              LDY #>PI2
04599  E265  20 67 D8           JSR FADD
04600  E268  20 0C DC    SIN    JSR MOVAF
04601  E26B  A9 E2              LDA #<TWOPI
04602  E26D  A0 E2              LDY #>TWOPI
04603  E26F  A6 6E              LDX ARGSGN
04604  E271  20 07 DB           JSR FDIVF
04605  E274  20 0C DC           JSR MOVAF
04606  E277  20 CC DC           JSR INT
04607  E27A  A9 00              LDA #0
04608  E27C  85 6F              STA ARISGN
04609  E27E  20 53 D8           JSR FSUBT
04610  E281  A9 E7              LDA #<FR4
04611  E283  A0 E2              LDY #>FR4
04612  E285  20 50 D8           JSR FSUB
04613  E288  A5 66              LDA FACSGN
04614  E28A  48                 PHA
04615  E28B  10 0D              BPL SIN1
04616  E28D  20 49 D8           JSR FADDH
04617  E290  A5 66              LDA FACSGN
04618  E292  30 09              BMI SIN2
04619  E294  A5 12              LDA TANSGN
04620  E296  49 FF              EOR #$FF
04621  E298  85 12              STA TANSGN
04622  E29A  20 B4 DF    SIN1   JSR NEGOP
04623  E29D  A9 E7       SIN2   LDA #<FR4
04624  E29F  A0 E2              LDY #>FR4
04625  E2A1  20 67 D8           JSR FADD
04626  E2A4  68                 PLA
04627  E2A5  10 03              BPL SIN3
04628  E2A7  20 B4 DF           JSR NEGOP
04629  E2AA  A9 EC       SIN3   LDA #<SINCON
04630  E2AC  A0 E2              LDY #>SINCON
04631  E2AE  4C 40 E0           JMP POLYX
04632  E2B1  20 CA DB    TAN    JSR MOV1F
04633  E2B4  A9 00              LDA #0
04634  E2B6  85 12              STA TANSGN
04635  E2B8  20 68 E2           JSR SIN
04636  E2BB  A2 4E              LDX #<TEMPF3
04637  E2BD  A0 00              LDY #>TEMPF3
04638  E2BF  20 F3 E0           JSR GMOVMF
04639  E2C2  A9 57              LDA #<TEMPF1
04640  E2C4  A0 00              LDY #>TEMPF1
04641  E2C6  20 A2 DB           JSR MOVFM
04642  E2C9  A9 00              LDA #0
04643  E2CB  85 66              STA FACSGN
04644  E2CD  A5 12              LDA TANSGN
04645  E2CF  20 D9 E2           JSR COSC
04646  E2D2  A9 4E              LDA #<TEMPF3
04647  E2D4  A0 00              LDY #>TEMPF3
04648  E2D6  4C 0F DB           JMP FDIV
04649  E2D9  48          COSC   PHA
04650  E2DA  4C 9A E2           JMP SIN1
04651  E2DD  81          PI2    .BYT @201,@111,@17,@332,@242






TRIG FUNCTIONS......PAGE 0067

LINE# LOC   CODE        LINE


04651  E2DE  49 
04651  E2DF  0F 
04651  E2E0  DA 
04651  E2E1  A2 
04652  E2E2  83          TWOPI  .BYT @203,@111,@17,@332,@242
04652  E2E3  49 
04652  E2E4  0F 
04652  E2E5  DA 
04652  E2E6  A2 
04653  E2E7  7F          FR4    .BYT @177,0,0,0,0
04653  E2E8  00 
04653  E2E9  00 
04653  E2EA  00 
04653  E2EB  00 
04654  E2EC  05          SINCON .BYT 5,@204,@346,@32,@55
04654  E2ED  84 
04654  E2EE  E6 
04654  E2EF  1A 
04654  E2F0  2D 
04655  E2F1  1B                 .BYT @33,@206,@50,@7,@373
04655  E2F2  86 
04655  E2F3  28 
04655  E2F4  07 
04655  E2F5  FB 
04656  E2F6  F8                 .BYT @370,@207,@231,@150,@211
04656  E2F7  87 
04656  E2F8  99 
04656  E2F9  68 
04656  E2FA  89 
04657  E2FB  01                 .BYT 1,@207,@43,@65,@337,@341
04657  E2FC  87 
04657  E2FD  23 
04657  E2FE  35 
04657  E2FF  DF 
04657  E300  E1 
04658  E301  86                 .BYT @206,@245,@135,@347,@50,@203
04658  E302  A5 
04658  E303  5D 
04658  E304  E7 
04658  E305  28 
04658  E306  83 
04659  E307  49                 .BYT @111,@17,@332,@242
04659  E308  0F 
04659  E309  DA 
04659  E30A  A2 
04660  E30B  A5 66       ATN    LDA FACSGN
04661  E30D  48                 PHA
04662  E30E  10 03              BPL ATN1
04663  E310  20 B4 DF           JSR NEGOP
04664  E313  A5 61       ATN1   LDA FACEXP
04665  E315  48                 PHA
04666  E316  C9 81              CMP #@201
04667  E318  90 07              BCC ATN2
04668  E31A  A9 BC              LDA #<FONE
04669  E31C  A0 D9              LDY #>FONE






TRIG FUNCTIONS......PAGE 0068

LINE# LOC   CODE        LINE


04670  E31E  20 0F DB           JSR FDIV
04671  E321  A9 3B       ATN2   LDA #<ATNCON
04672  E323  A0 E3              LDY #>ATNCON
04673  E325  20 40 E0           JSR POLYX
04674  E328  68                 PLA
04675  E329  C9 81              CMP #@201
04676  E32B  90 07              BCC ATN3
04677  E32D  A9 DD              LDA #<PI2
04678  E32F  A0 E2              LDY #>PI2
04679  E331  20 50 D8           JSR FSUB
04680  E334  68          ATN3   PLA
04681  E335  10 03              BPL ATN4
04682  E337  4C B4 DF           JMP NEGOP
04683  E33A  60          ATN4   RTS
04684  E33B  0B          ATNCON .BYT @13,@166,@263,@203
04684  E33C  76 
04684  E33D  B3 
04684  E33E  83 
04685  E33F  BD                 .BYT @275,@323,@171,@36,@364
04685  E340  D3 
04685  E341  79 
04685  E342  1E 
04685  E343  F4 
04686  E344  A6                 .BYT @246,@365,@173,@203,@374
04686  E345  F5 
04686  E346  7B 
04686  E347  83 
04686  E348  FC 
04687  E349  B0                 .BYT @260,@20
04687  E34A  10 
04688  E34B  7C                 .BYT @174,@14,@37,@147,@312
04688  E34C  0C 
04688  E34D  1F 
04688  E34E  67 
04688  E34F  CA 
04689  E350  7C                 .BYT @174,@336,@123,@313,@301
04689  E351  DE 
04689  E352  53 
04689  E353  CB 
04689  E354  C1 
04690  E355  7D                 .BYT @175,@24,@144,@160,@114
04690  E356  14 
04690  E357  64 
04690  E358  70 
04690  E359  4C 
04691  E35A  7D                 .BYT @175,@267,@352,@121,@172
04691  E35B  B7 
04691  E35C  EA 
04691  E35D  51 
04691  E35E  7A 
04692  E35F  7D                 .BYT @175,@143,@60,@210,@176
04692  E360  63 
04692  E361  30 
04692  E362  88 
04692  E363  7E 






TRIG FUNCTIONS......PAGE 0069

LINE# LOC   CODE        LINE


04693  E364  7E                 .BYT @176,@222,@104,@231,@72
04693  E365  92 
04693  E366  44 
04693  E367  99 
04693  E368  3A 
04694  E369  7E                 .BYT @176,@114,@314,@221,@307
04694  E36A  4C 
04694  E36B  CC 
04694  E36C  91 
04694  E36D  C7 
04695  E36E  7F                 .BYT @177,@252,@252,@252,@23
04695  E36F  AA 
04695  E370  AA 
04695  E371  AA 
04695  E372  13 
04696  E373  81                 .BYT @201,0,0,0,0
04696  E374  00 
04696  E375  00 
04696  E376  00 
04696  E377  00 
04697  E378              .END
04698  E378              .LIB   INIT







































INIT......PAGE 006A

LINE# LOC   CODE        LINE


04700  E378  20 5B E4    INIT   JSR INITV       ;GO INIT VECTORS
04701  E37B  20 A4 E3           JSR INITCZ      ;GO INIT CHARGET & Z-PAGE
04702  E37E  20 04 E4           JSR INITMS      ;GO PRINT INITILIZATION MESSAGES
04703  E381  A2 FB              LDX #STKEND-256 ;SET UP END OF STACK
04704  E383  9A                 TXS
04705  E384  4C 74 C4           JMP READY       ;GO TO READY






04707  E387  E6 7A       INITAT INC CHRGET+7
04708  E389  D0 02              BNE CHDGOT
04709  E38B  E6 7B              INC CHRGET+8
04710  E38D  AD 60 EA    CHDGOT LDA 60000
04711  E390  C9 3A              CMP #':
04712  E392  B0 0A              BCS CHDRTS
04713  E394  C9 20              CMP #' 
04714  E396  F0 EF              BEQ INITAT
04715  E398  38                 SEC
04716  E399  E9 30              SBC #'0
04717  E39B  38                 SEC
04718  E39C  E9 D0              SBC #$D0
04719  E39E  60          CHDRTS RTS
04720  E39F  80                 .BYT 128,79,199,82,88
04720  E3A0  4F 
04720  E3A1  C7 
04720  E3A2  52 
04720  E3A3  58 






04722  E3A4  A9 4C       INITCZ LDA #76
04723  E3A6  85 54              STA JMPER
04724  E3A8  85 00              STA USRPOK
04725  E3AA  A9 48              LDA #<FCERR
04726  E3AC  A0 D2              LDY #>FCERR
04727  E3AE  85 01              STA USRPOK+1
04728  E3B0  84 02              STY USRPOK+2
04729  E3B2  A9 91              LDA #<GIVAYF
04730  E3B4  A0 D3              LDY #>GIVAYF
04731  E3B6  85 05              STA ADRAY2
04732  E3B8  84 06              STY ADRAY2+1
04733  E3BA  A9 AA              LDA #<FLPINT
04734  E3BC  A0 D1              LDY #>FLPINT
04735  E3BE  85 03              STA ADRAY1
04736  E3C0  84 04              STY ADRAY1+1
04737  E3C2  A2 1C              LDX #INITCZ-INITAT-1
04738  E3C4  BD 87 E3    MOVCHG LDA INITAT,X
04739  E3C7  95 73              STA CHRGET,X
04740  E3C9  CA                 DEX






INIT......PAGE 006B

LINE# LOC   CODE        LINE


04741  E3CA  10 F8              BPL MOVCHG
04742  E3CC  A9 03              LDA #STRSIZ
04743  E3CE  85 53              STA FOUR6
04744  E3D0  A9 00              LDA #0
04745  E3D2  85 68              STA BITS
04746  E3D4  85 13              STA CHANNL
04747  E3D6  85 18              STA LASTPT+1
04748  E3D8  A2 01              LDX #1
04749  E3DA  8E FD 01           STX BUF-3
04750  E3DD  8E FC 01           STX BUF-4
04751  E3E0  A2 19              LDX #TEMPST
04752  E3E2  86 16              STX TEMPPT
04753  E3E4  38                 SEC             ;READ BOTTOM OF MEMORY
04754  E3E5  20 9C FF           JSR $FF9C
04755  E3E8  86 2B              STX TXTTAB      ;NOW TXTAB HAS IT
04756  E3EA  84 2C              STY TXTTAB+1
04757  E3EC  38                 SEC
04758  E3ED  20 99 FF           JSR $FF99       ;READ TOP OF MEMORY
04759  E3F0  86 37       USEDEF STX MEMSIZ
04760  E3F2  84 38              STY MEMSIZ+1
04761  E3F4  86 33              STX FRETOP
04762  E3F6  84 34              STY FRETOP+1
04763  E3F8  A0 00              LDY #0
04764  E3FA  98                 TYA
04765  E3FB  91 2B              STA (TXTTAB)Y
04766  E3FD  E6 2B              INC TXTTAB
04767  E3FF  D0 02              BNE INIT20
04768  E401  E6 2C              INC TXTTAB+1
04769  E403  60          INIT20 RTS






04771  E404  A5 2B       INITMS LDA TXTTAB
04772  E406  A4 2C              LDY TXTTAB+1
04773  E408  20 08 C4           JSR REASON
04774  E40B  A9 36              LDA #<FREMES
04775  E40D  A0 E4              LDY #>FREMES
04776  E40F  20 1E CB           JSR STROUT
04777  E412  A5 37              LDA MEMSIZ
04778  E414  38                 SEC
04779  E415  E5 2B              SBC TXTTAB
04780  E417  AA                 TAX
04781  E418  A5 38              LDA MEMSIZ+1
04782  E41A  E5 2C              SBC TXTTAB+1
04783  E41C  20 CD DD           JSR LINPRT
04784  E41F  A9 29              LDA #<WORDS
04785  E421  A0 E4              LDY #>WORDS
04786  E423  20 1E CB           JSR STROUT
04787  E426  4C 44 C6           JMP SCRTCH









INIT......PAGE 006C

LINE# LOC   CODE        LINE


04789  E429  20 42       WORDS  .BYT ' BYTES FREE',13,0
04789  E434  0D 
04789  E435  00 
04790  E436  93          FREMES .BYT 147,'**** CBM BASIC V2 ****',13,0
04790  E437  2A 2A 
04790  E44D  0D 
04790  E44E  00 




04792  E44F  3A C4       BVTRS  .WOR NERROR,NMAIN,NCRNCH,NQPLOP,NGONE,NEVAL
04792  E451  83 C4 
04792  E453  7C C5 
04792  E455  1A C7 
04792  E457  E4 C7 
04792  E459  86 CE 
04793  E45B              ;
04794  E45B  A2 0B       INITV  LDX #INITV-BVTRS-1 ;INIT VECTORS
04795  E45D  BD 4F E4    INITV1 LDA BVTRS,X
04796  E460  9D 00 03           STA IERROR,X
04797  E463  CA                 DEX
04798  E464  10 F7              BPL INITV1
04799  E466  60                 RTS




04801  E467  20 CC FF    PANIC  JSR CLSCHN      ;WARM START BASIC...
04802  E46A  A9 00              LDA #0          ;CLEAR CHANNELS
04803  E46C  85 13              STA CHANNL
04804  E46E  20 7A C6           JSR STKINI      ;RESTORE STACK
04805  E471  58                 CLI             ;ENABLE IRQ'S
04806  E472  4C 74 C4           JMP READY       ;DISPLAY READY ENTRY
04807  E475  00          CHKE0  .BYT $00
04808  E476              ;
04809  E476              ;PROGRAM LOAD PATCH
04810  E476              ;
04811  E476  20 33 C5    PLINK  JSR LNKPRG      ;GO LINK THE LOADED PROGRAM
04812  E479  4C 77 C6           JMP FLOAD       ;USE NORMAL ENTRY TO KEEP VARIABLES
04813  E47C              .END
04814  E47C              .END


ERRORS = 00000


SYMBOL TABLE

SYMBOL VALUE
 ABS      DC58    ADDEND   0028    ADDFRS   C3B0    ADDIND   D320
 ADDON    C8FB    ADDPR2   0002    ADDPR4   0004    ADDPR8   0008
 ADDPRC   0001    ADRAY1   0003    ADRAY2   0005    AFFRTS   C637
 ANDMSK   0049    ANDOP    CFE9    ARGEXP   0069    ARGHO    006A








SYMBOL TABLE

SYMBOL VALUE
 ARGLO    006D    ARGMO    006C    ARGMOH   006B    ARGSGN   006E
 ARISGN   006F    ARYGET   D5AE    ARYPNT   0058    ARYSTR   D5B0
 ARYTAB   002F    ARYVA2   D56E    ARYVA3   D572    ARYVAR   D566
 ARYVGO   D57D    ASC      D78B    ASPAC    CB0E    ATN      E30B
 ATN1     E313    ATN2     E321    ATN3     E334    ATN4     E33A
 ATNCON   E33B    AYINT    D1BF    BIGGES   DE32    BITS     0068
 BLT1     C3DC    BLTLP    C3E8    BLTU     C3B8    BLTUC    C3BF
 BRKTXT   C381    BSERR    D245    BSERR7   D308    BUF      0200
 BUFFUL   CBEA    BUFLEN   0059    BUFOFS   0200    BUFPAG   0002
 BUFPTR   0071    BVTRS    E44F    CAT      D63D    CCALL    FFE7
 CCLOS    E1C4    CGETL    E121    CHANNL   0013    CHARAC   0007
 CHDGOT   E38D    CHDRTS   E39E    CHEAD    C53C    CHKCLS   CEF7
 CHKCOM   CEFD    CHKE0    E475    CHKERR   CD99    CHKNUM   CD8D
 CHKOK    CD96    CHKOPN   CEFA    CHKSTR   CD8F    CHKVAL   CD90
 CHRD     D6EC    CHRGET   0073    CHRGOT   0079    CHRRTS   008A
 CKSMC0   DF52    CLD10    E16C    CLD20    E194    CLD50    E195
 CLD60    E1A1    CLD70    E1B5    CLEAR    C65E    CLEARC   C660
 CLEART   C663    CLMWID   000B    CLOAD    E165    CLRFAC   DCE9
 CLSCHN   FFCC    CMD      CA86    CMPFOR   C3A4    CMPSPC   C58E
 COIN     E11B    COLIS    C5DC    COMBYT   D7F1    COMPRT   CAE8
 CONINT   D7A1    CONT     C857    CONTRT   C870    CONUPK   DA8C
 COOUT    E115    COPEN    E1BB    COPFLT   C9D6    COPSTR   C9D9
 COPY     CA52    COPYC    CA68    COS      E261    COSC     E2D9
 COUNT    000B    CRDO     CAD7    CRDONE   C609    CRFIN    CAE5
 CRTSKP   CB42    CRUNCH   C579    CSAVE    E153    CSYS     E127
 CSYSRZ   E143    CURLIN   0039    CURTOL   0071    CVERF    E162
 CZLOOP   C544    DATA     C8F8    DATAN    C906    DATATK   0083
 DATBK    CC4D    DATBK1   CC51    DATLIN   003F    DATLOP   CCB8
 DATPTR   0041    DECBLT   C3F3    DECCNT   005D    DECCUR   D2CD
 DEF      D3B3    DEFFIN   D44F    DEFPNT   004E    DEFSTF   D418
 DEGREE   0067    DIM      D081    DIM3     D07E    DIMFLG   000C
 DIMRTS   D34B    DIRCN1   C7CE    DIRCON   C7BE    DIRIS    C849
 DIV10    DAFE    DIVIDE   DB29    DIVNRM   DB7E    DIVSUB   DB5D
 DNTCPY   CA4B    DOAGIN   CB6B    DOCMP    D072    DOCO     C948
 DOCOND   C940    DOCSTR   CD97    DOMASK   0012    DOMIN    CF0D
 DOPRE1   CE20    DOPREC   CDF9    DOREL    D016    DORES    000F
 DOSGFL   D81B    DPTFLG   005F    DSCPNT   0050    DSCTMP   0061
 DV0ERR   DB8A    DVAR     D5C7    DVAR2    D5DC    DVAR3    D5E6
 DVARS    D5BD    DVARTS   D5F6    EATEM    D0B0    END      C831
 ENDCHR   0008    ENDCON   C84B    ENDREL   CDD7    ENDTK    0080
 EORMSK   004A    EPSGN    0060    EQULTK   00B2    ERBRK    001E
 EREXIT   E0F6    EREXIX   E101    EREXIY   E106    ERLOAD   001D
 ERR      C369    ERR01    C19E    ERR02    C1AC    ERR03    C1B5
 ERR04    C1C2    ERR05    C1D0    ERR06    C1E2    ERR07    C1F0
 ERR08    C1FF    ERR09    C210    ERR10    C225    ERR11    C235
 ERR12    C23B    ERR13    C24F    ERR14    C25A    ERR15    C26A
 ERR16    C272    ERR17    C27F    ERR18    C290    ERR19    C29D
 ERR20    C2AA    ERR21    C2BA    ERR22    C2C8    ERR23    C2D5
 ERR24    C2E4    ERR25    C2ED    ERR26    C300    ERR27    C30E
 ERR28    C31E    ERR29    C324    ERR30    C383    ERRBD    0018
 ERRBS    0012    ERRCN    001A    ERRCRD   C44E    ERRDD    0013
 ERRDIR   D3A6    ERRDVO   0014    ERRFC    000E    ERRFIN   C469
 ERRGO2   D4D2    ERRGO3   D24A    ERRGO4   CD9B    ERRGO5   CD32
 ERRGUF   D3AE    ERRID    0015    ERRLS    0017    ERRNF    000A
 ERROD    000D    ERROM    0010    ERROR    C437    ERROV    000F








SYMBOL TABLE

SYMBOL VALUE
 ERRRG    000C    ERRSN    000B    ERRST    0019    ERRTAB   C328
 ERRTM    0016    ERRUF    001B    ERRUS    0011    ERVFY    001C
 EVAL     CE83    EVAL0    CE8A    EVAL1    CE8F    EVAL2    CE92
 EVAL3    CECC    EVAL4    CEE3    EXCHQT   C911    EXIGNT   CCFC
 EXP      DFED    EXP1     E00B    EXPCON   DFC4    EXPSGN   0060
 FAC      0061    FACEXP   0061    FACHO    0062    FACLO    0065
 FACMO    0064    FACMOH   0063    FACOV    0070    FACSGN   0066
 FADD     D867    FADD1    D897    FADD2    D8FE    FADD4    D8A3
 FADD5    D862    FADDA    D893    FADDC    D877    FADDH    D849
 FADDT    D86A    FADFLT   D8D2    FBUFFR   0100    FBUFPT   0071
 FCERR    D248    FCERR2   CA24    FCOMP    DC5B    FCOMPC   DC92
 FCOMPD   DC98    FCOMPN   DC5D    FCOMPS   DC31    FCSIGN   DC2F
 FDCEND   DF3A    FDECPT   0047    FDIV     DB0F    FDIVF    DB07
 FDIVT    DB12    FFLOOP   C38F    FFRTS    C3B7    FHALF    DF11
 FIN      DCF3    FIN1     DD0F    FINC     DD0A    FINDG1   DD71
 FINDGQ   DD0D    FINDIG   DD6A    FINDIV   DD52    FINDP    DD41
 FINE     DD47    FINE1    DD49    FINEC    DD30    FINEC1   DD2E
 FINEC2   DD35    FINEDG   DD91    FINGO    CFD6    FINI     C52A
 FININ1   C576    FININL   CACA    FINLOG   DD7E    FINML6   DAED
 FINMUL   DD5B    FINNOW   D18F    FINPTR   D185    FINQNG   DD62
 FINRE2   CE11    FINREL   CE07    FINZLP   DCF7    FLINRT   C640
 FLNRTS   C641    FLOAD    C677    FLOAT    DC3C    FLOATB   DC4F
 FLOATC   DC49    FLOATS   DC44    FLPINT   D1AA    FMAPTR   D194
 FMULT    DA28    FMULTT   DA2B    FNDFOR   C38A    FNDLIN   C613
 FNDLNC   C617    FNDLO1   C62E    FNDOER   D3F4    FNDVAR   D52A
 FNEDG1   DD33    FNTK     00A5    FNWAIT   D82D    FONE     D9BC
 FOR      C742    FORPNT   0049    FORPSH   CE43    FORSIZ   0012
 FORTK    0081    FOULDY   DEC4    FOUR6    0053    FOUT     DDDD
 FOUT1    DDE7    FOUT11   DEC6    FOUT12   DED3    FOUT14   DEE3
 FOUT15   DEEF    FOUT16   DE64    FOUT17   DF07    FOUT19   DF04
 FOUT2    DE6A    FOUT20   DF0C    FOUT3    DE16    FOUT37   DE00
 FOUT38   DE21    FOUT39   DE53    FOUT4    DE0B    FOUT40   DE90
 FOUT41   DE8E    FOUT5    DE2F    FOUT6    DE48    FOUT7    DE09
 FOUT8    DE66    FOUT9    DE28    FOUTBL   DF16    FOUTC    DDDF
 FOUTIM   DE68    FOUTPI   DE47    FOUTYP   DE97    FPWR1    DF9E
 FPWRT    DF7B    FPWRT1   DF84    FR4      E2E7    FRE      D37D
 FREFAC   D6A6    FREMES   E436    FREPLA   D6D5    FRERTS   D6EB
 FRESPC   0035    FRESTR   D6A3    FRETMP   D6AA    FRETMS   D6DB
 FRETOP   0033    FRETRT   D6D6    FRMEV1   CDA4    FRMEVL   CD9E
 FRMNUM   CD8A    FSUB     D850    FSUBT    D853    FUNDSP   C052
 GARBA2   D526    GARBAG   D516    GARBFL   000F    GET      CB7B
 GETADR   D7F7    GETAGN   CBD6    GETBPT   C5C7    GETBYT   D79E
 GETCMP   D066    GETCON   D818    GETDEF   D2EA    GETDTL   CB57
 GETERR   C456    GETFNM   D3E1    GETFOR   CD24    GETNTH   CC4A
 GETNUM   D7EB    GETSPA   D4F4    GETSPT   CA2C    GETSTK   C3FB
 GETTIM   CF84    GETTTY   CB92    GINLIN   CC03    GIVAYF   D391
 GLET     C804    GMOVMF   E0F3    GOBADV   D138    GOFLOT   D07B
 GOFUC    D798    GOGO     D5B8    GOLST    C6A4    GOMLDV   E008
 GOMOVF   CFA0    GONE     C7E1    GONE2    C7EF    GONE3    C7ED
 GONPRC   CF0F    GOOO     CF5D    GOOOOO   CF6E    GOOVER   DADF
 GORDY    C854    GORTS    C8D1    GOSUB    C883    GOSUTK   008D
 GOTARY   D24D    GOTK     00CB    GOTNUM   CA27    GOTO     C8A0
 GOTOTK   0089    GRBPAS   D606    GRBPNT   004E    GRBRTS   D601
 GRBTOP   005F    GREASE   D2B9    GREATK   00B1    GRODY    C714
 GTBYTC   D79B    HAVFOR   CD35    HIGHDS   0058    HIGHTR   005A








SYMBOL TABLE

SYMBOL VALUE
 ICRNCH   0304    IERROR   0300    IEVAL    030A    IF       C928
 IGONE    0308    IMAIN    0302    INCFAC   D96F    INCFRT   D97D
 INCHR    E10F    INCRND   DC23    INDEX    0022    INDEX1   0022
 INDEX2   0024    INDICE   0064    INDLOP   D1DB    INIT     E378
 INIT20   E403    INITAT   E387    INITCZ   E3A4    INITMS   E404
 INITV    E45B    INITV1   E45D    INLIN    C560    INLINC   C562
 INLOOP   CC15    INLPN1   D30F    INLPN2   D30E    INLPNM   D2F2
 INPCO1   CC0F    INPCOM   C9DA    INPCON   CC0D    INPFLG   0011
 INPPTR   0043    INPRT    DDC2    INPRTS   CCFB    INPUT    CBBF
 INPUTN   CBA5    INT      DCCC    INTEGR   0007    INTERR   D09C
 INTFLG   000E    INTIDX   D1B2    INTRTS   DCF2    INTXT    C371
 IODONE   CBB5    IORELE   CBB7    IQPLOP   0306    ISARY    D1D1
 ISCNTC   C82C    ISCRTS   C82B    ISFUN    CFA7    ISLETC   D113
 ISLRTS   D11C    ISSEC    D0AF    ISVAR    CF28    ISVRET   CF2B
 JERXIT   E1CE    JMPER    0054    JSRGM    D1A0    KLOOP    C582
 KLOOP1   C5A4    LASNUM   00C7    LASTPT   0017    LD100    DB7A
 LDFONE   C78B    LDZR     D123    LEFTD    D700    LEN      D77C
 LEN1     D782    LESSTK   00B3    LET      C9A5    LINGET   C96B
 LINLEN   0016    LINNUM   0014    LINPRT   DDCD    LIST     C69C
 LIST4    C6C9    LNKPRG   C533    LNKRTS   C55F    LOFBUF   00FF
 LOG      D9EA    LOG1     D9F4    LOG2     D9E5    LOGCN2   D9C1
 LOGEB2   DFBF    LOGERR   D9F1    LOOPDN   CD78    LOPFDA   D21C
 LOPFDV   D228    LOPFN    D0FB    LOPFND   D0F1    LOPPTA   D286
 LOPREL   CDBB    LOWDS    005D    LOWTR    005F    LPOPER   CDA9
 LSTEND   C6BB    LSTPNT   0049    LUK4IT   C8BC    LUKALL   C8C0
 MAIN     C480    MAIN1    C49C    MEMSIZ   0037    MID2     D748
 MIDD     D737    MINUTK   00AB    MLDEXP   DAB9    MLDVEX   DAD4
 MLEX10   DDA0    MLEXMI   DDAE    MLOOP    C4DF    MLTPL1   DA5E
 MLTPL2   DA61    MLTPL3   DA7D    MLTPLY   DA59    MORCO1   CAEE
 MOREN1   C3EC    MORLIN   C971    MORSTS   C807    MOV1F    DBCA
 MOV2F    DBC7    MOVAF    DC0C    MOVAFL   DC11    MOVCHG   E3C4
 MOVDO    D68C    MOVEF    DC0F    MOVFA    DBFC    MOVFA1   DBFE
 MOVFAL   DC02    MOVFM    DBA2    MOVFR    DB8F    MOVINS   D67A
 MOVLP    D690    MOVMF    DBD4    MOVRTS   DC1A    MOVSTR   D688
 MOVVF    DBD0    MUL10    DAE2    MUL10R   DAF8    MULDIV   DAB7
 MULSHF   D983    MULTRT   DA8B    MUSTCR   C5AC    MVDONE   D699
 MVSTRT   D6A2    N0999    DDB3    N32768   D1A5    N9999    DDB8
 NCMPOS   001E    NCRNCH   C57C    NEGFAC   D947    NEGFCH   D94D
 NEGHLF   D9E0    NEGOP    DFB4    NEGPRC   CDFA    NEGRTS   DFBE
 NEGTAB   C095    NEGXQS   DD67    NERROR   C43A    NEVAL    CE86
 NEWCHR   CA9D    NEWSGO   CD75    NEWSTT   C7AE    NEXT     CD1E
 NGONE    C7E4    NGONE1   C7E7    NMAIN    C483    NMARY1   D237
 NMIL     DDBD    NODATT   C5DE    NODEL    C4ED    NODELC   C508
 NOFREF   D384    NOML6    CA07    NONONO   D1CC    NORM1    D929
 NORM2    D91D    NORM3    D8DB    NORMAL   D8D7    NOSEC    D0BA
 NOTABR   CB13    NOTDIM   D296    NOTEVE   D159    NOTEVL   D128
 NOTFDD   D261    NOTFL1   D331    NOTFLT   D274    NOTFNS   D11D
 NOTIT    D109    NOTOL    C753    NOTOP    CED4    NOTQTI   CBCE
 NOTSTR   D0C4    NOTTAB   C098    NOTTK    00A8    NOWGE1   CC7D
 NOWGET   CC72    NOWLIN   CCD1    NQPLOP   C71A    NTHIS    C5F5
 NTHIS1   C5F9    NUMINS   CC89    NUMLEV   0017    NXTCMP   D05B
 NXTLGC   C99F    OKGOTO   C937    OKMSG    C364    OKNORM   CFD1
 OLDLIN   003B    OLDOV    0056    OLDTXT   003D    OMERR    C435
 OMERR1   D30B    ONEFUN   00B4    ONEON    C79F    ONGLOP   C957
 ONGLP1   C95F    ONGOTO   C94B    ONGRTS   C96A    OPMASK   004D








SYMBOL TABLE

SYMBOL VALUE
 OPPTR    004B    OPTAB    C080    OROP     CFE6    OUTCH    E109
 OUTDO    CB47    OUTQST   CB45    OUTRTS   CB4A    OUTSPC   CB3B
 OVERR    D97E    PANIC    E467    PAOC     E216    PAOC15   E254
 PAOC20   E203    PAOC30   E20B    PAOC32   E20E    PAOC40   E213
 PAOC5    E23C    PAOC7    E24E    PAOCX    E20A    PARCHK   CEF1
 PATCHS   DF53    PEEK     D80D    PI       00FF    PI2      E2DD
 PIVAL    CEA8    PLINK    E476    PLOOP    C6F3    PLOOP1   C700
 PLOT     FFF0    PLSV     E1D1    PLSV7    E1FD    PLUSTK   00AA
 POKE     D824    POKER    0014    POLY     E056    POLY1    E05A
 POLY2    E06D    POLY3    E069    POLY4    E07A    POLYPT   0071
 POLYX    E040    POS      D39E    POSINT   D1B8    PREAM    D761
 PRINT    CAA0    PRINTC   CAA2    PRINTK   0099    PRINTN   CA80
 PRIT3    C737    PRIT4    C6EF    PRTRTS   CAE7    PTDORL   C09B
 PTRGET   D08B    PTRGT1   D090    PTRGT2   D092    PTRGT3   D09F
 PULMOR   D725    PULSTK   CE66    PUSHF    CE38    PUSHF1   CE33
 PUTNEW   D4CA    PUTNW1   D4D5    Q        007F    QCHNUM   CE5D
 QCOMP    D061    QDATA    CC41    QDECT1   C4D7    QDOT     CEAD
 QINLIN   CBF9    QINT     DC9B    QINT1    DCBB    QINTGO   D1CE
 QINTGR   C9C2    QINTRT   DCBA    QISHFT   DCAF    QNUM     0080
 QOP      CE58    QOPGO    CE5B    QOPRTS   CE80    QPLOP    C717
 QPLUS    DD06    QPREC    CDF0    QPREC1   CE19    QSETNR   E0BB
 QSHFT    DB4C    QSTATV   CF92    QSTAVR   D13B    QVARIA   CA3D
 RADDC    E08F    RDBAS    FFF3    RDTIM    FFDE    READ     CC06
 READST   FFB7    READY    C474    REARTS   C434    REASAV   C416
 REASON   C408    REASTO   C421    REDDY    C376    REM      C93B
 REMER    C919    REMN     C909    REMRTS   C905    REMTK    008F
 RESCON   C5B8    RESCR1   C72F    RESER    C5B6    RESETC   CC71
 RESFIN   C827    RESHO    0026    RESLO    0029    RESLST   C09E
 RESMO    0028    RESMOH   0027    RESRCH   C72C    RESTOR   C81D
 RETU1    C8EB    RETURN   C8D2    RIGHTD   D72C    RLEFT    D706
 RLEFT1   D70C    RLEFT2   D70D    RLEFT3   D70E    RMULC    E08A
 RND      E094    RND1     E0D0    RNDRTS   D946    RNDSHF   D938
 RNDX     008B    ROLSHF   D9B0    ROMLOC   C000    ROUND    DC1B
 RUN      C871    RUNC     C659    RUNC2    C897    SAREG    030C
 SAVEIT   CA90    SAVQUO   DB3F    SCRATH   C642    SCRATK   00A2
 SCRTCH   C644    SETMSG   FF90    SETQUT   CC65    SETTIM   FFDB
 SGN      DC39    SGNFLG   0067    SHFARG   DB4F    SHFTR2   D985
 SHFTR3   D9A6    SHFTR4   D9AC    SHFTRT   D9BA    SHIFTR   D999
 SIGN     DC2B    SIGNRT   DC38    SIN      E268    SIN1     E29A
 SIN2     E29D    SIN3     E2AA    SINCON   E2EC    SIZE     0055
 SIZEOK   D65D    SNERR    CF08    SNERR1   C80B    SNERR2   C8E8
 SNERR3   C953    SNERR4   CB5F    SNERR5   CE30    SNERRX   C80E
 SNGFLT   D3A2    SPCTK    00A6    SPREG    030F    SQR      DF71
 SQR05    D9D6    SQR20    D9DB    SQUEEZ   D936    ST2TXT   D7E2
 STASGN   D056    STCURL   CB5B    STEPTK   00A9    STKEND   01FB
 STKINI   C67A    STKRTS   C68D    STMDSP   C00C    STOLD    DFFD
 STOLOP   C522    STOML1   D337    STOMLT   D27D    STOP     C82F
 STOPC    C832    STORDO   D83C    STPEND   C841    STR1     C5E5
 STRCMP   D02E    STRCP    D4BF    STRD     D465    STRDN2   CC91
 STRDON   CA9A    STREND   0031    STRFI1   D4A8    STRFI2   D4A9
 STRFIN   D4A4    STRFRE   D50B    STRGET   D497    STRINI   D475
 STRLIT   D487    STRLT2   D48D    STRNAM   D0DB    STRNEX   E0E0
 STRNG    C5EE    STRNG1   006F    STRNG2   0071    STRNGI   006F
 STROU2   DDDA    STROUT   CB1E    STRPR2   CB28    STRPRT   CB21
 STRRTS   CF5C    STRSIZ   0003    STRSPA   D47D    STRST2   D4B5








SYMBOL TABLE

SYMBOL VALUE
 STRTX2   CEC6    STRTXT   CEBD    STUFFH   C5C9    STXBUF   DEB2
 STXFND   D0EF    STXFOR   CD27    STXTPT   C68E    SUBFLG   0010
 SUBIT    D8AF    SVAR     D559    SVARGO   D561    SVARS    D54D
 SWAPLP   E01B    SXREG    030D    SYNCHR   CEFF    SYREG    030E
 TABER    CAF8    TABTK    00A3    TAN      E2B1    TANSGN   0012
 TEMPF1   0057    TEMPF2   005C    TEMPF3   004E    TEMPPT   0016
 TEMPST   0019    TENC     DAF9    TENEXP   005E    THENTK   00A7
 TIMELP   C9ED    TIMEND   DF52    TIMNUM   CA1D    TIMSTR   D46F
 TOTK     00A4    TRMNO1   CB62    TRMNOK   CB4D    TRMOK    CC9D
 TRMPOS   0009    TRYAG2   D4F6    TRYAG3   D501    TRYAGN   CD0C
 TRYMOR   C412    TRYOFF   DAC4    TSTDUN   C6E6    TSTOP    CDB8
 TSTR10   CF27    TSTROM   CF14    TURNON   D0D4    TVAR     D544
 TWOPI    E2E2    TXTPTR   007A    TXTTAB   002B    TYPLIN   C6E8
 UMLCNT   D378    UMLRTS   D37C    UMULT    D34C    UMULTC   D35F
 UMULTD   D355    UNPRTS   CE82    UNPSTK   CE64    USEDEF   E3F0
 USERR    C8E3    USRLOC   C058    USRPOK   0000    VAL      D7AD
 VAL2     D7CD    VALRTS   D7EA    VALTYP   000D    VAREND   CCDF
 VARNAM   0045    VAROK    D143    VARPNT   0047    VARTAB   002D
 VARTXT   004B    VARY0    CCEA    VERCK    000A    WAITER   D840
 WORDS    E429    XSPAC    CB0F    XSPAC1   CB19    XSPAC2   CB10
 ZEREMV   DADA    ZERITA   D2C8    ZERO     DF13    ZEROF1   D8F9
 ZEROFC   D8F7    ZEROML   D8FB    ZERRTS   D848    ZZ1      01FF
 ZZ2      0201    ZZ3      0202    ZZ4      01FF    ZZ5      01FF
 ZZ6      CF2A   

END OF ASSEMBLY
kernal......PAGE 0001

LINE# LOC   CODE        LINE


00001  0000              .LIB   DISCLAIMER




























































DISCLAIMER......PAGE 0002

LINE# LOC   CODE        LINE


00003  0000              ;****************************************
00004  0000              ;*                                      *
00005  0000              ;* KK  K EEEEE RRRR  NN  N  AAA  LL     *
00006  0000              ;* KK KK EE    RR  R NNN N AA  A LL     *
00007  0000              ;* KKK   EE    RR  R NNN N AA  A LL     *
00008  0000              ;* KKK   EEEE  RRRR  NNNNN AAAAA LL     *
00009  0000              ;* KK K  EE    RR  R NN NN AA  A LL     *
00010  0000              ;* KK KK EE    RR  R NN NN AA  A LL     *
00011  0000              ;* KK KK EEEEE RR  R NN NN AA  A LLLLL  *
00012  0000              ;*                                      *
00013  0000              ;***************************************
00014  0000              ;
00015  0000              ;***************************************
00016  0000              ;* PET KERNAL                          *
00017  0000              ;*   MEMORY AND I/O DEPENDENT ROUTINES *
00018  0000              ;* DRIVING THE HARDWARE OF THE         *
00019  0000              ;* FOLLOWING CBM MODELS:               *
00020  0000              ;*   VIXEN                             *
00021  0000              ;* COPYRIGHT (C) 1980 BY               *
00022  0000              ;* COMMODORE BUSINESS MACHINES (CBM)   *
00023  0000              ;***************************************
00024  0000              ;****LISTING DATE --1200 09 OCT.  1980**
00025  0000              ;***************************************
00026  0000              ;* THIS SOFTWARE IS FURNISHED FOR USE  *
00027  0000              ;* USE IN THE MICRO-PET COMPUTER       *
00028  0000              ;* ONLY.                               *
00029  0000              ;*                                     *
00030  0000              ;* COPIES THEREOF MAY NOT BE PROVIDED  *
00031  0000              ;* OR MADE AVAILABLE FOR USE ON ANY    *
00032  0000              ;* OTHER SYSTEM.                       *
00033  0000              ;*                                     *
00034  0000              ;* THE INFORMATION IN THIS DOCUMENT IS *
00035  0000              ;* SUBJECT TO CHANGE WITHOUT NOTICE.   *
00036  0000              ;*                                     *
00037  0000              ;* NO RESPONSIBILITY IS ASSUMED FOR    *
00038  0000              ;* RELIABILITY OF THIS SOFTWARE.       *
00039  0000              ;*                                     *
00040  0000              ;***************************************
00041  0000              .END
00042  0000              .LIB   DECLARE





















DECLARE......PAGE 0003

LINE# LOC   CODE        LINE


00044  0000              ;VIRTUAL REGS FOR MACHINE LANGUAGE MONITOR
00045  0000                     *=$0000
00046  0000              PCH    *=*+1
00047  0001              PCL    *=*+1
00048  0002              FLGS   *=*+1
00049  0003              ACC    *=*+1
00050  0004              XR     *=*+1
00051  0005              YR     *=*+1
00052  0006              SP     *=*+1
00053  0007              INVH   *=*+1           ;USER MODIFIABLE IRQ
00054  0008              INVL   *=*+1
00055  0009                     * =$90
00056  0090              STATUS *=*+1           ;I/O OPERATION STATUS BYTE
00057  0091              ; CRFAC *=*+2 ;CORRECTION FACTOR (UNUSED)
00058  0091              STKEY  *=*+1           ;STOP KEY FLAG
00059  0092              SVXT   *=*+1           ;TEMPORARY
00060  0093              VERCK  *=*+1           ;LOAD OR VERIFY FLAG
00061  0094              C3P0   *=*+1           ;IEEE BUFFERED CHAR FLAG
00062  0095              BSOUR  *=*+1           ;CHAR BUFFER FOR IEEE
00063  0096              SYNO   *=*+1           ;CASSETTE SYNC #
00064  0097              XSAV   *=*+1           ;TEMP FOR BASIN
00065  0098              LDTND  *=*+1           ;INDEX TO LOGICAL FILE
00066  0099              DFLTN  *=*+1           ;DEFAULT INPUT DEVICE #
00067  009A              DFLTO  *=*+1           ;DEFAULT OUTPUT DEVICE #
00068  009B              PRTY   *=*+1           ;CASSETTE PARITY
00069  009C              DPSW   *=*+1           ;CASSETTE DIPOLE SWITCH
00070  009D              MSGFLG *=*+1           ;OS MESSAGE FLAG
00071  009E              PTR1                   ;CASSETTE ERROR PASS1
00072  009E              T1     *=*+1           ;TEMPORARY 1
00073  009F              TMPC
00074  009F              PTR2                   ;CASSETTE ERROR PASS2
00075  009F              T2     *=*+1           ;TEMPORARY 2
00076  00A0              TIME   *=*+3           ;24 HOUR CLOCK IN 1/60TH SECONDS
00077  00A3              R2D2                   ;SERIAL BUS USAGE
00078  00A3              PCNTR  *=*+1           ;CASSETTE STUFF
00079  00A4              ; PTCH *=*+1  (UNUSED)
00080  00A4              BSOUR1                 ;TEMP USED BY SERIAL ROUTINE
00081  00A4              FIRT   *=*+1
00082  00A5              COUNT                  ;TEMP USED BY SERIAL ROUTINE
00083  00A5              CNTDN  *=*+1           ;CASSETTE SYNC COUNTDOWN
00084  00A6              BUFPT  *=*+1           ;CASSETTE BUFFER POINTER
00085  00A7              INBIT                  ;RS-232 RCVR INPUT BIT STORAGE
00086  00A7              SHCNL  *=*+1           ;CASSETTE SHORT COUNT
00087  00A8              BITCI                  ;RS-232 RCVR BIT COUNT IN
00088  00A8              RER    *=*+1           ;CASSETTE READ ERROR
00089  00A9              RINONE                 ;RS-232 RCVR FLAG FOR START BIT CHECK
00090  00A9              REZ    *=*+1           ;CASSETE READING ZEROES
00091  00AA              RIDATA                 ;RS-232 RCVR BYTE BUFFER
00092  00AA              RDFLG  *=*+1           ;CASSETTE READ MODE
00093  00AB              RIPRTY                 ;RS-232 RCVR PARITY STORAGE
00094  00AB              SHCNH  *=*+1           ;CASSETTE SHORT CNT
00095  00AC              SAL    *=*+1
00096  00AD              SAH    *=*+1
00097  00AE              EAL    *=*+1
00098  00AF              EAH    *=*+1






DECLARE......PAGE 0004

LINE# LOC   CODE        LINE


00099  00B0              CMP0   *=*+1
00100  00B1              TEMP   *=*+1
00101  00B2              TAPE1  *=*+2           ;ADDRESS OF TAPE BUFFER #1Y.
00102  00B4              BITTS                  ;RS-232 TRNS BIT COUNT
00103  00B4              SNSW1  *=*+1
00104  00B5              NXTBIT                 ;RS-232 TRNS NEXT BIT TO BE SENT
00105  00B5              DIFF   *=*+1
00106  00B6              RODATA                 ;RS-232 TRNS BYTE BUFFER
00107  00B6              PRP    *=*+1
00108  00B7              FNLEN  *=*+1           ;LENGTH CURRENT FILE N STR
00109  00B8              LA     *=*+1           ;CURRENT FILE LOGICAL ADDR
00110  00B9              SA     *=*+1           ;CURRENT FILE 2ND ADDR
00111  00BA              FA     *=*+1           ;CURRENT FILE PRIMARY ADDR
00112  00BB              FNADR  *=*+2           ;ADDR CURRENT FILE NAME STR
00113  00BD              ROPRTY                 ;RS-232 TRNS PARITY BUFFER
00114  00BD              OCHAR  *=*+1
00115  00BE              FSBLK  *=*+1           ;CASSETTE READ BLOCK COUNT
00116  00BF              MYCH   *=*+1
00117  00C0              CAS1   *=*+1           ;CASSETTE MANUAL/CONTROLLED SWITCH
00118  00C1              TMP0
00119  00C1              STAL   *=*+1
00120  00C2              STAH   *=*+1
00121  00C3              MEMUSS                 ;CASSETTE LOAD TEMPS (2 BYTES)
00122  00C3              TMP2   *=*+2
00123  00C5              ;
00124  00C5              ;VARIABLES FOR SCREEN EDITOR
00125  00C5              ;
00126  00C5              LSTX   *=*+1           ;KEY SCAN INDEX
00127  00C6              ; SFST *=*+1 ;KEYBOARD SHIFT FLAG (UNUSED)
00128  00C6              NDX    *=*+1           ;INDEX TO KEYBOARD Q
00129  00C7              RVS    *=*+1           ;RVS FIELD ON FLAG
00130  00C8              INDX   *=*+1
00131  00C9              LSXP   *=*+1           ;X POS AT START
00132  00CA              LSTP   *=*+1
00133  00CB              SFDX   *=*+1           ;SHIFT MODE ON PRINT
00134  00CC              BLNSW  *=*+1           ;CURSOR BLINK ENAB
00135  00CD              BLNCT  *=*+1           ;COUNT TO TOGGLE CUR
00136  00CE              GDBLN  *=*+1           ;CHAR BEFORE CURSOR
00137  00CF              BLNON  *=*+1           ;ON/OFF BLINK FLAG
00138  00D0              CRSW   *=*+1           ;INPUT VS GET FLAG
00139  00D1              PNT    *=*+2           ;POINTER TO ROW
00140  00D3              ; POINT *=*+1   (UNUSED)
00141  00D3              PNTR   *=*+1           ;POINTER TO COLUMN
00142  00D4              QTSW   *=*+1           ;QUOTE SWITCH
00143  00D5              LNMX   *=*+1           ;40/80 MAX POSITON
00144  00D6              TBLX   *=*+1
00145  00D7              DATA   *=*+1
00146  00D8              INSRT  *=*+1           ;INSERT MODE FLAG
00147  00D9              LDTB1  *=*+25          ;40/80 LINE FLAGS
00148  00F2              LINTMP *=*+1           ;TEMPORARY FOR LINE INDEX
00149  00F3              USER   *=*+2           ;SCREEN EDITOR COLOR IP
00150  00F5              KEYTAB *=*+2           ;KEYSCAN TABLE INDIRECT
00151  00F7              ;RS-232 Z-PAGE
00152  00F7              RIBUF  *=*+2           ;RS-232 INPUT BUFFER POINTER
00153  00F9              ROBUF  *=*+2           ;RS-232 OUTPUT BUFFER POINTER






DECLARE......PAGE 0005

LINE# LOC   CODE        LINE


00154  00FB              FREKZP *=*+4           ;FREE KERNAL ZERO PAGE 9/24/80
00155  00FF              BASZPT *=*+1           ;LOCATION ($00FF) USED BY BASIC



00157  0100                     *=$100
00158  0100              BAD    *=*+1
00159  0101                     *=$200
00160  0200              BUF    *=*+89          ;BASIC/MONITOR BUFFER
00161  0259              ; TABLES FOR OPEN FILES
00162  0259              ;
00163  0259              LAT    *=*+10          ;LOGICAL FILE NUMBERS
00164  0263              FAT    *=*+10          ;PRIMARY DEVICE NUMBERS
00165  026D              SAT    *=*+10          ;SECONDARY ADDRESSES


00167  0277              ; SYSTEM STORAGE
00168  0277              ;
00169  0277              KEYD   *=*+10          ;IRQ KEYBOARD BUFFER
00170  0281              MEMSTR *=*+2           ;START OF MEMORY
00171  0283              MEMSIZ *=*+2           ;TOP OF MEMORY
00172  0285              TIMOUT *=*+1           ;IEEE TIMEOUT FLAG


00174  0286              ; SCREEN EDITOR STORAGE
00175  0286              ;
00176  0286              COLOR  *=*+1           ;ACTIV COLOR NYBBLE
00177  0287              GDCOL  *=*+1           ;ORIGINAL COLOR BEFORE CURSOR
00178  0288              HIBASE *=*+1           ;BASE LOCATION OF SCREEN (TOP)
00179  0289              XMAX   *=*+1
00180  028A              RPTFLG *=*+1           ;KEY REPEAT FLAG
00181  028B              KOUNT  *=*+1
00182  028C              DELAY  *=*+1
00183  028D              SHFLAG *=*+1           ;SHIFT FLAG BYTE
00184  028E              LSTSHF *=*+1           ;LAST SHIFT PATTERN
00185  028F              KEYLOG *=*+2           ;INDIRECT FOR KEYBOARD TABLE SETUP
00186  0291              MODE   *=*+1           ;0-PET MODE, 1-CATTACANNA
00187  0292              AUTODN *=*+1           ;AUTO SCROLL DOWN FLAG(=0 ON,<>0 OFF)



00189  0293              ; RS-232 STORAGE
00190  0293              ;
00191  0293              M51CTR *=*+1           ;6551 CONTROL REGISTER
00192  0294              M51CDR *=*+1           ;6551 COMMAND REGISTER
00193  0295              M51AJB *=*+2           ;NON STANDARD (BITTIME/2-100)
00194  0297              RSSTAT *=*+1           ; RS-232 STATUS REGISTER
00195  0298              BITNUM *=*+1           ;NUMBER OF BITS TO SEND (FAST RESPONSE)
00196  0299              BAUDOF *=*+2           ;BAUD RATE FULL BIT TIME (CREATED BY OPEN)
00197  029B              ;
00198  029B              ; RECIEVER STORAGE
00199  029B              ;
00200  029B              ; INBIT *=*+1 ;INPUT BIT STORAGE
00201  029B              ; BITCI *=*+1 ;BIT COUNT IN
00202  029B              ; RINONE *=*+1 ;FLAG FOR START BIT CHECK






DECLARE......PAGE 0006

LINE# LOC   CODE        LINE


00203  029B              ; RIDATA *=*+1 ;BYTE IN BUFFER
00204  029B              ; RIPRTY *=*+1 ;BYTE IN PARITY STORAGE
00205  029B              RIDBE  *=*+1           ;INPUT BUFFER INDEX TO END
00206  029C              RIDBS  *=*+1           ;INPUT BUFFER POINTER TO START
00207  029D              ;
00208  029D              ; TRANSMITTER STORAGE
00209  029D              ;
00210  029D              ; BITTS *=*+1 ;# OF BITS TO BE SENT
00211  029D              ; NXTBIT *=*+1 ;NEXT BIT TO BE SENT
00212  029D              ; ROPRTY *=*+1 ;PARITY OF BYTE SENT
00213  029D              ; RODATA *=*+1 ;BYTE BUFFER OUT
00214  029D              RODBS  *=*+1           ;OUTPUT BUFFER INDEX TO START
00215  029E              RODBE  *=*+1           ;OUTPUT BUFFER INDEX TO END
00216  029F              ;
00217  029F              IRQTMP *=*+2           ;HOLDS IRQ DURING TAPE OPS
00218  02A1              ;



00220  02A1                     *=$0300         ;REM PROGRAM INDIRECTS(10)
00221  0300                     *=$0300+20      ;REM KERNAL/OS INDIRECTS(20)
00222  0314              CINV   *=*+2           ;IRQ RAM VECTOR
00223  0316              CBINV  *=*+2           ;BRK INSTR RAM VECTOR
00224  0318              NMINV  *=*+2           ;NMI RAM VECTOR
00225  031A              IOPEN  *=*+2           ;INDIRECTS FOR CODE
00226  031C              ICLOSE *=*+2           ; CONFORMS TO KERNAL SPEC 8/19/80
00227  031E              ICHKIN *=*+2
00228  0320              ICKOUT *=*+2
00229  0322              ICLRCH *=*+2
00230  0324              IBASIN *=*+2
00231  0326              IBSOUT *=*+2
00232  0328              ISTOP  *=*+2
00233  032A              IGETIN *=*+2
00234  032C              ICLALL *=*+2
00235  032E              USRCMD *=*+2
00236  0330              ILOAD  *=*+2
00237  0332              ISAVE  *=*+2           ;SAVESP



00239  0334                     *=$0300+60
00240  033C              TBUFFR *=*+192         ;CASSETTE DATA BUFFER



00242  03FC                     * =$400         ;RAMLOC



00244  0400                     *=$1000
00245  1000              VICSCN *=*+512         ;VIC SCREEN



00247  1200                     *=$9000






DECLARE......PAGE 0007

LINE# LOC   CODE        LINE


00248  9000              VICREG *=*+16          ;VIC REGISTERS




























































DECLARE......PAGE 0008

LINE# LOC   CODE        LINE


00250  9010              ; I/O DEVICES
00251  9010              ;
00252  9010                     *=$9110         ; DEVICE1 6522 (PAGE2 NMI)
00253  9110              D1ORB  *=*+1
00254  9111              D1ORAH *=*+1
00255  9112              D1DDRB *=*+1
00256  9113              D1DDRA *=*+1
00257  9114              D1T1L  *=*+1
00258  9115              D1T1H  *=*+1
00259  9116              D1T1LL *=*+1
00260  9117              D1T1LH *=*+1
00261  9118              D1T2L  *=*+1
00262  9119              D1T2H  *=*+1
00263  911A              D1SR   *=*+1
00264  911B              D1ACR  *=*+1
00265  911C              D1PCR  *=*+1
00266  911D              D1IFR  *=*+1
00267  911E              D1IER  *=*+1
00268  911F              D1ORA  *=*+1



00270  9120                     *=$9120         ; DEVICE2 6522 (PAGE3 IRQ)
00271  9120              COLM                   ;KEYBOARD MATRIX
00272  9120              D2ORB  *=*+1
00273  9121              ROWS                   ;KEYBOARD MATRIX
00274  9121              D2ORAH *=*+1
00275  9122              D2DDRB *=*+1
00276  9123              D2DDRA *=*+1
00277  9124              D2T1L  *=*+1
00278  9125              D2T1H  *=*+1
00279  9126              D2T1LL *=*+1
00280  9127              D2T1LH *=*+1
00281  9128              D2T2L  *=*+1
00282  9129              D2T2H  *=*+1
00283  912A              D2SR   *=*+1
00284  912B              D2ACR  *=*+1
00285  912C              D2PCR  *=*+1
00286  912D              D2IFR  *=*+1
00287  912E              D2IER  *=*+1
00288  912F              D2ORA  *=*+1



00290  9130                     *=$9400
00291  9400              VICCOL *=*+512         ;VIC COLOR NYBBLES















DECLARE......PAGE 0009

LINE# LOC   CODE        LINE


00293  9600              ;TAPE BLOCK TYPES
00294  9600              ;
00295  9600              EOT    =5              ;END OF TAPE
00296  9600              BLF    =1              ;BASIC LOAD FILE
00297  9600              BDF    =2              ;BASIC DATA FILE
00298  9600              PLF    =3              ;FIXED PROGRAM TYPE
00299  9600              BDFH   =4              ;BASIC DATA FILE HEADER
00300  9600              BUFSZ  =192            ;BUFFER SIZE
00301  9600              ;
00302  9600              ;SCREEN EDITOR CONSTANTS
00303  9600              ;
00304  9600              LLEN   =22             ;SINGLE LINE 22 COLUMNS
00305  9600              LLEN2  =44             ;DOUBLE LINE = 44 COLUMNS
00306  9600              NLINES =23             ;23 ROWS ON SCREEN
00307  9600              WHITE  =$01            ;WHITE SCREEN COLOR
00308  9600              BLUE   =$06            ;BLUE CHAR COLOR
00309  9600              CR     =$D             ;CARRIAGE RETURN
00310  9600              .END
00311  9600                     *=$E500         ;START OF VIXEN KERNAL
00312  E500              .LIB   EDITOR.1









































SCREEN EDITOR......PAGE 000A

LINE# LOC   CODE        LINE


00314  E500              MAXCHR=88
00315  E500              NWRAP=4                ;MAX NUMBER OF PHYSICAL LINES PER LOGICAL LINE
00316  E500              ;UNDEFINED FUNCTION ENTRY
00317  E500              ;
00318  E500              ; UNDEFD LDX #0
00319  E500              ; UNDEF2 LDA UNMSG,X
00320  E500              ; JSR PRT
00321  E500              ; INX
00322  E500              ; CPX #UNMSG2-UNMSG
00323  E500              ; BNE UNDEF2
00324  E500              ; SEC
00325  E500              ; RTS
00326  E500              ;
00327  E500              ; UNMSG .BYT $D,'?ADVANCED FUNCTION NOT AVAILABLE',$D
00328  E500              ; UNMSG2
00329  E500              ;
00330  E500              ;RETURN ADDRESS OF 6522
00331  E500              ;
00332  E500  A2 10       IOBASE LDX #<D1ORB
00333  E502  A0 91              LDY #>D1ORB
00334  E504  60                 RTS
00335  E505              ;
00336  E505              ;RETURN MAX ROWS,COLS OF SCREEN
00337  E505              ;
00338  E505  A2 16       SCRORG LDX #LLEN
00339  E507  A0 17              LDY #23
00340  E509  60                 RTS
00341  E50A              ;
00342  E50A              ;READ/PLOT CURSOR POSITION
00343  E50A              ;
00344  E50A  B0 07       PLOT   BCS PLOT10
00345  E50C  86 D6              STX TBLX
00346  E50E  84 D3              STY PNTR
00347  E510  20 87 E5           JSR STUPT
00348  E513  A6 D6       PLOT10 LDX TBLX
00349  E515  A4 D3              LDY PNTR
00350  E517  60                 RTS





00352  E518              ;INITIALIZE I/O
00353  E518              ;
00354  E518              CINT
00355  E518              ;
00356  E518              ; CHECK FOR EXPANSION RAM
00357  E518              ; ESTABLISH SCREEN MEMORY
00358  E518              ;
00359  E518  20 BB E5           JSR PANIC       ;SET UP VIC
00360  E51B              ;
00361  E51B  AD 88 02           LDA HIBASE      ;GET SCREEN BASE
00362  E51E  29 FD              AND #$FD        ;GET RID OF .5K BOUNDRY
00363  E520  0A                 ASL A           ;SET IT UP FOR THE VIC
00364  E521  0A                 ASL A






SCREEN EDITOR......PAGE 000B

LINE# LOC   CODE        LINE


00365  E522  09 80              ORA #$80
00366  E524  8D 05 90           STA VICREG+5    ;POINT THE VIC AT THE NEW SCREEN
00367  E527              ;
00368  E527  AD 88 02           LDA HIBASE      ;CHECK FOR .5K BOUNDARY
00369  E52A  29 02              AND #$02
00370  E52C  F0 08              BEQ NOHALF      ;BRANCH IF ON 1K BOUNDARY
00371  E52E  A9 80              LDA #$80        ;ELSE SET .5K BIT IN VIC
00372  E530  0D 02 90           ORA VICREG+2
00373  E533  8D 02 90           STA VICREG+2
00374  E536              NOHALF
00375  E536  A9 00              LDA #0          ;MAKE SURE WE'RE IN PET MODE
00376  E538  8D 91 02           STA MODE
00377  E53B  85 CF              STA BLNON       ;WE DONT HAVE A GOOD CHAR FROM THE SCREEN YET
00378  E53D  A9 DC              LDA #<SHFLOG    ;SET SHIFT LOGIC INDIRECTS
00379  E53F  8D 8F 02           STA KEYLOG
00380  E542  A9 EB              LDA #>SHFLOG
00381  E544  8D 90 02           STA KEYLOG+1
00382  E547  A9 0A              LDA #10
00383  E549  8D 89 02           STA XMAX        ;MAXIMUM TYPE AHEAD BUFFER SIZE
00384  E54C  8D 8C 02           STA DELAY
00385  E54F  A9 06              LDA #BLUE
00386  E551  8D 86 02           STA COLOR
00387  E554  A9 04              LDA #4
00388  E556  8D 8B 02           STA KOUNT       ;DELAY BETWEEN KEY REPEATS
00389  E559  A9 0C              LDA #$C
00390  E55B  85 CD              STA BLNCT
00391  E55D  85 CC              STA BLNSW
00392  E55F  AD 88 02    CLSR   LDA HIBASE      ;FILL HI BYTE PTR TABLE
00393  E562  09 80              ORA #$80
00394  E564  A8                 TAY
00395  E565  A9 00              LDA #0
00396  E567  AA                 TAX
00397  E568  94 D9       LPS1   STY LDTB1,X
00398  E56A  18                 CLC
00399  E56B  69 16              ADC #LLEN
00400  E56D  90 01              BCC LPS2
00401  E56F  C8                 INY             ;CARRY BUMP HI BYTE
00402  E570  E8          LPS2   INX
00403  E571  E0 18              CPX #NLINES+1   ;DONE # OF LINES?
00404  E573  D0 F3              BNE LPS1        ;NO...
00405  E575  A9 FF              LDA #$FF        ;TAG END OF LINE TABLE
00406  E577  95 D9              STA LDTB1,X
00407  E579  A2 16              LDX #NLINES-1   ;CLEAR FROM THE BOTTOM LINE UP
00408  E57B  20 8D EA    CLEAR1 JSR CLRLN       ;SEE SCROLL ROUTINES
00409  E57E  CA                 DEX
00410  E57F  10 FA              BPL CLEAR1





00412  E581              ;HOME FUNCTION
00413  E581              ;
00414  E581  A0 00       NXTD   LDY #0
00415  E583  84 D3              STY PNTR        ;LEFT COLUMN






SCREEN EDITOR......PAGE 000C

LINE# LOC   CODE        LINE


00416  E585  84 D6              STY TBLX        ;TOP LINE
00417  E587              ;
00418  E587              ;MOVE CURSOR TO TBLX,PNTR
00419  E587              ;
00420  E587              STUPT
00421  E587  A6 D6              LDX TBLX        ;GET CURENT LINE INDEX
00422  E589  A5 D3              LDA PNTR        ;GET CHARACTER POINTER
00423  E58B  B4 D9       FNDSTR LDY LDTB1,X     ;FIND BEGINING OF LINE
00424  E58D  30 08              BMI STOK        ;BRANCH IF START FOUND
00425  E58F  18                 CLC
00426  E590  69 16              ADC #LLEN       ;ADJUST POINTER
00427  E592  85 D3              STA PNTR
00428  E594  CA                 DEX
00429  E595  10 F4              BPL FNDSTR
00430  E597              ;
00431  E597              STOK
00432  E597  B5 D9              LDA LDTB1,X
00433  E599  29 03              AND #$03        ;GET RID OF GARBAGE
00434  E59B  0D 88 02           ORA HIBASE      ;OR IN HIGH ORDER BITS
00435  E59E  85 D2              STA PNT+1
00436  E5A0  BD FD ED           LDA LDTB2,X
00437  E5A3  85 D1              STA PNT
00438  E5A5              ;
00439  E5A5  A9 15              LDA #LLEN-1
00440  E5A7  E8                 INX
00441  E5A8  B4 D9       FNDEND LDY LDTB1,X
00442  E5AA  30 06              BMI STDONE
00443  E5AC  18                 CLC
00444  E5AD  69 16              ADC #LLEN
00445  E5AF  E8                 INX
00446  E5B0  10 F6              BPL FNDEND
00447  E5B2              STDONE
00448  E5B2  85 D5              STA LNMX
00449  E5B4  60                 RTS





00451  E5B5              ;PANIC NMI ENTRY
00452  E5B5              ;
00453  E5B5  20 BB E5    VPAN   JSR PANIC       ;FIX VIC SCREEN
00454  E5B8  4C 81 E5           JMP NXTD        ;HOME CURSOR





00456  E5BB  A9 03       PANIC  LDA #3          ;RESET DEFAULT I/O
00457  E5BD  85 9A              STA DFLTO
00458  E5BF  A9 00              LDA #0
00459  E5C1  85 99              STA DFLTN









SCREEN EDITOR......PAGE 000D

LINE# LOC   CODE        LINE


00461  E5C3              ;INIT VIC
00462  E5C3              ;
00463  E5C3  A2 10       INITV  LDX #$10
00464  E5C5  BD E3 ED    PX4    LDA TVIC-1,X
00465  E5C8  9D FF 8F           STA VICREG-1,X
00466  E5CB  CA                 DEX
00467  E5CC  D0 F7              BNE PX4
00468  E5CE  60                 RTS





00470  E5CF              ;
00471  E5CF              ;REMOVE CHARACTER FROM QUEUE
00472  E5CF              ;
00473  E5CF  AC 77 02    LP2    LDY KEYD
00474  E5D2  A2 00              LDX #0
00475  E5D4  BD 78 02    LP1    LDA KEYD+1,X
00476  E5D7  9D 77 02           STA KEYD,X
00477  E5DA  E8                 INX
00478  E5DB  E4 C6              CPX NDX
00479  E5DD  D0 F5              BNE LP1
00480  E5DF  C6 C6              DEC NDX
00481  E5E1  98                 TYA
00482  E5E2  58                 CLI
00483  E5E3  18                 CLC             ;GOOD RETURN
00484  E5E4  60                 RTS
00485  E5E5  20 42 E7    LOOP4  JSR PRT
00486  E5E8  A5 C6       LOOP3  LDA NDX
00487  E5EA  85 CC              STA BLNSW
00488  E5EC  8D 92 02           STA AUTODN      ;TURN ON AUTO SCROLL DOWN
00489  E5EF  F0 F7              BEQ LOOP3
00490  E5F1  78                 SEI
00491  E5F2  A5 CF              LDA BLNON
00492  E5F4  F0 0C              BEQ LP21
00493  E5F6  A5 CE              LDA GDBLN
00494  E5F8  AE 87 02           LDX GDCOL       ;RESTORE ORIGINAL COLOR
00495  E5FB  A0 00              LDY #0
00496  E5FD  84 CF              STY BLNON
00497  E5FF  20 A1 EA           JSR DSPP
00498  E602  20 CF E5    LP21   JSR LP2
00499  E605  C9 83              CMP #$83        ;RUN KEY?
00500  E607  D0 10              BNE LP22
00501  E609  A2 09              LDX #9
00502  E60B  78                 SEI
00503  E60C  86 C6              STX NDX
00504  E60E  BD F3 ED    LP23   LDA RUNTB-1,X
00505  E611  9D 76 02           STA KEYD-1,X
00506  E614  CA                 DEX
00507  E615  D0 F7              BNE LP23
00508  E617  F0 CF              BEQ LOOP3
00509  E619  C9 0D       LP22   CMP #$D
00510  E61B  D0 C8              BNE LOOP4
00511  E61D  A4 D5              LDY LNMX






SCREEN EDITOR......PAGE 000E

LINE# LOC   CODE        LINE


00512  E61F  84 D0              STY CRSW
00513  E621  B1 D1       CLP5   LDA (PNT)Y
00514  E623  C9 20              CMP #' 
00515  E625  D0 03              BNE CLP6
00516  E627  88                 DEY
00517  E628  D0 F7              BNE CLP5
00518  E62A  C8          CLP6   INY
00519  E62B  84 C8              STY INDX
00520  E62D  A0 00              LDY #0
00521  E62F  8C 92 02           STY AUTODN      ;TURN OFF AUTO SCROLL DOWN
00522  E632  84 D3              STY PNTR
00523  E634  84 D4              STY QTSW
00524  E636  A5 C9              LDA LSXP
00525  E638  30 1D              BMI LOP5
00526  E63A  A6 D6              LDX TBLX
00527  E63C  20 19 E7           JSR FINDST      ;FIND 1ST PHYSICAL LINE
00528  E63F  E4 C9              CPX LSXP
00529  E641  D0 14              BNE LOP5
00530  E643  D0 12              BNE LOP5
00531  E645  A5 CA              LDA LSTP
00532  E647  85 D3              STA PNTR
00533  E649  C5 C8              CMP INDX
00534  E64B  90 0A              BCC LOP5
00535  E64D  B0 42              BCS CLP2





00537  E64F              ;INPUT A LINE UNTIL CARRIAGE RETURN
00538  E64F              ;
00539  E64F  98          LOOP5  TYA
00540  E650  48                 PHA
00541  E651  8A                 TXA
00542  E652  48                 PHA
00543  E653  A5 D0              LDA CRSW
00544  E655  F0 91              BEQ LOOP3
00545  E657  A4 D3       LOP5   LDY PNTR
00546  E659  B1 D1              LDA (PNT)Y
00547  E65B  EA                 .BYT $EA,$EA,$EA
00547  E65C  EA 
00547  E65D  EA 
00548  E65E  EA                 .BYT $EA,$EA
00548  E65F  EA 
00549  E660  EA                 .BYT $EA,$EA
00549  E661  EA 
00550  E662  EA                 .BYT $EA,$EA,$EA
00550  E663  EA 
00550  E664  EA 
00551  E665  EA                 .BYT $EA,$EA
00551  E666  EA 
00552  E667  EA                 .BYT $EA
00553  E668  EA                 .BYT $EA
00554  E669  EA                 .BYT $EA,$EA
00554  E66A  EA 






SCREEN EDITOR......PAGE 000F

LINE# LOC   CODE        LINE


00555  E66B  EA                 .BYT $EA,$EA
00555  E66C  EA 
00556  E66D  EA                 .BYT $EA,$EA,$EA
00556  E66E  EA 
00556  E66F  EA 
00557  E670  EA                 .BYT $EA,$EA
00557  E671  EA 
00558  E672              NOTONE
00559  E672  85 D7              STA DATA
00560  E674  29 3F       LOP51  AND #$3F
00561  E676  06 D7              ASL DATA
00562  E678  24 D7              BIT DATA
00563  E67A  10 02              BPL LOP54
00564  E67C  09 80              ORA #$80
00565  E67E  90 04       LOP54  BCC LOP52
00566  E680  A6 D4              LDX QTSW
00567  E682  D0 04              BNE LOP53
00568  E684  70 02       LOP52  BVS LOP53
00569  E686  09 40              ORA #$40
00570  E688  E6 D3       LOP53  INC PNTR
00571  E68A  20 B8 E6           JSR QTSWC
00572  E68D  C4 C8              CPY INDX
00573  E68F  D0 17              BNE CLP1
00574  E691  A9 00       CLP2   LDA #0
00575  E693  85 D0              STA CRSW
00576  E695  A9 0D              LDA #$D
00577  E697  A6 99              LDX DFLTN       ;FIX GETS FROM SCREEN
00578  E699  E0 03              CPX #3          ;IS IT THE SCREEN?
00579  E69B  F0 06              BEQ CLP2A
00580  E69D  A6 9A              LDX DFLTO
00581  E69F  E0 03              CPX #3
00582  E6A1  F0 03              BEQ CLP21
00583  E6A3  20 42 E7    CLP2A  JSR PRT
00584  E6A6  A9 0D       CLP21  LDA #$D
00585  E6A8  85 D7       CLP1   STA DATA
00586  E6AA  68                 PLA
00587  E6AB  AA                 TAX
00588  E6AC  68                 PLA
00589  E6AD  A8                 TAY
00590  E6AE  A5 D7              LDA DATA
00591  E6B0  C9 DE              CMP #$DE        ;IS IT <PI> ?
00592  E6B2  D0 02              BNE CLP7
00593  E6B4  A9 FF              LDA #$FF
00594  E6B6  18          CLP7   CLC
00595  E6B7  60                 RTS





00597  E6B8  C9 22       QTSWC  CMP #$22
00598  E6BA  D0 08              BNE QTSWL
00599  E6BC  A5 D4              LDA QTSW
00600  E6BE  49 01              EOR #$1
00601  E6C0  85 D4              STA QTSW






SCREEN EDITOR......PAGE 0010

LINE# LOC   CODE        LINE


00602  E6C2  A9 22              LDA #$22
00603  E6C4  60          QTSWL  RTS





00605  E6C5  09 40       NXT33  ORA #$40
00606  E6C7  A6 C7       NXT3   LDX RVS
00607  E6C9  F0 02              BEQ NVS
00608  E6CB  09 80       NC3    ORA #$80
00609  E6CD  A6 D8       NVS    LDX INSRT
00610  E6CF  F0 02              BEQ NVS1
00611  E6D1  C6 D8              DEC INSRT
00612  E6D3  AE 86 02    NVS1   LDX COLOR PUT COLOR ON SCREEN
00613  E6D6  20 A1 EA           JSR DSPP
00614  E6D9  20 EA E6           JSR WLOGIC      ;CHECK FOR WRAPAROUND
00615  E6DC  68          LOOP2  PLA
00616  E6DD  A8                 TAY
00617  E6DE  A5 D8              LDA INSRT
00618  E6E0  F0 02              BEQ LOP2
00619  E6E2  46 D4              LSR QTSW
00620  E6E4  68          LOP2   PLA
00621  E6E5  AA                 TAX
00622  E6E6  68                 PLA
00623  E6E7  18                 CLC             ;GOOD RETURN
00624  E6E8  58                 CLI
00625  E6E9  60                 RTS

































SCREEN EDITOR......PAGE 0011

LINE# LOC   CODE        LINE


00627  E6EA              WLOGIC
00628  E6EA  20 FA E8           JSR CHKDWN      ;MAYBE WE SHOULD WE INCREMENT TBLX
00629  E6ED  E6 D3              INC PNTR        ;BUMP CHARCTER POINTER
00630  E6EF  A5 D5              LDA LNMX        ;
00631  E6F1  C5 D3              CMP PNTR        ;IF LNMX IS LESS THAN PNTR
00632  E6F3  B0 37              BCS WLGRTS      ;BRANCH IF LNMX>=PNTR
00633  E6F5  C9 57              CMP #MAXCHR-1   ;PAST MAX CHARACTERS
00634  E6F7  F0 2A              BEQ WLOG10      ;BRANCH IF SO
00635  E6F9  AD 92 02           LDA AUTODN      ;SHOULD WE AUTO SCROLL DOWN?
00636  E6FC  F0 03              BEQ WLOG20      ;BRANCH IF NOT
00637  E6FE  4C F0 E9           JMP BMT1        ;ELSE DECIDE WHICH WAY TO SCROLL



00639  E701              WLOG20
00640  E701  A6 D6              LDX TBLX        ;SEE IF WE SHOULD SCROLL DOWN
00641  E703  E0 17              CPX #NLINES
00642  E705  90 07              BCC WLOG30      ;BRANCH IF NOT
00643  E707  20 75 E9           JSR SCROL       ;ELSE DO THE SCROL UP
00644  E70A  C6 D6              DEC TBLX        ;AND ADJUST CURENT LINE#
00645  E70C  A6 D6              LDX TBLX
00646  E70E  16 D9       WLOG30 ASL LDTB1,X     ;WRAP THE LINE
00647  E710  56 D9              LSR LDTB1,X
00648  E712  4C 5B ED           JMP PATCHX      ;DO THE FIX FOR RUN MODE WRAP
00649  E715              PATOUT                 ;PATCH RE-ENTRY POINT
00650  E715  69 16              ADC #LLEN
00651  E717  85 D5              STA LNMX
00652  E719              FINDST
00653  E719  B5 D9              LDA LDTB1,X     ;IS THIS THE FIRST LINE?
00654  E71B  30 03              BMI FINX        ;BRANCH IF SO
00655  E71D  CA                 DEX             ;ELSE BACKUP 1
00656  E71E  D0 F9              BNE FINDST
00657  E720              FINX
00658  E720  4C 7E EA           JMP SETPNT      ;MAKE SURE PNT IS RIGHT
00659  E723  C6 D6       WLOG10 DEC TBLX
00660  E725  20 C3 E8           JSR NXLN
00661  E728  A9 00              LDA #0
00662  E72A  85 D3              STA PNTR        ;POINT TO FIRST BYTE
00663  E72C  60          WLGRTS RTS






















SCREEN EDITOR......PAGE 0012

LINE# LOC   CODE        LINE


00665  E72D  A6 D6       BKLN   LDX TBLX
00666  E72F  D0 06              BNE BKLN1
00667  E731  86 D3              STX PNTR
00668  E733  68                 PLA
00669  E734  68                 PLA
00670  E735  D0 A5              BNE LOOP2
00671  E737              ;
00672  E737  CA          BKLN1  DEX
00673  E738  86 D6              STX TBLX
00674  E73A  20 87 E5           JSR STUPT
00675  E73D  A4 D5              LDY LNMX
00676  E73F  84 D3              STY PNTR
00677  E741  60                 RTS





00679  E742              ;PRINT ROUTINE
00680  E742              ;
00681  E742  48          PRT    PHA
00682  E743  85 D7              STA DATA
00683  E745  8A                 TXA
00684  E746  48                 PHA
00685  E747  98                 TYA
00686  E748  48                 PHA
00687  E749  A9 00              LDA #0
00688  E74B  85 D0              STA CRSW
00689  E74D  A4 D3              LDY PNTR
00690  E74F  A5 D7              LDA DATA
00691  E751  10 03              BPL *+5
00692  E753  4C 00 E8           JMP NXTX
00693  E756  C9 0D              CMP #$D
00694  E758  D0 03              BNE NJT1
00695  E75A  4C D8 E8           JMP NXT1
00696  E75D  C9 20       NJT1   CMP #' 
00697  E75F  90 10              BCC NTCN
00698  E761  C9 60              CMP #$60        ;LOWER CASE?
00699  E763  90 04              BCC NJT8        ;NO...
00700  E765  29 DF              AND #$DF        ;YES...MAKE SCREEN LOWER
00701  E767  D0 02              BNE NJT9        ;ALWAYS
00702  E769  29 3F       NJT8   AND #$3F
00703  E76B  20 B8 E6    NJT9   JSR QTSWC
00704  E76E  4C C7 E6           JMP NXT3
00705  E771  A6 D8       NTCN   LDX INSRT
00706  E773  F0 03              BEQ CNC3X
00707  E775  4C CB E6           JMP NC3
00708  E778  C9 14       CNC3X  CMP #$14
00709  E77A  D0 2E              BNE NTCN1
00710  E77C  98                 TYA
00711  E77D  D0 06              BNE BAK1UP
00712  E77F  20 2D E7           JSR BKLN
00713  E782  4C 9F E7           JMP BK2
00714  E785  20 E8 E8    BAK1UP JSR CHKBAK      ;SHOULD WE DEC TBLX
00715  E788  88                 DEY






SCREEN EDITOR......PAGE 0013

LINE# LOC   CODE        LINE


00716  E789  84 D3              STY PNTR
00717  E78B  20 B2 EA    BK1    JSR SCOLOR      ;FIX COLOR PTRS
00718  E78E  C8          BK15   INY
00719  E78F  B1 D1              LDA (PNT)Y
00720  E791  88                 DEY
00721  E792  91 D1              STA (PNT)Y
00722  E794  C8                 INY
00723  E795  B1 F3              LDA (USER)Y
00724  E797  88                 DEY
00725  E798  91 F3              STA (USER)Y
00726  E79A  C8                 INY
00727  E79B  C4 D5              CPY LNMX
00728  E79D  D0 EF              BNE BK15
00729  E79F  A9 20       BK2    LDA #' 
00730  E7A1  91 D1              STA (PNT)Y 
00731  E7A3  AD 86 02           LDA COLOR
00732  E7A6  91 F3              STA (USER)Y
00733  E7A8  10 4D              BPL JPL3
00734  E7AA  A6 D4       NTCN1  LDX QTSW
00735  E7AC  F0 03              BEQ NC3W
00736  E7AE  4C CB E6    CNC3   JMP NC3
00737  E7B1  C9 12       NC3W   CMP #$12
00738  E7B3  D0 02              BNE NC1
00739  E7B5  85 C7              STA RVS
00740  E7B7  C9 13       NC1    CMP #$13
00741  E7B9  D0 03              BNE NC2
00742  E7BB  20 81 E5           JSR NXTD
00743  E7BE  C9 1D       NC2    CMP #$1D
00744  E7C0  D0 17              BNE NCX2
00745  E7C2  C8                 INY
00746  E7C3  20 FA E8           JSR CHKDWN
00747  E7C6  84 D3              STY PNTR
00748  E7C8  88                 DEY
00749  E7C9  C4 D5              CPY LNMX
00750  E7CB  90 09              BCC NCZ2
00751  E7CD  C6 D6              DEC TBLX
00752  E7CF  20 C3 E8           JSR NXLN
00753  E7D2  A0 00              LDY #0
00754  E7D4  84 D3       JPL4   STY PNTR
00755  E7D6  4C DC E6    NCZ2   JMP LOOP2
00756  E7D9  C9 11       NCX2   CMP #$11
00757  E7DB  D0 1D              BNE COLR1
00758  E7DD  18                 CLC
00759  E7DE  98                 TYA
00760  E7DF  69 16              ADC #LLEN
00761  E7E1  A8                 TAY
00762  E7E2  E6 D6              INC TBLX
00763  E7E4  C5 D5              CMP LNMX
00764  E7E6  90 EC              BCC JPL4
00765  E7E8  F0 EA              BEQ JPL4
00766  E7EA  C6 D6              DEC TBLX
00767  E7EC  E9 16       CURS10 SBC #LLEN
00768  E7EE  90 04              BCC GOTDWN
00769  E7F0  85 D3              STA PNTR
00770  E7F2  D0 F8              BNE CURS10






SCREEN EDITOR......PAGE 0014

LINE# LOC   CODE        LINE


00771  E7F4  20 C3 E8    GOTDWN JSR NXLN
00772  E7F7  4C DC E6    JPL3   JMP LOOP2
00773  E7FA  20 12 E9    COLR1  JSR CHKCOL      ;CHECK FOR A COLOR
00774  E7FD  4C 21 ED           JMP LOWER       ;WAS JMP LOOP2



00776  E800              ;CHECK COLOR
00777  E800              ;





00779  E800              ;SHIFTED KEYS
00780  E800              ;
00781  E800  EA          NXTX   .BYT $EA,$EA,$EA
00781  E801  EA 
00781  E802  EA 
00782  E803  EA                 .BYT $EA,$EA
00782  E804  EA 
00783  E805  EA                 .BYT $EA,$EA
00783  E806  EA 
00784  E807  EA                 .BYT $EA,$EA,$EA
00784  E808  EA 
00784  E809  EA 
00785  E80A  EA                 .BYT $EA,$EA
00785  E80B  EA 
00786  E80C  EA                 .BYT $EA
00787  E80D  EA                 .BYT $EA
00788  E80E  EA                 .BYT $EA,$EA
00788  E80F  EA 
00789  E810              ;
00790  E810  EA                 .BYT $EA,$EA
00790  E811  EA 
00791  E812              ;
00792  E812  EA                 .BYT $EA,$EA,$EA
00792  E813  EA 
00792  E814  EA 
00793  E815              KEEPIT
00794  E815  29 7F              AND #$7F
00795  E817  C9 7F              CMP #$7F
00796  E819  D0 02              BNE NXTX1
00797  E81B  A9 5E              LDA #$5E
00798  E81D  EA          NXTX1  .BYT $EA,$EA
00798  E81E  EA 
00799  E81F  EA                 .BYT $EA,$EA
00799  E820  EA 
00800  E821  EA                 .BYT $EA,$EA
00800  E822  EA 
00801  E823              NXTXA
00802  E823  C9 20              CMP #$20        ;IS IT A FUNCTION KEY
00803  E825  90 03              BCC UHUH
00804  E827  4C C5 E6           JMP NXT33
00805  E82A              UHUH






SCREEN EDITOR......PAGE 0015

LINE# LOC   CODE        LINE


00806  E82A  C9 0D              CMP #$D
00807  E82C  D0 03              BNE UP5
00808  E82E  4C D8 E8           JMP NXT1
00809  E831  A6 D4       UP5    LDX  QTSW
00810  E833  D0 3F              BNE UP6
00811  E835  C9 14              CMP #$14
00812  E837  D0 37              BNE UP9
00813  E839  A4 D5              LDY LNMX
00814  E83B  B1 D1              LDA (PNT)Y
00815  E83D  C9 20              CMP #' 
00816  E83F  D0 04              BNE INS3
00817  E841  C4 D3              CPY PNTR
00818  E843  D0 07              BNE INS1
00819  E845  C0 57       INS3   CPY #MAXCHR-1
00820  E847  F0 24              BEQ INSEXT      ;EXIT IF LINE TOO LONG
00821  E849  20 EE E9           JSR NEWLIN      ;SCROLL DOWN 1
00822  E84C  A4 D5       INS1   LDY LNMX
00823  E84E  20 B2 EA           JSR SCOLOR
00824  E851  88          INS2   DEY
00825  E852  B1 D1              LDA (PNT)Y
00826  E854  C8                 INY
00827  E855  91 D1              STA (PNT)Y
00828  E857  88                 DEY
00829  E858  B1 F3              LDA (USER)Y
00830  E85A  C8                 INY
00831  E85B  91 F3              STA (USER)Y
00832  E85D  88                 DEY
00833  E85E  C4 D3              CPY PNTR
00834  E860  D0 EF              BNE INS2
00835  E862  A9 20              LDA #$20
00836  E864  91 D1              STA (PNT)Y
00837  E866  AD 86 02           LDA COLOR
00838  E869  91 F3              STA (USER)Y
00839  E86B  E6 D8              INC INSRT
00840  E86D  4C DC E6    INSEXT JMP LOOP2
00841  E870  A6 D8       UP9    LDX INSRT
00842  E872  F0 05              BEQ UP2
00843  E874  09 40       UP6    ORA #$40
00844  E876  4C CB E6           JMP NC3
00845  E879  C9 11       UP2    CMP #$11
00846  E87B  D0 16              BNE NXT2
00847  E87D  A6 D6              LDX TBLX
00848  E87F  F0 37              BEQ JPL2
00849  E881  C6 D6              DEC TBLX
00850  E883  A5 D3              LDA PNTR
00851  E885  38                 SEC
00852  E886  E9 16              SBC #LLEN
00853  E888  90 04              BCC UPALIN
00854  E88A  85 D3              STA PNTR
00855  E88C  10 2A              BPL JPL2
00856  E88E  20 87 E5    UPALIN JSR STUPT
00857  E891  D0 25              BNE JPL2
00858  E893  C9 12       NXT2   CMP #$12
00859  E895  D0 04              BNE NXT6
00860  E897  A9 00              LDA #0






SCREEN EDITOR......PAGE 0016

LINE# LOC   CODE        LINE


00861  E899  85 C7              STA RVS
00862  E89B  C9 1D       NXT6   CMP #$1D
00863  E89D  D0 12              BNE NXT61
00864  E89F  98                 TYA
00865  E8A0  F0 09              BEQ BAKBAK
00866  E8A2  20 E8 E8           JSR CHKBAK
00867  E8A5  88                 DEY
00868  E8A6  84 D3              STY PNTR
00869  E8A8  4C DC E6           JMP LOOP2
00870  E8AB  20 2D E7    BAKBAK JSR BKLN
00871  E8AE  4C DC E6           JMP LOOP2
00872  E8B1  C9 13       NXT61  CMP #$13
00873  E8B3  D0 06              BNE SCCL
00874  E8B5  20 5F E5           JSR CLSR
00875  E8B8  4C DC E6    JPL2   JMP LOOP2
00876  E8BB              SCCL
00877  E8BB  09 80              ORA #$80        ;MAKE IT UPPER CASE
00878  E8BD  20 12 E9           JSR CHKCOL      ;TRY FOR COLOR
00879  E8C0  4C 30 ED           JMP UPPER       ;WAS JMP LOOP2
00880  E8C3              ;
00881  E8C3  46 C9       NXLN   LSR LSXP
00882  E8C5  A6 D6              LDX TBLX
00883  E8C7  E8          NXLN2  INX
00884  E8C8  E0 17              CPX #NLINES     ;OFF BOTTOM?
00885  E8CA  D0 03              BNE NXLN1       ;NO...
00886  E8CC  20 75 E9           JSR SCROL       ;YES...SCROLL
00887  E8CF  B5 D9       NXLN1  LDA LDTB1,X     ;DOUBLE LINE?
00888  E8D1  10 F4              BPL NXLN2       ;YES...SCROLL AGAIN
00889  E8D3  86 D6              STX TBLX
00890  E8D5  4C 87 E5           JMP STUPT
00891  E8D8              NXT1
00892  E8D8  A2 00              LDX #0
00893  E8DA  86 D8              STX INSRT
00894  E8DC  86 C7              STX RVS
00895  E8DE  86 D4              STX QTSW
00896  E8E0  86 D3              STX PNTR
00897  E8E2  20 C3 E8           JSR NXLN
00898  E8E5  4C DC E6    JPL5   JMP LOOP2
00899  E8E8              ;
00900  E8E8              ;
00901  E8E8              ; CHECK FOR A DECREMENT TBLX
00902  E8E8              ;
00903  E8E8  A2 04       CHKBAK LDX #NWRAP
00904  E8EA  A9 00              LDA #0
00905  E8EC  C5 D3       CHKLUP CMP PNTR
00906  E8EE  F0 07              BEQ BACK
00907  E8F0  18                 CLC
00908  E8F1  69 16              ADC #LLEN
00909  E8F3  CA                 DEX
00910  E8F4  D0 F6              BNE CHKLUP
00911  E8F6  60                 RTS
00912  E8F7              ;
00913  E8F7  C6 D6       BACK   DEC TBLX
00914  E8F9  60                 RTS
00915  E8FA              ;






SCREEN EDITOR......PAGE 0017

LINE# LOC   CODE        LINE


00916  E8FA              ; CHECK FOR INCREMENT TBLX
00917  E8FA              ;
00918  E8FA  A2 04       CHKDWN LDX #NWRAP
00919  E8FC  A9 15              LDA #LLEN-1
00920  E8FE  C5 D3       DWNCHK CMP PNTR
00921  E900  F0 07              BEQ DNLINE
00922  E902  18                 CLC
00923  E903  69 16              ADC #LLEN
00924  E905  CA                 DEX
00925  E906  D0 F6              BNE DWNCHK
00926  E908  60                 RTS
00927  E909              ;
00928  E909  A6 D6       DNLINE LDX TBLX
00929  E90B  E0 17              CPX #NLINES
00930  E90D  F0 02              BEQ DWNBYE
00931  E90F  E6 D6              INC TBLX
00932  E911              ;
00933  E911  60          DWNBYE RTS

00935  E912              CHKCOL
00936  E912  A2 07              LDX #7          ;THERE'S 8 COLORS
00937  E914  DD 21 E9    CHK1A  CMP COLTAB,X
00938  E917  F0 04              BEQ CHK1B
00939  E919  CA                 DEX
00940  E91A  10 F8              BPL CHK1A
00941  E91C  60                 RTS
00942  E91D              ;
00943  E91D              CHK1B
00944  E91D  8E 86 02           STX COLOR       ;CHANGE THE COLOR
00945  E920  60                 RTS
00946  E921              COLTAB
00947  E921              ;BLK,WHT,RED,CYAN,MAGENTA,GRN,BLUE,YELLOW
00948  E921  90                 .BYT $90,$05,$1C,$9F,$9C,$1E,$1F,$9E
00948  E922  05 
00948  E923  1C 
00948  E924  9F 
00948  E925  9C 
00948  E926  1E 
00948  E927  1F 
00948  E928  9E 
00949  E929              ;********************************
00950  E929              ; THE FOLLOWING TABLE SERVES TO
00951  E929              ; CONVERT TO AND FROM SCREEN CODE
00952  E929              ; TO KASCII.  IT IS IMPLEMENTED FOR
00953  E929              ; TESTING ONLY.  IT COULD BE IMPROVED
00954  E929              ; TO REDUCE CODE AND SPEED BY AN
00955  E929              ; ALGORITHM
00956  E929              ;
00957  E929              ;*********************************
00958  E929              .END
00959  E929              .LIB   CONKAT
00960  E929  EF                 .BYT $EF,$A1    ;ALL OF THIS IS AVAILABLE FOR PATCH SPACE
00960  E92A  A1 
00961  E92B  DF                 .BYT $DF,$A6
00961  E92C  A6 






SCREEN EDITOR......PAGE 0018

LINE# LOC   CODE        LINE


00962  E92D  E1                 .BYT $E1,$B1
00962  E92E  B1 
00963  E92F  E2                 .BYT $E2,$B2
00963  E930  B2 
00964  E931  E3                 .BYT $E3,$B3
00964  E932  B3 
00965  E933  E4                 .BYT $E4,$B4
00965  E934  B4 
00966  E935  E5                 .BYT $E5,$B5
00966  E936  B5 
00967  E937  E6                 .BYT $E6,$B6
00967  E938  B6 
00968  E939  E7                 .BYT $E7,$B7
00968  E93A  B7 
00969  E93B  E8                 .BYT $E8,$B8
00969  E93C  B8 
00970  E93D  E9                 .BYT $E9,$B9
00970  E93E  B9 
00971  E93F  FA                 .BYT $FA,$BA
00971  E940  BA 
00972  E941  FB                 .BYT $FB,$BB
00972  E942  BB 
00973  E943  FC                 .BYT $FC,$BC
00973  E944  BC 
00974  E945  EC                 .BYT $EC,$BD
00974  E946  BD 
00975  E947  FE                 .BYT $FE,$BE
00975  E948  BE 
00976  E949  84                 .BYT $84,$BF
00976  E94A  BF 
00977  E94B  F7                 .BYT $F7,$C0
00977  E94C  C0 
00978  E94D  F8                 .BYT $F8,$DB
00978  E94E  DB 
00979  E94F  F9                 .BYT $F9,$DD
00979  E950  DD 
00980  E951  EA                 .BYT $EA,$DE
00980  E952  DE 
00981  E953              UNKAT
00982  E953  5E                 .BYT $5E,$E0    ;E0-E2 SPECIAL CONVERSION CODES
00982  E954  E0 
00983  E955  5B                 .BYT $5B,$E1
00983  E956  E1 
00984  E957  5D                 .BYT $5D,$E2
00984  E958  E2 
00985  E959  40                 .BYT $40,$B0
00985  E95A  B0 
00986  E95B  61                 .BYT $61,$B1    ;UNCONVERSION
00986  E95C  B1 
00987  E95D  78                 .BYT $78,$DB
00987  E95E  DB 
00988  E95F  79                 .BYT $79,$DD
00988  E960  DD 
00989  E961  66                 .BYT $66,$B6
00989  E962  B6 






SCREEN EDITOR......PAGE 0019

LINE# LOC   CODE        LINE


00990  E963  77                 .BYT $77,$C0
00990  E964  C0 
00991  E965  70                 .BYT $70,$F0
00991  E966  F0 
00992  E967  71                 .BYT $71,$F1
00992  E968  F1 
00993  E969  72                 .BYT $72,$F2
00993  E96A  F2 
00994  E96B  73                 .BYT $73,$F3
00994  E96C  F3 
00995  E96D  74                 .BYT $74,$F4
00995  E96E  F4 
00996  E96F  75                 .BYT $75,$F5
00996  E970  F5 
00997  E971  76                 .BYT $76,$F6
00997  E972  F6 
00998  E973  7D                 .BYT $7D,$FD
00998  E974  FD 
00999  E975              .END
01000  E975              .LIB   EDITOR.2









































EDITOR.2......PAGE 001A

LINE# LOC   CODE        LINE


01002  E975              ;SCREEN SCROLL ROUTINE
01003  E975              ;
01004  E975  A5 AC       SCROL  LDA SAL
01005  E977  48                 PHA
01006  E978  A5 AD              LDA SAH
01007  E97A  48                 PHA
01008  E97B  A5 AE              LDA EAL
01009  E97D  48                 PHA
01010  E97E  A5 AF              LDA EAH
01011  E980  48                 PHA
01012  E981              ;
01013  E981              ;   S C R O L L   U P
01014  E981              ;
01015  E981  A2 FF       SCRO0  LDX #$FF
01016  E983  C6 D6              DEC TBLX
01017  E985  C6 C9              DEC LSXP
01018  E987  C6 F2              DEC LINTMP
01019  E989  E8          SCR10  INX             ;GOTO NEXT LINE
01020  E98A  20 7E EA           JSR SETPNT      ;POINT TO 'TO' LINE
01021  E98D  E0 16              CPX #NLINES-1   ;DONE?
01022  E98F  B0 0C              BCS SCR41       ;BRANCH IF SO
01023  E991              ;
01024  E991  BD FE ED           LDA LDTB2+1,X   ;SETUP FROM PNTR
01025  E994  85 AC              STA SAL
01026  E996  B5 DA              LDA LDTB1+1,X
01027  E998  20 56 EA           JSR SCRLIN      ;SCROLL THIS LINE UP1
01028  E99B  30 EC              BMI SCR10
01029  E99D              ;
01030  E99D              SCR41
01031  E99D  20 8D EA           JSR CLRLN
01032  E9A0              ;
01033  E9A0  A2 00              LDX #0          ;SCROLL HI BYTE POINTERS
01034  E9A2  B5 D9       SCRL5  LDA LDTB1,X
01035  E9A4  29 7F              AND #$7F
01036  E9A6  B4 DA              LDY LDTB1+1,X
01037  E9A8  10 02              BPL SCRL3
01038  E9AA  09 80              ORA #$80
01039  E9AC  95 D9       SCRL3  STA LDTB1,X
01040  E9AE  E8                 INX
01041  E9AF  E0 16              CPX #NLINES-1
01042  E9B1  D0 EF              BNE SCRL5
01043  E9B3              ;
01044  E9B3  A5 EF              LDA LDTB1+NLINES-1
01045  E9B5  09 80              ORA #$80
01046  E9B7  85 EF              STA LDTB1+NLINES-1
01047  E9B9  A5 D9              LDA LDTB1       ;DOUBLE LINE?
01048  E9BB  10 C4              BPL SCRO0       ;YES...SCROLL AGAIN
01049  E9BD              ;
01050  E9BD  E6 D6              INC TBLX
01051  E9BF  E6 F2              INC LINTMP
01052  E9C1  A9 FB              LDA #$FB        ;CHECK FOR CONTROL KEY
01053  E9C3  8D 20 91           STA COLM        ;DROP LINE 2 ON PORT B
01054  E9C6  AD 21 91           LDA ROWS
01055  E9C9  C9 FE              CMP #$FE        ;SLOW SCROLL KEY?(CONTROL)
01056  E9CB  08                 PHP             ;SAVE STATUS. RESTORE PORT B






EDITOR.2......PAGE 001B

LINE# LOC   CODE        LINE


01057  E9CC  A9 F7              LDA #$F7        ;FOR STOP KEY CHECK
01058  E9CE  8D 20 91           STA COLM
01059  E9D1  28                 PLP
01060  E9D2  D0 0B              BNE MLP42
01061  E9D4              ;
01062  E9D4  A0 00              LDY #0
01063  E9D6  EA          MLP4   NOP             ;DELAY
01064  E9D7  CA                 DEX
01065  E9D8  D0 FC              BNE MLP4
01066  E9DA  88                 DEY
01067  E9DB  D0 F9              BNE MLP4
01068  E9DD  84 C6              STY NDX         ;CLEAR KEY QUEUE BUFFER
01069  E9DF              ;
01070  E9DF  A6 D6       MLP42  LDX TBLX
01071  E9E1              ;
01072  E9E1  68                 PLA
01073  E9E2  85 AF              STA EAH
01074  E9E4  68                 PLA
01075  E9E5  85 AE              STA EAL
01076  E9E7  68                 PLA
01077  E9E8  85 AD              STA SAH
01078  E9EA  68                 PLA
01079  E9EB  85 AC              STA SAL
01080  E9ED              ;
01081  E9ED  60                 RTS




































EDITOR.2......PAGE 001C

LINE# LOC   CODE        LINE


01083  E9EE              NEWLIN
01084  E9EE  A6 D6              LDX TBLX
01085  E9F0  E8          BMT1   INX
01086  E9F1  B5 D9              LDA LDTB1,X     ;FIND LAST DISPLAY LINE OF THIS LINE
01087  E9F3  10 FB              BPL BMT1
01088  E9F5  86 F2              STX LINTMP      ;FOUND IT
01089  E9F7              ;GENERATE A NEW LINE
01090  E9F7  E0 16              CPX #NLINES-1   ;IS ONE LINE FROM BOTTOM?
01091  E9F9  F0 0D              BEQ NEWLX       ;YES...JUST CLEAR LAST
01092  E9FB  90 0B              BCC NEWLX       ;<NLINES...INSERT LINE
01093  E9FD  20 75 E9           JSR SCROL       ;SCROLL EVERYTHING
01094  EA00  A6 F2              LDX LINTMP
01095  EA02  CA                 DEX
01096  EA03  C6 D6              DEC TBLX
01097  EA05  4C 0E E7           JMP WLOG30
01098  EA08  A5 AC       NEWLX  LDA SAL
01099  EA0A  48                 PHA
01100  EA0B  A5 AD              LDA SAH
01101  EA0D  48                 PHA
01102  EA0E  A5 AE              LDA EAL
01103  EA10  48                 PHA
01104  EA11  A5 AF              LDA EAH
01105  EA13  48                 PHA
01106  EA14  A2 17              LDX #NLINES
01107  EA16  CA          SCD10  DEX
01108  EA17  20 7E EA           JSR SETPNT      ;SET UP TO ADDR
01109  EA1A  E4 F2              CPX LINTMP
01110  EA1C  90 0E              BCC SCR40
01111  EA1E  F0 0C              BEQ SCR40       ;BRANCH IF FINISHED
01112  EA20  BD FC ED           LDA LDTB2-1,X   ;SET FROM ADDR
01113  EA23  85 AC              STA SAL
01114  EA25  B5 D8              LDA LDTB1-1,X
01115  EA27  20 56 EA           JSR SCRLIN      ;SCROLL THIS LINE DOWN
01116  EA2A  30 EA              BMI SCD10
01117  EA2C              SCR40
01118  EA2C  20 8D EA           JSR CLRLN
01119  EA2F  A2 15              LDX #NLINES-2
01120  EA31              SCRD21
01121  EA31  E4 F2              CPX LINTMP      ;DONE?
01122  EA33  90 0F              BCC SCRD22      ;BRANCH IF SO
01123  EA35  B5 DA              LDA LDTB1+1,X
01124  EA37  29 7F              AND #$7F
01125  EA39  B4 D9              LDY LDTB1,X     ;WAS IT CONTINUED
01126  EA3B  10 02              BPL SCRD19      ;BRANCH IF SO
01127  EA3D  09 80              ORA #$80
01128  EA3F  95 DA       SCRD19 STA LDTB1+1,X
01129  EA41  CA                 DEX
01130  EA42  D0 ED              BNE SCRD21
01131  EA44              SCRD22
01132  EA44  A6 F2              LDX LINTMP
01133  EA46  20 0E E7           JSR WLOG30
01134  EA49              ;
01135  EA49  68                 PLA
01136  EA4A  85 AF              STA EAH
01137  EA4C  68                 PLA






EDITOR.2......PAGE 001D

LINE# LOC   CODE        LINE


01138  EA4D  85 AE              STA EAL
01139  EA4F  68                 PLA
01140  EA50  85 AD              STA SAH
01141  EA52  68                 PLA
01142  EA53  85 AC              STA SAL
01143  EA55  60                 RTS
01144  EA56              ;
01145  EA56              ; SCROLL LINE FROM SAL TO PNT
01146  EA56              ; AND COLORS FROM EAL TO USER
01147  EA56              ;
01148  EA56              SCRLIN
01149  EA56  29 03              AND #$03        ;CLEAR ANY GARBAGE STUFF
01150  EA58  0D 88 02           ORA HIBASE      ;PUT IN HIORDER BITS
01151  EA5B  85 AD              STA SAL+1
01152  EA5D  20 6E EA           JSR TOFROM      ;COLOR TO & FROM ADDRS
01153  EA60  A0 15              LDY #LLEN-1
01154  EA62              SCD20
01155  EA62  B1 AC              LDA (SAL)Y
01156  EA64  91 D1              STA (PNT)Y
01157  EA66  B1 AE              LDA (EAL)Y
01158  EA68  91 F3              STA (USER)Y
01159  EA6A  88                 DEY
01160  EA6B  10 F5              BPL SCD20
01161  EA6D  60                 RTS
01162  EA6E              ;
01163  EA6E              ; DO COLOR TO AND FROM ADDRESSES
01164  EA6E              ; FROM CHARACTER TO AND FROM ADRS
01165  EA6E              ;
01166  EA6E              TOFROM
01167  EA6E  20 B2 EA           JSR SCOLOR
01168  EA71  A5 AC              LDA SAL         ;CHARACTER FROM
01169  EA73  85 AE              STA EAL         ;MAKE COLOR FROM
01170  EA75  A5 AD              LDA SAL+1
01171  EA77  29 03              AND #$03
01172  EA79  09 94              ORA #>VICCOL
01173  EA7B  85 AF              STA EAL+1
01174  EA7D  60                 RTS
01175  EA7E              ;
01176  EA7E              ; SET UP PNT AND Y
01177  EA7E              ; FROM .X
01178  EA7E              ;
01179  EA7E  BD FD ED    SETPNT LDA LDTB2,X
01180  EA81  85 D1              STA PNT
01181  EA83  B5 D9              LDA LDTB1,X
01182  EA85  29 03              AND #$03
01183  EA87  0D 88 02           ORA HIBASE
01184  EA8A  85 D2              STA PNT+1
01185  EA8C  60                 RTS
01186  EA8D              ;
01187  EA8D              ; CLEAR THE LINE POINTED TO BY .X
01188  EA8D              ;
01189  EA8D  A0 15       CLRLN  LDY #LLEN-1
01190  EA8F  20 7E EA           JSR SETPNT
01191  EA92  20 B2 EA           JSR SCOLOR
01192  EA95  A9 20       CLR10  LDA #$20






EDITOR.2......PAGE 001E

LINE# LOC   CODE        LINE


01193  EA97  91 D1              STA (PNT)Y
01194  EA99  A9 01              LDA #WHITE      ;DO THE COLOR
01195  EA9B  91 F3              STA (USER)Y
01196  EA9D  88                 DEY
01197  EA9E  10 F5              BPL CLR10
01198  EAA0  60                 RTS





01200  EAA1              ;
01201  EAA1              ;PUT A CHAR ON THE SCREEN
01202  EAA1              ;
01203  EAA1  A8          DSPP   TAY             ;SAVE CHAR
01204  EAA2  A9 02              LDA #2
01205  EAA4  85 CD              STA BLNCT       ;BLINK CURSOR
01206  EAA6  20 B2 EA           JSR SCOLOR      ;SET COLOR PTR
01207  EAA9  98                 TYA             ;RESTORE COLOR
01208  EAAA  A4 D3       DSPP2  LDY PNTR        ;GET COLUMN
01209  EAAC  91 D1              STA (PNT)Y      ;CHAR TO SCREEN
01210  EAAE  8A                 TXA
01211  EAAF  91 F3              STA (USER)Y     ;COLOR TO SCREEN
01212  EAB1  60                 RTS





01214  EAB2  A5 D1       SCOLOR LDA PNT         ;GENERATE COLOR PTR
01215  EAB4  85 F3              STA USER
01216  EAB6  A5 D2              LDA PNT+1
01217  EAB8  29 03              AND #$03
01218  EABA  09 94              ORA #>VICCOL    ;VIC COLOR RAM
01219  EABC  85 F4              STA USER+1
01220  EABE  60                 RTS

























EDITOR.2......PAGE 001F

LINE# LOC   CODE        LINE


01222  EABF  20 EA FF    KEY    JSR $FFEA       ;UPDATE JIFFY CLOCK
01223  EAC2  A5 CC              LDA BLNSW       ;BLINKING CRSR ?
01224  EAC4  D0 29              BNE KEY4        ;NO
01225  EAC6  C6 CD              DEC BLNCT       ;TIME TO BLINK ?
01226  EAC8  D0 25              BNE KEY4        ;NO
01227  EACA  A9 14              LDA #20         ;RESET BLINK COUNTER
01228  EACC  85 CD       REPDO  STA BLNCT
01229  EACE  A4 D3              LDY PNTR        ;CURSOR POSITION
01230  EAD0  46 CF              LSR BLNON       ;CARRY SET IF ORIGINAL CHAR
01231  EAD2  AE 87 02           LDX GDCOL       ;GET CHAR ORIGINAL COLOR
01232  EAD5  B1 D1              LDA (PNT)Y      ;GET CHARACTER
01233  EAD7  B0 11              BCS KEY5        ;BRANCH IF NOT NEEDED
01234  EAD9              ;
01235  EAD9  E6 CF              INC BLNON       ;SET TO 1
01236  EADB  85 CE              STA GDBLN       ;SAVE ORIGINAL CHAR
01237  EADD  20 B2 EA           JSR SCOLOR
01238  EAE0  B1 F3              LDA (USER)Y     ;GET ORIGINAL COLOR
01239  EAE2  8D 87 02           STA GDCOL       ;SAVE IT
01240  EAE5  AE 86 02           LDX COLOR       ;BLINK IN THIS COLOR
01241  EAE8  A5 CE              LDA GDBLN       ;WITH ORIGINAL CHARACTER
01242  EAEA              ;
01243  EAEA  49 80       KEY5   EOR #$80        ;BLINK IT
01244  EAEC  20 AA EA           JSR DSPP2       ;DISPLAY IT
01245  EAEF              ;
01246  EAEF  AD 1F 91    KEY4   LDA D1ORA       ;GET CASSETTE SWITCHES
01247  EAF2  29 40              AND #$40        ;IS SWITHC DOWN
01248  EAF4  F0 0B              BEQ KEY3        ;BRANCH IF SO
01249  EAF6              ;
01250  EAF6  A0 00              LDY #0
01251  EAF8  84 C0              STY CAS1        ;CASSETTE OFF SWITCH
01252  EAFA              ;
01253  EAFA  AD 1C 91           LDA D1PCR
01254  EAFD  09 02              ORA #$02
01255  EAFF  D0 09              BNE KL24        ;BRANCH IF MOTOR IS OFF
01256  EB01              ;
01257  EB01  A5 C0       KEY3   LDA CAS1
01258  EB03  D0 0D              BNE KL2
01259  EB05              ;
01260  EB05  AD 1C 91           LDA D1PCR
01261  EB08  29 FD              AND #$FD        ;TURN MOTOR ON
01262  EB0A              ;
01263  EB0A  2C 1E 91    KL24   BIT D1IER       ;CHECK RS-232 TRANSMITTER ON (T1)
01264  EB0D  70 03              BVS KL2         ;YES...NO MANUAL CASS CONTROLS
01265  EB0F  8D 1C 91           STA D1PCR
01266  EB12              ;
01267  EB12  20 1E EB    KL2    JSR SCNKEY      ;SCAN KEYBOARD
01268  EB15              ;
01269  EB15  2C 24 91    KPREND BIT D2T1L       ;CLEAR INTERUPT FLAG
01270  EB18  68                 PLA             ;RESTORE REGISTERS
01271  EB19  A8                 TAY
01272  EB1A  68                 PLA
01273  EB1B  AA                 TAX
01274  EB1C  68                 PLA
01275  EB1D  40                 RTI             ;EXIT FROM IRQ ROUTINES







EDITOR.2......PAGE 0020

LINE# LOC   CODE        LINE


01277  EB1E              ; ****** GENERAL KEYBOARD SCAN ******
01278  EB1E              ;
01279  EB1E  A9 00       SCNKEY LDA #$00
01280  EB20  8D 8D 02           STA SHFLAG
01281  EB23  A0 40              LDY #64         ;LAST KEY INDEX
01282  EB25  84 CB              STY SFDX        ;NULL KEY FOUND
01283  EB27  8D 20 91           STA COLM        ;RAISE ALL LINES
01284  EB2A  AE 21 91           LDX ROWS        ;CHECK FOR A KEY DOWN
01285  EB2D  E0 FF              CPX #$FF        ;NO KEYS DOWN?
01286  EB2F  F0 5E              BEQ SCNOUT      ;BRANCH IF NONE
01287  EB31              ; LDA CRFAC ;CHECK FOR RESTORE BACKGROUND/BOARDER
01288  EB31              ; BPL DONTRE ;DON'T RESTORE IF PLUS
01289  EB31              ; LDA CRFAC+1 ;GET OLD VALUE
01290  EB31              ; STA VICREG+15 ;PUT IT BACK IN VIC
01291  EB31              ;DONTRE
01292  EB31              ; LDA #0
01293  EB31              ; STA CRFAC ;REMEMBER I CHANGED IT BACK
01294  EB31  A9 FE              LDA #$FE        ;START WITH 1ST COLUMN
01295  EB33  8D 20 91           STA COLM
01296  EB36  A0 00              LDY #0
01297  EB38  A9 5E              LDA #<MODE1
01298  EB3A  85 F5              STA KEYTAB
01299  EB3C  A9 EC              LDA #>MODE1
01300  EB3E  85 F6              STA KEYTAB+1
01301  EB40  A2 08       SCN20  LDX #8          ;8 ROW KEYBOARD
01302  EB42  AD 21 91           LDA ROWS
01303  EB45  CD 21 91           CMP ROWS        ;DEBOUNCE KEYBOARD
01304  EB48  D0 F6              BNE SCN20
01305  EB4A  4A          SCN30  LSR A           ;LOOK FOR KEY DOWN
01306  EB4B  B0 16              BCS CKIT        ;NONE
01307  EB4D  48                 PHA
01308  EB4E  B1 F5              LDA (KEYTAB),Y  ;GET CHAR CODE
01309  EB50  C9 05              CMP #$05
01310  EB52  B0 0C              BCS SPCK2       ;IF NOT SPECIAL KEY GO ON
01311  EB54  C9 03              CMP #$03        ;COULD IT BE A STOP KEY?
01312  EB56  F0 08              BEQ SPCK2       ;BRANCH IF SO
01313  EB58  0D 8D 02           ORA SHFLAG
01314  EB5B  8D 8D 02           STA SHFLAG      ;PUT SHIFT BIT IN FLAG BYTE
01315  EB5E  10 02              BPL CKUT
01316  EB60              SPCK2
01317  EB60  84 CB              STY SFDX        ;SAVE KEY NUMBER
01318  EB62  68          CKUT   PLA
01319  EB63  C8          CKIT   INY
01320  EB64  C0 41              CPY #65
01321  EB66  B0 09              BCS CKIT1       ;BRANCH IF FINISHED
01322  EB68  CA                 DEX
01323  EB69  D0 DF              BNE SCN30
01324  EB6B  38                 SEC
01325  EB6C  2E 20 91           ROL COLM        ;NEXT COLUMN ON KEYBOARD
01326  EB6F  D0 CF              BNE SCN20       ;ALWAYS BRANCH
01327  EB71              CKIT1
01328  EB71  6C 8F 02           JMP (KEYLOG)    ;EVALUATE SHIFT FUNCTIONS
01329  EB74  A4 CB       REKEY  LDY SFDX        ;GET KEY INDEX
01330  EB76  B1 F5              LDA (KEYTAB)Y   ;GET CHAR CODE
01331  EB78  AA                 TAX             ;SAVE THE CHAR






EDITOR.2......PAGE 0021

LINE# LOC   CODE        LINE


01332  EB79  C4 C5              CPY LSTX        ;SAME AS PREV CHAR INDEX?
01333  EB7B  F0 07              BEQ RPT10       ;YES
01334  EB7D  A0 10              LDY #$10        ;NO - RESET DELAY BEFORE REPEAT
01335  EB7F  8C 8C 02           STY DELAY
01336  EB82  D0 36              BNE CKIT2       ;ALWAYS
01337  EB84  29 7F       RPT10  AND #$7F        ;UNSHIFT IT
01338  EB86  2C 8A 02           BIT RPTFLG      ;CHECK FOR REPEAT DISABLE
01339  EB89  30 16              BMI RPT20       ;YES
01340  EB8B  70 49              BVS SCNRTS
01341  EB8D  C9 7F              CMP #$7F        ;NO KEYS ?
01342  EB8F  F0 29       SCNOUT BEQ CKIT2       ;YES - GET OUT
01343  EB91  C9 14              CMP #$14        ;AN INST/DEL KEY ?
01344  EB93  F0 0C              BEQ RPT20       ;YES - REPEAT IT
01345  EB95  C9 20              CMP #$20        ;A SPACE KEY ?
01346  EB97  F0 08              BEQ RPT20       ;YES
01347  EB99  C9 1D              CMP #$1D        ;A CRSR LEFT/RIGHT ?
01348  EB9B  F0 04              BEQ RPT20       ;YES
01349  EB9D  C9 11              CMP #$11        ;A CRSR UP/DWN ?
01350  EB9F  D0 35              BNE SCNRTS      ;NO - EXIT
01351  EBA1  AC 8C 02    RPT20  LDY DELAY       ;TIME TO REPEAT ?
01352  EBA4  F0 05              BEQ RPT40       ;YES
01353  EBA6  CE 8C 02           DEC DELAY
01354  EBA9  D0 2B              BNE SCNRTS
01355  EBAB  CE 8B 02    RPT40  DEC KOUNT       ;TIME FOR NEXT REPEAT ?
01356  EBAE  D0 26              BNE SCNRTS      ;NO
01357  EBB0  A0 04              LDY #4          ;YES - RESET CTR
01358  EBB2  8C 8B 02           STY KOUNT
01359  EBB5  A4 C6              LDY NDX         ;NO REPEAT IF QUEUE FULL
01360  EBB7  88                 DEY
01361  EBB8  10 1C              BPL SCNRTS
01362  EBBA              CKIT2
01363  EBBA  A4 CB              LDY SFDX        ;GET INDEX OF KEY
01364  EBBC  84 C5              STY LSTX        ;SAVE THIS INDEX TO KEY FOUND
01365  EBBE  AC 8D 02           LDY SHFLAG      ;UPDATE SHIFT STATUS
01366  EBC1  8C 8E 02           STY LSTSHF
01367  EBC4  E0 FF       CKIT3  CPX #$FF        ;A NULL KEY OR NO KEY ?
01368  EBC6  F0 0E              BEQ SCNRTS      ;BRANCH IF SO
01369  EBC8  8A                 TXA             ;NEED X AS INDEX SO...
01370  EBC9  A6 C6              LDX NDX         ;GET # OF CHARS IN KEY QUEUE
01371  EBCB  EC 89 02           CPX XMAX        ;IRQ BUFFER FULL ?
01372  EBCE  B0 06              BCS SCNRTS      ;YES - NO MORE INSERT
01373  EBD0              PUTQUE
01374  EBD0  9D 77 02           STA KEYD,X      ;PUT RAW DATA HERE
01375  EBD3  E8                 INX
01376  EBD4  86 C6              STX NDX         ;UPDATE KEY QUEUE COUNT
01377  EBD6  A9 F7       SCNRTS LDA #$F7        ;SETUP PB3 FOR STOP KEY SENSE
01378  EBD8  8D 20 91           STA COLM
01379  EBDB  60                 RTS













EDITOR.2......PAGE 0022

LINE# LOC   CODE        LINE


01381  EBDC              ;
01382  EBDC              ; SHIFT LOGIC
01383  EBDC              ;
01384  EBDC              SHFLOG
01385  EBDC  AD 8D 02           LDA SHFLAG
01386  EBDF  C9 03              CMP #$03        ;COMMODORE SHIFT COMBINATION?
01387  EBE1  D0 2C              BNE KEYLG2      ;BRANCH IF NOT
01388  EBE3  CD 8E 02           CMP LSTSHF      ;DID I DO THIS ALREADY
01389  EBE6  F0 EE              BEQ SCNRTS      ;BRANCH IF SO
01390  EBE8  AD 91 02           LDA MODE
01391  EBEB  30 56              BMI SHFOUT      ;DONT SHIFT IF ITS MINUS
01392  EBED  EA                 .BYT $EA,$EA    ;AND #$18 ;WHICH MODE?
01392  EBEE  EA 
01393  EBEF  EA                 .BYT $EA,$EA    ;BEQ KATAON ;IF PET MODE TURNON KATAKANA
01393  EBF0  EA 
01394  EBF1  EA                 .BYT $EA,$EA    ;LDA #0
01394  EBF2  EA 
01395  EBF3  EA                 .BYT $EA,$EA,$EA;STA MODE ;SET PET MODE
01395  EBF4  EA 
01395  EBF5  EA 
01396  EBF6  EA                 .BYT $EA,$EA,$EA;LDA VICREG+5 ;TURN ON PETSET
01396  EBF7  EA 
01396  EBF8  EA 
01397  EBF9  EA                 .BYT $EA,$EA    ;AND #$FD ;CLEAR BIT 1
01397  EBFA  EA 
01398  EBFB  EA                 .BYT $EA,$EA,$EA;STA VICREG+5
01398  EBFC  EA 
01398  EBFD  EA 
01399  EBFE  EA                 .BYT $EA,$EA    ;BNE SHFOUT
01399  EBFF  EA 
01400  EC00  AD 05 90    SWITCH LDA VICREG+5
01401  EC03  49 02              EOR #$02        ;TURN ON OTHER CASE
01402  EC05  8D 05 90           STA VICREG+5    ;POINT THE VIC THERE
01403  EC08  EA                 .BYT $EA,$EA    ;LDA #8 ;SET KATAKANA MODE
01403  EC09  EA 
01404  EC0A  EA                 .BYT $EA,$EA    ;STA MODE
01404  EC0B  EA 
01405  EC0C  4C 43 EC           JMP SHFOUT
01406  EC0F              KEYLG2
01407  EC0F  0A                 ASL A
01408  EC10  C9 08              CMP #$08        ;WAS IT A CONTROL KEY
01409  EC12  90 04              BCC NCTRL       ;BRANCH IF NOT
01410  EC14  A9 06              LDA #6          ;ELSE USE TABLE #4
01411  EC16  EA                 .BYT $EA,$EA    ;BNE NOTKAT ;DO THE TABLE SHIFT
01411  EC17  EA 
01412  EC18              ;
01413  EC18              NCTRL
01414  EC18  EA                 .BYT $EA,$EA,$EA;LDX MODE
01414  EC19  EA 
01414  EC1A  EA 
01415  EC1B  EA                 .BYT $EA,$EA    ;BEQ NOTKAT
01415  EC1C  EA 
01416  EC1D  EA                 .BYT $EA,$EA,$EA;LDX SHFLAG ;SEE IF CO.KEY
01416  EC1E  EA 
01416  EC1F  EA 






EDITOR.2......PAGE 0023

LINE# LOC   CODE        LINE


01417  EC20  EA                 .BYT $EA,$EA    ;CPX #2
01417  EC21  EA 
01418  EC22  EA                 .BYT $EA,$EA    ;BNE NOTKAT ;BRANCH IF NOT
01418  EC23  EA 
01419  EC24  EA                 .BYT $EA,$EA,$EA;CPX LSTSHF ;DID I DO THIS LAST TIME?
01419  EC25  EA 
01419  EC26  EA 
01420  EC27  EA                 .BYT $EA,$EA    ;BEQ SHFOUT ;BRANCH IF SO
01420  EC28  EA 
01421  EC29  EA                 .BYT $EA,$EA,$EA;LDA MODE ;ELSE ...
01421  EC2A  EA 
01421  EC2B  EA 
01422  EC2C  EA                 .BYT $EA,$EA    ;EOR #$18 ;SWITCH KATA-EXTENDED
01422  EC2D  EA 
01423  EC2E  EA                 .BYT $EA,$EA,$EA;STA MODE
01423  EC2F  EA 
01423  EC30  EA 
01424  EC31  EA                 .BYT $EA,$EA    ;BPL SHFOUT
01424  EC32  EA 
01425  EC33              NOTKAT
01426  EC33  EA                 .BYT $EA,$EA,$EA;ORA MODE ;ADD MODE TABLE OFFSET
01426  EC34  EA 
01426  EC35  EA 
01427  EC36  EA                 .BYT $EA,$EA    ;AND #$7F ;CLEAR
01427  EC37  EA 
01428  EC38  AA                 TAX
01429  EC39  BD 46 EC           LDA KEYCOD,X
01430  EC3C  85 F5              STA KEYTAB
01431  EC3E  BD 47 EC           LDA KEYCOD+1,X
01432  EC41  85 F6              STA KEYTAB+1
01433  EC43              SHFOUT
01434  EC43  4C 74 EB           JMP REKEY
01435  EC46              .END
01436  EC46              .LIB   EDITOR.3



























KEYBOARD TABLES......PAGE 0024

LINE# LOC   CODE        LINE


01438  EC46              KEYCOD                 ;KEYBOARD MODE 'DISPATCH'
01439  EC46  5E EC              .WORD MODE1
01440  EC48  9F EC              .WORD MODE2
01441  EC4A  E0 EC              .WORD MODE3
01442  EC4C  A3 ED              .WORD CONTRL    ;CONTROL KEYS
01443  EC4E              ;
01444  EC4E              ; COTTACONNA MODE
01445  EC4E              ;
01446  EC4E  5E EC              .WORD MODE1     ;PET MODE1
01447  EC50  9F EC              .WORD MODE2     ;PET MODE2
01448  EC52  69 ED              .WORD CCTTA3    ;DUMMY WORD
01449  EC54  A3 ED              .WORD CONTRL
01450  EC56              ;
01451  EC56              ; EXTENDED KATAKANA MODE
01452  EC56              ;
01453  EC56  21 ED              .WOR CCTTA2     ;KATAKANA CHARACTERS
01454  EC58  69 ED              .WOR CCTTA3     ;LIMITED GRAPHICS
01455  EC5A  69 ED              .WOR CCTTA3     ;DUMMY
01456  EC5C  A3 ED              .WOR CONTRL










































EDITOR.3......PAGE 0025

LINE# LOC   CODE        LINE


01459  EC5E              MODE1
01460  EC5E              ;1,3,5,7,9,+,YEN SIGN,DEL
01461  EC5E  31                 .BYT $31,$33,$35,$37,$39,$2B,$5C,$14
01461  EC5F  33 
01461  EC60  35 
01461  EC61  37 
01461  EC62  39 
01461  EC63  2B 
01461  EC64  5C 
01461  EC65  14 
01462  EC66              ;LFT.ARROW,W,R,Y,I,P,*,RETURN
01463  EC66  5F                 .BYT $5F,$57,$52,$59,$49,$50,$2A,$0D
01463  EC67  57 
01463  EC68  52 
01463  EC69  59 
01463  EC6A  49 
01463  EC6B  50 
01463  EC6C  2A 
01463  EC6D  0D 
01464  EC6E              ;CTRL,A,D,G,J,L,;,RT CRSR
01465  EC6E  04                 .BYT $04,$41,$44,$47,$4A,$4C,$3B,$1D
01465  EC6F  41 
01465  EC70  44 
01465  EC71  47 
01465  EC72  4A 
01465  EC73  4C 
01465  EC74  3B 
01465  EC75  1D 
01466  EC76              ;STOP,L.SHIFT,X,V,N,,,/,CRSR DWN
01467  EC76  03                 .BYT $03,1,$58,$56,$4E,$2C,$2F,$11
01467  EC77  01 
01467  EC78  58 
01467  EC79  56 
01467  EC7A  4E 
01467  EC7B  2C 
01467  EC7C  2F 
01467  EC7D  11 
01468  EC7E              ;SPACE,Z,C,B,M,.,R.SHIFTT,F1
01469  EC7E  20                 .BYT $20,$5A,$43,$42,$4D,$2E,1,$85
01469  EC7F  5A 
01469  EC80  43 
01469  EC81  42 
01469  EC82  4D 
01469  EC83  2E 
01469  EC84  01 
01469  EC85  85 
01470  EC86              ;CO.KEY,S,F,H,K,:,=,F2
01471  EC86  02                 .BYT $02,$53,$46,$48,$4B,$3A,$3D,$86
01471  EC87  53 
01471  EC88  46 
01471  EC89  48 
01471  EC8A  4B 
01471  EC8B  3A 
01471  EC8C  3D 
01471  EC8D  86 






EDITOR.3......PAGE 0026

LINE# LOC   CODE        LINE


01472  EC8E              ;Q,E,T,U,O,@,EXP,F3
01473  EC8E  51                 .BYT $51,$45,$54,$55,$4F,$40,$5E,$87
01473  EC8F  45 
01473  EC90  54 
01473  EC91  55 
01473  EC92  4F 
01473  EC93  40 
01473  EC94  5E 
01473  EC95  87 
01474  EC96              ;2,4,6,8,0,-,HOME,F4
01475  EC96  32                 .BYT $32,$34,$36,$38,$30,$2D,$13,$88
01475  EC97  34 
01475  EC98  36 
01475  EC99  38 
01475  EC9A  30 
01475  EC9B  2D 
01475  EC9C  13 
01475  EC9D  88 
01476  EC9E  FF                 .BYT $FF        ;END OF TABLE NULL

01478  EC9F              MODE2
01479  EC9F              ;!,%,',),+,YEN,INS
01480  EC9F  21                 .BYT $21,$23,$25,$27,$29,$DB,$A9,$94
01480  ECA0  23 
01480  ECA1  25 
01480  ECA2  27 
01480  ECA3  29 
01480  ECA4  DB 
01480  ECA5  A9 
01480  ECA6  94 
01481  ECA7              ;SHIFTED LFT.ARROW,W,R,Y,I,P,*,RETURN
01482  ECA7  5F                 .BYT $5F,$D7,$D2,$D9,$C9,$D0,$C0,$8D
01482  ECA8  D7 
01482  ECA9  D2 
01482  ECAA  D9 
01482  ECAB  C9 
01482  ECAC  D0 
01482  ECAD  C0 
01482  ECAE  8D 
01483  ECAF              ;CTRL,A,D,G,J,L,;,LF.CRSR
01484  ECAF  04                 .BYT $04,$C1,$C4,$C7,$CA,$CC,$5D,$9D
01484  ECB0  C1 
01484  ECB1  C4 
01484  ECB2  C7 
01484  ECB3  CA 
01484  ECB4  CC 
01484  ECB5  5D 
01484  ECB6  9D 
01485  ECB7              ;RUN,L.SHIFT,X,V,N,,,/,CRSR DWN
01486  ECB7  83                 .BYT  $83,1,$D8,$D6,$CE,$3C,$3F,$91
01486  ECB8  01 
01486  ECB9  D8 
01486  ECBA  D6 
01486  ECBB  CE 
01486  ECBC  3C 






EDITOR.3......PAGE 0027

LINE# LOC   CODE        LINE


01486  ECBD  3F 
01486  ECBE  91 
01487  ECBF              ;SHIFTED SPACE,Z,C,B,M,.,R.SHIFT,F5
01488  ECBF  A0                 .BYT $A0,$DA,$C3,$C2,$CD,$3E,1,$89
01488  ECC0  DA 
01488  ECC1  C3 
01488  ECC2  C2 
01488  ECC3  CD 
01488  ECC4  3E 
01488  ECC5  01 
01488  ECC6  89 
01489  ECC7              ;SHIFTEC CO.KEY  ,S,F,H,K,:,=,F6
01490  ECC7  02                 .BYT $02,$D3,$C6,$C8,$CB,$5B,$3D,$8A
01490  ECC8  D3 
01490  ECC9  C6 
01490  ECCA  C8 
01490  ECCB  CB 
01490  ECCC  5B 
01490  ECCD  3D 
01490  ECCE  8A 
01491  ECCF              ;SHIFTED  G,E,T,U,O,@,PI,F7
01492  ECCF  D1                 .BYT $D1,$C5,$D4,$D5,$CF,$BA,$DE,$8B
01492  ECD0  C5 
01492  ECD1  D4 
01492  ECD2  D5 
01492  ECD3  CF 
01492  ECD4  BA 
01492  ECD5  DE 
01492  ECD6  8B 
01493  ECD7              ;",$,&,(,
01494  ECD7  22                 .BYT $22,$24,$26,$28,$30,$DD,$93,$8C
01494  ECD8  24 
01494  ECD9  26 
01494  ECDA  28 
01494  ECDB  30 
01494  ECDC  DD 
01494  ECDD  93 
01494  ECDE  8C 
01495  ECDF  FF                 .BYT $FF        ;END OF TABLE NULL
01496  ECE0              MODE3                  ;LEFT WINDOW GRAHPICS
01497  ECE0              ;1,3,5,7,9,+,POUND SIGN,INS
01498  ECE0  21                 .BYT $21,$23,$25,$27,$29,$A6,$A8,$94
01498  ECE1  23 
01498  ECE2  25 
01498  ECE3  27 
01498  ECE4  29 
01498  ECE5  A6 
01498  ECE6  A8 
01498  ECE7  94 
01499  ECE8              ;LFT.ARROW,W,R,Y,I,P,*,RETURN
01500  ECE8  5F                 .BYT $5F,$B3,$B2,$B7,$A2,$AF,$DF,$8D
01500  ECE9  B3 
01500  ECEA  B2 
01500  ECEB  B7 
01500  ECEC  A2 






EDITOR.3......PAGE 0028

LINE# LOC   CODE        LINE


01500  ECED  AF 
01500  ECEE  DF 
01500  ECEF  8D 
01501  ECF0              ;CTRL,A,D,G,J,L,;,LF.CRSR
01502  ECF0  04                 .BYT $04,$B0,$AC,$A5,$B5,$B6,$5D,$9D
01502  ECF1  B0 
01502  ECF2  AC 
01502  ECF3  A5 
01502  ECF4  B5 
01502  ECF5  B6 
01502  ECF6  5D 
01502  ECF7  9D 
01503  ECF8              ; RUN,L.SHIFT,X,V,N,,,/,CRSR.UP
01504  ECF8  83                 .BYT $83,$01,$BD,$BE,$AA,$3C,$3F,$91
01504  ECF9  01 
01504  ECFA  BD 
01504  ECFB  BE 
01504  ECFC  AA 
01504  ECFD  3C 
01504  ECFE  3F 
01504  ECFF  91 
01505  ED00              ;SPACE,Z,C,B,M,.,R.SHIFT,F2
01506  ED00  A0                 .BYT $A0,$AD,$BC,$BF,$A7,$3E,$01,$89
01506  ED01  AD 
01506  ED02  BC 
01506  ED03  BF 
01506  ED04  A7 
01506  ED05  3E 
01506  ED06  01 
01506  ED07  89 
01507  ED08              ;CO.KEY,S,F,H,K,:,=,F4
01508  ED08  02                 .BYT $02,$AE,$BB,$B4,$A1,$5B,$3D,$8A
01508  ED09  AE 
01508  ED0A  BB 
01508  ED0B  B4 
01508  ED0C  A1 
01508  ED0D  5B 
01508  ED0E  3D 
01508  ED0F  8A 
01509  ED10              ;Q,E,T,U,O,@,PI,F6
01510  ED10  AB                 .BYT $AB,$B1,$A3,$B8,$B9,$A4,$DE,$8B
01510  ED11  B1 
01510  ED12  A3 
01510  ED13  B8 
01510  ED14  B9 
01510  ED15  A4 
01510  ED16  DE 
01510  ED17  8B 
01511  ED18              ;",$,&,(,0,-,HOME,F8
01512  ED18  22                 .BYT $22,$24,$26,$28,$30,$DC,$93,$8C
01512  ED19  24 
01512  ED1A  26 
01512  ED1B  28 
01512  ED1C  30 
01512  ED1D  DC 






EDITOR.3......PAGE 0029

LINE# LOC   CODE        LINE


01512  ED1E  93 
01512  ED1F  8C 
01513  ED20  FF                 .BYT $FF        ;END OF TABLE NULL
01514  ED21              CCTTA2                 ;WAS CCTTA2 IN JAPANESE VERSION
01515  ED21              LOWER
01516  ED21  C9 0E              CMP #$0E        ;DOES HE WANT LOWER CASE?
01517  ED23  D0 0B              BNE UPPER       ;BRANCH IF NOT
01518  ED25  A9 02              LDA #2          ;ELSE SET VIC TO POINT TO LOWER CASE
01519  ED27  0D 05 90           ORA VICREG+5
01520  ED2A  8D 05 90           STA VICREG+5
01521  ED2D  4C DC E6           JMP LOOP2
01522  ED30              UPPER
01523  ED30  C9 8E              CMP #$8E        ;DOES HE WANT UPPER CASE
01524  ED32  D0 0B              BNE LOCK        ;BRANCH IF NOT
01525  ED34  A9 FD              LDA #$FD        ;MAKE SURE VIC POINT TO UPPER/PET SET
01526  ED36  2D 05 90           AND VICREG+5
01527  ED39  8D 05 90           STA VICREG+5
01528  ED3C  4C DC E6    OUTHRE JMP LOOP2
01529  ED3F              LOCK
01530  ED3F  C9 08              CMP #8          ;DOES HE WANT TO LOCK IN THIS MODE?
01531  ED41  D0 0A              BNE UNLOCK      ;BRANCH IF NOT
01532  ED43  A9 80              LDA #$80        ;ELSE SET LOCK SWITCH ON
01533  ED45  0D 91 02           ORA MODE        ;DON'T HURT ANYTHING - JUST IN CASE
01534  ED48  8D 91 02           STA MODE
01535  ED4B  30 EF              BMI OUTHRE
01536  ED4D              UNLOCK
01537  ED4D  C9 09              CMP #9          ;DOES HE WANT TO UNLOCK THE KEYBOARD?
01538  ED4F  D0 EB              BNE OUTHRE      ;BRANCH IF NOT
01539  ED51  A9 7F              LDA #$7F        ;CLEAR THE LOCK SWITCH
01540  ED53  2D 91 02           AND MODE        ;DONT HURT ANYTHING
01541  ED56  8D 91 02           STA MODE
01542  ED59  10 E1              BPL OUTHRE      ;GET OUT
01543  ED5B              PATCHX
01544  ED5B  E8                 INX             ;INDEX TO NEXT LINE
01545  ED5C  B5 D9              LDA LDTB1,X     ;GET HIGH ORDER BYTE OF ADDRESS
01546  ED5E  09 80              ORA #$80        ;MAKE IT A NON-CONTINUATION LINE
01547  ED60  95 D9              STA LDTB1,X     ;AND PUT IT BACK
01548  ED62  CA                 DEX GET  BACK  TO  CURENT  LINE
01549  ED63  A5 D5              LDA LNMX        ;CONTINUE THE BYTES I TOOK OUT
01550  ED65  18                 CLC
01551  ED66  4C 15 E7           JMP PATOUT      ;AND GO BACK TO THE CODE WE PATCHED
01552  ED69              CCTTA3
01553  ED69                     *=$ED72         ;REMAINDER OF CCTTA3 MUST START HERE
01554  ED72  04                 .BYT $04,$FF,$FF,$FF,$FF,$FF,$E2,$9D
01554  ED73  FF 
01554  ED74  FF 
01554  ED75  FF 
01554  ED76  FF 
01554  ED77  FF 
01554  ED78  E2 
01554  ED79  9D 
01555  ED7A              ;RUN-K24-K31
01556  ED7A  83                 .BYT $83,$01,$FF,$FF,$FF,$FF,$FF,$91
01556  ED7B  01 
01556  ED7C  FF 






EDITOR.3......PAGE 002A

LINE# LOC   CODE        LINE


01556  ED7D  FF 
01556  ED7E  FF 
01556  ED7F  FF 
01556  ED80  FF 
01556  ED81  91 
01557  ED82              ;K32-K39.F5
01558  ED82  A0                 .BYT $A0,$FF,$FF,$FF,$FF,$EE,$01,$89
01558  ED83  FF 
01558  ED84  FF 
01558  ED85  FF 
01558  ED86  FF 
01558  ED87  EE 
01558  ED88  01 
01558  ED89  89 
01559  ED8A              ;CO.KEY,K40-K47.F6
01560  ED8A  02                 .BYT $02,$FF,$FF,$FF,$FF,$E1,$FD,$8A
01560  ED8B  FF 
01560  ED8C  FF 
01560  ED8D  FF 
01560  ED8E  FF 
01560  ED8F  E1 
01560  ED90  FD 
01560  ED91  8A 
01561  ED92              ;K48-K55
01562  ED92  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$B0,$E0,$8B
01562  ED93  FF 
01562  ED94  FF 
01562  ED95  FF 
01562  ED96  FF 
01562  ED97  B0 
01562  ED98  E0 
01562  ED99  8B 
01563  ED9A              ;K56-K63
01564  ED9A  F2                 .BYT $F2,$F4,$F6,$FF,$F0,$ED,$93,$8C
01564  ED9B  F4 
01564  ED9C  F6 
01564  ED9D  FF 
01564  ED9E  F0 
01564  ED9F  ED 
01564  EDA0  93 
01564  EDA1  8C 
01565  EDA2  FF                 .BYT $FF        ;END OF TABLE NULL
01566  EDA3              CONTRL
01567  EDA3              ;BLACK,RED,PURPLE,BLUE,RVS ,NULL,NULL,NULL
01568  EDA3  90                 .BYT $90,$1C,$9C,$1F,$12,$FF,$FF,$FF
01568  EDA4  1C 
01568  EDA5  9C 
01568  EDA6  1F 
01568  EDA7  12 
01568  EDA8  FF 
01568  EDA9  FF 
01568  EDAA  FF 
01569  EDAB              ;NULL,NULL,REVERSE,NULL,NULL,NULL,NULL,NULL
01570  EDAB  FF                 .BYT $FF,$FF,$12,$FF,$FF,$FF,$FF,$FF
01570  EDAC  FF 






EDITOR.3......PAGE 002B

LINE# LOC   CODE        LINE


01570  EDAD  12 
01570  EDAE  FF 
01570  EDAF  FF 
01570  EDB0  FF 
01570  EDB1  FF 
01570  EDB2  FF 
01571  EDB3              ;FIVE LINES OF NULLS
01572  EDB3  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01572  EDB4  FF 
01572  EDB5  FF 
01572  EDB6  FF 
01572  EDB7  FF 
01572  EDB8  FF 
01572  EDB9  FF 
01572  EDBA  FF 
01573  EDBB  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01573  EDBC  FF 
01573  EDBD  FF 
01573  EDBE  FF 
01573  EDBF  FF 
01573  EDC0  FF 
01573  EDC1  FF 
01573  EDC2  FF 
01574  EDC3  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01574  EDC4  FF 
01574  EDC5  FF 
01574  EDC6  FF 
01574  EDC7  FF 
01574  EDC8  FF 
01574  EDC9  FF 
01574  EDCA  FF 
01575  EDCB  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01575  EDCC  FF 
01575  EDCD  FF 
01575  EDCE  FF 
01575  EDCF  FF 
01575  EDD0  FF 
01575  EDD1  FF 
01575  EDD2  FF 
01576  EDD3  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01576  EDD4  FF 
01576  EDD5  FF 
01576  EDD6  FF 
01576  EDD7  FF 
01576  EDD8  FF 
01576  EDD9  FF 
01576  EDDA  FF 
01577  EDDB              ;WHITE,CYAN,GREEN,YELLOW,RVS OFF,NULL,NULL,NULL
01578  EDDB  05                 .BYT $05,$9F,$1E,$9E,$92,$FF,$FF,$FF
01578  EDDC  9F 
01578  EDDD  1E 
01578  EDDE  9E 
01578  EDDF  92 
01578  EDE0  FF 
01578  EDE1  FF 






EDITOR.3......PAGE 002C

LINE# LOC   CODE        LINE


01578  EDE2  FF 
01579  EDE3  FF                 .BYT $FF        ;END OF TABLE NULL
01580  EDE4              TVIC
01581  EDE4  05                 .BYT $05,$19,$16,$2E,$0,$C0,$0,0
01581  EDE5  19 
01581  EDE6  16 
01581  EDE7  2E 
01581  EDE8  00 
01581  EDE9  C0 
01581  EDEA  00 
01581  EDEB  00 
01582  EDEC  00                 .BYT 0,0,0,0,0,0,0,$1B
01582  EDED  00 
01582  EDEE  00 
01582  EDEF  00 
01582  EDF0  00 
01582  EDF1  00 
01582  EDF2  00 
01582  EDF3  1B 
01583  EDF4              ;
01584  EDF4  4C 4F       RUNTB  .BYT 'LOAD',$D,'RUN',$D
01584  EDF8  0D 
01584  EDF9  52 55 4E 
01584  EDFC  0D 
01585  EDFD              ;
01586  EDFD              LINZ0  = VICSCN
01587  EDFD              LINZ1  = LINZ0+LLEN
01588  EDFD              LINZ2  = LINZ1+LLEN
01589  EDFD              LINZ3  = LINZ2+LLEN
01590  EDFD              LINZ4  = LINZ3+LLEN
01591  EDFD              LINZ5  = LINZ4+LLEN
01592  EDFD              LINZ6  = LINZ5+LLEN
01593  EDFD              LINZ7  = LINZ6+LLEN
01594  EDFD              LINZ8  = LINZ7+LLEN
01595  EDFD              LINZ9  = LINZ8+LLEN
01596  EDFD              LINZ10 = LINZ9+LLEN
01597  EDFD              LINZ11 = LINZ10+LLEN
01598  EDFD              LINZ12 = LINZ11+LLEN
01599  EDFD              LINZ13 = LINZ12+LLEN
01600  EDFD              LINZ14 = LINZ13+LLEN
01601  EDFD              LINZ15 = LINZ14+LLEN
01602  EDFD              LINZ16 = LINZ15+LLEN
01603  EDFD              LINZ17 = LINZ16+LLEN
01604  EDFD              LINZ18 = LINZ17+LLEN
01605  EDFD              LINZ19 = LINZ18+LLEN
01606  EDFD              LINZ20 = LINZ19+LLEN
01607  EDFD              LINZ21 = LINZ20+LLEN
01608  EDFD              LINZ22 = LINZ21+LLEN
01609  EDFD              ;****** SCREEN LINES LO BYTE TABLE ******
01610  EDFD              LDTB2
01611  EDFD  00                 .BYTE <LINZ0
01612  EDFE  16                 .BYTE <LINZ1
01613  EDFF  2C                 .BYTE <LINZ2
01614  EE00  42                 .BYTE <LINZ3
01615  EE01  58                 .BYTE <LINZ4






EDITOR.3......PAGE 002D

LINE# LOC   CODE        LINE


01616  EE02  6E                 .BYTE <LINZ5
01617  EE03  84                 .BYTE <LINZ6
01618  EE04  9A                 .BYTE <LINZ7
01619  EE05  B0                 .BYTE <LINZ8
01620  EE06  C6                 .BYTE <LINZ9
01621  EE07  DC                 .BYTE <LINZ10
01622  EE08  F2                 .BYTE <LINZ11
01623  EE09  08                 .BYTE <LINZ12
01624  EE0A  1E                 .BYTE <LINZ13
01625  EE0B  34                 .BYTE <LINZ14
01626  EE0C  4A                 .BYTE <LINZ15
01627  EE0D  60                 .BYTE <LINZ16
01628  EE0E  76                 .BYTE <LINZ17
01629  EE0F  8C                 .BYTE <LINZ18
01630  EE10  A2                 .BYTE <LINZ19
01631  EE11  B8                 .BYTE <LINZ20
01632  EE12  CE                 .BYTE <LINZ21
01633  EE13  E4                 .BYTE <LINZ22
01634  EE14              .END
01635  EE14              .LIB   SERIAL2.1









































SERIAL ROUTINES......PAGE 002E

LINE# LOC   CODE        LINE


01637  EE14              ;COMMAND SERIAL BUS DEVICE TO TALK
01638  EE14              ;
01639  EE14  09 40       TALK   ORA #$40        ;MAKE A TALK ADR
01640  EE16  2C                 .BYT $2C        ;SKIP TWO BYTES





01642  EE17              ;COMMAND SERIAL BUS DEVICE TO LISTEN
01643  EE17              ;
01644  EE17  09 20       LISTN  ORA #$20        ;MAKE A LISTEN ADR
01645  EE19  20 60 F1           JSR RSP232      ;PROTECT SELF FROM RS232 NMI'S
01646  EE1C  48          LIST1  PHA
01647  EE1D              ;
01648  EE1D              ;
01649  EE1D  24 94              BIT C3P0        ;CHARACTER LEFT IN BUF?
01650  EE1F  10 0A              BPL LIST2       ;NO...
01651  EE21              ;
01652  EE21              ;SEND BUFFERED CHARACTER
01653  EE21              ;
01654  EE21  38                 SEC             ;SET EOI FLAG
01655  EE22  66 A3              ROR R2D2
01656  EE24              ;
01657  EE24  20 49 EE           JSR ISOUR       ;SEND LAST CHARACTER
01658  EE27              ;
01659  EE27  46 94              LSR C3P0        ;BUFFER CLEAR FLAG
01660  EE29  46 A3              LSR R2D2        ;CLEAR EOI FLAG
01661  EE2B              ;
01662  EE2B              ;
01663  EE2B  68          LIST2  PLA             ;TALK/LISTEN ADDRESS
01664  EE2C  85 95              STA BSOUR
01665  EE2E  20 A0 E4           JSR DATAHI
01666  EE31  C9 3F              CMP #$3F        ;CLKHI ONLY ON UNLISTEN
01667  EE33  D0 03              BNE LIST5
01668  EE35  20 84 EF           JSR CLKHI
01669  EE38              ;
01670  EE38  AD 1F 91    LIST5  LDA D1ORA       ;ASSERT ATTENTION
01671  EE3B  09 80              ORA #$80
01672  EE3D  8D 1F 91           STA D1ORA
01673  EE40              ;





01675  EE40              ISOURA
01676  EE40  20 8D EF           JSR CLKLO       ;SET CLOCK LINE LOW
01677  EE43  20 A0 E4           JSR DATAHI
01678  EE46  20 96 EF           JSR W1MS        ;DELAY 1 MS











SERIAL ROUTINES......PAGE 002F

LINE# LOC   CODE        LINE


01680  EE49  78          ISOUR  SEI             ;NO IRQ'S ALLOWED
01681  EE4A  20 A0 E4           JSR DATAHI      ;MAKE SURE DATA IS RELEASED
01682  EE4D  20 B2 E4           JSR DEBPIA      ;DATA SHOULD BE LOW
01683  EE50  4A                 LSR A
01684  EE51  B0 61              BCS NODEV
01685  EE53  20 84 EF           JSR CLKHI       ;CLOCK LINE HIGH
01686  EE56  24 A3              BIT R2D2        ;EOI FLAG TEST
01687  EE58  10 0C              BPL NOEOI
01688  EE5A              ; DO THE EOI
01689  EE5A  20 B2 E4    ISR02  JSR DEBPIA      ;WAIT FOR DATA TO GO HIGH
01690  EE5D  4A                 LSR A
01691  EE5E  90 FA              BCC ISR02
01692  EE60              ;
01693  EE60  20 B2 E4    ISR03  JSR DEBPIA      ;WAIT FOR DATA TO GO LOW
01694  EE63  4A                 LSR A
01695  EE64  B0 FA              BCS ISR03
01696  EE66              ;
01697  EE66  20 B2 E4    NOEOI  JSR DEBPIA      ;WAIT FOR DATA HIGH
01698  EE69  4A                 LSR A
01699  EE6A  90 FA              BCC NOEOI
01700  EE6C  20 8D EF           JSR CLKLO       ;SET CLOCK LOW
01701  EE6F              ;
01702  EE6F              ; SET TO SEND DATA
01703  EE6F              ;
01704  EE6F  A9 08              LDA #$08        ;COUNT 8 BITS
01705  EE71  85 A5              STA COUNT
01706  EE73              ;
01707  EE73              ISR01
01708  EE73  AD 1F 91           LDA D1ORA       ;DEBOUNCE THE BUS
01709  EE76  CD 1F 91           CMP D1ORA
01710  EE79  D0 F8              BNE ISR01
01711  EE7B  4A                 LSR A
01712  EE7C  4A                 LSR A
01713  EE7D  90 38              BCC FRMERR      ;DATA MUST BE HI
01714  EE7F              ;
01715  EE7F  66 95              ROR BSOUR       ;NEXT BIT INTO CARRY
01716  EE81  B0 05              BCS ISRHI
01717  EE83  20 A9 E4           JSR DATALO
01718  EE86  D0 03              BNE ISRCLK
01719  EE88  20 A0 E4    ISRHI  JSR DATAHI
01720  EE8B  20 84 EF    ISRCLK JSR CLKHI       ;CLOCK HI
01721  EE8E  EA                 NOP
01722  EE8F  EA                 NOP
01723  EE90  EA                 NOP
01724  EE91  EA                 NOP
01725  EE92  AD 2C 91           LDA D2PCR
01726  EE95  29 DF              AND #%11011111  ;DATA HIGH
01727  EE97  09 02              ORA #$02        ;CLOCK LOW
01728  EE99  8D 2C 91           STA D2PCR
01729  EE9C  C6 A5              DEC COUNT
01730  EE9E  D0 D3              BNE ISR01
01731  EEA0  A9 04              LDA #$04        ;SET TIMER FOR 1MS
01732  EEA2  8D 29 91           STA D2T2H
01733  EEA5  AD 2D 91    ISR04  LDA D2IFR
01734  EEA8  29 20              AND #$20






SERIAL ROUTINES......PAGE 0030

LINE# LOC   CODE        LINE


01735  EEAA  D0 0B              BNE FRMERR
01736  EEAC  20 B2 E4           JSR DEBPIA
01737  EEAF  4A                 LSR A
01738  EEB0  B0 F3              BCS ISR04
01739  EEB2  58                 CLI             ;LET IRQ'S CONTINUE
01740  EEB3  60                 RTS
01741  EEB4              ;
01742  EEB4              NODEV                  ;DEVICE NOT PRESENT ERROR
01743  EEB4  A9 80              LDA #$80
01744  EEB6  2C                 .BYT $2C
01745  EEB7              FRMERR                 ;FRAMING ERROR
01746  EEB7  A9 03              LDA #$03
01747  EEB9  20 6A FE    CSBERR JSR UDST        ;COMMODORE SERIAL BUSS ERROR ENTRY
01748  EEBC  58                 CLI             ;IRQ'S WERE OFF...TURN ON
01749  EEBD  18                 CLC             ;MAKE SURE NO KERNAL ERROR RETURNED
01750  EEBE  90 49              BCC DLABYE      ;TURN ATN OFF ,RELEASE ALL LINES
01751  EEC0              ;





01753  EEC0              ;SEND SECONDARY ADDRESS AFTER LISTEN
01754  EEC0              ;
01755  EEC0  85 95       SECND  STA BSOUR       ;BUFFER CHARACTER
01756  EEC2  20 40 EE           JSR ISOURA      ;SEND IT





01758  EEC5              ;RELEASE ATTENTION AFTER LISTEN
01759  EEC5              ;
01760  EEC5  AD 1F 91    SCATN  LDA D1ORA
01761  EEC8  29 7F              AND #$7F
01762  EECA  8D 1F 91           STA D1ORA       ;RELEASE ATTENTION
01763  EECD  60                 RTS





01765  EECE              ;TALK SECOND ADDRESS
01766  EECE              ;
01767  EECE  85 95       TKSA   STA BSOUR       ;BUFFER CHARACTER
01768  EED0  20 40 EE           JSR ISOURA      ;SEND SECOND ADDR





01770  EED3              TKATN                  ;SHIFT OVER TO LISTENER
01771  EED3  78                 SEI             ;NO IRQ'S HERE
01772  EED4  20 A9 E4           JSR DATALO      ;DATA LINE LOW
01773  EED7  20 C5 EE           JSR SCATN






SERIAL ROUTINES......PAGE 0031

LINE# LOC   CODE        LINE


01774  EEDA  20 84 EF           JSR CLKHI       ;CLOCK LINE HIGH JSR/RTS
01775  EEDD  20 B2 E4    TKATN1 JSR DEBPIA      ;WAIT FOR CLOCK TO GO LOW
01776  EEE0  B0 FB              BCS TKATN1
01777  EEE2  58                 CLI             ;IRQ'S OKAY NOW
01778  EEE3  60                 RTS





01780  EEE4              ;BUFFERED OUTPUT TO SERIAL BUS
01781  EEE4              ;
01782  EEE4  24 94       CIOUT  BIT C3P0        ;BUFFERED CHAR?
01783  EEE6  30 05              BMI CI2         ;YES...SEND LAST
01784  EEE8              ;
01785  EEE8  38                 SEC             ;NO...
01786  EEE9  66 94              ROR C3P0        ;SET BUFFERED CHAR FLAG
01787  EEEB  D0 05              BNE CI4         ;BRANCH ALWAYS
01788  EEED              ;
01789  EEED  48          CI2    PHA             ;SAVE CURRENT CHAR
01790  EEEE  20 49 EE           JSR ISOUR       ;SEND LAST CHAR
01791  EEF1  68                 PLA             ;RESTORE CURRENT CHAR
01792  EEF2  85 95       CI4    STA BSOUR       ;BUFFER CURRENT CHAR
01793  EEF4  18                 CLC             ;CARRY-GOOD EXIT
01794  EEF5  60                 RTS





01796  EEF6              ;SEND UNTALK COMMAND ON SERIAL BUS
01797  EEF6              ;
01798  EEF6  20 8D EF    UNTLK  JSR CLKLO
01799  EEF9  AD 1F 91           LDA D1ORA       ;PULL ATN
01800  EEFC  09 80              ORA #$80
01801  EEFE  8D 1F 91           STA D1ORA
01802  EF01  A9 5F              LDA #$5F        ;UNTALK COMMAND
01803  EF03  2C                 .BYT $2C        ;SKIP TWO BYTES





01805  EF04              ;SEND UNLISTEN COMMAND ON SERIAL BUS
01806  EF04              ;
01807  EF04  A9 3F       UNLSN  LDA #$3F        ;UNLISTEN COMMAND
01808  EF06  20 1C EE           JSR LIST1       ;SEND IT
01809  EF09              ;
01810  EF09              ; RELEASE ALL LINES
01811  EF09  20 C5 EE    DLABYE JSR SCATN       ;ALWAYS RELEASE ATN
01812  EF0C              ; DELAY THEN RELEASE CLOCK AND DATA
01813  EF0C              ;
01814  EF0C  8A          DLADLH TXA             ;DELAY APPROX 60 US
01815  EF0D  A2 0B              LDX #11
01816  EF0F  CA          DLAD00 DEX






SERIAL ROUTINES......PAGE 0032

LINE# LOC   CODE        LINE


01817  EF10  D0 FD              BNE DLAD00
01818  EF12  AA                 TAX
01819  EF13  20 84 EF           JSR CLKHI
01820  EF16  4C A0 E4           JMP DATAHI





01822  EF19              ;INPUT A BYTE FROM SERIAL BUS
01823  EF19              ;
01824  EF19              ACPTR
01825  EF19  78                 SEI             ;NO IRQ ALLOWED
01826  EF1A  A9 00              LDA #$00        ;SET EOI/ERROR FLAG
01827  EF1C  85 A5              STA COUNT
01828  EF1E  20 84 EF           JSR CLKHI       ;MAKE SURE CLOCK LINE IS RELEASED
01829  EF21  20 B2 E4    ACP00A JSR DEBPIA      ;WAIT FOR CLOCK HIGH
01830  EF24  90 FB              BCC ACP00A
01831  EF26  20 A0 E4           JSR DATAHI      ;DATA LINE HIGH
01832  EF29              ;
01833  EF29  A9 01       EOIACP LDA #$01        ;SET TIMER 2 FOR 256US
01834  EF2B  8D 29 91           STA D2T2H
01835  EF2E  AD 2D 91    ACP00  LDA D2IFR
01836  EF31  29 20              AND #$20        ;CHECK THE TIMER
01837  EF33  D0 07              BNE ACP00B      ;RAN OUT.....
01838  EF35  20 B2 E4           JSR DEBPIA      ;CHECK THE CLOCK LINE
01839  EF38  B0 F4              BCS ACP00       ;NO NOT YET
01840  EF3A  90 18              BCC ACP01       ;YES.....
01841  EF3C              ;
01842  EF3C  A5 A5       ACP00B LDA COUNT       ;CHECK FOR ERROR (TWICE THRU TIMEOUTS)
01843  EF3E  F0 05              BEQ ACP00C
01844  EF40  A9 02              LDA #2
01845  EF42  4C B9 EE           JMP CSBERR      ; ST = 2 READ TIMEOUT
01846  EF45              ;
01847  EF45              ; TIMER RAN OUT DO AN EOI THING
01848  EF45              ;
01849  EF45  20 A9 E4    ACP00C JSR DATALO      ;DATA LINE LOW
01850  EF48  20 0C EF           JSR DLADLH      ;DELAY AND THEN SET DATAHI (ALSO CLKHI)
01851  EF4B  A9 40              LDA #$40
01852  EF4D  20 6A FE           JSR UDST        ;OR AN EOI BIT INTO STATUS
01853  EF50  E6 A5              INC COUNT       ;GO AROUND AGAIN FOR ERROR CHECK ON EOI
01854  EF52  D0 D5              BNE EOIACP
01855  EF54              ;
01856  EF54              ; DO THE BYTE TRANSFER
01857  EF54              ;
01858  EF54  A9 08       ACP01  LDA #08         ;SET UP COUNTER
01859  EF56  85 A5              STA COUNT
01860  EF58              ;
01861  EF58  AD 1F 91    ACP03  LDA D1ORA       ;WAIT FOR CLOCK HIGH
01862  EF5B  CD 1F 91           CMP D1ORA       ;DEBOUNCE
01863  EF5E  D0 F8              BNE ACP03
01864  EF60  4A                 LSR A
01865  EF61  90 F5              BCC ACP03
01866  EF63  4A                 LSR A           ;PUT DATA BIT INTO CARRY
01867  EF64  66 A4              ROR BSOUR1      ;ROTATE DATA IN






SERIAL ROUTINES......PAGE 0033

LINE# LOC   CODE        LINE


01868  EF66              ;
01869  EF66  AD 1F 91    ACP03A LDA D1ORA       ;WAIT FOR CLOCK LOW
01870  EF69  CD 1F 91           CMP D1ORA       ;DEBOUNCE
01871  EF6C  D0 F8              BNE ACP03A
01872  EF6E  4A                 LSR A
01873  EF6F  B0 F5              BCS ACP03A
01874  EF71  C6 A5              DEC COUNT
01875  EF73  D0 E3              BNE ACP03       ;MORE BITS.....
01876  EF75              ;...EXIT...
01877  EF75  20 A9 E4           JSR DATALO      ;DATA LOW
01878  EF78  A5 90              LDA STATUS      ;CHECK FOR EOI
01879  EF7A  F0 03              BEQ ACP04       ;NONE...
01880  EF7C              ;
01881  EF7C  20 0C EF           JSR DLADLH      ;DELAY THEN SET DATA HIGH
01882  EF7F              ;
01883  EF7F  A5 A4       ACP04  LDA BSOUR1
01884  EF81  58                 CLI             ;IRQ IS OK
01885  EF82  18                 CLC             ;GOOD EXIT
01886  EF83  60                 RTS
01887  EF84              ;
01888  EF84              CLKHI                  ;SET CLOCK LINE HIGH (INVERTED)
01889  EF84  AD 2C 91           LDA D2PCR
01890  EF87  29 FD              AND #%11111101
01891  EF89  8D 2C 91           STA D2PCR
01892  EF8C  60                 RTS
01893  EF8D              ;
01894  EF8D              CLKLO                  ;SET CLOCK LINE LOW  (INVERTED)
01895  EF8D  AD 2C 91           LDA D2PCR
01896  EF90  09 02              ORA #$02
01897  EF92  8D 2C 91           STA D2PCR
01898  EF95  60                 RTS
01899  EF96              AROUND =*
01900  EF96              ;
01901  EF96              ; MOVED BECAUSE OF NEEDED PATCH SPACE
01902  EF96              ;
01903  EF96                     *=$E4A0         ;PATCH AREA
01904  E4A0              DATAHI                 ;SET DATA LINE HIGH (INVERTED)
01905  E4A0  AD 2C 91           LDA D2PCR
01906  E4A3  29 DF              AND #%11011111
01907  E4A5  8D 2C 91           STA D2PCR
01908  E4A8  60                 RTS
01909  E4A9              ;
01910  E4A9              DATALO                 ;SET DATA LINE LOW  (INVERTED)
01911  E4A9  AD 2C 91           LDA D2PCR
01912  E4AC  09 20              ORA #$20
01913  E4AE  8D 2C 91           STA D2PCR
01914  E4B1  60                 RTS
01915  E4B2              ;
01916  E4B2  AD 1F 91    DEBPIA LDA D1ORA       ;DEBPUNCE THE PIA
01917  E4B5  CD 1F 91           CMP D1ORA
01918  E4B8  D0 F8              BNE DEBPIA
01919  E4BA  4A                 LSR A           ;SHIFT THE CLOCK BIT INTO THE CARRY
01920  E4BB  60                 RTS
01921  E4BC              KSP2   =*              ;KERNAL SPACE FOR PATCH 2
01922  E4BC                     *=AROUND






SERIAL ROUTINES......PAGE 0034

LINE# LOC   CODE        LINE


01923  EF96              W1MS                   ;DELAY 1MS USING TIMER 2
01924  EF96  A9 04              LDA #$04
01925  EF98  8D 29 91           STA D2T2H
01926  EF9B              W1MS1                  ;TIMER WAIT LOOP
01927  EF9B  AD 2D 91           LDA D2IFR
01928  EF9E  29 20              AND #$20
01929  EFA0  F0 F9              BEQ W1MS1
01930  EFA2  60                 RTS
01931  EFA3              .END
01932  EFA3              .LIB   RS232TRANS



















































RS-232 TRANSMITT......PAGE 0035

LINE# LOC   CODE        LINE


01934  EFA3              ; RSTRAB - ENTRY FOR NMI CONTINUE ROUTINE
01935  EFA3              ; RSTBGN - ENTRY FOR START TRANSMITTER
01936  EFA3              ;
01937  EFA3              ;   RSR - 8/18/80
01938  EFA3              ;
01939  EFA3              ; VARIABLES USED
01940  EFA3              ;   BITTS - # OF BITS TO BE SENT (<>0 NOT DONE)
01941  EFA3              ;   NXTBIT - BYTE CONTAINS NEXT BIT TO BE SENT
01942  EFA3              ;   ROPRTY - BYTE CONTAINS PARITY BIT CALCULATED
01943  EFA3              ;   RODATA - STORES DATA BYTE CURRENTLY BEING TRANSMITTED
01944  EFA3              ;   RODBS - OUTPUT BUFFER INDEX START
01945  EFA3              ;   RODBE - OUTPUT BUFFER INDEX END
01946  EFA3              ;   IF RODBS=RODBE THEN BUFFER EMPTY
01947  EFA3              ;   ROBUF - INDIRECT POINTER TO DATA BUFFER
01948  EFA3              ;   RSSTAT - RS-232 STATUS BYTE
01949  EFA3              ;
01950  EFA3              ;   XXX US - NORMAL BIT PATH
01951  EFA3              ;   XXX US - WORST CASE PARITY BIT PATH
01952  EFA3              ;   XXX US - STOP BIT PATH
01953  EFA3              ;   XXX US - START BIT PATH
01954  EFA3              ;
01955  EFA3  A5 B4       RSTRAB LDA BITTS       ;CHECK FOR PLACE IN BYTE...
01956  EFA5  F0 47              BEQ RSTBGN      ;...DONE, =0 START NEXT
01957  EFA7              ;
01958  EFA7  30 3F              BMI RST050      ;...DOING STOP BITS
01959  EFA9              ;
01960  EFA9  46 B6              LSR RODATA      ;SHIFT DATA INTO CARRY
01961  EFAB  A2 00              LDX #00         ;PREPARE FOR A ZERO
01962  EFAD  90 01              BCC RST005      ;YES...A ZERO
01963  EFAF  CA                 DEX             ;NO...MAKE AN $FF
01964  EFB0  8A          RST005 TXA             ;READY TO SEND
01965  EFB1              ;
01966  EFB1  45 BD              EOR ROPRTY      ;CALC INTO PARITY
01967  EFB3  85 BD              STA ROPRTY
01968  EFB5              ;
01969  EFB5  C6 B4              DEC BITTS       ;BIT COUNT DOWN
01970  EFB7  F0 06              BEQ RST010      ;WANT A PARITY INSTEAD
01971  EFB9              ;
01972  EFB9  8A          RSTEXT TXA             ;CALC BIT WHOLE TO SEND
01973  EFBA  29 20              AND #$20        ;GOES OUT CB2
01974  EFBC  85 B5              STA NXTBIT
01975  EFBE  60                 RTS



















RS-232 TRANSMITT......PAGE 0036

LINE# LOC   CODE        LINE


01977  EFBF              ; CALCULATE PARITY
01978  EFBF              ;  NXTBIT =0 UPON ENTRY
01979  EFBF              ;
01980  EFBF  A9 20       RST010 LDA #$20        ;CHECK 6551 REG BITS
01981  EFC1  2C 94 02           BIT M51CDR
01982  EFC4  F0 14              BEQ RSPNO       ;...NO PARITY, SEND A STOP
01983  EFC6  30 1C              BMI RST040      ;...NOT REAL PARITY
01984  EFC8  70 14              BVS RST030      ;...EVEN PARITY
01985  EFCA              ;
01986  EFCA  A5 BD              LDA ROPRTY      ;CALC ODD PARITY
01987  EFCC  D0 01              BNE RSPEXT      ;CORRECT GUESS
01988  EFCE              ;
01989  EFCE  CA          RSWEXT DEX             ;WRONG GUESS...ITS A ONE
01990  EFCF              ;
01991  EFCF  C6 B4       RSPEXT DEC BITTS       ;ONE STOP BIT ALWAYS
01992  EFD1  AD 93 02           LDA M51CTR      ;CHECK # OF STOP BITS
01993  EFD4  10 E3              BPL RSTEXT      ;...ONE
01994  EFD6  C6 B4              DEC BITTS       ;...TWO
01995  EFD8  D0 DF              BNE RSTEXT      ;JUMP
01996  EFDA              ;
01997  EFDA              RSPNO                  ;LINE TO SEND CANNOT BE PB0
01998  EFDA  E6 B4              INC BITTS       ;COUNTS AS ONE STOP BIT
01999  EFDC  D0 F0              BNE RSWEXT      ;JUMP TO FLIP TO ONE
02000  EFDE              ;
02001  EFDE  A5 BD       RST030 LDA ROPRTY      ;EVEN PARITY
02002  EFE0  F0 ED              BEQ RSPEXT      ;CORRECT GUESS...EXIT
02003  EFE2  D0 EA              BNE RSWEXT      ;WRONG...FLIP AND EXIT
02004  EFE4              ;
02005  EFE4  70 E9       RST040 BVS RSPEXT      ;WANTED SPACE
02006  EFE6  50 E6              BVC RSWEXT      ; WANTED MARK



02008  EFE8              ; STOP BITS
02009  EFE8              ;
02010  EFE8  E6 B4       RST050 INC BITTS       ;STOP BIT COUNT TOWARDS ZERO
02011  EFEA  A2 FF              LDX #$FF        ;SEND STOP BIT
02012  EFEC  D0 CB              BNE RSTEXT      ;JUMP TO EXIT























RS-232 TRANSMITT......PAGE 0037

LINE# LOC   CODE        LINE


02014  EFEE              ; RSTBGN - ENTRY TO START BYTE TRANS
02015  EFEE              ;
02016  EFEE  AD 94 02    RSTBGN LDA M51CDR      ;CHECK FOR 3/X LINE
02017  EFF1  4A                 LSR A
02018  EFF2  90 07              BCC RST060      ;3 LINE...NO CHECK
02019  EFF4  2C 20 91           BIT D2ORB       ;CHECK FOR...
02020  EFF7  10 1D              BPL DSRERR      ;...DSR ERROR
02021  EFF9  50 1E              BVC CTSERR      ;...CTS ERROR
02022  EFFB              ;
02023  EFFB              ; SET UP TO SEND NEXT BYTE
02024  EFFB              ;
02025  EFFB  A9 00       RST060 LDA #0
02026  EFFD  85 BD              STA ROPRTY      ;ZERO PARITY
02027  EFFF  85 B5              STA NXTBIT      ;SEND START BIT
02028  F001  AE 98 02           LDX BITNUM      ;GET # OF BITS
02029  F004  86 B4       RST070 STX BITTS       ;BITTS=#OF BITTS+1
02030  F006              ;
02031  F006  AC 9D 02    RST080 LDY RODBS       ;CHECK BUFFER POINTERS
02032  F009  CC 9E 02           CPY RODBE
02033  F00C  F0 13              BEQ RSODNE      ;ALL DONE...
02034  F00E              ;
02035  F00E  B1 F9              LDA (ROBUF)Y    ;GET DATA...
02036  F010  85 B6              STA RODATA      ;...INTO BYTE BUFFER
02037  F012  EE 9D 02           INC RODBS       ;MOVE POINTER TO NEXT
02038  F015  60                 RTS



02040  F016              ; SET ERRORS
02041  F016              ;
02042  F016  A9 40       DSRERR LDA #$40        ;DSR GONE ERROR
02043  F018  2C                 .BYT $2C
02044  F019  A9 10       CTSERR LDA #$10        ;CTS GONE ERROR
02045  F01B  0D 97 02           ORA RSSTAT
02046  F01E  8D 97 02           STA RSSTAT
02047  F021              ;
02048  F021              ; ERRORS TURN OFF T1
02049  F021              ;
02050  F021  A9 40       RSODNE LDA #$40        ;KILL T1 NMI
02051  F023  8D 1E 91           STA D1IER
02052  F026  60                 RTS



02054  F027              ; BITCNT - CAL # OF BITS TO BE SENT
02055  F027              ;   RETURNS #OF BITS+1
02056  F027              ;
02057  F027  A2 09       BITCNT LDX #9          ;CALC WORD LENGTH
02058  F029  A9 20              LDA #$20
02059  F02B  2C 93 02           BIT M51CTR
02060  F02E  F0 01              BEQ BIT010
02061  F030  CA                 DEX             ;BIT 5 HIGH IS A 7 OR 5
02062  F031  50 02       BIT010 BVC BIT020
02063  F033  CA                 DEX             ;BIT 6 HIGH IS A 6 OR 5
02064  F034  CA                 DEX






RS-232 TRANSMITT......PAGE 0038

LINE# LOC   CODE        LINE


02065  F035  60          BIT020 RTS
02066  F036              .END
02067  F036              .LIB   RS232RCVR


























































RS-232 RECEIVER......PAGE 0039

LINE# LOC   CODE        LINE


02069  F036              ; RSRCVR - NMI ROUTINE TO COLLECT
02070  F036              ;  DATA INTO BYTES
02071  F036              ;
02072  F036              ; RSR 8/18/80
02073  F036              ;
02074  F036              ; VARIABLES USED
02075  F036              ;   INBIT - INPUT BIT VALUE
02076  F036              ;   BITCI - BIT COUNT IN
02077  F036              ;   RINONE - FLAG FOR START BIT CHECK <>0 START BIT
02078  F036              ;   RIDATA - BYTE INPUT BUFFER
02079  F036              ;   RIPRTY - HOLDS BYTE INPUT PARITY
02080  F036              ;   RIBUF - INDIRECT POINTER TO DATA BUFFER
02081  F036              ;   RIDBE - INPUT BUFFER INDEX TO END
02082  F036              ;   RIDBS - INPUT BUFFER POINTER TO START
02083  F036              ;   IF RIDBE=RIDBS THEN INPUT BUFFER EMPTY
02084  F036              ;
02085  F036  A6 A9       RSRCVR LDX RINONE      ;CHECK FOR START BIT
02086  F038  D0 2E              BNE RSRTRT      ;WAS START BIT
02087  F03A              ;
02088  F03A  C6 A8              DEC BITCI       ;CHECK WHERE WE ARE IN INPUT...
02089  F03C  F0 31              BEQ RSR030      ;HAVE A FULL BYTE
02090  F03E  30 0D              BMI RSR020      ;GETTING STOP BITS
02091  F040              ;
02092  F040              ; CALC PARITY
02093  F040              ;
02094  F040  A5 A7              LDA INBIT       ;GET DATA UP
02095  F042  45 AB              EOR RIPRTY      ;CALC NEW PARITY
02096  F044  85 AB              STA RIPRTY
02097  F046              ;
02098  F046              ; SHIFT DATA BIT IN
02099  F046              ;
02100  F046  46 A7              LSR INBIT       ;IN BIT POS 0
02101  F048  66 AA              ROR RIDATA      ;C INTO DATA
02102  F04A              ;
02103  F04A              ; EXIT
02104  F04A              ;
02105  F04A  60          RSREXT RTS
























RS-232 RECEIVER......PAGE 003A

LINE# LOC   CODE        LINE


02107  F04B              ; HAVE STOP BIT, SO STORE IN BUFFER
02108  F04B              ;
02109  F04B  C6 A8       RSR018 DEC BITCI       ;NO PARITY, DEC SO CHECK WORKS
02110  F04D  A5 A7       RSR020 LDA INBIT       ;GET DATA...
02111  F04F  F0 62              BEQ RSR060      ;...ZERO, AN ERROR?
02112  F051              ;
02113  F051  AD 93 02           LDA M51CTR      ;CHECK FOR CORRECT # OF STOP BITS
02114  F054  0A                 ASL A           ;CARRY TELL HOW MAY STOP BITS
02115  F055  A9 01              LDA #01
02116  F057  65 A8              ADC BITCI
02117  F059  D0 EF              BNE RSREXT      ;NO..EXIT
02118  F05B              ;
02119  F05B              ; RSRABL - ENABLE TO RECIEVE A BYTE
02120  F05B              ;
02121  F05B  A9 90       RSRABL LDA #$90        ;ENABLE CB1 FOR NEXT BYTE
02122  F05D  8D 1E 91           STA D1IER
02123  F060  85 A9              STA RINONE      ;FLAG FOR START BIT
02124  F062              ;
02125  F062  A9 20       RSRSXT LDA #$20        ;DISABLE T2
02126  F064  8D 1E 91           STA D1IER
02127  F067  60                 RTS


02129  F068              ; RECIEVER START BIT CHECK
02130  F068              ;
02131  F068  A5 A7       RSRTRT LDA INBIT       ;CHECK IF SPACE
02132  F06A  D0 EF              BNE RSRABL      ;BAD...TRY AGAIN
02133  F06C  85 A9              STA RINONE      ;GOOD...DISABLE FLAG
02134  F06E  60                 RTS             ;AND EXIT




02136  F06F              ;
02137  F06F              ; PUT DATA IN BUFFER (AT PARITY TIME)
02138  F06F              ;
02139  F06F  AC 9B 02    RSR030 LDY RIDBE       ;GET END
02140  F072  C8                 INY
02141  F073  CC 9C 02           CPY RIDBS       ;HAVE WE PASSED START?
02142  F076  F0 2A              BEQ RECERR      ;YES...ERROR
02143  F078              ;
02144  F078  8C 9B 02           STY RIDBE       ;MOVE RIDBE FOWARD
02145  F07B  88                 DEY
02146  F07C              ;
02147  F07C  A5 AA              LDA RIDATA      ;GET BYTE BUFFER UP
02148  F07E  AE 98 02           LDX BITNUM      ;SHIFT UNTILL FULL BYTE
02149  F081  E0 09       RSR031 CPX #9          ;ALWAYS 8 BITS
02150  F083  F0 04              BEQ RSR032
02151  F085  4A                 LSR A           ;FILL WITH ZEROS
02152  F086  E8                 INX
02153  F087  D0 F8              BNE RSR031
02154  F089              ;
02155  F089  91 F7       RSR032 STA (RIBUF)Y    ;DATA TO PAGE BUFFER
02156  F08B              ;
02157  F08B              ; PARITY CHECKING






RS-232 RECEIVER......PAGE 003B

LINE# LOC   CODE        LINE


02158  F08B              ;
02159  F08B  A9 20              LDA #$20        ;CHECK 6551 COMMAND REGISTER
02160  F08D  2C 94 02           BIT M51CDR
02161  F090  F0 B9              BEQ RSR018      ;NO PARITY BIT SO STOP BIT
02162  F092  30 B6              BMI RSREXT      ;NO PARITY CHECK
02163  F094              ;
02164  F094              ; CHECK CALC PARITY
02165  F094              ;
02166  F094  A5 A7              LDA INBIT
02167  F096  45 AB              EOR RIPRTY      ;PUT IN WITH PARITY
02168  F098  F0 03              BEQ RSR050      ;EVEN PARITY
02169  F09A  70 AE              BVS RSREXT      ;ODD...OKAY SO EXIT
02170  F09C  2C                 .BYT $2C        ;SKIP TWO
02171  F09D  50 AB       RSR050 BVC RSREXT      ;EVEN...OKAY SO EXIT
02172  F09F              ;
02173  F09F              ; ERRORS REPORTED
02174  F09F  A9 01              LDA #1          ;PARITY ERROR
02175  F0A1  2C                 .BYT $2C
02176  F0A2  A9 04       RECERR LDA #$4         ;RECIEVER OVERRUN
02177  F0A4  2C                 .BYT $2C
02178  F0A5  A9 80       BREAKE LDA #$80        ;BREAK DETECTED
02179  F0A7  2C                 .BYT $2C
02180  F0A8  A9 02       FRAMEE LDA #$02        ;FRAME ERROR
02181  F0AA  0D 97 02    ERR232 ORA RSSTAT
02182  F0AD  8D 97 02           STA RSSTAT
02183  F0B0  4C 5B F0           JMP RSRABL      ;BAD EXIT SO HANG ##????????##
02184  F0B3              ;
02185  F0B3              ; CHECK FOR ERRORS
02186  F0B3              ;
02187  F0B3  A5 AA       RSR060 LDA RIDATA      ;EXPECTING STOP...
02188  F0B5  D0 F1              BNE FRAMEE      ;FRAME ERROR
02189  F0B7  F0 EC              BEQ BREAKE      ;COULD BE A BREAK
02190  F0B9              ;
02191  F0B9              ; RS232 LOAD AND SAVE
02192  F0B9              ;
02193  F0B9  4C 96 F7    RS232  JMP ERROR9      ;BAD DEVICE NUMBER
02194  F0BC              .END
02195  F0BC              .LIB   RS232INOUT























RS232 INOUT......PAGE 003C

LINE# LOC   CODE        LINE


02197  F0BC              ; OUTPUT A FILE OVER USR PORT
02198  F0BC              ;  USING RS232
02199  F0BC              ;
02200  F0BC  85 9A       CKO232 STA DFLTO       ;SET DEFAULT OUT ###TEMP CODE###
02201  F0BE  AD 94 02           LDA M51CDR      ;CHECK FOR 3/X LINE
02202  F0C1  4A                 LSR A
02203  F0C2  90 27              BCC CKO100      ;3LINE...NO TURN AROUND
02204  F0C4              ;
02205  F0C4              ;*TURN AROUND LOGIC
02206  F0C4              ;
02207  F0C4              ; CHECK FOR DSR AND RTS
02208  F0C4              ;
02209  F0C4  A9 02              LDA #$02        ;BIT RTS IS ON
02210  F0C6  2C 10 91           BIT D1ORB
02211  F0C9  10 1D              BPL CKDSRX      ;NO DSR...ERROR
02212  F0CB  D0 1E              BNE CKO100      ;RTS...OUTPUTING OR FULL DUPLEX
02213  F0CD              ;
02214  F0CD              ; CHECK FOR ACTIVE INPUT
02215  F0CD              ;  RTS WILL BE LOW IF CURRENTLY INPUTING
02216  F0CD              ;
02217  F0CD  AD 1E 91    CKO020 LDA D1IER
02218  F0D0  29 30              AND #$30        ;LOOK AT IER FOR T2 OR CB1
02219  F0D2  D0 F9              BNE CKO020      ;HANG UNTILL INPUT DONE
02220  F0D4              ;
02221  F0D4              ; WAIT FOR CTS TO BE OFF AS SPEC REQS
02222  F0D4              ;
02223  F0D4  2C 10 91    CKO030 BIT D1ORB
02224  F0D7  70 FB              BVS CKO030
02225  F0D9              ;
02226  F0D9              ; TURN ON RTS
02227  F0D9              ;
02228  F0D9  AD 10 91           LDA D1ORB
02229  F0DC  09 02              ORA #$02
02230  F0DE  8D 10 91           STA D1ORB
02231  F0E1              ;
02232  F0E1              ; WAIT FOR CTS TO GO ON
02233  F0E1              ;
02234  F0E1  2C 10 91    CKO040 BIT D1ORB
02235  F0E4  70 05              BVS CKO100      ;DONE...
02236  F0E6  30 F9              BMI CKO040      ;WE STILL HAVE DSR
02237  F0E8              ;
02238  F0E8  20 16 F0    CKDSRX JSR DSRERR      ;A DATA SET READY ERROR
02239  F0EB              ;
02240  F0EB  18          CKO100 CLC             ;NO ERROR
02241  F0EC  60                 RTS
















RS232 INOUT......PAGE 003D

LINE# LOC   CODE        LINE


02243  F0ED              ; BSO232 - OUTPUT A CHAR RS232
02244  F0ED              ;
02245  F0ED              ; BUFFER HANDLER
02246  F0ED              ;
02247  F0ED  AC 9E 02    BSO232 LDY RODBE
02248  F0F0  C8                 INY
02249  F0F1  CC 9D 02           CPY RODBS       ;CHECK FOR BUFFER FULL
02250  F0F4  F0 F7              BEQ BSO232      ;HANG IF SO...(MAY NEED TIMEOUT?)
02251  F0F6  8C 9E 02           STY RODBE       ;INDICATE NEW START
02252  F0F9  88                 DEY
02253  F0FA  91 F9              STA (ROBUF)Y    ;STORE DATA
02254  F0FC              ;
02255  F0FC              ; SET UP IF NECESSARY TO OUTPUT
02256  F0FC              ;
02257  F0FC  2C 1E 91    BSO100 BIT D1IER       ;CHECK FOR A T1 NMI ENABLE
02258  F0FF  50 01              BVC BSO110      ;NONE SO SET UP TIMER
02259  F101  60                 RTS             ;ELSE RETURN
02260  F102              ;
02261  F102              ; SET UP FOR A FIRST BYTE OUT
02262  F102              ;
02263  F102  AD 99 02    BSO110 LDA BAUDOF      ;SET UP TIMER1
02264  F105  8D 14 91           STA D1T1L
02265  F108  AD 9A 02           LDA BAUDOF+1
02266  F10B  8D 15 91           STA D1T1H
02267  F10E              ;
02268  F10E              ; SET UP T1 NMI'S
02269  F10E              ;
02270  F10E  A9 C0              LDA #$C0
02271  F110  8D 1E 91           STA D1IER
02272  F113              ;
02273  F113  4C EE EF           JMP RSTBGN      ;BEGIN TRANSFER






























RS232 INOUT......PAGE 003E

LINE# LOC   CODE        LINE


02275  F116              ; INPUT A FILE OVER USER PORT
02276  F116              ;  USING RS232
02277  F116              ;
02278  F116  85 99       CKI232 STA DFLTN       ;SET DEFAULT INPUT
02279  F118              ;
02280  F118  AD 94 02           LDA M51CDR      ;CHECK FOR 3/X LINE
02281  F11B  4A                 LSR A
02282  F11C  90 28              BCC CKI100      ;3 LINE...NO HANDSHAKE
02283  F11E              ;
02284  F11E  29 08              AND #$08        ;FULL/HALF CHECK (BYTE SHIFTED ABOVE)
02285  F120  F0 24              BEQ CKI100      ;FULL...NO HANDSHAKE
02286  F122              ;
02287  F122              ;*TURN AROUND LOGIC
02288  F122              ;
02289  F122              ; CHECK IF DSR AND NOT RTS
02290  F122              ;
02291  F122  A9 02              LDA #$02        ;BIT RTS IS ON
02292  F124  2C 10 91           BIT D1ORB
02293  F127  10 BF              BPL CKDSRX      ;NO DSR...ERROR
02294  F129  F0 19              BEQ CKI090      ;RTS LOW...IN CORRECT MODE
02295  F12B              ;
02296  F12B              ; WAIT FOR ACTIVE OUTPUT TO BE DONE
02297  F12B              ;
02298  F12B  2C 1E 91    CKI010 BIT D1IER
02299  F12E  70 FB              BVS CKI010
02300  F130              ;
02301  F130              ; TURN OFF RTS
02302  F130              ;
02303  F130  AD 10 91           LDA D1ORB
02304  F133  29 FD              AND #$FF-02
02305  F135  8D 10 91           STA D1ORB
02306  F138              ;
02307  F138              ; WAIT FOR DCD TO GO HIGH (IN SPEC)
02308  F138              ;
02309  F138  AD 10 91    CKI020 LDA D1ORB
02310  F13B  29 04              AND #$04
02311  F13D  F0 F9              BEQ CKI020
02312  F13F              ;
02313  F13F              ; ENABLE CB1 FOR RS232 INPUT
02314  F13F              ;
02315  F13F  A9 90       CKI080 LDA #$90
02316  F141  8D 1E 91           STA D1IER
02317  F144  18          CKI090 CLC             ;NO ERROR
02318  F145  60                 RTS
02319  F146              ;
02320  F146              ; IF NOT 3 LINE HALF THEN...
02321  F146              ;  SEE IF WE NEED TO TURN ON CB1
02322  F146              ;
02323  F146  AD 1E 91    CKI100 LDA D1IER       ;CHECK FOR CB1 OR T2 ACTIVE
02324  F149  29 30              AND #$30
02325  F14B  F0 F2              BEQ CKI080      ;NO NEED TO TURN ON
02326  F14D  18                 CLC             ;NO ERROR
02327  F14E  60                 RTS








RS232 INOUT......PAGE 003F

LINE# LOC   CODE        LINE


02329  F14F              ; BSI232 - INPUT A CHAR RS232
02330  F14F              ;
02331  F14F              ; BUFFER HANDLER
02332  F14F              ;
02333  F14F  AC 9C 02    BSI232 LDY RIDBS       ;GET LAST BYTE ADDRESS
02334  F152  CC 9B 02           CPY RIDBE       ;SEE IF BUFFER EMPTY
02335  F155  F0 06              BEQ BSI010      ;RETURN A NULL IF NO CHAR
02336  F157              ;
02337  F157  B1 F7              LDA (RIBUF)Y    ;GET LAST CHAR
02338  F159  EE 9C 02           INC RIDBS       ;INC TO NEXT POS
02339  F15C              ;
02340  F15C              ; RECEIVER ALWAYS RUNS
02341  F15C              ;
02342  F15C  60                 RTS
02343  F15D  A9 00       BSI010 LDA #$0         ;RETURN A NULL
02344  F15F  60                 RTS




02346  F160              ; RSP232 - PROTECT SERIAL/CASS FROM RS232 NMI'S
02347  F160              ;
02348  F160  48          RSP232 PHA             ;SAVE .A
02349  F161  AD 1E 91           LDA D1IER       ;DOES RS232 HAVE ANY ENABLES?
02350  F164  F0 0C              BEQ RSPOK       ;NO...
02351  F166  AD 1E 91    RSPOFF LDA D1IER       ;WAIT UNTILL DONE
02352  F169  29 60              AND #%01100000  ; WITH T1 & T2
02353  F16B  D0 F9              BNE RSPOFF
02354  F16D  A9 10              LDA #%00010000  ; DISABLE CB1 (NEED TO RENABLE IN USER CODE)
02355  F16F  8D 1E 91           STA D1IER
02356  F172  68          RSPOK  PLA             ;ALL DONE
02357  F173  60                 RTS
02358  F174              .END
02359  F174              .LIB   MESSAGES



























MESSAGES......PAGE 0040

LINE# LOC   CODE        LINE


02361  F174  0D          MS1    .BYT $D,'I/O ERROR ',$A3
02361  F175  49 2F 
02361  F17F  A3 
02362  F180  0D          MS5    .BYT $D,'SEARCHING',$A0
02362  F181  53 45 
02362  F18A  A0 
02363  F18B  46 4F 52    MS6    .BYT 'FOR',$A0
02363  F18E  A0 
02364  F18F  0D          MS7    .BYT $D,'PRESS PLAY ON TAP',$C5
02364  F190  50 52 
02364  F1A1  C5 
02365  F1A2  50 52       MS8    .BYT 'PRESS RECORD & PLAY ON TAP',$C5
02365  F1BC  C5 
02366  F1BD  0D          MS10   .BYT $D,'LOADIN',$C7
02366  F1BE  4C 4F 
02366  F1C4  C7 
02367  F1C5  0D          MS11   .BYT $D,'SAVING',$A0
02367  F1C6  53 41 
02367  F1CC  A0 
02368  F1CD  0D          MS21   .BYT $D,'VERIFYIN',$C7
02368  F1CE  56 45 
02368  F1D6  C7 
02369  F1D7  0D          MS17   .BYT $D,'FOUND',$A0
02369  F1D8  46 4F 
02369  F1DD  A0 
02370  F1DE  0D          MS18   .BYT $D,'OK',$8D
02370  F1DF  4F 4B 
02370  F1E1  8D 
02371  F1E2              ; MS34 .BYT $D,'MONITOR',$8D
02372  F1E2              ; MS36 .BYT $D,'BREA',$CB





02374  F1E2              ;PRINT MESSAGE TO SCREEN ONLY IF
02375  F1E2              ;OUTPUT ENABLED
02376  F1E2              ;
02377  F1E2  24 9D       SPMSG  BIT MSGFLG      ;PRINTING MESSAGES?
02378  F1E4  10 0D              BPL MSG10       ;NO...
02379  F1E6  B9 74 F1    MSG    LDA MS1,Y
02380  F1E9  08                 PHP
02381  F1EA  29 7F              AND #$7F
02382  F1EC  20 D2 FF           JSR BSOUT
02383  F1EF  C8                 INY
02384  F1F0  28                 PLP
02385  F1F1  10 F3              BPL MSG
02386  F1F3  18          MSG10  CLC
02387  F1F4  60                 RTS
02388  F1F5              .END
02389  F1F5              .LIB   CHANNELIO










CHANNEL I/O......PAGE 0041

LINE# LOC   CODE        LINE


02391  F1F5              ;***************************************
02392  F1F5              ;* GETIN -- GET CHARACTER FROM CHANNEL *
02393  F1F5              ;*      CHANNEL IS DETERMINED BY DFLTN.*
02394  F1F5              ;* IF DEVICE IS 0, KEYBOARD QUEUE IS   *
02395  F1F5              ;* EXAMINED AND A CHARACTER REMOVED IF *
02396  F1F5              ;* AVAILABLE.  IF QUEUE IS EMPTY, Z    *
02397  F1F5              ;* FLAG IS RETURNED SET.  DEVICES 1-31 *
02398  F1F5              ;* ADVANCE TO BASIN.                   *
02399  F1F5              ;***************************************
02400  F1F5              ;
02401  F1F5  A5 99       NGETIN LDA DFLTN       ;CHECK DEVICE
02402  F1F7  D0 08              BNE GN10        ;NOT KEYBOARD
02403  F1F9              ;
02404  F1F9  A5 C6              LDA NDX         ;QUEUE INDEX
02405  F1FB  F0 6D              BEQ BN31        ;NOBODY THERE...EXIT
02406  F1FD              ;
02407  F1FD  78                 SEI
02408  F1FE  4C CF E5           JMP LP2         ;GO REMOVE A CHARACTER
02409  F201              ;
02410  F201  C9 02       GN10   CMP #2          ;IS IT RS-232
02411  F203  D0 18              BNE BN10        ;NO...USE BASIN
02412  F205              ;
02413  F205  84 97       GN232  STY XSAV        ;SAVE .Y, USED IN RS232
02414  F207  20 4F F1           JSR BSI232
02415  F20A  A4 97              LDY XSAV        ;RESTORE .Y
02416  F20C  18                 CLC             ;GOOD RETURN
02417  F20D  60                 RTS



02419  F20E              ;***************************************
02420  F20E              ;* BASIN-- INPUT CHARACTER FROM CHANNEL*
02421  F20E              ;*     INPUT DIFFERS FROM GET ON DEVICE*
02422  F20E              ;* #0 FUNCTION WHICH IS KEYBOARD. THE  *
02423  F20E              ;* SCREEN EDITOR MAKES READY AN ENTIRE *
02424  F20E              ;* LINE WHICH IS PASSED CHAR BY CHAR   *
02425  F20E              ;* UP TO THE CARRIAGE RETURN.  OTHER   *
02426  F20E              ;* DEVICES ARE:                        *
02427  F20E              ;*      0 -- KEYBOARD                  *
02428  F20E              ;*      1 -- CASSETTE #1               *
02429  F20E              ;*      2 -- RS232                     *
02430  F20E              ;*      3 -- SCREEN                    *
02431  F20E              ;*   4-31 -- SERIAL BUS                *
02432  F20E              ;***************************************
02433  F20E              ;
02434  F20E  A5 99       NBASIN LDA DFLTN       ;CHECK DEVICE
02435  F210  D0 0B              BNE BN10        ;IS NOT KEYBOARD...
02436  F212              ;
02437  F212              ;INPUT FROM KEYBOARD
02438  F212              ;
02439  F212  A5 D3              LDA PNTR        ;SAVE CURRENT...
02440  F214  85 CA              STA LSTP        ;... CURSOR COLUMN
02441  F216  A5 D6              LDA TBLX        ;SAVE CURRENT...
02442  F218  85 C9              STA LSXP        ;... LINE NUMBER
02443  F21A  4C 4F E6           JMP LOOP5       ;BLINK CURSOR UNTIL RETURN






CHANNEL I/O......PAGE 0042

LINE# LOC   CODE        LINE


02444  F21D              ;
02445  F21D  C9 03       BN10   CMP #3          ;IS INPUT FROM SCREEN?
02446  F21F  D0 09              BNE BN20        ;NO...
02447  F221              ;
02448  F221  85 D0              STA CRSW        ;FAKE A CARRIAGE RETURN
02449  F223  A5 D5              LDA LNMX        ;SAY WE ENDED...
02450  F225  85 C8              STA INDX        ;...UP ON THIS LINE
02451  F227  4C 4F E6           JMP LOOP5       ;PICK UP CHARACTERS
02452  F22A              ;
02453  F22A  B0 38       BN20   BCS BN30        ;DEVICES >3
02454  F22C  C9 02              CMP #2          ;RS232?
02455  F22E  F0 3F              BEQ BN50
02456  F230              ;
02457  F230              ;INPUT FROM CASSETTE BUFFERS
02458  F230              ;
02459  F230  86 97              STX XSAV
02460  F232  20 50 F2           JSR JTGET
02461  F235  B0 16              BCS JTG37       ;STOP KEY/ERROR
02462  F237  48                 PHA
02463  F238  20 50 F2           JSR JTGET
02464  F23B  B0 0D              BCS JTG36       ;STOP KEY/ERROR
02465  F23D  D0 05              BNE JTG35       ;NOT AN END OF FILE
02466  F23F  A9 40              LDA #64         ;TELL USER EOF
02467  F241  20 6A FE           JSR UDST        ;IN STATUS
02468  F244  C6 A6       JTG35  DEC BUFPT
02469  F246  A6 97              LDX XSAV        ;.X PRESERVED
02470  F248  68                 PLA             ;CHARACTER RETURNED
02471  F249              ;C-CLEAR FROM JTGET
02472  F249  60                 RTS             ;ALL DONE
02473  F24A              ;
02474  F24A  AA          JTG36  TAX             ;SAVE ERROR INFO
02475  F24B  68                 PLA             ;TOSS DATA
02476  F24C  8A                 TXA             ;RESTORE ERROR
02477  F24D  A6 97       JTG37  LDX XSAV        ;RETURN
02478  F24F  60                 RTS             ;ERROR RETURN C-SET FROM JTGET



02480  F250              ;GET A CHARACTER FROM APPROPRIATE
02481  F250              ;CASSETTE BUFFER
02482  F250              ;
02483  F250  20 8A F8    JTGET  JSR JTP20       ;BUFFER POINTER WRAP?
02484  F253  D0 0B              BNE JTG10       ;NO...
02485  F255  20 C0 F8           JSR RBLK        ;YES...READ NEXT BLOCK
02486  F258  B0 11              BCS BN32        ;STOP KEY PRESSED
02487  F25A  A9 00              LDA #0
02488  F25C  85 A6              STA BUFPT       ;POINT TO BEGIN.
02489  F25E  F0 F0              BEQ JTGET       ;BRANCH ALWAYS
02490  F260              ;
02491  F260  B1 B2       JTG10  LDA (TAPE1)Y    ;GET CHAR FROM BUF
02492  F262  18                 CLC             ;GOOD RETURN
02493  F263  60                 RTS 









CHANNEL I/O......PAGE 0043

LINE# LOC   CODE        LINE


02495  F264              ;INPUT FROM SERIAL BUS
02496  F264              ;
02497  F264  A5 90       BN30   LDA STATUS      ;STATUS FROM LAST
02498  F266  F0 04              BEQ BN35        ;WAS GOOD
02499  F268  A9 0D              LDA #$D         ;BAD...ALL DONE
02500  F26A  18          BN31   CLC             ;VALID DATA
02501  F26B  60          BN32   RTS
02502  F26C              ;
02503  F26C  4C 19 EF    BN35   JMP ACPTR       ;GOOD...HANDSHAKE
02504  F26F              ;
02505  F26F              ;INPUT FROM RS232
02506  F26F              ;
02507  F26F  20 05 F2    BN50   JSR GN232       ;GET INFO
02508  F272  B0 05              BCS BN52        ;ERROR RETURN
02509  F274  C9 00              CMP #00
02510  F276  F0 F7              BEQ BN50        ;WAIT FOR VALID DATA
02511  F278  18                 CLC             ;GOOD RETURN
02512  F279  60          BN52   RTS











































CHANNEL OUTPUT......PAGE 0044

LINE# LOC   CODE        LINE


02514  F27A              ;***************************************
02515  F27A              ;* BSOUT -- OUT CHARACTER TO CHANNEL   *
02516  F27A              ;*     DETERMINED BY VARIABLE DFLTO:   *
02517  F27A              ;*     0 -- INVALID                    *
02518  F27A              ;*     1 -- CASSETTE #1                *
02519  F27A              ;*     2 -- RS232                      *
02520  F27A              ;*     3 -- SCREEN                     *
02521  F27A              ;*  4-31 -- SERIAL BUS                 *
02522  F27A              ;***************************************
02523  F27A              ;
02524  F27A  48          NBSOUT PHA             ;PRESERVE .A
02525  F27B  A5 9A              LDA DFLTO       ;CHECK DEVICE
02526  F27D  C9 03              CMP #3          ;IS IT THE SCREEN?
02527  F27F  D0 04              BNE BO10        ;NO...
02528  F281              ;
02529  F281              ;PRINT TO CRT
02530  F281              ;
02531  F281  68                 PLA             ;RESTORE DATA
02532  F282  4C 42 E7           JMP PRT         ;PRINT ON CRT
02533  F285              ;
02534  F285              BO10
02535  F285  90 04              BCC BO20        ;DEVICE 1 OR 2
02536  F287              ;
02537  F287              ;PRINT TO SERIAL BUS
02538  F287              ;
02539  F287  68                 PLA
02540  F288  4C E4 EE           JMP CIOUT
02541  F28B              ;
02542  F28B              ;PRINT TO CASSETTE DEVICES
02543  F28B              ;
02544  F28B  C9 02       BO20   CMP #2          ;RS232?
02545  F28D  F0 2A              BEQ BO50
02546  F28F              ;
02547  F28F  68                 PLA
02548  F290  85 9E       CASOUT STA T1
02549  F292              ;
02550  F292              ;PRESERVE REGISTERS
02551  F292              ;
02552  F292  48                 PHA
02553  F293  8A                 TXA
02554  F294  48                 PHA
02555  F295  98                 TYA
02556  F296  48                 PHA
02557  F297              ;
02558  F297  20 8A F8           JSR JTP20       ;CHECK BUFFER POINTER
02559  F29A  D0 0E              BNE JTP10       ;HAS NOT REACHED END
02560  F29C  20 E3 F8           JSR WBLK        ;WRITE FULL BUFFER
02561  F29F  B0 0E              BCS RSTOR       ;ABORT ON STOP KEY
02562  F2A1              ;
02563  F2A1              ;PUT BUFFER TYPE BYTE
02564  F2A1              ;
02565  F2A1  A9 02              LDA #BDF
02566  F2A3  A0 00              LDY #0
02567  F2A5  91 B2              STA (TAPE1)Y
02568  F2A7              ;






CHANNEL OUTPUT......PAGE 0045

LINE# LOC   CODE        LINE


02569  F2A7              ;RESET BUFFER POINTER
02570  F2A7              ;
02571  F2A7  C8                 INY             ;MAKE .Y=1
02572  F2A8  84 A6              STY BUFPT       ;BUFPT=1
02573  F2AA              ;
02574  F2AA  A5 9E       JTP10  LDA T1
02575  F2AC  91 B2              STA (TAPE1)Y    ;DATA TO BUFFER
02576  F2AE              ;
02577  F2AE              ;RESTORE .X AND .Y
02578  F2AE              ;
02579  F2AE  18                 CLC             ;GOOD RETURN
02580  F2AF  68          RSTOR  PLA
02581  F2B0  A8                 TAY
02582  F2B1  68                 PLA
02583  F2B2  AA                 TAX
02584  F2B3  68                 PLA             ;RESTORE .A
02585  F2B4  90 02              BCC RSTOR1      ;NO ERROR
02586  F2B6  A9 00              LDA #00         ;STOP ERROR IF C-SET
02587  F2B8  60          RSTOR1 RTS
02588  F2B9              ;
02589  F2B9              ;OUTPUT TO RS232
02590  F2B9              ;
02591  F2B9  68          BO50   PLA             ;GET DATA
02592  F2BA  86 97              STX XSAV        ;PUT IN A TEMP
02593  F2BC  84 9E              STY T1
02594  F2BE  20 ED F0           JSR BSO232      ;COULD PUT CODE HERE
02595  F2C1  A6 97              LDX XSAV        ;GO RESTORE
02596  F2C3  A4 9E              LDY T1
02597  F2C5  18                 CLC             ;GOOD RETURN
02598  F2C6  60                 RTS
02599  F2C7              .END
02600  F2C7              .LIB   OPENCHANNEL





























OPEN CHANNEL......PAGE 0046

LINE# LOC   CODE        LINE


02602  F2C7              ;***************************************
02603  F2C7              ;* CHKIN -- OPEN CHANNEL FOR INPUT     *
02604  F2C7              ;*                                     *
02605  F2C7              ;* THE NUMBER OF THE LOGICAL FILE TO BE*
02606  F2C7              ;* OPENED FOR INPUT IS PASSED IN .X.   *
02607  F2C7              ;* CHKIN SEARCHES THE LOGICAL FILE     *
02608  F2C7              ;* TO LOOK UP DEVICE AND COMMAND INFO. *
02609  F2C7              ;* ERRORS ARE REPORTED IF THE DEVICE   *
02610  F2C7              ;* WAS NOT OPENED FOR INPUT ,(E.G.     *
02611  F2C7              ;* CASSETTE WRITE FILE), OR THE LOGICAL*
02612  F2C7              ;* FILE HAS NO REFERENCE IN THE TABLES.*
02613  F2C7              ;* DEVICE 0, (KEYBOARD), AND DEVICE 3  *
02614  F2C7              ;* (SCREEN), REQUIRE NO TABLE ENTRIES  *
02615  F2C7              ;* AND ARE HANDLED SEPARATE.           *
02616  F2C7              ;***************************************
02617  F2C7              ;
02618  F2C7  20 CF F3    NCHKIN JSR LOOKUP      ;SEE IF FILE KNOWN
02619  F2CA  F0 03              BEQ JX310       ;YUP...
02620  F2CC              ;
02621  F2CC  4C 84 F7           JMP ERROR3      ;NO...FILE NOT OPEN
02622  F2CF              ;
02623  F2CF  20 DF F3    JX310  JSR JZ100       ;EXTRACT FILE INFO
02624  F2D2              ;
02625  F2D2  A5 BA              LDA FA
02626  F2D4  F0 16              BEQ JX320       ;IS KEYBOARD...DONE.
02627  F2D6              ;
02628  F2D6              ;COULD BE SCREEN, KEYBOARD, OR SERIAL
02629  F2D6              ;
02630  F2D6  C9 03              CMP #3
02631  F2D8  F0 12              BEQ JX320       ;IS SCREEN...DONE.
02632  F2DA  B0 14              BCS JX330       ;IS SERIAL...ADDRESS IT
02633  F2DC  C9 02              CMP #2          ;RS232?
02634  F2DE  D0 03              BNE JX315       ;NO...
02635  F2E0              ;
02636  F2E0  4C 16 F1           JMP CKI232
02637  F2E3              ;
02638  F2E3              ;SOME EXTRA CHECKS FOR TAPE
02639  F2E3              ;
02640  F2E3  A6 B9       JX315  LDX SA
02641  F2E5  E0 60              CPX #$60        ;IS COMMAND A READ?
02642  F2E7  F0 03              BEQ JX320       ;YES...O.K....DONE
02643  F2E9              ;
02644  F2E9  4C 8D F7           JMP ERROR6      ;NOT INPUT FILE
02645  F2EC              ;
02646  F2EC  85 99       JX320  STA DFLTN       ;ALL INPUT COME FROM HERE
02647  F2EE              ;
02648  F2EE  18                 CLC             ;GOOD EXIT
02649  F2EF  60                 RTS
02650  F2F0              ;
02651  F2F0              ;AN SERIAL DEVICE HAS TO BE A TALKER
02652  F2F0              ;
02653  F2F0  AA          JX330  TAX             ;DEVICE # FOR DFLTO
02654  F2F1  20 14 EE           JSR TALK        ;TELL HIM TO TALK
02655  F2F4              ;
02656  F2F4  A5 B9              LDA SA          ;A SECOND?






OPEN CHANNEL......PAGE 0047

LINE# LOC   CODE        LINE


02657  F2F6  10 06              BPL JX340       ;YES...SEND IT
02658  F2F8  20 D3 EE           JSR TKATN       ;NO...LET GO
02659  F2FB  4C 01 F3           JMP JX350
02660  F2FE              ;
02661  F2FE  20 CE EE    JX340  JSR TKSA        ;SEND SECOND
02662  F301              ;
02663  F301  8A          JX350  TXA
02664  F302  24 90              BIT STATUS      ;DID HE LISTEN?
02665  F304  10 E6              BPL JX320       ;YES
02666  F306              ;
02667  F306  4C 8A F7           JMP ERROR5      ;DEVICE NOT PRESENT


















































OPEN CHANNEL OUT......PAGE 0048

LINE# LOC   CODE        LINE


02669  F309              ;***************************************
02670  F309              ;* CHKOUT -- OPEN CHANNEL FOR OUTPUT     *
02671  F309              ;*                                     *
02672  F309              ;* THE NUMBER OF THE LOGICAL FILE TO BE*
02673  F309              ;* OPENED FOR OUTPUT IS PASSED IN .X.  *
02674  F309              ;* CHKOUT SEARCHES THE LOGICAL FILE    *
02675  F309              ;* TO LOOK UP DEVICE AND COMMAND INFO. *
02676  F309              ;* ERRORS ARE REPORTED IF THE DEVICE   *
02677  F309              ;* WAS NOT OPENED FOR INPUT ,(E.G.     *
02678  F309              ;* KEYBOARD), OR THE LOGICAL FILE HAS   *
02679  F309              ;* REFERENCE IN THE TABLES.             *
02680  F309              ;* DEVICE 0, (KEYBOARD), AND DEVICE 3  *
02681  F309              ;* (SCREEN), REQUIRE NO TABLE ENTRIES  *
02682  F309              ;* AND ARE HANDLED SEPARATE.           *
02683  F309              ;***************************************
02684  F309              ;
02685  F309  20 CF F3    NCKOUT JSR LOOKUP      ;IS FILE IN TABLE?
02686  F30C  F0 03              BEQ CK5         ;YES...
02687  F30E              ;
02688  F30E  4C 84 F7           JMP ERROR3      ;NO...FILE NOT OPEN
02689  F311              ;
02690  F311  20 DF F3    CK5    JSR JZ100       ;EXTRACT TABLE INFO
02691  F314              ;
02692  F314  A5 BA              LDA FA          ;IS IT KEYBOARD?
02693  F316  D0 03              BNE CK10        ;NO...SOMETHING ELSE.
02694  F318              ;
02695  F318  4C 90 F7    CK20   JMP ERROR7      ;YES...NOT OUTPUT FILE
02696  F31B              ;
02697  F31B              ;COULD BE SCREEN,SERIAL,OR TAPES
02698  F31B              ;
02699  F31B  C9 03       CK10   CMP #3
02700  F31D  F0 0F              BEQ CK30        ;IS SCREEN...DONE
02701  F31F  B0 11              BCS CK40        ;IS SERIAL...ADDRESS IT
02702  F321  C9 02              CMP #2          ;RS232?
02703  F323  D0 03              BNE CK15
02704  F325              ;
02705  F325  4C BC F0           JMP CKO232
02706  F328              ;
02707  F328              ;
02708  F328              ;SPECIAL TAPE CHANNEL HANDLING
02709  F328              ;
02710  F328  A6 B9       CK15   LDX SA
02711  F32A  E0 60              CPX #$60        ;IS COMMAND READ?
02712  F32C  F0 EA              BEQ CK20        ;YES...ERROR
02713  F32E              ;
02714  F32E  85 9A       CK30   STA DFLTO       ;ALL OUTPUT GOES HERE
02715  F330              ;
02716  F330  18                 CLC             ;GOOD EXIT
02717  F331  60                 RTS
02718  F332              ;
02719  F332  AA          CK40   TAX             ;SAVE DEVICE FOR DFLTO
02720  F333  20 17 EE           JSR LISTN       ;TELL HIM TO LISTEN
02721  F336              ;
02722  F336  A5 B9              LDA SA          ;IS THERE A SECOND?
02723  F338  10 05              BPL CK50        ;YES...






OPEN CHANNEL OUT......PAGE 0049

LINE# LOC   CODE        LINE


02724  F33A              ;
02725  F33A  20 C5 EE           JSR SCATN       ;NO...RELEASE LINES
02726  F33D  D0 03              BNE CK60        ;BRANCH ALWAYS
02727  F33F              ;
02728  F33F  20 C0 EE    CK50   JSR SECND       ;SEND SECOND...
02729  F342              ;
02730  F342  8A          CK60   TXA
02731  F343  24 90              BIT STATUS      ;DID HE LISTEN?
02732  F345  10 E7              BPL CK30        ;YES...FINISH UP
02733  F347              ;
02734  F347  4C 8A F7           JMP ERROR5      ;NO...DEVICE NOT PRESENT
02735  F34A              .END
02736  F34A              .LIB   CLOSE
















































CLOSE......PAGE 004A

LINE# LOC   CODE        LINE


02738  F34A              ;***************************************
02739  F34A              ;* CLOSE -- CLOSE LOGICAL FILE       *
02740  F34A              ;*                                   *
02741  F34A              ;*     THE LOGICAL FILE NUMBER OF THE*
02742  F34A              ;* FILE TO BE CLOSED IS PASSED IN .A.*
02743  F34A              ;* KEYBOARD, SCREEN, AND FILES NOT   *
02744  F34A              ;* OPEN PASS STRAIGHT THROUGH. TAPE  *
02745  F34A              ;* FILES OPEN FOR WRITE ARE CLOSED BY*
02746  F34A              ;* DUMPING THE LAST BUFFER AND       *
02747  F34A              ;* CONDITIONALLY WRITING AN END OF   *
02748  F34A              ;* TAPE BLOCK.SERIAL FILES ARE CLOSED*
02749  F34A              ;* BY SENDING A CLOSE FILE COMMAND IF*
02750  F34A              ;* A SECONDARY ADDRESS WAS SPECIFIED *
02751  F34A              ;* IN ITS OPEN COMMAND.              *
02752  F34A              ;***************************************
02753  F34A              ;
02754  F34A  20 D4 F3    NCLOSE JSR JLTLK       ;LOOK FILE UP
02755  F34D  F0 02              BEQ JX050       ;OPEN...
02756  F34F  18                 CLC             ;ELSE RETURN
02757  F350  60                 RTS
02758  F351              ;
02759  F351  20 DF F3    JX050  JSR JZ100       ;EXTRACT TABLE DATA
02760  F354  8A                 TXA             ;SAVE TABLE INDEX
02761  F355  48                 PHA
02762  F356              ;
02763  F356  A5 BA              LDA FA          ;CHECK DEVICE NUMBER
02764  F358  F0 57              BEQ JX150       ;IS KEYBOARD...DONE
02765  F35A  C9 03              CMP #3
02766  F35C  F0 53              BEQ JX150       ;IS SCREEN...DONE
02767  F35E  B0 4E              BCS JX120       ;IS SERIAL...PROCESS
02768  F360  C9 02              CMP #2          ;RS232?
02769  F362  D0 29              BNE JX115       ;NO...
02770  F364              ;
02771  F364              ; RS-232
02772  F364              ;
02773  F364              ; REMOVE FILE FROM TABLES
02774  F364  68                 PLA
02775  F365  20 B2 F3           JSR JXRMV
02776  F368              ;
02777  F368              ; DISABLE ALL RS-232 NMI'S (CB1 T1 T2)
02778  F368              ;
02779  F368  A9 7D              LDA #%01111101
02780  F36A  8D 1E 91           STA D1IER
02781  F36D              ;
02782  F36D              ; SEND MARK & ALL LINES HIGH
02783  F36D              ;
02784  F36D  A9 06              LDA #%00000110
02785  F36F  8D 10 91           STA D1ORB
02786  F372  A9 EE              LDA #%11101110
02787  F374  8D 1C 91           STA D1PCR
02788  F377              ;
02789  F377              ; DEALLOCATE BUFFERS
02790  F377              ;
02791  F377  20 75 FE           JSR GETTOP      ;GET MEMSIZ
02792  F37A  A5 F8              LDA RIBUF+1     ;CHECK INPUT ALLOCATION






CLOSE......PAGE 004B

LINE# LOC   CODE        LINE


02793  F37C  F0 01              BEQ CLS010      ;NOT...ALLOCATED
02794  F37E  C8                 INY
02795  F37F  A5 FA       CLS010 LDA ROBUF+1     ;CHECK OUTPUT ALLOCATION
02796  F381  F0 01              BEQ CLS020
02797  F383  C8                 INY
02798  F384  A9 00       CLS020 LDA #00         ;DEALLOCATE
02799  F386  85 F8              STA RIBUF+1
02800  F388  85 FA              STA ROBUF+1
02801  F38A              ; FLAG TOP OF MEMORY CHANGE
02802  F38A  4C 3C F5           JMP MEMTCF      ;GO SET NEW TOP
02803  F38D              ;
02804  F38D              ;CLOSE CASSETTE FILE
02805  F38D              ;
02806  F38D  A5 B9       JX115  LDA SA          ;WAS IT A TAPE READ?
02807  F38F  29 0F              AND #$F
02808  F391  F0 1E              BEQ JX150       ;YES
02809  F393              ;
02810  F393  20 4D F8           JSR ZZZ         ;NO. . .IT IS WRITE
02811  F396  A9 00              LDA #0          ;END OF FILE CHARACTER
02812  F398  20 90 F2           JSR CASOUT      ;PUT IN END OF FILE
02813  F39B  20 E3 F8           JSR WBLK        ;EMPTY LAST BUFFER
02814  F39E  B0 2D              BCS JX170       ;STOP KEY PRESSED
02815  F3A0              ;
02816  F3A0  A5 B9              LDA SA
02817  F3A2  C9 62              CMP #$62        ;WRITE END OF TAPE BLOCK?
02818  F3A4  D0 0B              BNE JX150       ;NO...
02819  F3A6              ;
02820  F3A6  A9 05              LDA #EOT
02821  F3A8  20 E7 F7           JSR TAPEH       ;WRITE END OF TAPE BLOCK
02822  F3AB  4C B1 F3           JMP JX150
02823  F3AE              ;
02824  F3AE              ;CLOSE AN SERIAL FILE
02825  F3AE              ;
02826  F3AE  20 DA F6    JX120  JSR CLSEI
02827  F3B1              ;
02828  F3B1              ;ENTRY TO REMOVE A GIVE LOGICAL FILE
02829  F3B1              ;FROM TABLE OF LOGICAL, PRIMARY,
02830  F3B1              ;AND SECONDARY ADDRESSES
02831  F3B1              ;
02832  F3B1  68          JX150  PLA             ;GET TABLE INDEX OFF STACK
02833  F3B2              ;
02834  F3B2              ; JXRMV - ENTRY TO USE AS AN RS-232 SUBROUTINE
02835  F3B2              ;
02836  F3B2  AA          JXRMV  TAX
02837  F3B3  C6 98              DEC LDTND
02838  F3B5  E4 98              CPX LDTND       ;IS DELETED FILE AT END?
02839  F3B7  F0 14              BEQ JX170       ;YES...DONE
02840  F3B9              ;
02841  F3B9              ;DELETE ENTRY IN MIDDLE BY MOVING
02842  F3B9              ;LAST ENTRY TO THAT POSITION.
02843  F3B9              ;
02844  F3B9  A4 98              LDY LDTND
02845  F3BB  B9 59 02           LDA LAT,Y
02846  F3BE  9D 59 02           STA LAT,X
02847  F3C1  B9 63 02           LDA FAT,Y






CLOSE......PAGE 004C

LINE# LOC   CODE        LINE


02848  F3C4  9D 63 02           STA FAT,X
02849  F3C7  B9 6D 02           LDA SAT,Y
02850  F3CA  9D 6D 02           STA SAT,X
02851  F3CD              ;
02852  F3CD  18          JX170  CLC             ;CLOSE EXIT
02853  F3CE  60                 RTS





02855  F3CF              ;LOOKUP TABLIZED LOGICAL FILE DATA
02856  F3CF              ;
02857  F3CF  A9 00       LOOKUP LDA #0
02858  F3D1  85 90              STA STATUS
02859  F3D3  8A                 TXA
02860  F3D4  A6 98       JLTLK  LDX LDTND
02861  F3D6  CA          JX600  DEX
02862  F3D7  30 15              BMI JZ101
02863  F3D9  DD 59 02           CMP LAT,X
02864  F3DC  D0 F8              BNE JX600
02865  F3DE  60                 RTS





02867  F3DF              ;ROUTINE TO FETCH TABLE ENTRIES
02868  F3DF              ;
02869  F3DF  BD 59 02    JZ100  LDA LAT,X
02870  F3E2  85 B8              STA LA
02871  F3E4  BD 63 02           LDA FAT,X
02872  F3E7  85 BA              STA FA
02873  F3E9  BD 6D 02           LDA SAT,X
02874  F3EC  85 B9              STA SA
02875  F3EE  60          JZ101  RTS
02876  F3EF              .END
02877  F3EF              .LIB   CLALL























CLOSE ALL FILES......PAGE 004D

LINE# LOC   CODE        LINE


02879  F3EF              ;***************************************
02880  F3EF              ;* CLALL -- CLOSE ALL LOGICAL FILES  *
02881  F3EF              ;*      DELETES ALL TABLE ENTRIES AND*
02882  F3EF              ;* RESTORES DEFAULT I/O CHANNELS     *
02883  F3EF              ;* AND CLEARS IEEE PORT DEVICES      *
02884  F3EF              ;*************************************
02885  F3EF              ;
02886  F3EF  A9 00       NCLALL LDA #0
02887  F3F1  85 98              STA LDTND       ;FORGET ALL FILES



02889  F3F3              ;********************************************
02890  F3F3              ;* CLRCH -- CLEAR CHANNELS                  *
02891  F3F3              ;*   UNLISTEN OR UNTALK IEEE DEVICES, BUT   *
02892  F3F3              ;* LEAVE OTHERS ALONE.  DEFAULT CHANNELS    *
02893  F3F3              ;* ARE RESTORED.                            *
02894  F3F3              ;********************************************
02895  F3F3              ;
02896  F3F3  A2 03       NCLRCH LDX #3
02897  F3F5  E4 9A              CPX DFLTO       ;IS OUTPUT CHANNEL IEEE?
02898  F3F7  B0 03              BCS JX750       ;NO...
02899  F3F9              ;
02900  F3F9  20 04 EF           JSR UNLSN       ;YES...UNLISTEN IT
02901  F3FC              ;
02902  F3FC  E4 99       JX750  CPX DFLTN       ;IS INPUT CHANNEL IEEE?
02903  F3FE  B0 03              BCS CLALL2      ;NO...
02904  F400              ;
02905  F400  20 F6 EE           JSR UNTLK       ;YES...UNTALK IT
02906  F403              ;
02907  F403              ;RESTORE DEFAULT VALUES
02908  F403              ;
02909  F403              ;
02910  F403  86 9A       CLALL2 STX DFLTO       ;OUTPUT CHAN=3=SCREEN
02911  F405  A9 00              LDA #0
02912  F407  85 99              STA DFLTN       ;INPUT CHAN=0=KEYBOARD
02913  F409  60                 RTS
02914  F40A              .END
02915  F40A              .LIB   OPEN






















OPEN FILE......PAGE 004E

LINE# LOC   CODE        LINE


02917  F40A              ;***********************************
02918  F40A              ;*                                 *
02919  F40A              ;* OPEN FUNCTION                   *
02920  F40A              ;*                                 *
02921  F40A              ;* CREATES AN ENTRY IN THE LOGICAL *
02922  F40A              ;* FILES TABLES CONSISTING OF      *
02923  F40A              ;* LOGICAL FILE NUMBER--LA, DEVICE *
02924  F40A              ;* NUMBER--FA, AND SECONDARY CMD-- *
02925  F40A              ;* SA.                             *
02926  F40A              ;*                                 *
02927  F40A              ;* A FILE NAME DESCRIPTOR, FNADR & *
02928  F40A              ;* FNLEN ARE PASSED TO THIS ROUTINE*
02929  F40A              ;*                                 *
02930  F40A              ;***********************************
02931  F40A              ;
02932  F40A  A6 B8       NOPEN  LDX LA          ;CHECK FILE #
02933  F40C  D0 03              BNE OP98        ;IS NOT THE KEYBOARD
02934  F40E              ;
02935  F40E  4C 8D F7           JMP ERROR6      ;NOT INPUT FILE...
02936  F411              ;
02937  F411  20 CF F3    OP98   JSR LOOKUP      ;SEE IF IN TABLE
02938  F414  D0 03              BNE OP100       ;NOT FOUND...O.K.
02939  F416              ;
02940  F416  4C 81 F7           JMP ERROR2      ;FILE OPEN
02941  F419              ;
02942  F419  A6 98       OP100  LDX LDTND       ;LOGICAL DEVICE TABLE END
02943  F41B  E0 0A              CPX #10         ;MAXIMUM # OF OPEN FILES
02944  F41D  90 03              BCC OP110       ;LESS THAN 10...O.K.
02945  F41F              ;
02946  F41F  4C 7E F7           JMP ERROR1      ;TOO MANY FILES
02947  F422              ;
02948  F422  E6 98       OP110  INC LDTND       ;NEW FILE
02949  F424  A5 B8              LDA LA
02950  F426  9D 59 02           STA LAT,X       ;STORE LOGICAL FILE #
02951  F429  A5 B9              LDA SA
02952  F42B  09 60              ORA #$60        ;MAKE SA AN SERIAL COMMAND
02953  F42D  85 B9              STA SA
02954  F42F  9D 6D 02           STA SAT,X       ;STORE COMMAND #
02955  F432  A5 BA              LDA FA
02956  F434  9D 63 02           STA FAT,X       ;STORE DEVICE #
02957  F437              ;
02958  F437              ;PERFORM DEVICE SPECIFIC OPEN TASKS
02959  F437              ;
02960  F437  F0 5A              BEQ OP175       ;IS KEYBOARD...DONE.
02961  F439  C9 03              CMP #3
02962  F43B  F0 56              BEQ OP175       ;IS SCREEN...DONE.
02963  F43D  90 05              BCC OP150       ;ARE CASSETTES 1 & 2
02964  F43F              ;
02965  F43F  20 95 F4           JSR OPENI       ;IS ON SERIAL...OPEN IT
02966  F442  90 4F              BCC OP175       ;BRANCH ALWAYS...DONE
02967  F444              ;
02968  F444              ;PERFORM TAPE OPEN STUFF
02969  F444              ;
02970  F444  C9 02       OP150  CMP #2
02971  F446  D0 03              BNE OP152






OPEN FILE......PAGE 004F

LINE# LOC   CODE        LINE


02972  F448              ;
02973  F448  4C C7 F4           JMP OPN232
02974  F44B              ;
02975  F44B  20 4D F8    OP152  JSR ZZZ         ;SEE IF TAPE BUFFER
02976  F44E  B0 03              BCS OP155       ;YES
02977  F450              ;
02978  F450  4C 96 F7           JMP ERROR9      ;NO...DEALLOCATED
02979  F453              ;
02980  F453  A5 B9       OP155  LDA SA
02981  F455  29 0F              AND #$F         ;MASK OFF COMMAND
02982  F457  D0 1F              BNE OP200       ;NON ZERO IS TAPE WRITE
02983  F459              ;
02984  F459              ;OPEN CASSETE TAPE FILE TO READ
02985  F459              ;
02986  F459  20 94 F8           JSR CSTE1       ;TELL "PRESS PLAY"
02987  F45C  B0 36              BCS OP180       ;STOP KEY PRESSED
02988  F45E              ;
02989  F45E  20 47 F6           JSR LUKING      ;TELL USER "SEARCHING"
02990  F461              ;
02991  F461  A5 B7              LDA FNLEN
02992  F463  F0 0A              BEQ OP170       ;LOOKING FOR ANY FILE
02993  F465              ;
02994  F465  20 67 F8           JSR FAF         ;LOOKING FOR NAMED FILE
02995  F468  90 18              BCC OP171       ;FOUND IT!!!
02996  F46A  F0 28              BEQ OP180       ;STOP KEY PRESSED
02997  F46C              ;
02998  F46C  4C 87 F7    OP160  JMP ERROR4      ;FILE NOT FOUND
02999  F46F              ;
03000  F46F  20 AF F7    OP170  JSR FAH         ;GET ANY OLD HEADER
03001  F472  F0 20              BEQ OP180       ;STOP KEY PRESSED
03002  F474  90 0C              BCC OP171       ;ALL O.K.
03003  F476  B0 F4              BCS OP160       ;FILE NOT FOUND...
03004  F478              ;
03005  F478              ;OPEN CASSETTE TAPE FOR WRITE
03006  F478              ;
03007  F478  20 B7 F8    OP200  JSR CSTE2       ;TELL "PRESS PLAY AND RECORD"
03008  F47B  B0 17              BCS OP180       ;STOP KEY PRESSED
03009  F47D  A9 04              LDA #BDFH       ;DATA FILE HEADER TYPE
03010  F47F  20 E7 F7           JSR TAPEH       ;WRITE IT
03011  F482              ;
03012  F482              ;FINISH OPEN FOR TAPE READ/WRITE
03013  F482              ;
03014  F482  A9 BF       OP171  LDA #BUFSZ-1    ;ASSUME FORCE READ
03015  F484              ;
03016  F484  A4 B9              LDY SA
03017  F486  C0 60              CPY #$60        ;OPEN FOR READ?
03018  F488  F0 07              BEQ OP172
03019  F48A              ;
03020  F48A              ;SET POINTERS FOR BUFFERING DATA
03021  F48A              ;
03022  F48A  A0 00              LDY #0
03023  F48C  A9 02              LDA #BDF        ;TYPE FLAG FOR BLOCK
03024  F48E  91 B2              STA (TAPE1)Y    ;TO BEGIN OF BUFFER
03025  F490  98                 TYA
03026  F491              ;






OPEN FILE......PAGE 0050

LINE# LOC   CODE        LINE


03027  F491  85 A6       OP172  STA BUFPT       ;POINT TO DATA
03028  F493  18          OP175  CLC             ;FLAG GOOD OPEN
03029  F494  60          OP180  RTS             ;EXIT IN PEACE





03031  F495  A5 B9       OPENI  LDA SA
03032  F497  30 2C              BMI OP50        ;NO SA...DONE
03033  F499              ;
03034  F499  A4 B7              LDY FNLEN
03035  F49B  F0 28              BEQ OP50        ;NO FILE NAME...DONE
03036  F49D              ;
03037  F49D  A5 BA              LDA FA
03038  F49F  20 17 EE           JSR LISTN       ;DEVICE LA TO LISTEN
03039  F4A2              ;
03040  F4A2  A5 B9              LDA SA
03041  F4A4  09 F0              ORA #$F0
03042  F4A6  20 C0 EE           JSR SECND
03043  F4A9              ;
03044  F4A9  A5 90              LDA STATUS      ;ANYBODY HOME?
03045  F4AB  10 05              BPL OP35        ;YES...CONTINUE
03046  F4AD              ;
03047  F4AD              ;THIS ROUTINE IS CALLED BY OTHER
03048  F4AD              ;KERNAL ROUTINES WHICH ARE CALLED
03049  F4AD              ;DIRECTLY BY OS.  KILL RETURN
03050  F4AD              ;ADDRESS TO RETURN TO OS.
03051  F4AD              ;
03052  F4AD  68                 PLA
03053  F4AE  68                 PLA
03054  F4AF  4C 8A F7           JMP ERROR5      ;DEVICE NOT PRESENT
03055  F4B2              ;
03056  F4B2  A5 B7       OP35   LDA FNLEN
03057  F4B4  F0 0C              BEQ OP45        ;NO NAME...DONE SEQUENCE
03058  F4B6              ;
03059  F4B6              ;SEND FILE NAME OVER SERIAL
03060  F4B6              ;
03061  F4B6  A0 00              LDY #0
03062  F4B8  B1 BB       OP40   LDA (FNADR)Y
03063  F4BA  20 E4 EE           JSR CIOUT
03064  F4BD  C8                 INY
03065  F4BE  C4 B7              CPY FNLEN
03066  F4C0  D0 F6              BNE OP40
03067  F4C2              ;
03068  F4C2  20 04 EF    OP45   JSR UNLSN
03069  F4C5              ;
03070  F4C5  18          OP50   CLC             ;NO  ERROR
03071  F4C6  60                 RTS












OPEN RS232 FILE......PAGE 0051

LINE# LOC   CODE        LINE


03073  F4C7              ; OPN232 - OPEN AN RS-232 OR PARALLEL PORT FILE
03074  F4C7              ;
03075  F4C7              ; VARIABLES INITILIZED
03076  F4C7              ;   BITNUM - # OF BITS TO BE SENT CALC FROM M51CTR
03077  F4C7              ;   BAUDOF - BAUD RATE FULL
03078  F4C7              ;   RSSTAT - RS-232 STATUS REG
03079  F4C7              ;   M51CTR - 6551 CONTROL REG
03080  F4C7              ;   M51CDR - 6551 COMMAND REG
03081  F4C7              ;   M51AJB - USER TIME ####NOT IMPLEMENTED###
03082  F4C7              ;
03083  F4C7              OPN232
03084  F4C7              ;
03085  F4C7              ; SET UP DDRB AND CB2 FOR RS-232
03086  F4C7              ;
03087  F4C7  A9 06              LDA #%00000110  ;DDRB
03088  F4C9  8D 12 91           STA D1DDRB
03089  F4CC  8D 10 91           STA D1ORB       ;DTR,RTS HIGH
03090  F4CF  A9 EE              LDA #%11101110  ;CASS OFF,TR MARK,CB1 HTL
03091  F4D1  8D 1C 91           STA D1PCR
03092  F4D4              ;
03093  F4D4              ; PASS PRAMS TO M51REGS
03094  F4D4  A0 00              LDY #00
03095  F4D6  8C 97 02           STY RSSTAT      ;CLEAR STATUS
03096  F4D9              ;
03097  F4D9  C4 B7       OPN020 CPY FNLEN       ;CHECK IF AT END OF FILENAME
03098  F4DB  F0 0A              BEQ OPN025      ;YES...
03099  F4DD              ;
03100  F4DD  B1 BB              LDA (FNADR)Y    ;MOVE DATA
03101  F4DF  99 93 02           STA M51CTR,Y    ;TO M51REGS
03102  F4E2  C8                 INY
03103  F4E3  C0 04              CPY #4          ;ONLY 4 POSSIBLE PRAMS
03104  F4E5  D0 F2              BNE OPN020
03105  F4E7              ;
03106  F4E7              ; CALC # OF BITS
03107  F4E7              ;
03108  F4E7  20 27 F0    OPN025 JSR BITCNT
03109  F4EA  8E 98 02           STX BITNUM
03110  F4ED              ;
03111  F4ED              ; CALC BAUD RATE
03112  F4ED              ;
03113  F4ED  AD 93 02           LDA M51CTR
03114  F4F0  29 0F              AND #$0F
03115  F4F2  D0 00              BNE OPN010
03116  F4F4              ;
03117  F4F4              ; GET BAUD RATE FROM ELSE WHERE ###NEED CODE###
03118  F4F4              ;
03119  F4F4  0A          OPN010 ASL A           ;GET INDEX INTO BAUDO
03120  F4F5  AA                 TAX
03121  F4F6  BD 5A FF           LDA BAUDO-2,X
03122  F4F9  0A                 ASL A           ;BAUDO*2+200 IS RATE
03123  F4FA  A8                 TAY
03124  F4FB  BD 5B FF           LDA BAUDO-1,X
03125  F4FE  2A                 ROL A
03126  F4FF  48                 PHA
03127  F500  98                 TYA






OPEN RS232 FILE......PAGE 0052

LINE# LOC   CODE        LINE


03128  F501  69 C8              ADC #CBIT+CBIT  ;TABLE HAS CB1 ADJST OFFSET
03129  F503  8D 99 02           STA BAUDOF
03130  F506  68                 PLA
03131  F507  69 00              ADC #0          ;GET CARRY IN
03132  F509  8D 9A 02           STA BAUDOF+1
03133  F50C              ;
03134  F50C              ; CHECK FOR 3/X LINE RESPONSE
03135  F50C              ;
03136  F50C  AD 94 02    OPN030 LDA M51CDR      ;BIT 0 OF M51CDR
03137  F50F  4A                 LSR A
03138  F510  90 09              BCC OPN050      ;...3 LINE
03139  F512              ;
03140  F512              ; CHECK FOR X LINE PROPER STATES
03141  F512              ;
03142  F512  AD 20 91           LDA D2ORB
03143  F515  0A                 ASL A
03144  F516  B0 03              BCS OPN050
03145  F518  4C 16 F0           JMP DSRERR      ;NO DATA SET
03146  F51B              ;
03147  F51B              ; SET UP BUFFER POINTERS (DBE=DBS)
03148  F51B              ;
03149  F51B  AD 9B 02    OPN050 LDA RIDBE
03150  F51E  8D 9C 02           STA RIDBS
03151  F521  AD 9E 02           LDA RODBE
03152  F524  8D 9D 02           STA RODBS
03153  F527              ;
03154  F527              ; ALLOCATE BUFFERS
03155  F527              ;
03156  F527  20 75 FE    OPN055 JSR GETTOP      ;GET MEMSIZ
03157  F52A  A5 F8              LDA RIBUF+1     ;IN ALLOCATION...
03158  F52C  D0 05              BNE OPN060      ;ALREADY
03159  F52E  88                 DEY             ;THERE GOES 256 BYTES
03160  F52F  84 F8              STY RIBUF+1
03161  F531  86 F7              STX RIBUF
03162  F533  A5 FA       OPN060 LDA ROBUF+1     ;OUT ALLOCATION...
03163  F535  D0 05              BNE MEMTCF      ;ALREAY
03164  F537  88                 DEY             ;THERE GOES 256 BYTES
03165  F538  84 FA              STY ROBUF+1
03166  F53A  86 F9              STX ROBUF
03167  F53C  38          MEMTCF SEC             ;SIGNAL TOP OF MEMORY CHANGE
03168  F53D  A9 F0              LDA #$F0
03169  F53F  4C 7B FE           JMP SETTOP      ;TOP CHANGED
03170  F542              .END
03171  F542              .LIB   LOAD

















LOAD FUNCTION......PAGE 0053

LINE# LOC   CODE        LINE


03173  F542              ;**********************************
03174  F542              ;* LOAD RAM FUNCTION              *
03175  F542              ;*                                *
03176  F542              ;* LOADS FROM CASSETTE 1 OR 2, OR *
03177  F542              ;* SERIAL BUS DEVICES >=4 TO 31   *
03178  F542              ;* AS DETERMINED BY CONTENTS OF   *
03179  F542              ;* VARIABLE FA. VERIFY FLAG IN .A *
03180  F542              ;*                                *
03181  F542              ;* ALT LOAD IF SA=0, NORMAL SA=1  *
03182  F542              ;* .X , .Y LOAD ADDRESS IF SA=0   *
03183  F542              ;* .A=0 PERFORMS LOAD,<> IS VERIFY*
03184  F542              ;*                                *
03185  F542              ;* HIGH LOAD RETURN IN X,Y.       *
03186  F542              ;*                                *
03187  F542              ;**********************************



03189  F542  86 C3       LOADSP STX MEMUSS      ;.X HAS LOW ALT START
03190  F544  84 C4              STY MEMUSS+1
03191  F546  6C 30 03    LOAD   JMP (ILOAD)     ;MONITOR LOAD ENTRY
03192  F549              ;
03193  F549  85 93       NLOAD  STA VERCK       ;STORE VERIFY FLAG
03194  F54B  A9 00              LDA #0
03195  F54D  85 90              STA STATUS
03196  F54F              ;
03197  F54F  A5 BA              LDA FA          ;CHECK DEVICE NUMBER
03198  F551  D0 03              BNE LD20
03199  F553              ;
03200  F553  4C 96 F7    LD10   JMP ERROR9      ;BAD DEVICE #-KEYBOARD
03201  F556              ;
03202  F556  C9 03       LD20   CMP #3
03203  F558  F0 F9              BEQ LD10        ;DISALLOW SCREEN LOAD
03204  F55A  90 6E              BCC LD100       ;HANDLE TAPES DIFFERENT
03205  F55C              ;
03206  F55C              ;LOAD FROM CBM IEEE DEVICE
03207  F55C              ;
03208  F55C  A4 B7              LDY FNLEN       ;MUST HAVE FILE NAME
03209  F55E  D0 03              BNE LD25        ;YES...OK
03210  F560              ;
03211  F560  4C 93 F7           JMP ERROR8      ;MISSING FILE NAME
03212  F563              ;
03213  F563  20 BC E4    LD25   JSR PATCH2      ;TELL USER LOOKING
03214  F566  A9 60              LDA #$60        ;SPECIAL LOAD COMMAND
03215  F568  85 B9              STA SA
03216  F56A  20 95 F4           JSR OPENI       ;OPEN THE FILE
03217  F56D              ;
03218  F56D  A5 BA              LDA FA
03219  F56F  20 14 EE           JSR TALK        ;ESTABLISH THE CHANNEL
03220  F572  A5 B9              LDA SA
03221  F574  20 CE EE           JSR TKSA        ;TELL IT TO LOAD
03222  F577              ;
03223  F577  20 19 EF           JSR ACPTR       ;GET FIRST BYTE
03224  F57A  85 AE              STA EAL
03225  F57C              ;






LOAD FUNCTION......PAGE 0054

LINE# LOC   CODE        LINE


03226  F57C  A5 90              LDA STATUS      ;TEST STATUS FOR ERROR
03227  F57E  4A                 LSR A
03228  F57F  4A                 LSR A
03229  F580  B0 45              BCS LD90        ;FILE NOT FOUND...
03230  F582  20 19 EF           JSR ACPTR
03231  F585  85 AF              STA EAH
03232  F587              ;
03233  F587  20 C1 E4           JSR PATCH3      ;TELL USER LOADING
03234  F58A              ;
03235  F58A              ;
03236  F58A  A9 FD       LD40   LDA #$FD        ;MASK OFF TIMEOUT
03237  F58C  25 90              AND STATUS
03238  F58E  85 90              STA STATUS
03239  F590              ;
03240  F590  20 E1 FF           JSR STOP        ;STOP KEY?
03241  F593  D0 03              BNE LD45        ;NO...
03242  F595              ;
03243  F595  4C CB F6           JMP BREAK       ;STOP KEY PRESSED
03244  F598              ;
03245  F598  20 19 EF    LD45   JSR ACPTR       ;GET BYTE OFF IEEE
03246  F59B  AA                 TAX
03247  F59C  A5 90              LDA STATUS      ;WAS THERE A TIMEOUT?
03248  F59E  4A                 LSR A
03249  F59F  4A                 LSR A
03250  F5A0  B0 E8              BCS LD40        ;YES...TRY AGAIN
03251  F5A2  8A                 TXA
03252  F5A3  A4 93              LDY VERCK       ;PERFORMING VERIFY?
03253  F5A5  F0 0C              BEQ LD50        ;NO...LOAD
03254  F5A7  A0 00              LDY #0
03255  F5A9  D1 AE              CMP (EAL)Y      ;VERIFY IT
03256  F5AB  F0 08              BEQ LD60        ;O.K....
03257  F5AD  A9 10              LDA #SPERR      ;NO GOOD...VERIFY ERROR
03258  F5AF  20 6A FE           JSR UDST        ;UPDATE STATUS
03259  F5B2  2C                 .BYT $2C        ;SKIP NEXT STORE
03260  F5B3              ;
03261  F5B3  91 AE       LD50   STA (EAL)Y
03262  F5B5  E6 AE       LD60   INC EAL         ;INCREMENT STORE ADDR
03263  F5B7  D0 02              BNE LD64
03264  F5B9  E6 AF              INC EAH
03265  F5BB  24 90       LD64   BIT STATUS      ;EOI?
03266  F5BD  50 CB              BVC LD40        ;NO...CONTINUE LOAD
03267  F5BF              ;
03268  F5BF  20 F6 EE           JSR UNTLK       ;CLOSE CHANNEL
03269  F5C2  20 DA F6           JSR CLSEI       ;CLOSE THE FILE
03270  F5C5  90 7A              BCC LD180       ;BRANCH ALWAYS
03271  F5C7              ;
03272  F5C7  4C 87 F7    LD90   JMP ERROR4      ;FILE NOT FOUND
03273  F5CA              ;
03274  F5CA              ;LOAD FROM TAPE
03275  F5CA              ;
03276  F5CA  C9 02       LD100  CMP #2
03277  F5CC  D0 03              BNE LD102
03278  F5CE              ;
03279  F5CE  4C B9 F0           JMP RS232
03280  F5D1              ;






LOAD FUNCTION......PAGE 0055

LINE# LOC   CODE        LINE


03281  F5D1  20 4D F8    LD102  JSR ZZZ         ;SET POINTERS AT TAPE
03282  F5D4  B0 03              BCS LD104
03283  F5D6  4C 96 F7           JMP ERROR9      ;DEALLOCATED...
03284  F5D9  20 94 F8    LD104  JSR CSTE1       ;TELL USER ABOUT BUTTONS
03285  F5DC  B0 68              BCS LD190       ;STOP KEY PRESSED?
03286  F5DE  20 47 F6           JSR LUKING      ;TELL USER SEARCHING
03287  F5E1              ;
03288  F5E1  A5 B7       LD112  LDA FNLEN       ;IS THERE A NAME?
03289  F5E3  F0 09              BEQ LD150       ;NONE...LOAD ANYTHING
03290  F5E5  20 67 F8           JSR FAF         ;FIND A FILE ON TAPE
03291  F5E8  90 0B              BCC LD170       ;GOT IT!
03292  F5EA  F0 5A              BEQ LD190       ;STOP KEY PRESSED
03293  F5EC  B0 D9              BCS LD90        ;NOPE...END OF TAPE
03294  F5EE              ;
03295  F5EE  20 AF F7    LD150  JSR FAH         ;FIND ANY HEADER
03296  F5F1  F0 53              BEQ LD190       ;STOP KEY PRESSED
03297  F5F3  B0 D2              BCS LD90        ;NO HEADER
03298  F5F5              ;
03299  F5F5  A5 90       LD170  LDA STATUS
03300  F5F7  29 10              AND #SPERR      ;MUST GOT HEADER RIGHT
03301  F5F9  38                 SEC
03302  F5FA  D0 4A              BNE LD190       ;IS BAD
03303  F5FC              ;
03304  F5FC  E0 01              CPX #BLF        ;IS IT A MOVABLE PROGRAM...
03305  F5FE  F0 11              BEQ LD178       ;YES
03306  F600              ;
03307  F600  E0 03              CPX #PLF        ;IS IT A PROGRAM
03308  F602  D0 DD              BNE LD112       ;NO...ITS SOMETHING ELSE
03309  F604              ;
03310  F604  A0 01       LD177  LDY #1          ;FIXED LOAD...
03311  F606  B1 B2              LDA (TAPE1)Y    ;...THE ADDRESS IN THE...
03312  F608  85 C3              STA MEMUSS      ;...BUFFER IS THE START ADDRESS
03313  F60A  C8                 INY
03314  F60B  B1 B2              LDA (TAPE1)Y
03315  F60D  85 C4              STA MEMUSS+1
03316  F60F  B0 04              BCS LD179       ;JMP ..CARRY SET BY CPX'S
03317  F611              ;
03318  F611  A5 B9       LD178  LDA SA          ;CHECK FOR MONITOR LOAD...
03319  F613  D0 EF              BNE LD177       ;...YES WE WANT FIXED TYPE
03320  F615              ;
03321  F615  A0 03       LD179  LDY #3          ;TAPEA - TAPESTA
03322  F617              ;CARRY SET BY CPX'S
03323  F617  B1 B2              LDA (TAPE1)Y
03324  F619  A0 01              LDY #1
03325  F61B  F1 B2              SBC (TAPE1)Y
03326  F61D  AA                 TAX             ;LOW TO .X
03327  F61E  A0 04              LDY #4
03328  F620  B1 B2              LDA (TAPE1)Y
03329  F622  A0 02              LDY #2
03330  F624  F1 B2              SBC (TAPE1)Y
03331  F626  A8                 TAY             ;HIGH TO .Y
03332  F627              ;
03333  F627  18                 CLC             ;EA = STA+(TAPEA-TAPESTA)
03334  F628  8A                 TXA
03335  F629  65 C3              ADC MEMUSS      ;






LOAD FUNCTION......PAGE 0056

LINE# LOC   CODE        LINE


03336  F62B  85 AE              STA EAL
03337  F62D  98                 TYA
03338  F62E  65 C4              ADC MEMUSS+1
03339  F630  85 AF              STA EAH
03340  F632  A5 C3              LDA MEMUSS      ;SET UP STARTING ADDRESS
03341  F634  85 C1              STA STAL
03342  F636  A5 C4              LDA MEMUSS+1
03343  F638  85 C2              STA STAH
03344  F63A  20 6A F6           JSR LODING      ;TELL USER LOADING
03345  F63D  20 C9 F8           JSR TRD         ;DO TAPE BLOCK LOAD
03346  F640  24                 .BYT $24        ;CARRY FROM TRD
03347  F641              ;
03348  F641  18          LD180  CLC             ;GOOD EXIT
03349  F642              ;
03350  F642              ; SET UP END LOAD ADDRESS
03351  F642              ;
03352  F642  A6 AE              LDX EAL
03353  F644  A4 AF              LDY EAH
03354  F646              ;
03355  F646  60          LD190  RTS





03357  F647              ;SUBROUTINE TO PRINT TO CONSOLE:
03358  F647              ;
03359  F647              ;SEARCHING [FOR NAME]
03360  F647              ;
03361  F647  A5 9D       LUKING LDA MSGFLG      ;SUPPOSED TO PRINT?
03362  F649  10 1E              BPL LD115       ;...NO
03363  F64B  A0 0C              LDY #MS5-MS1    ;"SEARCHING"
03364  F64D  20 E6 F1           JSR MSG
03365  F650  A5 B7              LDA FNLEN
03366  F652  F0 15              BEQ LD115
03367  F654  A0 17              LDY #MS6-MS1    ;"FOR"
03368  F656  20 E6 F1           JSR MSG



03370  F659              ;SUBROUTINE TO OUTPUT FILE NAME
03371  F659              ;
03372  F659  A4 B7       OUTFN  LDY FNLEN       ;IS THERE A NAME?
03373  F65B  F0 0C              BEQ LD115       ;NO...DONE
03374  F65D  A0 00              LDY #0
03375  F65F  B1 BB       LD110  LDA (FNADR)Y
03376  F661  20 D2 FF           JSR BSOUT
03377  F664  C8                 INY
03378  F665  C4 B7              CPY FNLEN
03379  F667  D0 F6              BNE LD110
03380  F669              ;
03381  F669  60          LD115  RTS









LOAD FUNCTION......PAGE 0057

LINE# LOC   CODE        LINE


03383  F66A              ;SUBROUTINE TO PRINT:
03384  F66A              ;
03385  F66A              ;LOADING/VERIFING
03386  F66A              ;
03387  F66A  A0 49       LODING LDY #MS10-MS1   ;ASSUME 'LOADING'
03388  F66C  A5 93              LDA VERCK       ;CHECK FLAG
03389  F66E  F0 02              BEQ LD410       ;ARE DOING LOAD
03390  F670  A0 59              LDY #MS21-MS1   ;ARE 'VERIFYING'
03391  F672  4C E2 F1    LD410  JMP SPMSG
03392  F675              SKIPBY = *
03393  F675              ;
03394  F675              ; PATCHES FOR DISK AUTO-OFFSET LOAD
03395  F675              ;
03396  F675                     *=KSP2          ;KERNAL SPACE FOR PATCH 2
03397  E4BC  A6 B9       PATCH2 LDX SA          ;SAVE SA IN .X
03398  E4BE  4C 47 F6           JMP LUKING      ;GO TELL USER
03399  E4C1  8A          PATCH3 TXA             ;FIND OUT HOW TO LOAD
03400  E4C2  D0 08              BNE PATCH4      ;USE PROGRAMS LOAD ADDRESS
03401  E4C4  A5 C3              LDA MEMUSS      ;ELSE MOVE WHERE I WANT
03402  E4C6  85 AE              STA EAL
03403  E4C8  A5 C4              LDA MEMUSS+1
03404  E4CA  85 AF              STA EAH
03405  E4CC  4C 6A F6    PATCH4 JMP LODING      ;TELL USER LOADING
03406  E4CF              ;
03407  E4CF              KSP3   = *             ;KERNAL SPACE FOR PATCH 3
03408  E4CF                     *=SKIPBY
03409  F675              .END
03410  F675              .LIB   SAVE

































SAVE FUNCTION......PAGE 0058

LINE# LOC   CODE        LINE


03412  F675              ;***********************************
03413  F675              ;* SAVE                            *
03414  F675              ;*                                 *
03415  F675              ;* SAVES TO CASSETTE 1 OR 2, OR    *
03416  F675              ;* IEEE DEVICES 4>=N>=31 AS SELECT-*
03417  F675              ;* ED BY VARIABLE FA.              *
03418  F675              ;*                                 *
03419  F675              ;*START OF SAVE IS INDIRECT AT .A  *
03420  F675              ;*END OF SAVE IS .X,.Y             *
03421  F675              ;***********************************



03423  F675  86 AE       SAVESP STX EAL
03424  F677  84 AF              STY EAH
03425  F679  AA                 TAX             ;SET UP START
03426  F67A  B5 00              LDA $00,X
03427  F67C  85 C1              STA STAL
03428  F67E  B5 01              LDA $01,X
03429  F680  85 C2              STA STAH
03430  F682              ;
03431  F682  6C 32 03    SAVE   JMP (ISAVE)
03432  F685  A5 BA       NSAVE  LDA FA  ***MONITOR ENTRY
03433  F687  D0 03              BNE SV20
03434  F689              ;
03435  F689  4C 96 F7    SV10   JMP ERROR9      ;BAD DEVICE #
03436  F68C              ;
03437  F68C  C9 03       SV20   CMP #3
03438  F68E  F0 F9              BEQ SV10
03439  F690  90 5F              BCC SV100
03440  F692  A9 61              LDA #$61
03441  F694  85 B9              STA SA
03442  F696  A4 B7              LDY FNLEN
03443  F698  D0 03              BNE SV25
03444  F69A              ;
03445  F69A  4C 93 F7           JMP ERROR8      ;MISSING FILE NAME
03446  F69D              ;
03447  F69D  20 95 F4    SV25   JSR OPENI
03448  F6A0  20 28 F7           JSR SAVING
03449  F6A3  A5 BA              LDA FA
03450  F6A5  20 17 EE           JSR LISTN
03451  F6A8  A5 B9              LDA SA
03452  F6AA  20 C0 EE           JSR SECND
03453  F6AD  A0 00              LDY #0
03454  F6AF  20 D2 FB           JSR RD300
03455  F6B2  A5 AC              LDA SAL
03456  F6B4  20 E4 EE           JSR CIOUT
03457  F6B7  A5 AD              LDA SAH
03458  F6B9  20 E4 EE           JSR CIOUT
03459  F6BC  20 11 FD    SV30   JSR CMPSTE      ;COMPARE START TO END
03460  F6BF  B0 16              BCS SV50        ;HAVE REACHED END
03461  F6C1  B1 AC              LDA (SAL)Y
03462  F6C3  20 E4 EE           JSR CIOUT
03463  F6C6  20 E1 FF           JSR STOP
03464  F6C9  D0 07              BNE SV40






SAVE FUNCTION......PAGE 0059

LINE# LOC   CODE        LINE


03465  F6CB              ;
03466  F6CB  20 DA F6    BREAK  JSR CLSEI
03467  F6CE  A9 00              LDA #0
03468  F6D0  38                 SEC
03469  F6D1  60                 RTS
03470  F6D2              ;
03471  F6D2  20 1B FD    SV40   JSR INCSAL      ;INCREMENT CURRENT ADDR.
03472  F6D5  D0 E5              BNE SV30
03473  F6D7  20 04 EF    SV50   JSR UNLSN





03475  F6DA  24 B9       CLSEI  BIT SA
03476  F6DC  30 11              BMI CLSEI2
03477  F6DE  A5 BA              LDA FA
03478  F6E0  20 17 EE           JSR LISTN
03479  F6E3  A5 B9              LDA SA
03480  F6E5  29 EF              AND #$EF
03481  F6E7  09 E0              ORA #$E0
03482  F6E9  20 C0 EE           JSR SECND
03483  F6EC  20 04 EF           JSR UNLSN
03484  F6EF              ;
03485  F6EF  18          CLSEI2 CLC
03486  F6F0  60                 RTS





03488  F6F1  C9 02       SV100  CMP #2
03489  F6F3  D0 03              BNE SV102
03490  F6F5              ;
03491  F6F5  4C B9 F0           JMP RS232
03492  F6F8              ;
03493  F6F8  20 4D F8    SV102  JSR ZZZ         ;GET ADDR OF TAPE
03494  F6FB  90 8C              BCC SV10        ;BUFFER IS DEALLOCATED
03495  F6FD  20 B7 F8           JSR CSTE2
03496  F700  B0 25              BCS SV115       ;STOP KEY PRESSED
03497  F702  20 28 F7           JSR SAVING      ;TELL USER 'SAVING'
03498  F705  A2 03       SV105  LDX #PLF        ;DECIDE TYPE TO SAVE
03499  F707  A5 B9              LDA SA          ;1-PLF 0-BLF
03500  F709  29 01              AND #01
03501  F70B  D0 02              BNE SV106
03502  F70D  A2 01              LDX #BLF
03503  F70F  8A          SV106  TXA
03504  F710  20 E7 F7           JSR TAPEH
03505  F713  B0 12              BCS SV115       ;STOP KEY PRESSED
03506  F715  20 E6 F8           JSR TWRT
03507  F718  B0 0D              BCS SV115       ;STOP KEY PRESSED
03508  F71A  A5 B9              LDA SA
03509  F71C  29 02              AND #2          ;WRITE END OF TAPE?
03510  F71E  F0 06              BEQ SV110       ;NO...
03511  F720              ;






SAVE FUNCTION......PAGE 005A

LINE# LOC   CODE        LINE


03512  F720  A9 05              LDA #EOT
03513  F722  20 E7 F7           JSR TAPEH
03514  F725  24                 .BYT $24        ;SKIP 1 BYTE
03515  F726              ;
03516  F726  18          SV110  CLC
03517  F727  60          SV115  RTS



03519  F728              ;SUBROUTINE TO OUTPUT:
03520  F728              ;'SAVING <FILE NAME>'
03521  F728              ;
03522  F728  A5 9D       SAVING LDA MSGFLG
03523  F72A  10 FB              BPL SV115       ;NO PRINT
03524  F72C              ;
03525  F72C  A0 51              LDY #MS11-MS1   ;'SAVING'
03526  F72E  20 E6 F1           JSR MSG
03527  F731  4C 59 F6           JMP OUTFN       ;<FILE NAME>
03528  F734              .END
03529  F734              .LIB   TIME









































TIME FUNCTION......PAGE 005B

LINE# LOC   CODE        LINE


03531  F734              ;***********************************
03532  F734              ;*                                 *
03533  F734              ;* TIME                            *
03534  F734              ;*                                 *
03535  F734              ;*CONSISTS OF THREE FUNCTIONS:     *
03536  F734              ;* (1) UDTIM-- UPDATE TIME. USUALLY*
03537  F734              ;*     CALLED EVERY 60TH SECOND.   *
03538  F734              ;* (2) SETTIM-- SET TIME. .Y=MSD,  *
03539  F734              ;*     .X=NEXT SIGNIFICANT,.A=LSD  *
03540  F734              ;* (3) RDTIM-- READ TIME. .Y=MSD,  *
03541  F734              ;*     .X=NEXT SIGNIFICANT,.A=LSD  *
03542  F734              ;*                                 *
03543  F734              ;***********************************
03544  F734              ;INTERRUPTS ARE COMING FROM TV HORIZONTAL
03545  F734              ;WHICH IS CLOSE TO 60HZ BUT A LITTLE OVER.
03546  F734              ;CRFAC COUNTS UP THEN SKIPS ONE UPDATE
03547  F734              ;OF THE TIME REGISTER.
03548  F734              ;
03549  F734  A2 00       UDTIM  LDX #0          ;PRE-LOAD FOR LATER
03550  F736              ; INC CRFAC
03551  F736              ; LDA CRFAC
03552  F736              ; BNE UD10
03553  F736              ; INC CRFAC+1
03554  F736              ; UD10 CMP #$6F
03555  F736              ; BNE UD20
03556  F736              ; LDA CRFAC+1
03557  F736              ; CMP #2
03558  F736              ; BEQ UD50
03559  F736              ;
03560  F736              ;HERE WE PROCEED WITH AN INCREMENT
03561  F736              ;OF THE TIME REGISTER.
03562  F736              ;
03563  F736  E6 A2       UD20   INC TIME+2
03564  F738  D0 06              BNE UD30
03565  F73A  E6 A1              INC TIME+1
03566  F73C  D0 02              BNE UD30
03567  F73E  E6 A0              INC TIME
03568  F740              ;
03569  F740              ;HERE WE CHECK FOR ROLL-OVER 23:59:59
03570  F740              ;AND RESET THE CLOCK TO ZERO IF TRUE
03571  F740              ;
03572  F740              ;24:00:00 = 5184000 JIFFIES
03573  F740              ;=79*65536+26*256+0
03574  F740              ;=$4F*65536+$1A*256+$0+CORRECTION
03575  F740              ;
03576  F740              ;FINAL CORRECTION IS +1/60TH IN
03577  F740              ;24 HOURS.
03578  F740              ;
03579  F740  38          UD30   SEC
03580  F741  A5 A2              LDA TIME+2
03581  F743  E9 01              SBC #$01
03582  F745  A5 A1              LDA TIME+1
03583  F747  E9 1A              SBC #$1A
03584  F749  A5 A0              LDA TIME
03585  F74B  E9 4F              SBC #$4F






TIME FUNCTION......PAGE 005C

LINE# LOC   CODE        LINE


03586  F74D  90 06              BCC UD60
03587  F74F              ;
03588  F74F              ;TIME HAS ROLLED--ZERO REGISTER
03589  F74F              ;
03590  F74F  86 A0              STX TIME
03591  F751  86 A1              STX TIME+1
03592  F753  86 A2              STX TIME+2
03593  F755              ; BCS UD60 ;BRANCH ALWAYS
03594  F755              ;
03595  F755              ;COR. FACTOR ROLLED--ZERO IT
03596  F755              ;
03597  F755              ; UD50 STX CRFAC
03598  F755              ; STX CRFAC+1
03599  F755              ;
03600  F755              ;SET STOP KEY FLAG HERE
03601  F755              ;
03602  F755  AD 2F 91    UD60   LDA D2ORA       ;WAIT FOR IT TO SETTLE
03603  F758  CD 2F 91           CMP D2ORA
03604  F75B  D0 F8              BNE UD60        ;STILL BOUNCING
03605  F75D  4C CF E4           JMP STPTCH      ;JUMP TO PATCH CHECKING FOR BOTH SHIFT KEYS
03606  F760              ;
03607  F760              ; THE FOLLOWING 3 BYTES WERE REPLACED WITH THE PRECEEDING JMP
03608  F760              ;
03609  F760              ;  STA STKEY ;SAVE FOR OTHER ROUTINES
03610  F760              ;  RTS





03612  F760  78          RDTIM  SEI             ;KEEP TIME FROM ROLLING
03613  F761  A5 A2              LDA TIME+2      ;GET LSD
03614  F763  A6 A1              LDX TIME+1      ;GET NEXT MOST SIG.
03615  F765  A4 A0              LDY TIME        ;GET MSD





03617  F767  78          SETTIM SEI             ;KEEP TIME FROM CHANGING
03618  F768  85 A2              STA TIME+2      ;STORE LSD
03619  F76A  86 A1              STX TIME+1      ;NEXT MOST SIGNIFICANT
03620  F76C  84 A0              STY TIME        ;STORE MSD
03621  F76E  58                 CLI
03622  F76F  60                 RTS
03623  F770              SKIPIT = *             ;GO AROUND THIS PATCH
03624  F770              ;
03625  F770              ;*********************************************************************
03626  F770              ;
03627  F770              ;   PATCH TO CHECK FOR RIGHT SHIFT KEY  ON STOP KEY CHECK
03628  F770              ;
03629  F770              ;*********************************************************************
03630  F770              ;
03631  F770                     *=KSP3
03632  E4CF              STPTCH






TIME FUNCTION......PAGE 005D

LINE# LOC   CODE        LINE


03633  E4CF  AA                 TAX             ;SAVE STOP KEY ROW
03634  E4D0  38                 SEC
03635  E4D1  2E 20 91           ROL COLM        ;LOOK AT NEXT ROW FOR THIS COLUMN
03636  E4D4  AD 21 91           LDA ROWS
03637  E4D7  6E 20 91           ROR COLM        ;PUT IT BACK THE WAY IT WAS
03638  E4DA  29 40              AND #$40        ;CHECK RIGHT SHIFT KEY BIT
03639  E4DC  F0 03              BEQ ITSSET      ;BRANCH IF RIGHT SHIFT IS DOWN
03640  E4DE              ;
03641  E4DE  86 91              STX STKEY       ;ELSE LEAVE IT AS IT IS
03642  E4E0  60                 RTS
03643  E4E1              ;
03644  E4E1  8A          ITSSET TXA
03645  E4E2  29 FD              AND #$FD        ;CLEAR THE SHIFT BIT
03646  E4E4  85 91              STA STKEY       ;ITS NOT THE STOP KEY ALONE
03647  E4E6  60                 RTS
03648  E4E7              ;
03649  E4E7              KSP4   = *
03650  E4E7                     *=SKIPIT
03651  F770              .END
03652  F770              .LIB   ERRORHANDLER









































ERROR HANDLER......PAGE 005E

LINE# LOC   CODE        LINE


03654  F770              ;***************************************
03655  F770              ;* STOP -- CHECK STOP KEY FLAG AND     *
03656  F770              ;* RETURN Z FLAG SET IF FLAG TRUE.     *
03657  F770              ;* ALSO CLOSES ACTIVE CHANNELS AND     *
03658  F770              ;* FLUSHES KEYBOARD QUEUE.             *
03659  F770              ;* ALSO RETURNS KEY DOWNS FROM LAST    *
03660  F770              ;* KEYBOARD ROW IN .A.                 *
03661  F770              ;***************************************
03662  F770  A5 91       NSTOP  LDA STKEY       ;VALUE OF LAST ROW
03663  F772  C9 FE              CMP #$FE        ;CHECK STOP KEY POSITION
03664  F774  D0 07              BNE STOP2       ;NOT DOWN
03665  F776  08                 PHP
03666  F777  20 CC FF           JSR CLRCH       ;CLEAR CHANNELS
03667  F77A  85 C6              STA NDX         ;FLUSH QUEUE
03668  F77C  28                 PLP
03669  F77D  60          STOP2  RTS





03671  F77E              ;************************************
03672  F77E              ;*                                  *
03673  F77E              ;* ERROR HANDLER                    *
03674  F77E              ;*                                  *
03675  F77E              ;* PRINTS KERNAL ERROR MESSAGE IF   *
03676  F77E              ;* BIT 6 OF MSGFLG SET.  RETURNS    *
03677  F77E              ;* WITH ERROR # IN .A AND CARRY.    *
03678  F77E              ;*                                  *
03679  F77E              ;************************************
03680  F77E              ;
03681  F77E  A9 01       ERROR1 LDA #1          ;TOO MANY FILES
03682  F780  2C                 .BYT $2C
03683  F781  A9 02       ERROR2 LDA #2          ;FILE OPEN
03684  F783  2C                 .BYT $2C
03685  F784  A9 03       ERROR3 LDA #3          ;FILE NOT OPEN
03686  F786  2C                 .BYT $2C
03687  F787  A9 04       ERROR4 LDA #4          ;FILE NOT FOUND
03688  F789  2C                 .BYT $2C
03689  F78A  A9 05       ERROR5 LDA #5          ;DEVICE NOT PRESENT
03690  F78C  2C                 .BYT $2C
03691  F78D  A9 06       ERROR6 LDA #6          ;NOT INPUT FILE
03692  F78F  2C                 .BYT $2C
03693  F790  A9 07       ERROR7 LDA #7          ;NOT OUTPUT FILE
03694  F792  2C                 .BYT $2C
03695  F793  A9 08       ERROR8 LDA #8          ;MISSING FILE NAME
03696  F795  2C                 .BYT $2C
03697  F796  A9 09       ERROR9 LDA #9          ;BAD DEVICE #
03698  F798              ;
03699  F798  48                 PHA             ;ERROR NUMBER ON STACK
03700  F799  20 CC FF           JSR CLRCH       ;RESTORE I/O CHANNELS
03701  F79C              ;
03702  F79C  A0 00              LDY #MS1-MS1
03703  F79E  24 9D              BIT MSGFLG      ;ARE WE PRINTING ERROR?
03704  F7A0  50 0A              BVC EREXIT      ;NO...






ERROR HANDLER......PAGE 005F

LINE# LOC   CODE        LINE


03705  F7A2              ;
03706  F7A2  20 E6 F1           JSR MSG         ;PRINT "CBM I/O ERROR #"
03707  F7A5  68                 PLA
03708  F7A6  48                 PHA
03709  F7A7  09 30              ORA #$30        ;MAKE ERROR # ASCII
03710  F7A9  20 D2 FF           JSR BSOUT       ;PRINT IT
03711  F7AC              ;
03712  F7AC  68          EREXIT PLA
03713  F7AD  38                 SEC
03714  F7AE  60                 RTS
03715  F7AF              .END
03716  F7AF              .LIB   TAPEFILE

















































TAPE FILES......PAGE 0060

LINE# LOC   CODE        LINE


03718  F7AF              ;FAH -- FIND ANY HEADER
03719  F7AF              ;
03720  F7AF              ;READS TAPE DEVICE UNTIL ONE OF FOLLOWING
03721  F7AF              ;BLOCK TYPES FOUND: BDFH--BASIC DATA
03722  F7AF              ;FILE HEADER, BLF--BASIC LOAD FILE
03723  F7AF              ;FOR SUCCESS CARRY IS CLEAR ON RETURN.
03724  F7AF              ;FOR FAILURE CARRY IS SET ON RETURN.
03725  F7AF              ;IN ADDITION ACCUMULATOR IS 0 IF STOP
03726  F7AF              ;KEY WAS PRESSED.
03727  F7AF  A5 93       FAH    LDA VERCK       ;SAVE OLD VERIFY
03728  F7B1  48                 PHA
03729  F7B2  20 C0 F8           JSR RBLK        ;READ TAPE BLOCK
03730  F7B5  68                 PLA
03731  F7B6  85 93              STA VERCK       ;RESTORE VERIFY FLAG
03732  F7B8  B0 2C              BCS FAH40       ;READ TERMINATED
03733  F7BA              ;
03734  F7BA  A0 00              LDY #0
03735  F7BC  B1 B2              LDA (TAPE1)Y    ;GET HEADER TYPE
03736  F7BE              ;
03737  F7BE  C9 05              CMP #EOT        ;CHECK END OF TAPE?
03738  F7C0  F0 24              BEQ FAH40       ;YES...FAILURE
03739  F7C2              ;
03740  F7C2  C9 01              CMP #BLF        ;BASIC LOAD FILE?
03741  F7C4  F0 08              BEQ FAH50       ;YES...SUCCESS
03742  F7C6              ;
03743  F7C6  C9 03              CMP #PLF        ;FIXED LOAD FILE?
03744  F7C8  F0 04              BEQ FAH50       ;YES...SUCCESS
03745  F7CA              ;
03746  F7CA  C9 04              CMP #BDFH       ;BASIC DATA FILE?
03747  F7CC  D0 E1              BNE FAH         ;NO...KEEP TRYING
03748  F7CE              ;
03749  F7CE  AA          FAH50  TAX             ;RETURN FILE TYPE IN .X
03750  F7CF  24 9D              BIT MSGFLG      ;PRINTING MESSAGES?
03751  F7D1  10 11              BPL FAH45       ;NO...
03752  F7D3              ;
03753  F7D3  A0 63              LDY #MS17-MS1   ;PRINT "FOUND"
03754  F7D5  20 E6 F1           JSR MSG
03755  F7D8              ;
03756  F7D8              ;OUTPUT COMPLETE FILE NAME
03757  F7D8              ;
03758  F7D8  A0 05              LDY #5
03759  F7DA  B1 B2       FAH55  LDA (TAPE1)Y
03760  F7DC  20 D2 FF           JSR BSOUT
03761  F7DF  C8                 INY
03762  F7E0  C0 15              CPY #21
03763  F7E2  D0 F6              BNE FAH55
03764  F7E4  18          FAH45  CLC             ;SUCCESS FLAG
03765  F7E5  88                 DEY             ;MAKE NONZERO FOR OKAY RETURN
03766  F7E6              ;
03767  F7E6  60          FAH40  RTS











TAPE FILES......PAGE 0061

LINE# LOC   CODE        LINE


03769  F7E7              ;TAPEH--WRITE TAPE HEADER
03770  F7E7              ;ERROR IF TAPE BUFFER DE-ALLOCATED
03771  F7E7              ;CARRY CLEAR IF O.K.
03772  F7E7              ;
03773  F7E7  85 9E       TAPEH  STA T1
03774  F7E9              ;
03775  F7E9              ;DETERMINE ADDRESS OF BUFFER
03776  F7E9              ;
03777  F7E9  20 4D F8           JSR ZZZ
03778  F7EC  90 5E              BCC TH40        ;BUFFER WAS DE-ALLOCATED
03779  F7EE              ;
03780  F7EE              ;PRESERVE START AND END ADDRESSES
03781  F7EE              ;FOR CASE OF HEADER FOR LOAD FILE
03782  F7EE              ;
03783  F7EE  A5 C2              LDA STAH
03784  F7F0  48                 PHA
03785  F7F1  A5 C1              LDA STAL
03786  F7F3  48                 PHA
03787  F7F4  A5 AF              LDA EAH
03788  F7F6  48                 PHA
03789  F7F7  A5 AE              LDA EAL
03790  F7F9  48                 PHA
03791  F7FA              ;
03792  F7FA              ;PUT BLANKS IN TAPE BUFFER
03793  F7FA              ;
03794  F7FA  A0 BF              LDY #BUFSZ-1
03795  F7FC  A9 20              LDA #' 
03796  F7FE  91 B2       BLNK2  STA (TAPE1)Y
03797  F800  88                 DEY
03798  F801  D0 FB              BNE BLNK2
03799  F803              ;
03800  F803              ;PUT BLOCK TYPE IN HEADER
03801  F803              ;
03802  F803  A5 9E              LDA T1
03803  F805  91 B2              STA (TAPE1)Y
03804  F807              ;
03805  F807              ;PUT START LOAD ADDRESS IN HEADER
03806  F807              ;
03807  F807  C8                 INY
03808  F808  A5 C1              LDA STAL
03809  F80A  91 B2              STA (TAPE1)Y
03810  F80C  C8                 INY
03811  F80D  A5 C2              LDA STAH
03812  F80F  91 B2              STA (TAPE1)Y
03813  F811              ;
03814  F811              ;PUT END LOAD ADDRESS IN HEADER
03815  F811              ;
03816  F811  C8                 INY
03817  F812  A5 AE              LDA EAL
03818  F814  91 B2              STA (TAPE1)Y
03819  F816  C8                 INY
03820  F817  A5 AF              LDA EAH
03821  F819  91 B2              STA (TAPE1)Y
03822  F81B              ;
03823  F81B              ;PUT FILE NAME IN HEADER






TAPE FILES......PAGE 0062

LINE# LOC   CODE        LINE


03824  F81B              ;
03825  F81B  C8                 INY
03826  F81C  84 9F              STY T2
03827  F81E  A0 00              LDY #0
03828  F820  84 9E              STY T1
03829  F822  A4 9E       TH20   LDY T1
03830  F824  C4 B7              CPY FNLEN
03831  F826  F0 0C              BEQ TH30
03832  F828  B1 BB              LDA (FNADR)Y
03833  F82A  A4 9F              LDY T2
03834  F82C  91 B2              STA (TAPE1)Y
03835  F82E  E6 9E              INC T1
03836  F830  E6 9F              INC T2
03837  F832  D0 EE              BNE TH20
03838  F834              ;
03839  F834              ;SET UP START AND END ADDRESS OF HEADER
03840  F834              ;
03841  F834  20 54 F8    TH30   JSR LDAD1
03842  F837              ;
03843  F837              ;SET UP TIME FOR LEADER
03844  F837              ;
03845  F837  A9 69              LDA #$69
03846  F839  85 AB              STA SHCNH
03847  F83B              ;
03848  F83B  20 EA F8           JSR TWRT2       ;WRITE HEADER ON TAPE
03849  F83E              ;
03850  F83E              ;RESTORE START AND END ADDRESS OF
03851  F83E              ;LOAD FILE.
03852  F83E              ;
03853  F83E  A8                 TAY             ;SAVE ERROR CODE IN .Y
03854  F83F  68                 PLA
03855  F840  85 AE              STA EAL
03856  F842  68                 PLA 
03857  F843  85 AF              STA EAH
03858  F845  68                 PLA
03859  F846  85 C1              STA STAL
03860  F848  68                 PLA
03861  F849  85 C2              STA STAH
03862  F84B  98                 TYA             ;RESTORE ERROR CODE FOR RETURN
03863  F84C              ;
03864  F84C  60          TH40   RTS





03866  F84D              ;FUNCTION TO RETURN TAPE BUFFER
03867  F84D              ;ADDRESS IN TAPE1
03868  F84D              ;
03869  F84D  A6 B2       ZZZ    LDX TAPE1       ;ASSUME TAPE1
03870  F84F  A4 B3              LDY TAPE1+1
03871  F851  C0 02              CPY #>BUF       ;CHECK FOR ALLOCATION...
03872  F853              ;...[TAPE1+1]=0 OR 1 MEANS DEALLOCATED
03873  F853              ;...C CLR => DEALLOCATED
03874  F853  60                 RTS






TAPE FILES......PAGE 0063

LINE# LOC   CODE        LINE


03876  F854  20 4D F8    LDAD1  JSR ZZZ         ;GET PTR TO CASSETTE
03877  F857  8A                 TXA
03878  F858  85 C1              STA STAL        ;SAVE START LOW
03879  F85A  18                 CLC
03880  F85B  69 C0              ADC #BUFSZ      ;COMPUTE POINTER TO END
03881  F85D  85 AE              STA EAL         ;SAVE END LOW
03882  F85F  98                 TYA
03883  F860  85 C2              STA STAH        ;SAVE START HIGH
03884  F862  69 00              ADC #0          ;COMPUTE POINTER TO END
03885  F864  85 AF              STA EAH         ;SAVE END HIGH
03886  F866  60                 RTS





03888  F867  20 AF F7    FAF    JSR FAH         ;FIND ANY HEADER
03889  F86A  B0 1D              BCS FAF40       ;FAILED
03890  F86C              ;
03891  F86C              ;SUCCESS...SEE IF RIGHT NAME
03892  F86C              ;
03893  F86C  A0 05              LDY #5          ;OFFSET INTO TAPE HEADER
03894  F86E  84 9F              STY T2
03895  F870  A0 00              LDY #0          ;OFFSET INTO FILE NAME
03896  F872  84 9E              STY T1
03897  F874  C4 B7       FAF20  CPY FNLEN       ;COMPARE THIS MANY
03898  F876  F0 10              BEQ FAF30       ;DONE
03899  F878              ;
03900  F878  B1 BB              LDA (FNADR)Y
03901  F87A  A4 9F              LDY T2
03902  F87C  D1 B2              CMP (TAPE1)Y
03903  F87E  D0 E7              BNE FAF         ;MISMATCH--TRY NEXT HEADER
03904  F880  E6 9E              INC T1
03905  F882  E6 9F              INC T2
03906  F884  A4 9E              LDY T1
03907  F886  D0 EC              BNE FAF20       ;BRANCH ALWAYS
03908  F888              ;
03909  F888  18          FAF30  CLC             ;SUCCESS FLAG
03910  F889  60          FAF40  RTS
03911  F88A              .END
03912  F88A              .LIB   TAPECONTROL




















TAPE CONTROL......PAGE 0064

LINE# LOC   CODE        LINE


03914  F88A  20 4D F8    JTP20  JSR ZZZ
03915  F88D  E6 A6              INC BUFPT
03916  F88F  A4 A6              LDY BUFPT
03917  F891  C0 C0              CPY #BUFSZ
03918  F893  60                 RTS





03920  F894              ;STAYS IN ROUTINE D2T1LL PLAY SWITCH
03921  F894              ;
03922  F894  20 AB F8    CSTE1  JSR CS10
03923  F897  F0 1C              BEQ CS25
03924  F899  A0 1B              LDY #MS7-MS1    ;"PRESS PLAY..."
03925  F89B  20 E6 F1    CS30   JSR MSG
03926  F89E  20 4B F9    CS40   JSR TSTOP       ;WATCH FOR STOP KEY
03927  F8A1  20 AB F8           JSR CS10        ;WATCH CASSETTE SWITCHES
03928  F8A4  D0 F8              BNE CS40
03929  F8A6  A0 6A              LDY #MS18-MS1   ;"OK"
03930  F8A8  4C E6 F1           JMP MSG





03932  F8AB              ;SUBR RETURNS <> FOR CASSETTE SWITCH
03933  F8AB              ;
03934  F8AB  A9 40       CS10   LDA #$40        ;CHECK PORT
03935  F8AD  2C 1F 91           BIT D1ORA       ;CLOSED?...
03936  F8B0  D0 03              BNE CS25        ;NO. . .
03937  F8B2  2C 1F 91           BIT D1ORA       ;CHECK AGAIN TO DEBOUNCE
03938  F8B5  18          CS25   CLC             ;GOOD RETURN
03939  F8B6  60                 RTS





03941  F8B7              ;CHECKS FOR PLAY & RECORD
03942  F8B7              ;
03943  F8B7  20 AB F8    CSTE2  JSR CS10
03944  F8BA  F0 F9              BEQ CS25
03945  F8BC  A0 2E              LDY #MS8-MS1    ;"RECORD"
03946  F8BE  D0 DB              BNE CS30





03948  F8C0              ;READ HEADER BLOCK ENTRY
03949  F8C0              ;
03950  F8C0  A9 00       RBLK   LDA #0
03951  F8C2  85 90              STA STATUS
03952  F8C4  85 93              STA VERCK






TAPE CONTROL......PAGE 0065

LINE# LOC   CODE        LINE


03953  F8C6  20 54 F8           JSR LDAD1



03955  F8C9              ;READ LOAD BLOCK ENTRY
03956  F8C9              ;
03957  F8C9  20 94 F8    TRD    JSR CSTE1       ;SAY 'PRESS PLAY'
03958  F8CC  B0 1F              BCS TWRT3       ;STOP KEY PRESSED
03959  F8CE  78                 SEI
03960  F8CF  A9 00              LDA #0          ;CLEAR FLAGS...
03961  F8D1  85 AA              STA RDFLG
03962  F8D3  85 B4              STA SNSW1
03963  F8D5  85 B0              STA CMP0
03964  F8D7  85 9E              STA PTR1
03965  F8D9  85 9F              STA PTR2
03966  F8DB  85 9C              STA DPSW
03967  F8DD  A9 82              LDA #$82        ;ENABLE FOR CA1 IRQ...READ LINE
03968  F8DF  A2 0E              LDX #14         ;POINT IRQ VECTOR TO READ
03969  F8E1  D0 11              BNE TAPE        ;JMP





03971  F8E3              ;WRITE HEADER BLOCK ENTRY
03972  F8E3              ;
03973  F8E3  20 54 F8    WBLK   JSR LDAD1
03974  F8E6              ;
03975  F8E6              ;WRITE LOAD BLOCK ENTRY
03976  F8E6              ;
03977  F8E6  A9 14       TWRT   LDA #20         ;BETWEEN BLOCK SHORTS
03978  F8E8  85 AB              STA SHCNH
03979  F8EA  20 B7 F8    TWRT2  JSR CSTE2       ;SAY 'PRESS PLAY & RECORD'
03980  F8ED  B0 68       TWRT3  BCS STOP3       ;STOP KEY PRESSED
03981  F8EF  78                 SEI
03982  F8F0  A9 A0              LDA #$A0        ;ENABLE T2 IRQS...WRITE TIME
03983  F8F2  A2 08              LDX #8          ;VECTOR IRQ TO WRTZ





03985  F8F4              ;START TAPE OPERATION ENTRY POINT
03986  F8F4              ;
03987  F8F4  A0 7F       TAPE   LDY #$7F        ;KILL UNWANTED IRQ'S
03988  F8F6  8C 2E 91           STY D2IER
03989  F8F9  8D 2E 91           STA D2IER       ;TURN ON WANTED
03990  F8FC              ; WAIT FOR RS-232 TO FINISH
03991  F8FC  20 60 F1           JSR RSP232
03992  F8FF              ; MOVE IRQ TO IRQTEMP FOR CASS OPS
03993  F8FF  AD 14 03           LDA CINV
03994  F902  8D 9F 02           STA IRQTMP
03995  F905  AD 15 03           LDA CINV+1
03996  F908  8D A0 02           STA IRQTMP+1
03997  F90B  20 FB FC           JSR BSIV        ;GO CHANGE IRQ VECTOR






TAPE CONTROL......PAGE 0066

LINE# LOC   CODE        LINE


03998  F90E  A9 02              LDA #2          ;FSBLK STARTS AT 2
03999  F910  85 BE              STA FSBLK
04000  F912  20 DB FB           JSR NEWCH       ;PREP LOCAL COUNTERS AND FLAGS
04001  F915  AD 1C 91           LDA D1PCR       ;TURN MOTOR ON
04002  F918  29 FD              AND #$FD        ;LOW TURNS ON
04003  F91A  09 0C              ORA #$0C        ;MAKE SURE
04004  F91C  8D 1C 91           STA D1PCR
04005  F91F  85 C0              STA CAS1        ;FLAG INTERNAL CONTROL OF CASS MOTOR
04006  F921  A2 FF              LDX #$FF        ;DELAY BETWEEN BLOCKS
04007  F923  A0 FF       TP32   LDY #$FF
04008  F925  88          TP35   DEY
04009  F926  D0 FD              BNE TP35
04010  F928  CA                 DEX
04011  F929  D0 F8              BNE TP32
04012  F92B  8D 29 91           STA D2T2H
04013  F92E  58                 CLI
04014  F92F  AD A0 02    TP40   LDA IRQTMP+1    ;CHECK FOR INTERRUPT VECTOR...
04015  F932  CD 15 03           CMP CINV+1      ;...POINTING AT KEY ROUTINE
04016  F935  18                 CLC
04017  F936  F0 1F              BEQ STOP3       ;...YES RETURN
04018  F938  20 4B F9           JSR TSTOP       ;...NO CHECK FOR STOP KEY
04019  F93B  AD 2D 91           LDA D2IFR
04020  F93E  29 40              AND #$40        ; CHECK FOR T1 IRQ
04021  F940  F0 ED              BEQ TP40        ;...NO
04022  F942  AD 14 91           LDA D1T1L       ; KILL T1 IRQ REQUEST
04023  F945  20 34 F7           JSR UDTIM       ; STOP KEY CHECK
04024  F948  4C 2F F9           JMP TP40        ;STAY IN LOOP UNTILL TAPES ARE DONE





04026  F94B  20 E1 FF    TSTOP  JSR STOP        ;STOP KEY DOWN?
04027  F94E  18                 CLC             ;ASSUME NO STOP
04028  F94F  D0 0B              BNE STOP4       ;WE WERE RIGHT
04029  F951              ;
04030  F951              ;STOP KEY DOWN...
04031  F951              ;
04032  F951  20 CF FC           JSR TNIF        ;TURN OFF CASSETTES
04033  F954  38                 SEC             ;FAILURE FLAG
04034  F955  68                 PLA             ;BACK ONE SQUARE...
04035  F956  68                 PLA
04036  F957              ; LDA #0 ;STOP KEY FLAG
04037  F957              ;
04038  F957  A9 00       STOP3  LDA #0          ;DEALLOCATE IRQTMP
04039  F959  8D A0 02           STA IRQTMP+1    ;IF C-SET THEN STOP KEY
04040  F95C  60          STOP4  RTS





04042  F95D              ;
04043  F95D              ; STT1 - SET UP TIMEOUT WATCH FOR NEXT DIPOLE
04044  F95D              ;






TAPE CONTROL......PAGE 0067

LINE# LOC   CODE        LINE


04045  F95D  86 B1       STT1   STX TEMP        ;.X HAS CONSTANT FOR TIMEOUT
04046  F95F  A5 B0              LDA CMP0        ;CMP0*5
04047  F961  0A                 ASL A
04048  F962  0A                 ASL A
04049  F963  18                 CLC
04050  F964  65 B0              ADC CMP0
04051  F966  18                 CLC 
04052  F967  65 B1              ADC TEMP        ;ADJUST LONG BYTE COUNT
04053  F969  85 B1              STA TEMP
04054  F96B  A9 00              LDA #0
04055  F96D  24 B0              BIT CMP0        ;CHECK CMP0 ...
04056  F96F  30 01              BMI STT2        ;...MINUS, NO ADJUST
04057  F971  2A                 ROL A           ;...PLUS SO ADJUST POS
04058  F972  06 B1       STT2   ASL TEMP        ;MULTIPLY CORRECTED VALUE BY 4
04059  F974  2A                 ROL A
04060  F975  06 B1              ASL TEMP
04061  F977  2A                 ROL A
04062  F978  AA                 TAX
04063  F979  AD 28 91    STT3   LDA D2T2L       ;WATCH OUT FOR D2T2H ROLLOVER...
04064  F97C  C9 15              CMP #21         ;...TIME FOR ROUTINE...!!!...
04065  F97E  90 F9              BCC STT3        ;...TOO CLOSE SO WAIT UND2T1LL PAST
04066  F980  65 B1              ADC TEMP        ;CALCULATE AND...
04067  F982  8D 24 91           STA D2T1L       ;...STORE ADUSTED TIME COUNT
04068  F985  8A                 TXA
04069  F986  6D 29 91           ADC D2T2H       ;ADJUST FOR HIGH TIME COUNT
04070  F989  8D 25 91           STA D2T1H
04071  F98C  58                 CLI             ;ALLOW FOR RE-ENTRY CODE
04072  F98D  60                 RTS
04073  F98E              .END
04074  F98E              .LIB   READ































CASSETTE READ......PAGE 0068

LINE# LOC   CODE        LINE


04076  F98E              ; VARIABLES USED IN CASSETTE READ ROUTINES
04077  F98E              ;
04078  F98E              ;  REZ - COUNTS ZEROS (IF Z THEN CORRECT # OF DIPOLES)
04079  F98E              ;  RER - FLAGS ERRORS (IF Z THEN NO ERROR)
04080  F98E              ;  DIFF - USED TO PRESERVE SYNO (OUTSIDE OF BIT ROUTINES)
04081  F98E              ;  SYNO - FLAGS IF WE HAVE BLOCK SYNC (16 ZERO DIPOLES)
04082  F98E              ;  SNSW1 - FLAGS IF WE HAVE BYTE SYNC (A LONGLONG)
04083  F98E              ;  DATA - HOLDS MOST RECENT DIPOLE BIT VALUE
04084  F98E              ;  MYCH - HOLDS INPUT BYTE BEING BUILT
04085  F98E              ;  FIRT - USED TO INDICATE WHICH HALF OF DIPOLE WE'RE IN
04086  F98E              ;  SVXT - TEMP USED TO ADJUST SOFTWARE SERVO
04087  F98E              ;  TEMP - USED TO HOLD DIPOLE TIME DURING TYPE CALCULATIONS
04088  F98E              ;  PRTY - HOLDS CURRENT CALCULATED PARITY BIT
04089  F98E              ;  PRP - HAS COMBINED ERROR VALUES FROM BIT ROUTINES
04090  F98E              ;  FSBLK - INDICATE WHICH BLOCK WE'RE LOOKING AT (0 TO EXIT)
04091  F98E              ;  SHCNL - HOLDS FSBLK, USED TO DIRECT ROUTINES, BECAUSE OF EXIT CASE
04092  F98E              ;  RDFLG - HOLDS FUNCTION MODE
04093  F98E              ;     MI - WAITING FOR BLOCK SYNC
04094  F98E              ;     VS - IN DATA BLOCK READING DATA
04095  F98E              ;     NE - WAITING FOR BYTE SYNC
04096  F98E              ;  SAL - INDIRECT TO DATA STORAGE AREA
04097  F98E              ;  SHCNH - LEFT OVER FROM DEBUGGING
04098  F98E              ;  BAD - STORAGE SPACE FOR BAD READ LOCATIONS (BOTTOM OF STACK)
04099  F98E              ;  PTR1 - COUNT OF READ LOCATIONS IN ERROR (POINTER INTO BAD, MAX 61)
04100  F98E              ;  PTR2 - COUNT OF RE-READ LOCATIONS (POINTER INTO BAD, DURING RE-READ)
04101  F98E              ;  VERCHK - VERIFY OR LOAD FLAG (Z - LOADING)
04102  F98E              ;


































CASSETTE READ......PAGE 0069

LINE# LOC   CODE        LINE


04104  F98E  AE 29 91    READ   LDX D2T2H       ;GET TIME SINCE LAST INTERRUPT
04105  F991  A0 FF              LDY #$FF        ;COMPUTE COUNTER DIFFERENCE
04106  F993  98                 TYA
04107  F994  ED 28 91           SBC D2T2L
04108  F997  EC 29 91           CPX D2T2H       ;CHECK FOR TIMER HIGH ROLLOVER...
04109  F99A  D0 F2              BNE READ        ;...YES THEN RECOMPUTE
04110  F99C  86 B1              STX TEMP
04111  F99E  AA                 TAX
04112  F99F  8C 28 91           STY D2T2L       ;RELOAD TIMER2 (COUNT DOWN FROM $FFFF)
04113  F9A2  8C 29 91           STY D2T2H
04114  F9A5  98                 TYA
04115  F9A6  E5 B1              SBC TEMP        ;CALCULATE HIGH
04116  F9A8  86 B1              STX TEMP
04117  F9AA  4A                 LSR A           ;MOVE TWO BITS FROM HIGH TO TEMP
04118  F9AB  66 B1              ROR TEMP
04119  F9AD  4A                 LSR A
04120  F9AE  66 B1              ROR TEMP
04121  F9B0  A5 B0              LDA CMP0        ;CALC MIN PULSE VALUE
04122  F9B2  18                 CLC
04123  F9B3  69 3C              ADC #60
04124  F9B5  2C 21 91           BIT D2ORAH      ;CLEAR READ INTERRUPT FLAG
04125  F9B8  C5 B1              CMP TEMP        ;IF PULSE LESS THAN MIN...
04126  F9BA  B0 4A              BCS RDBK        ;...THEN IGNORE AS NOISE
04127  F9BC  A6 9C              LDX DPSW        ;CHECK IF LAST BIT...
04128  F9BE  F0 03              BEQ RJDJ        ;...NO THEN CONTINUE
04129  F9C0  4C AD FA           JMP RADJ        ;...YES THEN GO FINISH BYTE


04131  F9C3  A6 A3       RJDJ   LDX PCNTR       ;IF 9 BITS READ...
04132  F9C5  30 1B              BMI JRAD2       ;... THEN GOTO ENDING
04133  F9C7  A2 00              LDX #0          ;SET BIT VALUE TO ZERO
04134  F9C9  69 30              ADC #48         ;ADD UP TO HALF WAY BETWEEN...
04135  F9CB  65 B0              ADC CMP0        ;...SHORT PULSE AND SYNC PULSE
04136  F9CD  C5 B1              CMP TEMP        ;CHECK FOR SHORT...
04137  F9CF  B0 1C              BCS RADX2       ;...YES IT'S A SHORT
04138  F9D1  E8                 INX             ;SET BIT VALUE TO ONE
04139  F9D2  69 26              ADC #38         ;MOVE TO MIDDLE OF HIGH
04140  F9D4  65 B0              ADC CMP0
04141  F9D6  C5 B1              CMP TEMP        ;CHECK FOR ONE...
04142  F9D8  B0 17              BCS RADL        ;...YES IT'S A ONE
04143  F9DA  69 2C              ADC #44         ;MOVE TO LONGLONG
04144  F9DC  65 B0              ADC CMP0
04145  F9DE  C5 B1              CMP TEMP        ;CHECK FOR LONGLONG...
04146  F9E0  90 03              BCC SRER        ;...GREATER THAN IS ERROR
04147  F9E2  4C 60 FA    JRAD2  JMP RAD2        ;...IT'S A LONGLONG


04149  F9E5  A5 B4       SRER   LDA SNSW1       ;IF NOT SYNCRONIZED...
04150  F9E7  F0 1D              BEQ RDBK        ;...THEN NO ERROR
04151  F9E9  85 A8              STA RER         ;...ELSE FLAG RER
04152  F9EB  D0 19              BNE RDBK        ;JMP


04154  F9ED  E6 A9       RADX2  INC REZ         ;COUNT REZ UP ON ZEROS
04155  F9EF  B0 02              BCS RAD5        ;JMP






CASSETTE READ......PAGE 006A

LINE# LOC   CODE        LINE


04156  F9F1  C6 A9       RADL   DEC REZ         ;COUNT REZ DOWN ON ONES
04157  F9F3  38          RAD5   SEC             ;CALC ACTUAL VALUE FOR COMPARE STORE
04158  F9F4  E9 13              SBC #19
04159  F9F6  E5 B1              SBC TEMP        ;SUBTRACT INPUT VALUE FROM CONSTANT...
04160  F9F8  65 92              ADC SVXT        ;...ADD DIFFERENCE TO TEMP STORAGE...
04161  F9FA  85 92              STA SVXT        ;...USED LATER TO ADJUST SOFT SERVO
04162  F9FC  A5 A4              LDA FIRT        ;FLIP DIPOLE FLAG
04163  F9FE  49 01              EOR #1
04164  FA00  85 A4              STA FIRT
04165  FA02  F0 21              BEQ RAD3        ;SECOND HALF OF DIPOLE
04166  FA04  86 D7              STX DATA        ;FIRST HALF SO STORE ITS VALUE



04168  FA06  A5 B4       RDBK   LDA SNSW1       ;IF NO BYTE START...
04169  FA08  F0 18              BEQ RADBK       ;...THEN RETURN
04170  FA0A  2C 2D 91           BIT D2IFR       ;CHECK TO SEE IF TIMER1 IRQD US...
04171  FA0D  50 13              BVC RADBK       ;...NO, SO EXIT
04172  FA0F  A9 00              LDA #0          ;...YES, SET DIPOLE FLAG FOR FIRST HALF
04173  FA11  85 A4              STA FIRT
04174  FA13  A5 A3              LDA PCNTR       ;CHECK WHERE WE ARE IN BYTE...
04175  FA15  10 30              BPL RAD4        ;...DOING DATA
04176  FA17  30 C9              BMI JRAD2       ;...PROCESS PARITY


04178  FA19  A2 A6       RADP   LDX #166        ;SET UP FOR LONGLONG TIMEOUT
04179  FA1B  20 5D F9           JSR STT1
04180  FA1E  A5 9B              LDA PRTY        ;IF PARITY NOT EVEN...
04181  FA20  D0 C3              BNE SRER        ;...THEN GO SET ERROR
04182  FA22  4C 56 FF    RADBK  JMP PREND       ;GO RESTORE REGS AND RTI



04184  FA25  A5 92       RAD3   LDA SVXT        ;ADJUST THE SOFTWARE SERVO (CMP0)
04185  FA27  F0 07              BEQ ROUT1       ;NO ADJUST
04186  FA29  30 03              BMI ROUT2       ;ADJUST FOR MORE BASE TIME
04187  FA2B  C6 B0              DEC CMP0        ;ADJUST FOR LESS BASE TIME
04188  FA2D  2C                 .BYT $2C        ;SKIP TWO BYTES
04189  FA2E  E6 B0       ROUT2  INC CMP0
04190  FA30  A9 00       ROUT1  LDA #0          ;CLEAR DIFFERENCE VALUE
04191  FA32  85 92              STA SVXT
04192  FA34              ;CHECK FOR CONSECUTIVE LIKE VALUES IN DIPOLE...
04193  FA34  E4 D7              CPX DATA
04194  FA36  D0 0F              BNE RAD4        ;...NO, GO PROCESS INFO
04195  FA38  8A                 TXA             ;...YES SO CHECK THE VALUES...
04196  FA39  D0 AA              BNE SRER        ;IF THEY WERE ONES THEN  ERROR
04197  FA3B              ; CONSECUTIVE ZEROS
04198  FA3B  A5 A9              LDA REZ         ;...CHECK HOW MANY ZEROS HAVE HAPPENED
04199  FA3D  30 C7              BMI RDBK        ;...IF MANY DON'T CHECK
04200  FA3F  C9 10              CMP #16         ;... DO WE HAVE 16 YET?...
04201  FA41  90 C3              BCC RDBK        ;....NO SO CONTINUE
04202  FA43  85 96              STA SYNO        ;....YES SO FLAG SYNO (BETWEEN BLOCKS)
04203  FA45  B0 BF              BCS RDBK        ;JMP








CASSETTE READ......PAGE 006B

LINE# LOC   CODE        LINE


04205  FA47  8A          RAD4   TXA             ;MOVE READ DATA TO .A
04206  FA48  45 9B              EOR PRTY        ;CALCULATE PARITY
04207  FA4A  85 9B              STA PRTY
04208  FA4C  A5 B4              LDA SNSW1       ;REAL DATA?...
04209  FA4E  F0 D2              BEQ RADBK       ;...NO SO FORGET BY EXITING
04210  FA50  C6 A3              DEC PCNTR       ;DEC BIT COUNT
04211  FA52  30 C5              BMI RADP        ;IF MINUS THEN  TIME FOR PARITY
04212  FA54  46 D7              LSR DATA        ;SHIFT BIT FROM DATA...
04213  FA56  66 BF              ROR MYCH        ;...INTO BYTE STORAGE (MYCH) BUFFER
04214  FA58  A2 DA              LDX #218        ;SET UP FOR NEXT DIPOLE
04215  FA5A  20 5D F9           JSR STT1
04216  FA5D  4C 56 FF           JMP PREND       ;RESTORE REGS AND RTI



04218  FA60              ; RAD2 - LONGLONG HANDLER (COULD BE A LONG ONE)
04219  FA60  A5 96       RAD2   LDA SYNO        ;HAVE WE GOTTEN BLOCK SYNC...
04220  FA62  F0 04              BEQ RAD2Y       ;...NO
04221  FA64  A5 B4              LDA SNSW1       ;CHECK IF WE'VE HAD A REAL BYTE START...
04222  FA66  F0 04              BEQ RAD2X       ;...NO
04223  FA68  A5 A3       RAD2Y  LDA PCNTR       ;ARE WE AT END OF BYTE...
04224  FA6A  10 85              BPL RADL        ;...NO SO TREAT IT AS A LONG ONE READ


04226  FA6C  46 B1       RAD2X  LSR TEMP        ;ADJUST TIMEOUT FOR...
04227  FA6E  A9 93              LDA #147        ;...LONGLONG PULSE VALUE
04228  FA70  38                 SEC
04229  FA71  E5 B1              SBC TEMP
04230  FA73  65 B0              ADC CMP0
04231  FA75  0A                 ASL A
04232  FA76  AA                 TAX             ;AND SET TIMEOUT FOR LAST BIT
04233  FA77  20 5D F9           JSR STT1
04234  FA7A  E6 9C              INC DPSW        ;SET BIT THROW AWAY FLAG
04235  FA7C  A5 B4              LDA SNSW1       ;IF BYTE SYNCRONIZED....
04236  FA7E  D0 11              BNE RADQ2       ;...THEN SKIP TO PASS CHAR
04237  FA80  A5 96              LDA SYNO        ;THROWS OUT DATA UNTILL BLOCK SYNC...
04238  FA82  F0 26              BEQ RDBK2       ;...NO BLOCK SYNC
04239  FA84  85 A8              STA RER         ;FLAG DATA AS ERROR
04240  FA86  A9 00              LDA #0          ;KILL 16 SYNC FLAG
04241  FA88  85 96              STA SYNO
04242  FA8A  A9 C0              LDA #$C0        ;SET UP FOR TIMER1 INTERRUPTS
04243  FA8C  8D 2E 91           STA D2IER
04244  FA8F  85 B4              STA SNSW1       ;FLAG THAT WE HAVE BYTE SYNCRONIZED
04245  FA91              ;
04246  FA91  A5 96       RADQ2  LDA SYNO        ;SAVE SYNO STATUS
04247  FA93  85 B5              STA DIFF
04248  FA95  F0 09              BEQ RADK        ;NO BLOCK SYNC, NO BYTE LOOKING
04249  FA97  A9 00              LDA #0          ;TURN OFF BYTE SYNC SWITCH
04250  FA99  85 B4              STA SNSW1
04251  FA9B  A9 40              LDA #$40        ;DISABLE TIMER1 INTERRUPTS
04252  FA9D  8D 2E 91           STA D2IER
04253  FAA0  A5 BF       RADK   LDA MYCH        ;PASS CHARACTER TO BYTE ROUTINE
04254  FAA2  85 BD              STA OCHAR
04255  FAA4  A5 A8              LDA RER         ;COMBINE ERROR VALUES WITH ZERO COUNT...
04256  FAA6  05 A9              ORA REZ






CASSETTE READ......PAGE 006C

LINE# LOC   CODE        LINE


04257  FAA8  85 B6              STA PRP         ;...AND SAVE IN PRP
04258  FAAA  4C 56 FF    RDBK2  JMP PREND       ;GO BACK AND GET LAST BYTE


04260  FAAD  20 DB FB    RADJ   JSR NEWCH       ;FINISH BYTE, CLR FLAGS
04261  FAB0  85 9C              STA DPSW        ;CLEAR BIT THROW AWAY FLAG
04262  FAB2  A2 DA              LDX #218        ;INITILIZE FOR NEXT DIPOLE
04263  FAB4  20 5D F9           JSR STT1
04264  FAB7  A5 BE              LDA FSBLK       ;CHECK FOR LAST VALUE
04265  FAB9  F0 02              BEQ RD15
04266  FABB  85 A7              STA SHCNL


















































BYTE HANDLER......PAGE 006D

LINE# LOC   CODE        LINE


04268  FABD              ;*************************************************
04269  FABD              ;* BYTE HANDLER OF CASSETTE READ                 *
04270  FABD              ;*                                               *
04271  FABD              ;* THIS PORTION OF IN LINE CODE IS PASSED THE    *
04272  FABD              ;* BYTE ASSEMBLED FROM READING TAPE IN OCHAR.    *
04273  FABD              ;* RER IS SET IF THE BYTE READ IS IN ERROR.      *
04274  FABD              ;* REZ IS SET IF THE INTERRUPT PROGRAM IS READING*
04275  FABD              ;* ZEROS.  RDFLG TELLS US WHAT WE ARE DOING.     *
04276  FABD              ;* BIT 7 SAYS TO IGNORE BYTES UNTIL REZ IS SET   *
04277  FABD              ;* BIT 6 SAYS TO LOAD THE BYTE. OTHERWISE RDFLG  *
04278  FABD              ;* IS A COUNTDOWN AFTER SYNC.  IF VERCK IS SET   *
04279  FABD              ;* WE DO A COMPARE INSTEAD OF A STORE AND SET    *
04280  FABD              ;* STATUS.  FSBLK COUNTS THE TWO BLOCKS. PTR1 IS *
04281  FABD              ;* INDEX TO ERROR TABLE FOR PASS1.  PTR2 IS INDEX*
04282  FABD              ;* TO CORRECTION TABLE FOR PASS2.                *
04283  FABD              ;*************************************************
04284  FABD              ;
04285  FABD              SPERR=16
04286  FABD              CKERR=32
04287  FABD              SBERR=4
04288  FABD              LBERR=8
04289  FABD              ;
04290  FABD  A9 0F       RD15   LDA #$F
04291  FABF              ;
04292  FABF  24 AA              BIT RDFLG       ;TEST FUNCTION MODE
04293  FAC1  10 17              BPL RD20        ;NOT WAITING FOR ZEROS
04294  FAC3              ;
04295  FAC3  A5 B5              LDA DIFF        ;ZEROS YET?
04296  FAC5  D0 0C              BNE RD12        ;YES...WAIT FOR SYNC
04297  FAC7  A6 BE              LDX FSBLK       ;IS PASS OVER?
04298  FAC9  CA                 DEX             ;...IF FSBLK ZERO THEN NO ERROR (FIRST GOOD)
04299  FACA  D0 0B              BNE RD10        ;NO...
04300  FACC              ;
04301  FACC  A9 08              LDA #LBERR
04302  FACE  20 6A FE           JSR UDST        ;YES...LONG BLOCK ERROR
04303  FAD1  D0 04              BNE RD10        ;BRANCH ALWAYS
04304  FAD3              ;
04305  FAD3  A9 00       RD12   LDA #0
04306  FAD5  85 AA              STA RDFLG       ;NEW MODE IS WAIT FOR SYNC
04307  FAD7  4C 56 FF    RD10   JMP PREND       ;EXIT...DONE
04308  FADA              ;
04309  FADA  70 31       RD20   BVS RD60        ;WE ARE LOADING
04310  FADC  D0 18              BNE RD200       ;WE ARE SYNCING
04311  FADE              ;
04312  FADE  A5 B5              LDA DIFF        ;DO WE HAVE BLOCK SYNC...
04313  FAE0  D0 F5              BNE RD10        ;...YES, EXIT
04314  FAE2  A5 B6              LDA PRP         ;IF FIRST BYTE HAS ERROR...
04315  FAE4  D0 F1              BNE RD10        ;...THEN SKIP (EXIT)
04316  FAE6  A5 A7              LDA SHCNL       ;MOVE FSBLK TO CARRY...
04317  FAE8  4A                 LSR A
04318  FAE9  A5 BD              LDA OCHAR       ; SHOULD BE A HEADER COUNT CHAR
04319  FAEB  30 03              BMI RD22        ;IF NEG THEN FIRSTBLOCK DATA
04320  FAED  90 18              BCC RD40        ;...EXPECTING FIRSTBLOCK DATA...YES
04321  FAEF  18                 CLC
04322  FAF0  B0 15       RD22   BCS RD40        ;EXPECTING SECOND BLOCK?...YES






BYTE HANDLER......PAGE 006E

LINE# LOC   CODE        LINE


04323  FAF2  29 0F              AND #$F         ;MASK OFF HIGH STORE HEADER COUNT...
04324  FAF4  85 AA              STA RDFLG       ;...IN MODE FLAG (HAVE CORRECT BLOCK)
04325  FAF6  C6 AA       RD200  DEC RDFLG       ;WAIT UNTILL WE GET REAL DATA...
04326  FAF8  D0 DD              BNE RD10        ;...9876543210 REAL
04327  FAFA  A9 40              LDA #$40        ;NEXT UP IS REAL DATA...
04328  FAFC  85 AA              STA RDFLG       ;...SET DATA MODE
04329  FAFE  20 D2 FB           JSR RD300       ;GO SETUP ADDRESS POINTERS
04330  FB01  A9 00              LDA #0          ;DEBUG CODE####################################
04331  FB03  85 AB              STA SHCNH
04332  FB05  F0 D0              BEQ RD10        ;JMP TO CONTINUE


04334  FB07  A9 80       RD40   LDA #$80        ;WE WANT TO...
04335  FB09  85 AA              STA RDFLG       ;IGNORE BYTES MODE
04336  FB0B  D0 CA              BNE RD10        ;JMP


04338  FB0D  A5 B5       RD60   LDA DIFF        ;CHECK FOR END OF BLOCK...
04339  FB0F  F0 0A              BEQ RD70        ;...OKAY
04340  FB11              ;
04341  FB11  A9 04              LDA #SBERR      ;SHORT BLOCK ERROR
04342  FB13  20 6A FE           JSR UDST
04343  FB16  A9 00              LDA #0          ;FORCE RDFLG FOR AN END
04344  FB18  4C 97 FB           JMP RD161


04346  FB1B  20 11 FD    RD70   JSR CMPSTE      ;CHECK FOR END OF STORAGE AREA
04347  FB1E  90 03              BCC *+5         ;NOT DONE YET
04348  FB20  4C 95 FB           JMP RD160
04349  FB23  A6 A7              LDX SHCNL       ;CHECK WHICH PASS...
04350  FB25  CA                 DEX
04351  FB26  F0 2D              BEQ RD58        ;...SECOND PASS
04352  FB28  A5 93              LDA VERCK       ;CHECK IF LOAD OR VERIFY...
04353  FB2A  F0 0C              BEQ RD80        ;...LOADING
04354  FB2C  A0 00              LDY #0          ;...JUST VERIFYING
04355  FB2E  A5 BD              LDA OCHAR
04356  FB30  D1 AC              CMP (SAL)Y      ;COMPARE WITH DATA IN PET
04357  FB32  F0 04              BEQ RD80        ;...GOOD SO CONTINUE
04358  FB34  A9 01              LDA #1          ;...BAD SO FLAG...
04359  FB36  85 B6              STA PRP         ;...AS AN ERROR

04361  FB38              ; STORE BAD LOCATIONS FOR SECOND PASS RE-TRY
04362  FB38  A5 B6       RD80   LDA PRP         ;CHK FOR ERRORS...
04363  FB3A  F0 4B              BEQ RD59        ;...NO ERRORS
04364  FB3C  A2 3D              LDX #61         ;MAX ALLOWED IS 30
04365  FB3E  E4 9E              CPX PTR1        ;ARE WE AT MAX?...
04366  FB40  90 3E              BCC RD55        ;...YES, FLAG AS SECOND PASS ERROR
04367  FB42  A6 9E              LDX PTR1        ;GET INDEX INTO BAD...
04368  FB44  A5 AD              LDA SAH         ;...AND STORE THE BAD LOCATION
04369  FB46  9D 01 01           STA BAD+1,X     ;...IN BAD TABLE
04370  FB49  A5 AC              LDA SAL
04371  FB4B  9D 00 01           STA BAD,X
04372  FB4E  E8                 INX             ;ADVANCE POINTER TO NEXT
04373  FB4F  E8                 INX
04374  FB50  86 9E              STX PTR1






BYTE HANDLER......PAGE 006F

LINE# LOC   CODE        LINE


04375  FB52  4C 87 FB           JMP RD59        ;GO STORE CHARACTER


04377  FB55              ; CHECK BAD TABLE FOR RE-TRY (SECOND PASS)
04378  FB55  A6 9F       RD58   LDX PTR2        ;HAVE WE DONE ALL IN THE TABLE?...
04379  FB57  E4 9E              CPX PTR1
04380  FB59  F0 35              BEQ RD90        ;...YES
04381  FB5B  A5 AC              LDA SAL         ;SEE IF THIS IS NEXT IN THE TABLE...
04382  FB5D  DD 00 01           CMP BAD,X
04383  FB60  D0 2E              BNE RD90        ;...NO
04384  FB62  A5 AD              LDA SAH
04385  FB64  DD 01 01           CMP BAD+1,X
04386  FB67  D0 27              BNE RD90        ;...NO
04387  FB69  E6 9F              INC PTR2        ;WE FOUND NEXT ONE, SO ADVANCE POINTER
04388  FB6B  E6 9F              INC PTR2
04389  FB6D  A5 93              LDA VERCK       ;DOING A LOAD OR VERIFY?...
04390  FB6F  F0 0B              BEQ RD52        ;...LOADING
04391  FB71  A5 BD              LDA OCHAR       ;...VERIFYING, SO CHECK
04392  FB73  A0 00              LDY #0
04393  FB75  D1 AC              CMP (SAL)Y
04394  FB77  F0 17              BEQ RD90        ;...OKAY
04395  FB79  C8                 INY             ;MAKE .Y= 1
04396  FB7A  84 B6              STY PRP         ;FLAG IT AS AN ERROR


04398  FB7C  A5 B6       RD52   LDA PRP         ;A SECOND PASS ERROR?...
04399  FB7E  F0 07              BEQ RD59        ;...NO
04400  FB80              ;SECOND PASS ERR
04401  FB80  A9 10       RD55   LDA #SPERR
04402  FB82  20 6A FE           JSR UDST
04403  FB85  D0 09              BNE RD90        ;JMP


04405  FB87  A5 93       RD59   LDA VERCK       ;LOAD OR VERIFY?...
04406  FB89  D0 05              BNE RD90        ;...VERIFY, DON'T STORE
04407  FB8B  A8                 TAY             ;MAKE Y ZERO
04408  FB8C  A5 BD              LDA OCHAR
04409  FB8E  91 AC              STA (SAL)Y      ;STORE CHARACTER
04410  FB90  20 1B FD    RD90   JSR INCSAL      ;INCREMENT ADDR.
04411  FB93  D0 3A              BNE RD180       ;BRANCH ALWAYS



04413  FB95  A9 80       RD160  LDA #$80        ;SET MODE SKIP NEXT DATA
04414  FB97  85 AA       RD161  STA RDFLG
04415  FB99  A6 BE              LDX FSBLK       ;DEC FSBLK FOR NEXT PASS...
04416  FB9B  CA                 DEX
04417  FB9C  30 02              BMI RD167       ;WE ARE DONE...FSBLK=0
04418  FB9E  86 BE              STX FSBLK       ;...ELSE FSBLK=NEXT
04419  FBA0  C6 A7       RD167  DEC SHCNL       ;DEC PASS CALC...
04420  FBA2  F0 08              BEQ RD175       ;...ALL DONE
04421  FBA4  A5 9E              LDA PTR1        ;CHECK FOR FIRST PASS ERRORS...
04422  FBA6  D0 27              BNE RD180       ;...YES SO CONTINUE
04423  FBA8  85 BE              STA FSBLK       ;CLEAR FSBLK IF NO ERRORS...
04424  FBAA  F0 23              BEQ RD180       ;JMP TO EXIT






BYTE HANDLER......PAGE 0070

LINE# LOC   CODE        LINE


04426  FBAC  20 CF FC    RD175  JSR TNIF        ;READ IT ALL...EXIT
04427  FBAF  20 D2 FB           JSR RD300       ;RESTORE SAL & SAH
04428  FBB2  A0 00              LDY #0          ;SET SHCNH TO ZERO...
04429  FBB4  84 AB              STY SHCNH       ;...USED TO CALC PARITY BYTE
04430  FBB6              ;
04431  FBB6              ;COMPUTE PARITY OVER LOAD
04432  FBB6              ;
04433  FBB6  B1 AC       VPRTY  LDA (SAL)Y      ;CALC BLOCK BCC
04434  FBB8  45 AB              EOR SHCNH
04435  FBBA  85 AB              STA SHCNH
04436  FBBC  20 1B FD           JSR INCSAL      ;INCREMENT ADDRESS
04437  FBBF  20 11 FD           JSR CMPSTE      ;TEST AGAINST END
04438  FBC2  90 F2              BCC VPRTY       ;NOT DONE YET...
04439  FBC4  A5 AB              LDA SHCNH       ;CHECK FOR BCC CHAR MATCH...
04440  FBC6  45 BD              EOR OCHAR
04441  FBC8  F0 05              BEQ RD180       ;...YES, EXIT
04442  FBCA              ;CHKSUM ERROR
04443  FBCA  A9 20              LDA #CKERR
04444  FBCC  20 6A FE           JSR UDST
04445  FBCF  4C 56 FF    RD180  JMP PREND




04447  FBD2  A5 C2       RD300  LDA STAH        ; RESTORE STARTING ADDRESS...
04448  FBD4  85 AD              STA SAH         ;...POINTERS (SAH & SAL)
04449  FBD6  A5 C1              LDA STAL
04450  FBD8  85 AC              STA SAL
04451  FBDA  60                 RTS




04453  FBDB  A9 08       NEWCH  LDA #8          ;SET UP FOR 8 BITS+PARITY
04454  FBDD  85 A3              STA PCNTR
04455  FBDF  A9 00              LDA #0          ;INITILIZE...
04456  FBE1  85 A4              STA FIRT        ;..DIPOLE COUNTER
04457  FBE3  85 A8              STA RER         ;..ERROR FLAG
04458  FBE5  85 9B              STA PRTY        ;..PARITY BIT
04459  FBE7  85 A9              STA REZ         ;..ZERO COUNT
04460  FBE9  60                 RTS             ;.A=0 ON RETURN
04461  FBEA              .END
04462  FBEA              .LIB   WRITE


















TAPE WRITE......PAGE 0071

LINE# LOC   CODE        LINE


04464  FBEA              ; CASSETTE INFO - FSBLK IS BLOCK COUNTER FOR RECORD
04465  FBEA              ;       FSBLK = 2 -FIRST HEADER
04466  FBEA              ;             = 1 -FIRST DATA
04467  FBEA              ;             = 0 -SECOND DATA
04468  FBEA              ;
04469  FBEA              ; WRITE - TOGGLE WRITE BIT ACCORDING TO LSB IN OCHAR
04470  FBEA              ;
04471  FBEA  A5 BD       WRITE  LDA OCHAR       ;SHIFT BIT TO WRITE INTO CARRY
04472  FBEC  4A                 LSR A
04473  FBED  A9 60              LDA #96         ;...C CLR WRITE SHORT
04474  FBEF  90 02              BCC WRT1
04475  FBF1  A9 B0       WRTW   LDA #176        ;...C SET WRITE LONG
04476  FBF3  A2 00       WRT1   LDX #0          ;SET AND STORE TIME
04477  FBF5  8D 28 91    WRTX   STA D2T2L
04478  FBF8  8E 29 91           STX D2T2H
04479  FBFB  AD 20 91           LDA D2ORB       ;TOGGLE WRITE BIT
04480  FBFE  49 08              EOR #$08
04481  FC00  8D 20 91           STA D2ORB
04482  FC03  29 08              AND #$08        ;LEAVE ONLY WRITE BIT
04483  FC05  60                 RTS
04484  FC06              ;
04485  FC06  38          WRTL3  SEC             ;FLAG SAH FOR END OF BLOCK
04486  FC07  66 AD              ROR SAH
04487  FC09  30 3C              BMI WRT3        ; JMP
04488  FC0B              ;
04489  FC0B              ; WRTN - CALLED AT THE END OF EACH BYTE
04490  FC0B              ;   TO WRITE A LONG RER    REZ
04491  FC0B              ;              HHHHHHLLLLLLHHHLLL...
04492  FC0B              ;
04493  FC0B  A5 A8       WRTN   LDA RER         ;CHECK FOR ONE LONG
04494  FC0D  D0 12              BNE WRTN1
04495  FC0F  A9 10              LDA #16         ;WRITE A LONG BIT
04496  FC11  A2 01              LDX #1
04497  FC13  20 F5 FB           JSR WRTX
04498  FC16  D0 2F              BNE WRT3
04499  FC18  E6 A8              INC RER
04500  FC1A  A5 AD              LDA SAH         ;IF END OF BLOCK(BIT SET BY WRTL3)...
04501  FC1C  10 29              BPL WRT3        ;...NO END CONTINUE
04502  FC1E  4C 95 FC           JMP WRNC        ;...END ...FINISH OFF
04503  FC21              ;
04504  FC21  A5 A9       WRTN1  LDA REZ         ;CHECK FOR A ONE BIT
04505  FC23  D0 09              BNE WRTN2
04506  FC25  20 F1 FB           JSR WRTW
04507  FC28  D0 1D              BNE WRT3
04508  FC2A  E6 A9              INC REZ
04509  FC2C  D0 19              BNE WRT3
04510  FC2E              ;
04511  FC2E  20 EA FB    WRTN2  JSR WRITE
04512  FC31  D0 14              BNE WRT3        ;ON BIT LOW EXIT
04513  FC33  A5 A4              LDA FIRT        ;CHECK FOR FIRST OF DIPOLE
04514  FC35  49 01              EOR #1
04515  FC37  85 A4              STA FIRT
04516  FC39  F0 0F              BEQ WRT2        ;DIPOLE DONE
04517  FC3B  A5 BD              LDA OCHAR       ;FLIPS BIT FOR COMPLEMENTARY RIGHT
04518  FC3D  49 01              EOR #1






TAPE WRITE......PAGE 0072

LINE# LOC   CODE        LINE


04519  FC3F  85 BD              STA OCHAR
04520  FC41  29 01              AND #1          ;TOGGLE PARITY
04521  FC43  45 9B              EOR PRTY
04522  FC45  85 9B              STA PRTY
04523  FC47  4C 56 FF    WRT3   JMP PREND       ;RESTORE REGS AND RTI EXIT
04524  FC4A              ;
04525  FC4A  46 BD       WRT2   LSR OCHAR       ;MOVE TO NEXT BIT
04526  FC4C  C6 A3              DEC PCNTR       ;DEC COUNTER FOR # OF BITS
04527  FC4E  A5 A3              LDA PCNTR       ;CHECK FOR 8 BITS SENT...
04528  FC50  F0 3A              BEQ WRT4        ;...IF YES MOVE IN PARITY
04529  FC52  10 F3              BPL WRT3        ;...ELSE SEND REST
04530  FC54              ;
04531  FC54  20 DB FB    WRTS   JSR NEWCH       ;CLEAN UP COUNTERS
04532  FC57  58                 CLI             ;ALLOW FOR INTERRUPTS TO NEST
04533  FC58  A5 A5              LDA CNTDN       ;ARE WE WRITING HEADER COUNTERS?...
04534  FC5A  F0 12              BEQ WRT6        ;...NO
04535  FC5C              ; WRITE HEADER COUNTERS (9876543210 TO HELP WITH READ)
04536  FC5C  A2 00              LDX #0          ;CLEAR BCC
04537  FC5E  86 D7              STX DATA
04538  FC60  C6 A5       WRTS1  DEC CNTDN
04539  FC62  A6 BE              LDX FSBLK       ;CHECK FOR FIRST BLOCK HEADER
04540  FC64  E0 02              CPX #2
04541  FC66  D0 02              BNE WRT61       ;...NO
04542  FC68  09 80              ORA #$80        ;...YES MARK FIRST BLOCK HEADER
04543  FC6A  85 BD       WRT61  STA OCHAR       ;WRITE CHARACTERS IN HEADER
04544  FC6C  D0 D9              BNE WRT3
04545  FC6E              ;
04546  FC6E  20 11 FD    WRT6   JSR CMPSTE      ;COMPARE START:END
04547  FC71  90 0A              BCC WRT7        ;NOT DONE
04548  FC73  D0 91              BNE WRTL3       ;GO MARK END
04549  FC75  E6 AD              INC SAH
04550  FC77  A5 D7              LDA DATA        ;WRITE OUT BCC
04551  FC79  85 BD              STA OCHAR
04552  FC7B  B0 CA              BCS WRT3        ;JMP
04553  FC7D              ;
04554  FC7D  A0 00       WRT7   LDY #0          ;GET NEXT CHARACTER
04555  FC7F  B1 AC              LDA (SAL)Y
04556  FC81  85 BD              STA OCHAR       ;STORE IN OUTPUT CHARACTER
04557  FC83  45 D7              EOR DATA        ;UPDATE BCC
04558  FC85  85 D7              STA DATA
04559  FC87  20 1B FD           JSR INCSAL      ;INCREMENT FETCH ADDRESS
04560  FC8A  D0 BB              BNE WRT3        ;BRANCH ALWAYS
04561  FC8C              ;
04562  FC8C  A5 9B       WRT4   LDA PRTY        ;MOVE PARITY INTO OCHAR...
04563  FC8E  49 01              EOR #1
04564  FC90  85 BD              STA OCHAR       ;...TO BE WRITTEN AS NEXT BIT
04565  FC92  4C 56 FF    WRTBK  JMP PREND       ;RESTORE REGS AND RTI EXIT
04566  FC95              ;
04567  FC95  C6 BE       WRNC   DEC FSBLK       ;CHECK FOR END
04568  FC97  D0 03              BNE WREND       ;...BLOCK ONLY
04569  FC99  20 08 FD           JSR TNOF        ;...WRITE, SO TURN OFF MOTOR
04570  FC9C  A9 50       WREND  LDA #80         ;PUT 80 CASSETTE SYNCS AT END
04571  FC9E  85 A7              STA SHCNL
04572  FCA0  A2 08              LDX #8
04573  FCA2  78                 SEI






TAPE WRITE......PAGE 0073

LINE# LOC   CODE        LINE


04574  FCA3  20 FB FC           JSR BSIV        ;SET VECTOR TO WRITE ZEROS
04575  FCA6  D0 EA              BNE WRTBK       ;JMP
04576  FCA8              ;
04577  FCA8  A9 78       WRTZ   LDA #120        ;WRITE LEADING ZEROS FOR SYNC
04578  FCAA  20 F3 FB           JSR WRT1
04579  FCAD  D0 E3              BNE WRTBK
04580  FCAF  C6 A7              DEC SHCNL       ;CHECK IF DONE WITH LOW SYNC...
04581  FCB1  D0 DF              BNE WRTBK       ;...NO
04582  FCB3  20 DB FB           JSR NEWCH       ;...YES CLEAR UP COUNTERS
04583  FCB6  C6 AB              DEC SHCNH       ;CHECK IF DONE WITH SYNC...
04584  FCB8  10 D8              BPL WRTBK       ;...NO
04585  FCBA  A2 0A              LDX #10         ;...YES SO SET VECTOR FOR DATA
04586  FCBC  20 FB FC           JSR BSIV
04587  FCBF  58                 CLI
04588  FCC0  E6 AB              INC SHCNH       ;ZERO SHCNH
04589  FCC2  A5 BE              LDA FSBLK       ;IF DONE THEN...
04590  FCC4  F0 30              BEQ STKY        ;...GOTO SYSTEM RESTORE
04591  FCC6  20 D2 FB           JSR RD300
04592  FCC9  A2 09              LDX #9          ;SET UP FOR HEADER COUNT
04593  FCCB  86 A5              STX CNTDN
04594  FCCD  D0 85              BNE WRTS        ;JMP
04595  FCCF              ;
04596  FCCF  08          TNIF   PHP             ;CLEAN UP INTERRUPTS AND RESTORE PIA'S
04597  FCD0  78                 SEI
04598  FCD1  20 08 FD           JSR TNOF        ;TURN OFF MOTOR
04599  FCD4  A9 7F              LDA #$7F        ;CLEAR INTERRUPTS
04600  FCD6  8D 2E 91           STA D2IER
04601  FCD9  A9 F7              LDA #$F7        ;RESTORE KEYBOARD COL FOR STOP CHECK
04602  FCDB  8D 20 91           STA D2ORB
04603  FCDE  A9 40              LDA #%01000000  ;D2ACR=FREE RUNNING T1, T2 ONE SHOT...
04604  FCE0  8D 2B 91           STA D2ACR       ;...SHIFT DISABLED, AND NO LATCHING
04605  FCE3  20 39 FE           JSR IOKEYS      ;RESTORE KEYBOARD IRQ FROM TIMMER1
04606  FCE6  AD A0 02           LDA IRQTMP+1    ;RESTORE KEYBOARD INTERRUPT VECTOR
04607  FCE9  F0 09              BEQ TNIQ        ;NO IRQ (IRQ VECTOR CANNOT BE Z-PAGE)
04608  FCEB  8D 15 03           STA CINV+1
04609  FCEE  AD 9F 02           LDA IRQTMP
04610  FCF1  8D 14 03           STA CINV
04611  FCF4  28          TNIQ   PLP
04612  FCF5  60                 RTS
04613  FCF6              ;
04614  FCF6  20 CF FC    STKY   JSR TNIF        ;GO RESTORE SYSTEM INTERRUPTS
04615  FCF9  F0 97              BEQ WRTBK       ;CAME FOR CASSETTE IRQ SO RTI
04616  FCFB              ;
04617  FCFB              ; BSIV - SUBROUTINE TO CHANGE IRQ VECTORS
04618  FCFB              ;  ENTRYS - .X = 8 WRITE ZEROS TO TAPE
04619  FCFB              ;           .X = 10 WRITE DATA TO TAPE
04620  FCFB              ;           .X = 12 RESTORE TO KEYSCAN
04621  FCFB              ;           .X = 14 READ DATA FROM TAPE
04622  FCFB              ;
04623  FCFB  BD E9 FD    BSIV   LDA BSIT-8,X    ;MOVE IRQ VECTORS, TABLE TO INDIRECT
04624  FCFE  8D 14 03           STA CINV
04625  FD01  BD EA FD           LDA BSIT+1-8,X
04626  FD04  8D 15 03           STA CINV+1
04627  FD07  60                 RTS
04628  FD08              ;






TAPE WRITE......PAGE 0074

LINE# LOC   CODE        LINE


04629  FD08  AD 1C 91    TNOF   LDA D1PCR       ;TURN OFF CASSETTE MOTOR
04630  FD0B  09 0E              ORA #$0E        ;...ON CA2
04631  FD0D  8D 1C 91           STA D1PCR
04632  FD10  60                 RTS



04634  FD11              ;COMPARE START AND END LOAD/SAVE
04635  FD11              ;ADDRESSES.  SUBROUTINE CALLED BY
04636  FD11              ;TAPE READ, SAVE, TAPE WRITE
04637  FD11              ;
04638  FD11  38          CMPSTE SEC
04639  FD12  A5 AC              LDA SAL
04640  FD14  E5 AE              SBC EAL
04641  FD16  A5 AD              LDA SAH
04642  FD18  E5 AF              SBC EAH
04643  FD1A  60                 RTS



04645  FD1B              ;INCREMENT ADDRESS POINTER SAL
04646  FD1B              ;
04647  FD1B  E6 AC       INCSAL INC SAL
04648  FD1D  D0 02              BNE INCR
04649  FD1F  E6 AD              INC SAH
04650  FD21  60          INCR   RTS
04651  FD22              .END
04652  FD22              .LIB   INIT

































INITIALIZATION......PAGE 0075

LINE# LOC   CODE        LINE


04654  FD22              ; START - SYSTEM RESET
04655  FD22              ; WILL GOTO ROM AT $A000...
04656  FD22              ; IF LOCS $A004-$A008
04657  FD22              ; = 'A0CBM'
04658  FD22              ;      ^^^> THESE HAVE MSB SET
04659  FD22              ; KERNAL EXPECTS...
04660  FD22              ; $A000- .WORD INITILIZE (HARD START)
04661  FD22              ; $A002- .WORD PANIC (WARM START)
04662  FD22              ; ... ELSE BASIC SYSTEM USED
04663  FD22  A2 FF       START  LDX #$FF
04664  FD24  78                 SEI
04665  FD25  9A                 TXS
04666  FD26  D8                 CLD
04667  FD27  20 3F FD           JSR A0INT       ;TEST FOR $A0 ROM IN
04668  FD2A  D0 03              BNE START1
04669  FD2C  6C 00 A0           JMP ($A000)     ; GO INIT AS $A000 ROM WANTS
04670  FD2F  20 8D FD    START1 JSR RAMTAS      ;GO RAM TEST AND SET
04671  FD32  20 52 FD           JSR RESTOR      ;GO SET UP OS VECTORS
04672  FD35  20 F9 FD           JSR IOINIT      ;GO INITILIZE I/O DEVICES
04673  FD38  20 18 E5           JSR CINT        ;GO INITILIZE SCREEN
04674  FD3B  58                 CLI             ;INTERRUPTS OKAY NOW
04675  FD3C  6C 00 C0           JMP ($C000)     ;GO TO BASIC SYSTEM




04677  FD3F              ; A0INT - TEST FOR AN $A000 ROM
04678  FD3F              ;  RETURNS Z - $A000 IN
04679  FD3F              ;
04680  FD3F  A2 05       A0INT  LDX #TBLA0E-TBLA0R ;CHECK FOR $A000
04681  FD41  BD 4C FD    A0IN1  LDA TBLA0R-1,X
04682  FD44  DD 03 A0           CMP $A004-1,X
04683  FD47  D0 03              BNE A0IN2
04684  FD49  CA                 DEX
04685  FD4A  D0 F5              BNE A0IN1
04686  FD4C  60          A0IN2  RTS
04687  FD4D              ;
04688  FD4D  41 30       TBLA0R .BYT 'A0',$C3,$C2,$CD ;..A0CBM..
04688  FD4F  C3 
04688  FD50  C2 
04688  FD51  CD 
04689  FD52              TBLA0E




04691  FD52              ; RESTOR - SET KERNAL INDIRECTS AND VECTORS (SYSTEM)
04692  FD52              ;
04693  FD52  A2 6D       RESTOR LDX #<VECTSS
04694  FD54  A0 FD              LDY #>VECTSS
04695  FD56  18                 CLC
04696  FD57              ;
04697  FD57              ; VECTOR - SET KERNAL INDIRECT AND VECTORS (USER)
04698  FD57              ;
04699  FD57  86 C3       VECTOR STX TMP2






INITIALIZATION......PAGE 0076

LINE# LOC   CODE        LINE


04700  FD59  84 C4              STY TMP2+1
04701  FD5B  A0 1F              LDY #VECTSE-VECTSS-1
04702  FD5D  B9 14 03    MOVOS1 LDA CINV,Y      ;GET FROM STORAGE
04703  FD60  B0 02              BCS MOVOS2      ;C...WANT STORAGE TO USER
04704  FD62  B1 C3              LDA (TMP2)Y     ;...WANT USER TO STORAGE
04705  FD64  91 C3       MOVOS2 STA (TMP2)Y     ;PUT IN USER
04706  FD66  99 14 03           STA CINV,Y      ;PUT IN STORAGE
04707  FD69  88                 DEY
04708  FD6A  10 F1              BPL MOVOS1
04709  FD6C  60                 RTS
04710  FD6D              ;
04711  FD6D  BF EA       VECTSS .WOR KEY,TIMB,NNMI
04711  FD6F  D2 FE 
04711  FD71  AD FE 
04712  FD73  0A F4              .WOR NOPEN,NCLOSE,NCHKIN
04712  FD75  4A F3 
04712  FD77  C7 F2 
04713  FD79  09 F3              .WOR NCKOUT,NCLRCH,NBASIN
04713  FD7B  F3 F3 
04713  FD7D  0E F2 
04714  FD7F  7A F2              .WOR NBSOUT,NSTOP,NGETIN
04714  FD81  70 F7 
04714  FD83  F5 F1 
04715  FD85  EF F3              .WOR NCLALL,TIMB ;GOTO BREAK ON A USRCMD JMP
04715  FD87  D2 FE 
04716  FD89  49 F5              .WOR NLOAD,NSAVE
04716  FD8B  85 F6 
04717  FD8D              VECTSE

































INITILIZE CODE......PAGE 0077

LINE# LOC   CODE        LINE


04719  FD8D              ; RAMTAS - MEMORY SIZE CHECK AND SET
04720  FD8D              ;
04721  FD8D  A9 00       RAMTAS LDA #0          ;ZERO LOW MEMORY
04722  FD8F  AA                 TAX             ;START AT 00
04723  FD90  95 00       RAMTZ0 STA $00,X       ;ZERO PAGE
04724  FD92  9D 00 02           STA $200,X      ;USER BUFFERS AND VARS
04725  FD95  9D 00 03           STA $300,X      ;SYSTEM SPACE AND USER SPACE
04726  FD98  E8                 INX
04727  FD99  D0 F5              BNE RAMTZ0
04728  FD9B              ;
04729  FD9B              ;ALLOCATE TAPE BUFFERS
04730  FD9B              ;
04731  FD9B  A2 3C              LDX #<TBUFFR
04732  FD9D  A0 03              LDY #>TBUFFR
04733  FD9F  86 B2              STX TAPE1
04734  FDA1  84 B3              STY TAPE1+1
04735  FDA3              ;
04736  FDA3              ; SET TOP AND BOTTOM OF MEMORY
04737  FDA3              ;
04738  FDA3  85 C1       RAMTBT STA TMP0        ;SET LOW INITAL INDEX
04739  FDA5  85 97              STA XSAV        ;SET TOP/BOTTOM FLAG
04740  FDA7  8D 81 02           STA MEMSTR      ;SET LOW BOTTOM ON A PAGE
04741  FDAA  A8                 TAY             ;MOVE ZERO TO .Y
04742  FDAB  A9 04              LDA #4          ;SET HIGH INITAL INDEX
04743  FDAD  85 C2              STA TMP0+1
04744  FDAF              ;
04745  FDAF  E6 C1       RAMTZ1 INC TMP0        ;MOVE INDEX THRU MEMORY
04746  FDB1  D0 02              BNE RAMTZ2
04747  FDB3  E6 C2              INC TMP0+1
04748  FDB5              ;
04749  FDB5  20 91 FE    RAMTZ2 JSR CHKMEM      ;GO CHECK
04750  FDB8  A5 97              LDA XSAV        ;TOP/BOTTOM CHECK...
04751  FDBA  F0 22              BEQ RAMTZ5      ;...BOTTOM
04752  FDBC              ;
04753  FDBC  B0 F1              BCS RAMTZ1      ;TOP & STILL GOOD
04754  FDBE  A4 C2              LDY TMP0+1      ;ELSE FOUND BAD
04755  FDC0  A6 C1              LDX TMP0
04756  FDC2  C0 20              CPY #$20        ;CHECK IF MEMORY GOOD
04757  FDC4  90 25              BCC BADRAM      ;NO...BAD SYSTEM RAM
04758  FDC6  C0 21              CPY #$21        ;CHECK FOR SCREEN LOCATION
04759  FDC8  B0 08              BCS RAMTZ4      ;SCREEN TO BOTTOM
04760  FDCA  A0 1E              LDY #$1E        ;SCREEN TO TOP
04761  FDCC  8C 88 02           STY HIBASE      ;SET SYSTEM SCREEN BASE
04762  FDCF  4C 7B FE    RAMTZ3 JMP SETTOP      ;GO SET TOP OF SYSTEM MEMORY
04763  FDD2              ;
04764  FDD2  A9 12       RAMTZ4 LDA #$12        ;SET NEW BOTTOM
04765  FDD4  8D 82 02           STA MEMSTR+1
04766  FDD7  A9 10              LDA #$10        ;SCREEN TO BOTTOM
04767  FDD9  8D 88 02           STA HIBASE
04768  FDDC  D0 F1              BNE RAMTZ3      ;JMP & SAVE A BYTE
04769  FDDE              ;
04770  FDDE  90 CF       RAMTZ5 BCC RAMTZ1      ;BOTTOM & STILL BAD
04771  FDE0  A5 C2              LDA TMP0+1      ;DO THIS WAY SO .Y STILL GOOD
04772  FDE2  8D 82 02           STA MEMSTR+1    ;SET BOTTOM
04773  FDE5  85 97              STA XSAV        ;FLAG TO TOP






INITILIZE CODE......PAGE 0078

LINE# LOC   CODE        LINE


04774  FDE7  C9 11              CMP #$11
04775  FDE9  90 C4              BCC RAMTZ1      ;GO FIND TOP IF SYSTEM RAM IS GOOD
04776  FDEB              ;
04777  FDEB  20 C3 E5    BADRAM JSR INITV       ;INITILIZE VIC  RAM IS BAD
04778  FDEE  4C EB FD           JMP BADRAM



04780  FDF1  A8 FC       BSIT   .WOR WRTZ,WRTN,KEY,READ ;TABLE OF INDIRECTS FOR CASSETTE IRQ'S
04780  FDF3  0B FC 
04780  FDF5  BF EA 
04780  FDF7  8E F9 

















































INITILIZE CODE......PAGE 0079

LINE# LOC   CODE        LINE


04782  FDF9              ; IOINIT - INITILIZE IO DEVICES
04783  FDF9              ;
04784  FDF9  A9 7F       IOINIT LDA #$7F        ;KILL IERS
04785  FDFB  8D 1E 91           STA D1IER
04786  FDFE  8D 2E 91           STA D2IER
04787  FE01  A9 40              LDA #%01000000  ;FREE RUNNING T1 D2
04788  FE03  8D 2B 91           STA D2ACR
04789  FE06  A9 40              LDA #%01000000  ;FREE RUNNING T1 T2 ONESHOT D1
04790  FE08  8D 1B 91           STA D1ACR
04791  FE0B  A9 FE              LDA #%11111110  ;D1 CA2 HIGH,CB2 HIGH,CA1 NEG,CB1 POS
04792  FE0D  8D 1C 91           STA D1PCR
04793  FE10  A9 DE              LDA #%11011110  ;D2 CA2 HIGH,CB2 LOW,CA1 NEG,CB1 POS
04794  FE12  8D 2C 91           STA D2PCR
04795  FE15  A2 00              LDX #$00
04796  FE17  8E 12 91           STX D1DDRB      ;USER PORT (NO RS-232)
04797  FE1A  A2 FF              LDX #%11111111
04798  FE1C  8E 22 91           STX D2DDRB      ;KEYBOARD COLS ARE OUTPUTS
04799  FE1F  A2 00              LDX #$00
04800  FE21  8E 23 91           STX D2DDRA      ;KEYBOARD ROWS ARE INPUTS
04801  FE24  A2 80              LDX #%10000000  ;SCLK SDATA 4JOY CASSW SATN
04802  FE26  8E 13 91           STX D1DDRA      ;...CASS MOTOR, CASS SWITCH, ACK
04803  FE29  A2 00              LDX #%00000000  ;SATN LOW
04804  FE2B  8E 1F 91           STX D1ORA
04805  FE2E  20 84 EF           JSR CLKHI       ;CLKHI TO RELEASE SERIAL DEVICE
04806  FE31  A9 82              LDA #$82        ;ENABLE PANIC BUTTON
04807  FE33  8D 1E 91           STA D1IER
04808  FE36  20 8D EF           JSR CLKLO       ;CLKLO TO RESTORE CLOCK LINE
04809  FE39              ;
04810  FE39  A9 C0       IOKEYS LDA #$C0        ;ENABLE T1 INTERRUPTS
04811  FE3B  8D 2E 91           STA D2IER
04812  FE3E  A9 89              LDA #<SIXTY     ;...AT 60 HZ RATE
04813  FE40  8D 24 91           STA D2T1L
04814  FE43  A9 42              LDA #>SIXTY
04815  FE45  8D 25 91           STA D2T1H
04816  FE48  60                 RTS
04817  FE49              ;
04818  FE49              ; SIXTY HERTZ VALUE
04819  FE49              ;
04820  FE49              SIXTY  = 17033






















INIT - SYS SUBS......PAGE 007A

LINE# LOC   CODE        LINE


04822  FE49  85 B7       SETNAM STA FNLEN
04823  FE4B  86 BB              STX FNADR
04824  FE4D  84 BC              STY FNADR+1
04825  FE4F  60                 RTS





04827  FE50  85 B8       SETLFS STA LA
04828  FE52  86 BA              STX FA
04829  FE54  84 B9              STY SA
04830  FE56  60                 RTS





04832  FE57  A5 BA       READSS LDA FA          ;SEE WHICH DEVICES' TO READ
04833  FE59  C9 02              CMP #2          ;IS IT RS-232?
04834  FE5B  D0 0B              BNE READST      ;NO...READ SERIAL/CASS
04835  FE5D  AD 97 02           LDA RSSTAT      ;YES...GET RS-232 UP
04836  FE60  A9 00              LDA #00         ;CLEAR RS232 STATUS WHEN READ
04837  FE62  8D 97 02           STA RSSTAT
04838  FE65  60                 RTS
04839  FE66  85 9D       SETMSG STA MSGFLG
04840  FE68  A5 90       READST LDA STATUS
04841  FE6A  05 90       UDST   ORA STATUS
04842  FE6C  85 90              STA STATUS
04843  FE6E  60                 RTS





04845  FE6F  8D 85 02    SETTMO STA TIMOUT
04846  FE72  60                 RTS





04848  FE73  90 06       MEMTOP BCC SETTOP
04849  FE75              ;
04850  FE75              ;CARRY SET--READ TOP OF MEMORY
04851  FE75              ;
04852  FE75  AE 83 02    GETTOP LDX MEMSIZ
04853  FE78  AC 84 02           LDY MEMSIZ+1
04854  FE7B              ;
04855  FE7B              ;CARRY CLEAR--SET TOP OF MEMORY
04856  FE7B              ;
04857  FE7B  8E 83 02    SETTOP STX MEMSIZ
04858  FE7E  8C 84 02           STY MEMSIZ+1
04859  FE81  60                 RTS







INIT - SYS SUBS......PAGE 007B

LINE# LOC   CODE        LINE


04861  FE82              ;MANAGE BOTTOM OF MEMORY
04862  FE82              ;
04863  FE82  90 06       MEMBOT BCC SETBOT
04864  FE84              ;
04865  FE84              ;CARRY SET--READ BOTTOM OF MEMORY
04866  FE84              ;
04867  FE84  AE 81 02           LDX MEMSTR
04868  FE87  AC 82 02           LDY MEMSTR+1
04869  FE8A              ;
04870  FE8A              ;CARRY CLEAR--SET BOTTOM OF MEMORY
04871  FE8A              ;
04872  FE8A  8E 81 02    SETBOT STX MEMSTR
04873  FE8D  8C 82 02           STY MEMSTR+1
04874  FE90  60                 RTS





04876  FE91              ;********************************
04877  FE91              ;
04878  FE91              ; C H E C K   M E M O R Y
04879  FE91              ;
04880  FE91              ; CHECK FOR THE EXISTENCE OF
04881  FE91              ; RAM AT THE LOCATION SPECIFIED
04882  FE91              ; IN TMP0
04883  FE91              ;
04884  FE91              ; C=0 IF THERE IS NO RAM AT TMP0
04885  FE91              ; C=1 IF THERE IS RAM AT TMP0
04886  FE91              ;
04887  FE91              ; (TMP0) IS PRESERVED
04888  FE91              ;*******************************
04889  FE91              ;
04890  FE91  B1 C1       CHKMEM LDA (TMP0)Y
04891  FE93  AA                 TAX             ;SAVE BYTE AT TEST LOCATION
04892  FE94  A9 55              LDA #$55        ;TEST ALL BITS
04893  FE96  91 C1              STA (TMP0)Y
04894  FE98  D1 C1              CMP (TMP0)Y     ;DO THEY MATCH
04895  FE9A  D0 08              BNE NOMEM       ;BRANCH IF NOT
04896  FE9C  6A                 ROR A           ;TRY THE OTHER BITS
04897  FE9D  91 C1              STA (TMP0)Y
04898  FE9F  D1 C1              CMP (TMP0)Y     ;DO THEY MATCH
04899  FEA1  D0 01              BNE NOMEM       ;BRANCH IF NOT
04900  FEA3  A9                 .BYT  $A9       ;CARRY IS SET SO SKIP
04901  FEA4  18          NOMEM  CLC             ;NO RAM FLAG
04902  FEA5  8A                 TXA             ;RESTORE IN CASE OF RAM
04903  FEA6  91 C1              STA (TMP0)Y
04904  FEA8  60                 RTS
04905  FEA9              .END
04906  FEA9              .LIB   RS232NMIFILE











NMI HANDLER......PAGE 007C

LINE# LOC   CODE        LINE


04908  FEA9  78          NMI    SEI             ;NO IRQ'S ALLOWED...
04909  FEAA  6C 18 03           JMP (NMINV)     ;...COULD MESS UP CASSETTES
04910  FEAD  48          NNMI   PHA             ;SAVE 6502 REGS
04911  FEAE  8A                 TXA
04912  FEAF  48                 PHA
04913  FEB0  98                 TYA
04914  FEB1  48                 PHA
04915  FEB2  AD 1D 91    NNMI10 LDA D1IFR       ;CHECK IF REAL NMI...
04916  FEB5  10 48              BPL NMIRTN      ;...NO
04917  FEB7              ;
04918  FEB7  2D 1E 91           AND D1IER       ;SHOW ONLY ENABLES
04919  FEBA  AA                 TAX             ;SAVE IN .X FOR LATTER
04920  FEBB  29 02              AND #$02        ;CHECK IF RESTORE KEY...
04921  FEBD  F0 1F              BEQ NNMI20      ;...NO
04922  FEBF              ;
04923  FEBF  20 3F FD    NNMI18 JSR A0INT       ;CHECK IF $A0 IN...
04924  FEC2  D0 03              BNE NNMI19      ;...NO
04925  FEC4  6C 02 A0           JMP ($A002)     ;...YES
04926  FEC7              ;
04927  FEC7              ; CHECK FOR STOP KEY DOWN
04928  FEC7              ;
04929  FEC7  2C 11 91    NNMI19 BIT D1ORAH      ;CLR CA1 FLAG
04930  FECA  20 34 F7           JSR UDTIM
04931  FECD  20 E1 FF           JSR STOP
04932  FED0  D0 2D              BNE NMIRTN      ;NO STOP KEY
04933  FED2              ;
04934  FED2              ; TIMB - WHERE SYSTEM GOES ON A BRK INSTRUCTION
04935  FED2              ;
04936  FED2  20 52 FD    TIMB   JSR RESTOR      ;RESTORE SYSTEM INDIRECTS
04937  FED5  20 F9 FD           JSR IOINIT      ;RESTORE I/O FOR BASIC
04938  FED8  20 18 E5           JSR CINT        ;RESTORE SCREEN FOR BASIC
04939  FEDB  6C 02 C0           JMP ($C002)     ;...NO, SO BASIC WARM START


04941  FEDE              ; DISABLE NMI'S UNTILL READY
04942  FEDE              ;  SAVE ON STACK
04943  FEDE              ;
04944  FEDE  AD 1E 91    NNMI20 LDA D1IER       ;SAVE CURRENT ENABLES...
04945  FEE1  09 80              ORA #$80        ;SO WE CAN ENABLE ON RESTORE
04946  FEE3  48                 PHA
04947  FEE4  A9 7F              LDA #$7F        ;KILL THE REST
04948  FEE6  8D 1E 91           STA D1IER
04949  FEE9              ;
04950  FEE9              ;
04951  FEE9              ; T1 NMI CHECK - TRANSMITT A BIT
04952  FEE9              ;
04953  FEE9  8A                 TXA
04954  FEEA  29 40              AND #$40        ;CHECK FOR T1
04955  FEEC  F0 14              BEQ NNMI30      ;NO...
04956  FEEE              ;
04957  FEEE  A9 CE              LDA #$CE        ;FIXED PCR HERE
04958  FEF0              ; WILL TURN OFF YOUR CASS MOTOR!
04959  FEF0  05 B5              ORA NXTBIT      ;LOAD DATA AND...
04960  FEF2  8D 1C 91           STA D1PCR       ;...SEND IT
04961  FEF5              ;






NMI HANDLER......PAGE 007D

LINE# LOC   CODE        LINE


04962  FEF5  AD 14 91           LDA D1T1L       ;KILL REQUEST
04963  FEF8              ;
04964  FEF8  68                 PLA             ;RESTORE NMI'S
04965  FEF9  8D 1E 91           STA D1IER       ;READY FOR NEXT...
04966  FEFC              ;
04967  FEFC  20 A3 EF           JSR RSTRAB      ;GO CALC INFO (CODE COULD BE IN LINE)
04968  FEFF  4C 56 FF    NMIRTN JMP NMIRTI
04969  FF02              ;


04971  FF02              ; T2 NMI CHECK - RECIEVE A BIT
04972  FF02              ;
04973  FF02  8A          NNMI30 TXA
04974  FF03  29 20              AND #$20        ;MASK TO T2
04975  FF05  F0 25              BEQ NNMI40      ;NO...
04976  FF07              ;
04977  FF07  AD 10 91           LDA D1ORB       ;GET DATA IN
04978  FF0A  29 01              AND #01         ;MASK OFF...
04979  FF0C  85 A7              STA INBIT       ;...SAVE FOR LATTER
04980  FF0E              ;
04981  FF0E              ; UPDATE T2 FOR MID BIT CHECK
04982  FF0E              ;   (WORST CASE <255 US TO HERE)
04983  FF0E              ;
04984  FF0E  AD 18 91           LDA D1T2L       ;CALC NEW TIME & CLR NMI
04985  FF11  E9 16              SBC #22         ;TIME FOR THIS LOOP
04986  FF13  6D 99 02           ADC BAUDOF
04987  FF16  8D 18 91           STA D1T2L
04988  FF19  AD 19 91           LDA D1T2H
04989  FF1C  6D 9A 02           ADC BAUDOF+1
04990  FF1F  8D 19 91           STA D1T2H
04991  FF22              ;
04992  FF22              ;
04993  FF22  68                 PLA             ;RESTORE NMI'S
04994  FF23  8D 1E 91           STA D1IER
04995  FF26              ;
04996  FF26  20 36 F0           JSR RSRCVR      ;GO SHIFT IN...
04997  FF29  4C 56 FF           JMP NMIRTI


04999  FF2C              ; CB1 NMI HANDLER - RECIEVE A START BIT
05000  FF2C              ;
05001  FF2C  8A          NNMI40 TXA             ;CHECK FOR EDGE
05002  FF2D  29 10              AND #$10        ;ON CB1...
05003  FF2F  F0 25              BEQ NMIRTI      ;NO...
05004  FF31              ;
05005  FF31              ; CHECK FOR NOISE ?
05006  FF31              ;
05007  FF31  AD 93 02           LDA M51CTR      ;GET LENGTH TO CHECK FOR
05008  FF34  29 0F              AND #$0F
05009  FF36  D0 00              BNE NNMI42      ;USE TABLES
05010  FF38              ;
05011  FF38              ; GET BAUD RATE FROM ELSE WHERE ###NEED CODE###
05012  FF38              ;
05013  FF38  0A          NNMI42 ASL A           ;GET DATA FROM BAUD TABLE
05014  FF39  AA                 TAX






NMI HANDLER......PAGE 007E

LINE# LOC   CODE        LINE


05015  FF3A  BD 5A FF           LDA BAUDO-2,X   ;MOVE TO TIMER
05016  FF3D  8D 18 91           STA D1T2L
05017  FF40  BD 5B FF           LDA BAUDO-1,X
05018  FF43  8D 19 91           STA D1T2H
05019  FF46              ;
05020  FF46  AD 10 91           LDA D1ORB       ;KILL CB1 EDGE NMI
05021  FF49  68                 PLA             ;RESTORE NMI'S
05022  FF4A  09 20              ORA #$20        ;ENABLE T2 NMI
05023  FF4C  29 EF              AND #$EF        ;DISABLE EDGE ON CB1
05024  FF4E  8D 1E 91           STA D1IER
05025  FF51              ;
05026  FF51  AE 98 02           LDX BITNUM      ;GET #OF BITS IN
05027  FF54  86 A8              STX BITCI       ;PUT IN RCVRCNT
05028  FF56              ;


05030  FF56              NMIRTI                 ;RESTORE 6502 REGS
05031  FF56  68          PREND  PLA             ;BECAUSE OF MISSING SCREEN EDITOR
05032  FF57  A8                 TAY
05033  FF58  68                 PLA
05034  FF59  AA                 TAX
05035  FF5A  68                 PLA
05036  FF5B  40                 RTI




05038  FF5C              ; BAUDO TABLE CONTAINS VALUES
05039  FF5C              ;  FOR 1.023E6/BAUD RATE/2
05040  FF5C              ;
05041  FF5C  92 27       BAUDO  .WOR 10230-CBIT ; 50 BAUD
05042  FF5E  40 1A              .WOR  6820-CBIT ;   75   BAUD
05043  FF60  C6 11              .WOR  4650-CBIT ;  110   BAUD
05044  FF62  74 0E              .WOR  3800-CBIT ;  134.6 BAUD
05045  FF64  EE 0C              .WOR  3410-CBIT ;  150   BAUD
05046  FF66  45 06              .WOR  1705-CBIT ;  300   BAUD
05047  FF68  F1 02              .WOR  853-CBIT  ;  600   BAUD
05048  FF6A  46 01              .WOR  426-CBIT  ; 1200   BAUD
05049  FF6C  B8 00              .WOR  284-CBIT  ; 1800   BAUD
05050  FF6E  71 00              .WOR  213-CBIT  ; 2400   BAUD
05051  FF70  2A 00              .WOR  142-CBIT  ; 3600   BAUD
05052  FF72              ;
05053  FF72              ; CBIT - AN ADJUSTMENT TO MAKE NEXT T2 HIT NEAR CENTER
05054  FF72              ;   OF THE NEXT BIT.
05055  FF72              ;   APROX THE TIME TO SERVICE A CB1 NMI
05056  FF72              CBIT   = 100           ;US
05057  FF72              .END
05058  FF72              .LIB   IRQFILE













IRQFILE - DISPATCHER......PAGE 007F

LINE# LOC   CODE        LINE


05060  FF72              ; PULS - CHECKS FOR REAL IRQ'S OR BREAKS
05061  FF72              ;
05062  FF72  48          PULS   PHA
05063  FF73  8A                 TXA
05064  FF74  48                 PHA
05065  FF75  98                 TYA
05066  FF76  48                 PHA
05067  FF77  BA                 TSX
05068  FF78  BD 04 01           LDA $104,X      ;GET OLD P STATUS
05069  FF7B  29 10              AND #$10        ;BREAK FLAG?
05070  FF7D  F0 03              BEQ PULS1       ;...NO
05071  FF7F  6C 16 03           JMP (CBINV)     ;...YES...BREAK INSTR
05072  FF82  6C 14 03    PULS1  JMP (CINV)      ;...IRQ
05073  FF85              .END
05074  FF85              .LIB   VECTORS














































JUMP TABLE/VECTORS......PAGE 0080

LINE# LOC   CODE        LINE


05076  FF85                     *=$FF8A         ;NEW VECTORS FOR BASIC
05077  FF8A  4C 52 FD           JMP RESTOR      ;RESTORE VECTORS TO INITIAL SYSTEM
05078  FF8D  4C 57 FD           JMP VECTOR      ;CHANGE VECTORS FOR USER
05079  FF90                     * =$FF90
05080  FF90  4C 66 FE           JMP SETMSG      ;CONTROL O.S. MESSAGES
05081  FF93  4C C0 EE           JMP SECND       ;SEND SA AFTER LISTEN
05082  FF96  4C CE EE           JMP TKSA        ;SEND SA AFTER TALK
05083  FF99  4C 73 FE           JMP MEMTOP      ;SET/READ TOP OF MEMORY
05084  FF9C  4C 82 FE           JMP MEMBOT      ;SET/READ BOTTOM OF MEMORY
05085  FF9F  4C 1E EB           JMP SCNKEY      ;SCAN KEYBOARD
05086  FFA2  4C 6F FE           JMP SETTMO      ;SET TIMEOUT IN IEEE
05087  FFA5  4C 19 EF           JMP ACPTR       ;HANDSHAKE IEEE BYTE IN
05088  FFA8  4C E4 EE           JMP CIOUT       ;HANDSHAKE IEEE BYTE OUT
05089  FFAB  4C F6 EE           JMP UNTLK       ;SEND UNTALK OUT IEEE
05090  FFAE  4C 04 EF           JMP UNLSN       ;SEND UNLISTEN OUT IEEE
05091  FFB1  4C 17 EE           JMP LISTN       ;SEND LISTEN OUT IEEE
05092  FFB4  4C 14 EE           JMP TALK        ;SEND TALK OUT IEEE
05093  FFB7  4C 57 FE           JMP READSS      ;RETURN I/O STATUS BYTE
05094  FFBA  4C 50 FE           JMP SETLFS      ;SET LA, FA, SA
05095  FFBD  4C 49 FE           JMP SETNAM      ;SET LENGTH AND FN ADR
05096  FFC0  6C 1A 03    OPEN   JMP (IOPEN)     ;OPEN LOGICAL FILE
05097  FFC3  6C 1C 03    CLOSE  JMP (ICLOSE)    ;CLOSE LOGICAL FILE
05098  FFC6  6C 1E 03    CHKIN  JMP (ICHKIN)    ;OPEN CHANNEL IN
05099  FFC9  6C 20 03    CKOUT  JMP (ICKOUT)    ;OPEN CHANNEL OUT
05100  FFCC  6C 22 03    CLRCH  JMP (ICLRCH)    ;CLOSE I/O CHANNEL
05101  FFCF  6C 24 03    BASIN  JMP (IBASIN)    ;INPUT FROM CHANNEL
05102  FFD2  6C 26 03    BSOUT  JMP (IBSOUT)    ;OUTPUT TO CHANNEL
05103  FFD5  4C 42 F5           JMP LOADSP      ;LOAD FROM FILE
05104  FFD8  4C 75 F6           JMP SAVESP      ;SAVE TO FILE
05105  FFDB  4C 67 F7           JMP SETTIM      ;SET INTERNAL CLOCK
05106  FFDE  4C 60 F7           JMP RDTIM       ;READ INTERNAL CLOCK
05107  FFE1  6C 28 03    STOP   JMP (ISTOP)     ;SCAN STOP KEY
05108  FFE4  6C 2A 03    GETIN  JMP (IGETIN)    ;GET CHAR FROM Q
05109  FFE7  6C 2C 03    CLALL  JMP (ICLALL)    ;CLOSE ALL FILES
05110  FFEA  4C 34 F7           JMP UDTIM       ;INCREMENT CLOCK
05111  FFED  4C 05 E5    JSCROG JMP SCRORG      ;SCREEN ORG
05112  FFF0  4C 0A E5    JPLOT  JMP PLOT        ;READ/SET X,Y COORD
05113  FFF3  4C 00 E5    JIOBAS JMP IOBASE      ;RETURN I/O BASE
05114  FFF6                     *=$FFFA
05115  FFFA  A9 FE              .WOR NMI        ;PROGRAM DEFINEABLE
05116  FFFC  22 FD              .WOR START      ;INITIALIZATION CODE
05117  FFFE  72 FF              .WOR PULS       ;INTERRUPT HANDLER
05118  0000              .END
05119  0000              .END


ERRORS = 00000


SYMBOL TABLE

SYMBOL VALUE
 A0IN1    FD41    A0IN2    FD4C    A0INT    FD3F    ACC      0003
 ACP00    EF2E    ACP00A   EF21    ACP00B   EF3C    ACP00C   EF45








SYMBOL TABLE

SYMBOL VALUE
 ACP01    EF54    ACP03    EF58    ACP03A   EF66    ACP04    EF7F
 ACPTR    EF19    AROUND   EF96    AUTODN   0292    BACK     E8F7
 BAD      0100    BADRAM   FDEB    BAK1UP   E785    BAKBAK   E8AB
 BASIN    FFCF    BASZPT   00FF    BAUDO    FF5C    BAUDOF   0299
 BDF      0002    BDFH     0004    BIT010   F031    BIT020   F035
 BITCI    00A8    BITCNT   F027    BITNUM   0298    BITTS    00B4
 BK1      E78B    BK15     E78E    BK2      E79F    BKLN     E72D
 BKLN1    E737    BLF      0001    BLNCT    00CD    BLNK2    F7FE
 BLNON    00CF    BLNSW    00CC    BLUE     0006    BMT1     E9F0
 BN10     F21D    BN20     F22A    BN30     F264    BN31     F26A
 BN32     F26B    BN35     F26C    BN50     F26F    BN52     F279
 BO10     F285    BO20     F28B    BO50     F2B9    BREAK    F6CB
 BREAKE   F0A5    BSI010   F15D    BSI232   F14F    BSIT     FDF1
 BSIV     FCFB    BSO100   F0FC    BSO110   F102    BSO232   F0ED
 BSOUR    0095    BSOUR1   00A4    BSOUT    FFD2    BUF      0200
 BUFPT    00A6    BUFSZ    00C0    C3P0     0094    CAS1     00C0
 CASOUT   F290    CBINV    0316    CBIT     0064    CCTTA2   ED21
 CCTTA3   ED69    CHK1A    E914    CHK1B    E91D    CHKBAK   E8E8
 CHKCOL   E912    CHKDWN   E8FA    CHKIN    FFC6    CHKLUP   E8EC
 CHKMEM   FE91    CI2      EEED    CI4      EEF2    CINT     E518
 CINV     0314    CIOUT    EEE4    CK10     F31B    CK15     F328
 CK20     F318    CK30     F32E    CK40     F332    CK5      F311
 CK50     F33F    CK60     F342    CKDSRX   F0E8    CKERR    0020
 CKI010   F12B    CKI020   F138    CKI080   F13F    CKI090   F144
 CKI100   F146    CKI232   F116    CKIT     EB63    CKIT1    EB71
 CKIT2    EBBA    CKIT3    EBC4    CKO020   F0CD    CKO030   F0D4
 CKO040   F0E1    CKO100   F0EB    CKO232   F0BC    CKOUT    FFC9
 CKUT     EB62    CLALL    FFE7    CLALL2   F403    CLEAR1   E57B
 CLKHI    EF84    CLKLO    EF8D    CLOSE    FFC3    CLP1     E6A8
 CLP2     E691    CLP21    E6A6    CLP2A    E6A3    CLP5     E621
 CLP6     E62A    CLP7     E6B6    CLR10    EA95    CLRCH    FFCC
 CLRLN    EA8D    CLS010   F37F    CLS020   F384    CLSEI    F6DA
 CLSEI2   F6EF    CLSR     E55F    CMP0     00B0    CMPSTE   FD11
 CNC3     E7AE    CNC3X    E778    CNTDN    00A5    COLM     9120
 COLOR    0286    COLR1    E7FA    COLTAB   E921    CONTRL   EDA3
 COUNT    00A5    CR       000D    CRSW     00D0    CS10     F8AB
 CS25     F8B5    CS30     F89B    CS40     F89E    CSBERR   EEB9
 CSTE1    F894    CSTE2    F8B7    CTSERR   F019    CURS10   E7EC
 D1ACR    911B    D1DDRA   9113    D1DDRB   9112    D1IER    911E
 D1IFR    911D    D1ORA    911F    D1ORAH   9111    D1ORB    9110
 D1PCR    911C    D1SR     911A    D1T1H    9115    D1T1L    9114
 D1T1LH   9117    D1T1LL   9116    D1T2H    9119    D1T2L    9118
 D2ACR    912B    D2DDRA   9123    D2DDRB   9122    D2IER    912E
 D2IFR    912D    D2ORA    912F    D2ORAH   9121    D2ORB    9120
 D2PCR    912C    D2SR     912A    D2T1H    9125    D2T1L    9124
 D2T1LH   9127    D2T1LL   9126    D2T2H    9129    D2T2L    9128
 DATA     00D7    DATAHI   E4A0    DATALO   E4A9    DEBPIA   E4B2
 DELAY    028C    DFLTN    0099    DFLTO    009A    DIFF     00B5
 DLABYE   EF09    DLAD00   EF0F    DLADLH   EF0C    DNLINE   E909
 DPSW     009C    DSPP     EAA1    DSPP2    EAAA    DSRERR   F016
 DWNBYE   E911    DWNCHK   E8FE    EAH      00AF    EAL      00AE
 EOIACP   EF29    EOT      0005    EREXIT   F7AC    ERR232   F0AA
 ERROR1   F77E    ERROR2   F781    ERROR3   F784    ERROR4   F787
 ERROR5   F78A    ERROR6   F78D    ERROR7   F790    ERROR8   F793
 ERROR9   F796    FA       00BA    FAF      F867    FAF20    F874








SYMBOL TABLE

SYMBOL VALUE
 FAF30    F888    FAF40    F889    FAH      F7AF    FAH40    F7E6
 FAH45    F7E4    FAH50    F7CE    FAH55    F7DA    FAT      0263
 FINDST   E719    FINX     E720    FIRT     00A4    FLGS     0002
 FNADR    00BB    FNDEND   E5A8    FNDSTR   E58B    FNLEN    00B7
 FRAMEE   F0A8    FREKZP   00FB    FRMERR   EEB7    FSBLK    00BE
 GDBLN    00CE    GDCOL    0287    GETIN    FFE4    GETTOP   FE75
 GN10     F201    GN232    F205    GOTDWN   E7F4    HIBASE   0288
 IBASIN   0324    IBSOUT   0326    ICHKIN   031E    ICKOUT   0320
 ICLALL   032C    ICLOSE   031C    ICLRCH   0322    IGETIN   032A
 ILOAD    0330    INBIT    00A7    INCR     FD21    INCSAL   FD1B
 INDX     00C8    INITV    E5C3    INS1     E84C    INS2     E851
 INS3     E845    INSEXT   E86D    INSRT    00D8    INVH     0007
 INVL     0008    IOBASE   E500    IOINIT   FDF9    IOKEYS   FE39
 IOPEN    031A    IRQTMP   029F    ISAVE    0332    ISOUR    EE49
 ISOURA   EE40    ISR01    EE73    ISR02    EE5A    ISR03    EE60
 ISR04    EEA5    ISRCLK   EE8B    ISRHI    EE88    ISTOP    0328
 ITSSET   E4E1    JIOBAS   FFF3    JLTLK    F3D4    JPL2     E8B8
 JPL3     E7F7    JPL4     E7D4    JPL5     E8E5    JPLOT    FFF0
 JRAD2    F9E2    JSCROG   FFED    JTG10    F260    JTG35    F244
 JTG36    F24A    JTG37    F24D    JTGET    F250    JTP10    F2AA
 JTP20    F88A    JX050    F351    JX115    F38D    JX120    F3AE
 JX150    F3B1    JX170    F3CD    JX310    F2CF    JX315    F2E3
 JX320    F2EC    JX330    F2F0    JX340    F2FE    JX350    F301
 JX600    F3D6    JX750    F3FC    JXRMV    F3B2    JZ100    F3DF
 JZ101    F3EE    KEEPIT   E815    KEY      EABF    KEY3     EB01
 KEY4     EAEF    KEY5     EAEA    KEYCOD   EC46    KEYD     0277
 KEYLG2   EC0F    KEYLOG   028F    KEYTAB   00F5    KL2      EB12
 KL24     EB0A    KOUNT    028B    KPREND   EB15    KSP2     E4BC
 KSP3     E4CF    KSP4     E4E7    LA       00B8    LAT      0259
 LBERR    0008    LD10     F553    LD100    F5CA    LD102    F5D1
 LD104    F5D9    LD110    F65F    LD112    F5E1    LD115    F669
 LD150    F5EE    LD170    F5F5    LD177    F604    LD178    F611
 LD179    F615    LD180    F641    LD190    F646    LD20     F556
 LD25     F563    LD40     F58A    LD410    F672    LD45     F598
 LD50     F5B3    LD60     F5B5    LD64     F5BB    LD90     F5C7
 LDAD1    F854    LDTB1    00D9    LDTB2    EDFD    LDTND    0098
 LINTMP   00F2    LINZ0    1000    LINZ1    1016    LINZ10   10DC
 LINZ11   10F2    LINZ12   1108    LINZ13   111E    LINZ14   1134
 LINZ15   114A    LINZ16   1160    LINZ17   1176    LINZ18   118C
 LINZ19   11A2    LINZ2    102C    LINZ20   11B8    LINZ21   11CE
 LINZ22   11E4    LINZ3    1042    LINZ4    1058    LINZ5    106E
 LINZ6    1084    LINZ7    109A    LINZ8    10B0    LINZ9    10C6
 LIST1    EE1C    LIST2    EE2B    LIST5    EE38    LISTN    EE17
 LLEN     0016    LLEN2    002C    LNMX     00D5    LOAD     F546
 LOADSP   F542    LOCK     ED3F    LODING   F66A    LOOKUP   F3CF
 LOOP2    E6DC    LOOP3    E5E8    LOOP4    E5E5    LOOP5    E64F
 LOP2     E6E4    LOP5     E657    LOP51    E674    LOP52    E684
 LOP53    E688    LOP54    E67E    LOWER    ED21    LP1      E5D4
 LP2      E5CF    LP21     E602    LP22     E619    LP23     E60E
 LPS1     E568    LPS2     E570    LSTP     00CA    LSTSHF   028E
 LSTX     00C5    LSXP     00C9    LUKING   F647    M51AJB   0295
 M51CDR   0294    M51CTR   0293    MAXCHR   0058    MEMBOT   FE82
 MEMSIZ   0283    MEMSTR   0281    MEMTCF   F53C    MEMTOP   FE73
 MEMUSS   00C3    MLP4     E9D6    MLP42    E9DF    MODE     0291
 MODE1    EC5E    MODE2    EC9F    MODE3    ECE0    MOVOS1   FD5D








SYMBOL TABLE

SYMBOL VALUE
 MOVOS2   FD64    MS1      F174    MS10     F1BD    MS11     F1C5
 MS17     F1D7    MS18     F1DE    MS21     F1CD    MS5      F180
 MS6      F18B    MS7      F18F    MS8      F1A2    MSG      F1E6
 MSG10    F1F3    MSGFLG   009D    MYCH     00BF    NBASIN   F20E
 NBSOUT   F27A    NC1      E7B7    NC2      E7BE    NC3      E6CB
 NC3W     E7B1    NCHKIN   F2C7    NCKOUT   F309    NCLALL   F3EF
 NCLOSE   F34A    NCLRCH   F3F3    NCTRL    EC18    NCX2     E7D9
 NCZ2     E7D6    NDX      00C6    NEWCH    FBDB    NEWLIN   E9EE
 NEWLX    EA08    NGETIN   F1F5    NJT1     E75D    NJT8     E769
 NJT9     E76B    NLINES   0017    NLOAD    F549    NMI      FEA9
 NMINV    0318    NMIRTI   FF56    NMIRTN   FEFF    NNMI     FEAD
 NNMI10   FEB2    NNMI18   FEBF    NNMI19   FEC7    NNMI20   FEDE
 NNMI30   FF02    NNMI40   FF2C    NNMI42   FF38    NODEV    EEB4
 NOEOI    EE66    NOHALF   E536    NOMEM    FEA4    NOPEN    F40A
 NOTKAT   EC33    NOTONE   E672    NSAVE    F685    NSTOP    F770
 NTCN     E771    NTCN1    E7AA    NVS      E6CD    NVS1     E6D3
 NWRAP    0004    NXLN     E8C3    NXLN1    E8CF    NXLN2    E8C7
 NXT1     E8D8    NXT2     E893    NXT3     E6C7    NXT33    E6C5
 NXT6     E89B    NXT61    E8B1    NXTBIT   00B5    NXTD     E581
 NXTX     E800    NXTX1    E81D    NXTXA    E823    OCHAR    00BD
 OP100    F419    OP110    F422    OP150    F444    OP152    F44B
 OP155    F453    OP160    F46C    OP170    F46F    OP171    F482
 OP172    F491    OP175    F493    OP180    F494    OP200    F478
 OP35     F4B2    OP40     F4B8    OP45     F4C2    OP50     F4C5
 OP98     F411    OPEN     FFC0    OPENI    F495    OPN010   F4F4
 OPN020   F4D9    OPN025   F4E7    OPN030   F50C    OPN050   F51B
 OPN055   F527    OPN060   F533    OPN232   F4C7    OUTFN    F659
 OUTHRE   ED3C    PANIC    E5BB    PATCH2   E4BC    PATCH3   E4C1
 PATCH4   E4CC    PATCHX   ED5B    PATOUT   E715    PCH      0000
 PCL      0001    PCNTR    00A3    PLF      0003    PLOT     E50A
 PLOT10   E513    PNT      00D1    PNTR     00D3    PREND    FF56
 PRP      00B6    PRT      E742    PRTY     009B    PTR1     009E
 PTR2     009F    PULS     FF72    PULS1    FF82    PUTQUE   EBD0
 PX4      E5C5    QTSW     00D4    QTSWC    E6B8    QTSWL    E6C4
 R2D2     00A3    RAD2     FA60    RAD2X    FA6C    RAD2Y    FA68
 RAD3     FA25    RAD4     FA47    RAD5     F9F3    RADBK    FA22
 RADJ     FAAD    RADK     FAA0    RADL     F9F1    RADP     FA19
 RADQ2    FA91    RADX2    F9ED    RAMTAS   FD8D    RAMTBT   FDA3
 RAMTZ0   FD90    RAMTZ1   FDAF    RAMTZ2   FDB5    RAMTZ3   FDCF
 RAMTZ4   FDD2    RAMTZ5   FDDE    RBLK     F8C0    RD10     FAD7
 RD12     FAD3    RD15     FABD    RD160    FB95    RD161    FB97
 RD167    FBA0    RD175    FBAC    RD180    FBCF    RD20     FADA
 RD200    FAF6    RD22     FAF0    RD300    FBD2    RD40     FB07
 RD52     FB7C    RD55     FB80    RD58     FB55    RD59     FB87
 RD60     FB0D    RD70     FB1B    RD80     FB38    RD90     FB90
 RDBK     FA06    RDBK2    FAAA    RDFLG    00AA    RDTIM    F760
 READ     F98E    READSS   FE57    READST   FE68    RECERR   F0A2
 REKEY    EB74    REPDO    EACC    RER      00A8    RESTOR   FD52
 REZ      00A9    RIBUF    00F7    RIDATA   00AA    RIDBE    029B
 RIDBS    029C    RINONE   00A9    RIPRTY   00AB    RJDJ     F9C3
 ROBUF    00F9    RODATA   00B6    RODBE    029E    RODBS    029D
 ROPRTY   00BD    ROUT1    FA30    ROUT2    FA2E    ROWS     9121
 RPT10    EB84    RPT20    EBA1    RPT40    EBAB    RPTFLG   028A
 RS232    F0B9    RSODNE   F021    RSP232   F160    RSPEXT   EFCF
 RSPNO    EFDA    RSPOFF   F166    RSPOK    F172    RSR018   F04B








SYMBOL TABLE

SYMBOL VALUE
 RSR020   F04D    RSR030   F06F    RSR031   F081    RSR032   F089
 RSR050   F09D    RSR060   F0B3    RSRABL   F05B    RSRCVR   F036
 RSREXT   F04A    RSRSXT   F062    RSRTRT   F068    RSSTAT   0297
 RST005   EFB0    RST010   EFBF    RST030   EFDE    RST040   EFE4
 RST050   EFE8    RST060   EFFB    RST070   F004    RST080   F006
 RSTBGN   EFEE    RSTEXT   EFB9    RSTOR    F2AF    RSTOR1   F2B8
 RSTRAB   EFA3    RSWEXT   EFCE    RUNTB    EDF4    RVS      00C7
 SA       00B9    SAH      00AD    SAL      00AC    SAT      026D
 SAVE     F682    SAVESP   F675    SAVING   F728    SBERR    0004
 SCATN    EEC5    SCCL     E8BB    SCD10    EA16    SCD20    EA62
 SCN20    EB40    SCN30    EB4A    SCNKEY   EB1E    SCNOUT   EB8F
 SCNRTS   EBD6    SCOLOR   EAB2    SCR10    E989    SCR40    EA2C
 SCR41    E99D    SCRD19   EA3F    SCRD21   EA31    SCRD22   EA44
 SCRL3    E9AC    SCRL5    E9A2    SCRLIN   EA56    SCRO0    E981
 SCROL    E975    SCRORG   E505    SECND    EEC0    SETBOT   FE8A
 SETLFS   FE50    SETMSG   FE66    SETNAM   FE49    SETPNT   EA7E
 SETTIM   F767    SETTMO   FE6F    SETTOP   FE7B    SFDX     00CB
 SHCNH    00AB    SHCNL    00A7    SHFLAG   028D    SHFLOG   EBDC
 SHFOUT   EC43    SIXTY    4289    SKIPBY   F675    SKIPIT   F770
 SNSW1    00B4    SP       0006    SPCK2    EB60    SPERR    0010
 SPMSG    F1E2    SRER     F9E5    STAH     00C2    STAL     00C1
 START    FD22    START1   FD2F    STATUS   0090    STDONE   E5B2
 STKEY    0091    STKY     FCF6    STOK     E597    STOP     FFE1
 STOP2    F77D    STOP3    F957    STOP4    F95C    STPTCH   E4CF
 STT1     F95D    STT2     F972    STT3     F979    STUPT    E587
 SV10     F689    SV100    F6F1    SV102    F6F8    SV105    F705
 SV106    F70F    SV110    F726    SV115    F727    SV20     F68C
 SV25     F69D    SV30     F6BC    SV40     F6D2    SV50     F6D7
 SVXT     0092    SWITCH   EC00    SYNO     0096    T1       009E
 T2       009F    TALK     EE14    TAPE     F8F4    TAPE1    00B2
 TAPEH    F7E7    TBLA0E   FD52    TBLA0R   FD4D    TBLX     00D6
 TBUFFR   033C    TEMP     00B1    TH20     F822    TH30     F834
 TH40     F84C    TIMB     FED2    TIME     00A0    TIMOUT   0285
 TKATN    EED3    TKATN1   EEDD    TKSA     EECE    TMP0     00C1
 TMP2     00C3    TMPC     009F    TNIF     FCCF    TNIQ     FCF4
 TNOF     FD08    TOFROM   EA6E    TP32     F923    TP35     F925
 TP40     F92F    TRD      F8C9    TSTOP    F94B    TVIC     EDE4
 TWRT     F8E6    TWRT2    F8EA    TWRT3    F8ED    UD20     F736
 UD30     F740    UD60     F755    UDST     FE6A    UDTIM    F734
 UHUH     E82A    UNKAT    E953    UNLOCK   ED4D    UNLSN    EF04
 UNTLK    EEF6    UP2      E879    UP5      E831    UP6      E874
 UP9      E870    UPALIN   E88E    UPPER    ED30    USER     00F3
 USRCMD   032E    VECTOR   FD57    VECTSE   FD8D    VECTSS   FD6D
 VERCK    0093    VICCOL   9400    VICREG   9000    VICSCN   1000
 VPAN     E5B5    VPRTY    FBB6    W1MS     EF96    W1MS1    EF9B
 WBLK     F8E3    WHITE    0001    WLGRTS   E72C    WLOG10   E723
 WLOG20   E701    WLOG30   E70E    WLOGIC   E6EA    WREND    FC9C
 WRITE    FBEA    WRNC     FC95    WRT1     FBF3    WRT2     FC4A
 WRT3     FC47    WRT4     FC8C    WRT6     FC6E    WRT61    FC6A
 WRT7     FC7D    WRTBK    FC92    WRTL3    FC06    WRTN     FC0B
 WRTN1    FC21    WRTN2    FC2E    WRTS     FC54    WRTS1    FC60
 WRTW     FBF1    WRTX     FBF5    WRTZ     FCA8    XMAX     0289
 XR       0004    XSAV     0097    YR       0005    ZZZ      F84D


END OF ASSEMBLY
